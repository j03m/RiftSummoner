function transformAsset(e){var t="-"+jc.assetCategory;return"-iphone"==t&&(t=""),e.replace(jc.assetWildCard,t)}function ajax(e){var t,i=e.url,n=e.method||"GET",a=e.success||function(){},r=e.failure||function(){},s=e.data||{};try{t=new XMLHttpRequest}catch(o){throw"Couldn't create xmlhttp = "+o}t.onreadystatechange=function(e){return function(){4==t.readyState&&(200==t.status?a(e,{status:t.status,response:t.responseText}):r(e,{status:t.status,response:t.responseText}))}}(e),t.open(n,i),t.send(s)}var jc=jc||{},tracers={general:0,touch:0,touchcore:0,touchid:0,touchout:0,mouse:0,states:0,sprite:0,move:0,updatetime:0,memory:0,tests:0,requestManager:0,gameplay:0,mainLayer:0,resource:0,camera:0,console:1,zerverpipe:0,resource:0,ui:0,scroller:1,utilEffects:1};jc.log=function(e,t){for(var i=0;i<e.length;i++)if(1!=tracers[e[i]])return;"string"==typeof t||t instanceof String?cc.log(JSON.stringify(e)+": "+t):cc.log(JSON.stringify(e)+": "+JSON.stringify(t))},jc.clone=function(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var i in e)t[i]=jc.clone(e[i]);return t};var jc=jc||{};jc.isBrowser="undefined"==typeof window?!1:!0,!function(){var e=this,t=e._,i={},n=Array.prototype,a=Object.prototype,r=Function.prototype,s=n.push,o=n.slice,c=n.concat,h=a.toString,l=a.hasOwnProperty,d=n.forEach,u=n.map,p=n.reduce,f=n.reduceRight,g=n.filter,m=n.every,v=n.some,y=n.indexOf,w=n.lastIndexOf,b=Array.isArray,S=Object.keys,T=r.bind,k=function(e){return e instanceof k?e:this instanceof k?(this._wrapped=e,void 0):new k(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports._=k):e._=k,k.VERSION="1.5.1";var P=k.each=k.forEach=function(e,t,n){if(null!=e)if(d&&e.forEach===d)e.forEach(t,n);else if(e.length===+e.length){for(var a=0,r=e.length;r>a;a++)if(t.call(n,e[a],a,e)===i)return}else for(var s in e)if(k.has(e,s)&&t.call(n,e[s],s,e)===i)return};k.map=k.collect=function(e,t,i){var n=[];return null==e?n:u&&e.map===u?e.map(t,i):(P(e,function(e,a,r){n.push(t.call(i,e,a,r))}),n)};var j="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(e,t,i,n){var a=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return n&&(t=k.bind(t,n)),a?e.reduce(t,i):e.reduce(t);if(P(e,function(e,r,s){a?i=t.call(n,i,e,r,s):(i=e,a=!0)}),!a)throw new TypeError(j);return i},k.reduceRight=k.foldr=function(e,t,i,n){var a=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return n&&(t=k.bind(t,n)),a?e.reduceRight(t,i):e.reduceRight(t);var r=e.length;if(r!==+r){var s=k.keys(e);r=s.length}if(P(e,function(o,c,h){c=s?s[--r]:--r,a?i=t.call(n,i,e[c],c,h):(i=e[c],a=!0)}),!a)throw new TypeError(j);return i},k.find=k.detect=function(e,t,i){var n;return C(e,function(e,a,r){return t.call(i,e,a,r)?(n=e,!0):void 0}),n},k.filter=k.select=function(e,t,i){var n=[];return null==e?n:g&&e.filter===g?e.filter(t,i):(P(e,function(e,a,r){t.call(i,e,a,r)&&n.push(e)}),n)},k.reject=function(e,t,i){return k.filter(e,function(e,n,a){return!t.call(i,e,n,a)},i)},k.every=k.all=function(e,t,n){t||(t=k.identity);var a=!0;return null==e?a:m&&e.every===m?e.every(t,n):(P(e,function(e,r,s){return(a=a&&t.call(n,e,r,s))?void 0:i}),!!a)};var C=k.some=k.any=function(e,t,n){t||(t=k.identity);var a=!1;return null==e?a:v&&e.some===v?e.some(t,n):(P(e,function(e,r,s){return a||(a=t.call(n,e,r,s))?i:void 0}),!!a)};k.contains=k.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},k.invoke=function(e,t){var i=o.call(arguments,2),n=k.isFunction(t);return k.map(e,function(e){return(n?t:e[t]).apply(e,i)})},k.pluck=function(e,t){return k.map(e,function(e){return e[t]})},k.where=function(e,t,i){return k.isEmpty(t)?i?void 0:[]:k[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},k.findWhere=function(e,t){return k.where(e,t,!0)},k.max=function(e,t,i){if(!t&&k.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&k.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return P(e,function(e,a,r){var s=t?t.call(i,e,a,r):e;s>n.computed&&(n={value:e,computed:s})}),n.value},k.min=function(e,t,i){if(!t&&k.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&k.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return P(e,function(e,a,r){var s=t?t.call(i,e,a,r):e;s<n.computed&&(n={value:e,computed:s})}),n.value},k.shuffle=function(e){var t,i=0,n=[];return P(e,function(e){t=k.random(i++),n[i-1]=n[t],n[t]=e}),n};var x=function(e){return k.isFunction(e)?e:function(t){return t[e]}};k.sortBy=function(e,t,i){var n=x(t);return k.pluck(k.map(e,function(e,t,a){return{value:e,index:t,criteria:n.call(i,e,t,a)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};var B=function(e,t,i,n){var a={},r=x(null==t?k.identity:t);return P(e,function(t,s){var o=r.call(i,t,s,e);n(a,o,t)}),a};k.groupBy=function(e,t,i){return B(e,t,i,function(e,t,i){(k.has(e,t)?e[t]:e[t]=[]).push(i)})},k.countBy=function(e,t,i){return B(e,t,i,function(e,t){k.has(e,t)||(e[t]=0),e[t]++})},k.sortedIndex=function(e,t,i,n){i=null==i?k.identity:x(i);for(var a=i.call(n,t),r=0,s=e.length;s>r;){var o=r+s>>>1;i.call(n,e[o])<a?r=o+1:s=o}return r},k.toArray=function(e){return e?k.isArray(e)?o.call(e):e.length===+e.length?k.map(e,k.identity):k.values(e):[]},k.size=function(e){return null==e?0:e.length===+e.length?e.length:k.keys(e).length},k.first=k.head=k.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:o.call(e,0,t)},k.initial=function(e,t,i){return o.call(e,0,e.length-(null==t||i?1:t))},k.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},k.rest=k.tail=k.drop=function(e,t,i){return o.call(e,null==t||i?1:t)},k.compact=function(e){return k.filter(e,k.identity)};var A=function(e,t,i){return t&&k.every(e,k.isArray)?c.apply(i,e):(P(e,function(e){k.isArray(e)||k.isArguments(e)?t?s.apply(i,e):A(e,t,i):i.push(e)}),i)};k.flatten=function(e,t){return A(e,t,[])},k.without=function(e){return k.difference(e,o.call(arguments,1))},k.uniq=k.unique=function(e,t,i,n){k.isFunction(t)&&(n=i,i=t,t=!1);var a=i?k.map(e,i,n):e,r=[],s=[];return P(a,function(i,n){(t?n&&s[s.length-1]===i:k.contains(s,i))||(s.push(i),r.push(e[n]))}),r},k.union=function(){return k.uniq(k.flatten(arguments,!0))},k.intersection=function(e){var t=o.call(arguments,1);return k.filter(k.uniq(e),function(e){return k.every(t,function(t){return k.indexOf(t,e)>=0})})},k.difference=function(e){var t=c.apply(n,o.call(arguments,1));return k.filter(e,function(e){return!k.contains(t,e)})},k.zip=function(){for(var e=k.max(k.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;e>i;i++)t[i]=k.pluck(arguments,""+i);return t},k.object=function(e,t){if(null==e)return{};for(var i={},n=0,a=e.length;a>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},k.indexOf=function(e,t,i){if(null==e)return-1;var n=0,a=e.length;if(i){if("number"!=typeof i)return n=k.sortedIndex(e,t),e[n]===t?n:-1;n=0>i?Math.max(0,a+i):i}if(y&&e.indexOf===y)return e.indexOf(t,i);for(;a>n;n++)if(e[n]===t)return n;return-1},k.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(w&&e.lastIndexOf===w)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var a=n?i:e.length;a--;)if(e[a]===t)return a;return-1},k.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),a=0,r=new Array(n);n>a;)r[a++]=e,e+=i;return r};var D=function(){};k.bind=function(e,t){var i,n;if(T&&e.bind===T)return T.apply(e,o.call(arguments,1));if(!k.isFunction(e))throw new TypeError;return i=o.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(o.call(arguments)));D.prototype=e.prototype;var a=new D;D.prototype=null;var r=e.apply(a,i.concat(o.call(arguments)));return Object(r)===r?r:a}},k.partial=function(e){var t=o.call(arguments,1);return function(){return e.apply(this,t.concat(o.call(arguments)))}},k.bindAll=function(e){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return P(t,function(t){e[t]=k.bind(e[t],e)}),e},k.memoize=function(e,t){var i={};return t||(t=k.identity),function(){var n=t.apply(this,arguments);return k.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},k.delay=function(e,t){var i=o.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},k.defer=function(e){return k.delay.apply(k,[e,1].concat(o.call(arguments,1)))},k.throttle=function(e,t,i){var n,a,r,s=null,o=0;i||(i={});var c=function(){o=i.leading===!1?0:new Date,s=null,r=e.apply(n,a)};return function(){var h=new Date;o||i.leading!==!1||(o=h);var l=t-(h-o);return n=this,a=arguments,0>=l?(clearTimeout(s),s=null,o=h,r=e.apply(n,a)):s||i.trailing===!1||(s=setTimeout(c,l)),r}},k.debounce=function(e,t,i){var n,a=null;return function(){var r=this,s=arguments,o=function(){a=null,i||(n=e.apply(r,s))},c=i&&!a;return clearTimeout(a),a=setTimeout(o,t),c&&(n=e.apply(r,s)),n}},k.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},k.wrap=function(e,t){return function(){var i=[e];return s.apply(i,arguments),t.apply(this,i)}},k.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},k.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},k.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)k.has(e,i)&&t.push(i);return t},k.values=function(e){var t=[];for(var i in e)k.has(e,i)&&t.push(e[i]);return t},k.pairs=function(e){var t=[];for(var i in e)k.has(e,i)&&t.push([i,e[i]]);return t},k.invert=function(e){var t={};for(var i in e)k.has(e,i)&&(t[e[i]]=i);return t},k.functions=k.methods=function(e){var t=[];for(var i in e)k.isFunction(e[i])&&t.push(i);return t.sort()},k.extend=function(e){return P(o.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},k.pick=function(e){var t={},i=c.apply(n,o.call(arguments,1));return P(i,function(i){i in e&&(t[i]=e[i])}),t},k.omit=function(e){var t={},i=c.apply(n,o.call(arguments,1));for(var a in e)k.contains(i,a)||(t[a]=e[a]);return t},k.defaults=function(e){return P(o.call(arguments,1),function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])}),e},k.clone=function(e){return k.isObject(e)?k.isArray(e)?e.slice():k.extend({},e):e},k.tap=function(e,t){return t(e),e};var F=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof k&&(e=e._wrapped),t instanceof k&&(t=t._wrapped);var a=h.call(e);if(a!=h.call(t))return!1;switch(a){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=i.length;r--;)if(i[r]==e)return n[r]==t;var s=e.constructor,o=t.constructor;if(s!==o&&!(k.isFunction(s)&&s instanceof s&&k.isFunction(o)&&o instanceof o))return!1;i.push(e),n.push(t);var c=0,l=!0;if("[object Array]"==a){if(c=e.length,l=c==t.length)for(;c--&&(l=F(e[c],t[c],i,n)););}else{for(var d in e)if(k.has(e,d)&&(c++,!(l=k.has(t,d)&&F(e[d],t[d],i,n))))break;if(l){for(d in t)if(k.has(t,d)&&!c--)break;l=!c}}return i.pop(),n.pop(),l};k.isEqual=function(e,t){return F(e,t,[],[])},k.isEmpty=function(e){if(null==e)return!0;if(k.isArray(e)||k.isString(e))return 0===e.length;for(var t in e)if(k.has(e,t))return!1;return!0},k.isElement=function(e){return!(!e||1!==e.nodeType)},k.isArray=b||function(e){return"[object Array]"==h.call(e)},k.isObject=function(e){return e===Object(e)},P(["Arguments","Function","String","Number","Date","RegExp"],function(e){k["is"+e]=function(t){return h.call(t)=="[object "+e+"]"}}),k.isArguments(arguments)||(k.isArguments=function(e){return!(!e||!k.has(e,"callee"))}),"function"!=typeof/./&&(k.isFunction=function(e){return"function"==typeof e}),k.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},k.isNaN=function(e){return k.isNumber(e)&&e!=+e},k.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==h.call(e)},k.isNull=function(e){return null===e},k.isUndefined=function(e){return void 0===e},k.has=function(e,t){return l.call(e,t)},k.noConflict=function(){return e._=t,this},k.identity=function(e){return e},k.times=function(e,t,i){for(var n=Array(Math.max(0,e)),a=0;e>a;a++)n[a]=t.call(i,a);return n},k.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};O.unescape=k.invert(O.escape);var R={escape:new RegExp("["+k.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+k.keys(O.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(e){k[e]=function(t){return null==t?"":(""+t).replace(R[e],function(t){return O[e][t]})}}),k.result=function(e,t){if(null==e)return void 0;var i=e[t];return k.isFunction(i)?i.call(e):i},k.mixin=function(e){P(k.functions(e),function(t){var i=k[t]=e[t];k.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,i.apply(k,e))}})};var _=0;k.uniqueId=function(e){var t=++_+"";return e?e+t:t},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,E={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(e,t,i){var n;i=k.defaults({},i,k.templateSettings);var a=new RegExp([(i.escape||M).source,(i.interpolate||M).source,(i.evaluate||M).source].join("|")+"|$","g"),r=0,s="__p+='";e.replace(a,function(t,i,n,a,o){return s+=e.slice(r,o).replace(I,function(e){return"\\"+E[e]}),i&&(s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(s+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(s+="';\n"+a+"\n__p+='"),r=o+t.length,t}),s+="';\n",i.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{n=new Function(i.variable||"obj","_",s)}catch(o){throw o.source=s,o}if(t)return n(t,k);var c=function(e){return n.call(this,e,k)};return c.source="function("+(i.variable||"obj")+"){\n"+s+"}",c},k.chain=function(e){return k(e).chain()};var L=function(e){return this._chain?k(e).chain():e};k.mixin(k),P(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];k.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],L.call(this,i)}}),P(["concat","join","slice"],function(e){var t=n[e];k.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){function e(e){var i=!1;return function(){if(i)throw new Error("Callback was already called.");i=!0,e.apply(t,arguments)}}var t,i,n={};t=this,null!=t&&(i=t.async),n.noConflict=function(){return t.async=i,n};var a=function(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i+=1)t(e[i],i,e)},r=function(e,t){if(e.map)return e.map(t);var i=[];return a(e,function(e,n,a){i.push(t(e,n,a))}),i},s=function(e,t,i){return e.reduce?e.reduce(t,i):(a(e,function(e,n,a){i=t(i,e,n,a)}),i)},o=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t};"undefined"!=typeof process&&process.nextTick?(n.nextTick=process.nextTick,n.setImmediate="undefined"!=typeof setImmediate?setImmediate:n.nextTick):"function"==typeof setImmediate?(n.nextTick=function(e){setImmediate(e)},n.setImmediate=n.nextTick):(n.nextTick=function(e){setTimeout(e,0)},n.setImmediate=n.nextTick),n.each=function(t,i,n){if(n=n||function(){},!t.length)return n();var r=0;a(t,function(a){i(a,e(function(e){e?(n(e),n=function(){}):(r+=1,r>=t.length&&n(null))}))})},n.forEach=n.each,n.eachSeries=function(e,t,i){if(i=i||function(){},!e.length)return i();var n=0,a=function(){t(e[n],function(t){t?(i(t),i=function(){}):(n+=1,n>=e.length?i(null):a())})};a()},n.forEachSeries=n.eachSeries,n.eachLimit=function(e,t,i,n){var a=c(t);a.apply(null,[e,i,n])},n.forEachLimit=n.eachLimit;var c=function(e){return function(t,i,n){if(n=n||function(){},!t.length||0>=e)return n();var a=0,r=0,s=0;!function o(){if(a>=t.length)return n();for(;e>s&&r<t.length;)r+=1,s+=1,i(t[r-1],function(e){e?(n(e),n=function(){}):(a+=1,s-=1,a>=t.length?n():o())})}()}},h=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[n.each].concat(t))}},l=function(e,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,[c(e)].concat(i))}},d=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[n.eachSeries].concat(t))}},u=function(e,t,i,n){var a=[];t=r(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){i(e.value,function(i,n){a[e.index]=n,t(i)})},function(e){n(e,a)})};n.map=h(u),n.mapSeries=d(u),n.mapLimit=function(e,t,i,n){return p(t)(e,i,n)};var p=function(e){return l(e,u)};n.reduce=function(e,t,i,a){n.eachSeries(e,function(e,n){i(t,e,function(e,i){t=i,n(e)})},function(e){a(e,t)})},n.inject=n.reduce,n.foldl=n.reduce,n.reduceRight=function(e,t,i,a){var s=r(e,function(e){return e}).reverse();n.reduce(s,t,i,a)},n.foldr=n.reduceRight;var f=function(e,t,i,n){var a=[];t=r(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){i(e.value,function(i){i&&a.push(e),t()})},function(){n(r(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};n.filter=h(f),n.filterSeries=d(f),n.select=n.filter,n.selectSeries=n.filterSeries;var g=function(e,t,i,n){var a=[];t=r(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){i(e.value,function(i){i||a.push(e),t()})},function(){n(r(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};n.reject=h(g),n.rejectSeries=d(g);var m=function(e,t,i,n){e(t,function(e,t){i(e,function(i){i?(n(e),n=function(){}):t()})},function(){n()})};n.detect=h(m),n.detectSeries=d(m),n.some=function(e,t,i){n.each(e,function(e,n){t(e,function(e){e&&(i(!0),i=function(){}),n()})},function(){i(!1)})},n.any=n.some,n.every=function(e,t,i){n.each(e,function(e,n){t(e,function(e){e||(i(!1),i=function(){}),n()})},function(){i(!0)})},n.all=n.every,n.sortBy=function(e,t,i){n.map(e,function(e,i){t(e,function(t,n){t?i(t):i(null,{value:e,criteria:n})})},function(e,t){if(e)return i(e);var n=function(e,t){var i=e.criteria,n=t.criteria;return n>i?-1:i>n?1:0};i(null,r(t.sort(n),function(e){return e.value}))})},n.auto=function(e,t){t=t||function(){};var i=o(e);if(!i.length)return t(null);var r={},c=[],h=function(e){c.unshift(e)},l=function(e){for(var t=0;t<c.length;t+=1)if(c[t]===e)return c.splice(t,1),void 0},d=function(){a(c.slice(0),function(e){e()})};h(function(){o(r).length===i.length&&(t(null,r),t=function(){})}),a(i,function(i){var c=e[i]instanceof Function?[e[i]]:e[i],u=function(e){var s=Array.prototype.slice.call(arguments,1);if(s.length<=1&&(s=s[0]),e){var c={};a(o(r),function(e){c[e]=r[e]}),c[i]=s,t(e,c),t=function(){}}else r[i]=s,n.setImmediate(d)},p=c.slice(0,Math.abs(c.length-1))||[],f=function(){return s(p,function(e,t){return e&&r.hasOwnProperty(t)},!0)&&!r.hasOwnProperty(i)};if(f())c[c.length-1](u,r);else{var g=function(){f()&&(l(g),c[c.length-1](u,r))};h(g)}})},n.waterfall=function(e,t){if(t=t||function(){},e.constructor!==Array){var i=new Error("First argument to waterfall must be an array of functions");return t(i)}if(!e.length)return t();var a=function(e){return function(i){if(i)t.apply(null,arguments),t=function(){};else{var r=Array.prototype.slice.call(arguments,1),s=e.next();s?r.push(a(s)):r.push(t),n.setImmediate(function(){e.apply(null,r)})}}};a(n.iterator(e))()};var v=function(e,t,i){if(i=i||function(){},t.constructor===Array)e.map(t,function(e,t){e&&e(function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),t.call(null,e,i)})},i);else{var n={};e.each(o(t),function(e,i){t[e](function(t){var a=Array.prototype.slice.call(arguments,1);a.length<=1&&(a=a[0]),n[e]=a,i(t)})},function(e){i(e,n)})}};n.parallel=function(e,t){v({map:n.map,each:n.each},e,t)},n.parallelLimit=function(e,t,i){v({map:p(t),each:c(t)},e,i)},n.series=function(e,t){if(t=t||function(){},e.constructor===Array)n.mapSeries(e,function(e,t){e&&e(function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),t.call(null,e,i)})},t);else{var i={};n.eachSeries(o(e),function(t,n){e[t](function(e){var a=Array.prototype.slice.call(arguments,1);a.length<=1&&(a=a[0]),i[t]=a,n(e)})},function(e){t(e,i)})}},n.iterator=function(e){var t=function(i){var n=function(){return e.length&&e[i].apply(null,arguments),n.next()};return n.next=function(){return i<e.length-1?t(i+1):null},n};return t(0)},n.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var y=function(e,t,i,n){var a=[];e(t,function(e,t){i(e,function(e,i){a=a.concat(i||[]),t(e)})},function(e){n(e,a)})};n.concat=h(y),n.concatSeries=d(y),n.whilst=function(e,t,i){e()?t(function(a){return a?i(a):(n.whilst(e,t,i),void 0)}):i()},n.doWhilst=function(e,t,i){e(function(a){return a?i(a):(t()?n.doWhilst(e,t,i):i(),void 0)})},n.until=function(e,t,i){e()?i():t(function(a){return a?i(a):(n.until(e,t,i),void 0)})},n.doUntil=function(e,t,i){e(function(a){return a?i(a):(t()?i():n.doUntil(e,t,i),void 0)})},n.queue=function(t,i){function r(e,t,r,s){t.constructor!==Array&&(t=[t]),a(t,function(t){var a={data:t,callback:"function"==typeof s?s:null};r?e.tasks.unshift(a):e.tasks.push(a),e.saturated&&e.tasks.length===i&&e.saturated(),n.setImmediate(e.process)})}void 0===i&&(i=1);var s=0,o={tasks:[],concurrency:i,saturated:null,empty:null,drain:null,push:function(e,t){r(o,e,!1,t)},unshift:function(e,t){r(o,e,!0,t)},process:function(){if(s<o.concurrency&&o.tasks.length){var i=o.tasks.shift();o.empty&&0===o.tasks.length&&o.empty(),s+=1;var n=function(){s-=1,i.callback&&i.callback.apply(i,arguments),o.drain&&o.tasks.length+s===0&&o.drain(),o.process()},a=e(n);t(i.data,a)}},length:function(){return o.tasks.length},running:function(){return s}};return o},n.cargo=function(e,t){var i=!1,s=[],o={tasks:s,payload:t,saturated:null,empty:null,drain:null,push:function(e,i){e.constructor!==Array&&(e=[e]),a(e,function(e){s.push({data:e,callback:"function"==typeof i?i:null}),o.saturated&&s.length===t&&o.saturated()}),n.setImmediate(o.process)},process:function c(){if(!i){if(0===s.length)return o.drain&&o.drain(),void 0;var n="number"==typeof t?s.splice(0,t):s.splice(0),h=r(n,function(e){return e.data});o.empty&&o.empty(),i=!0,e(h,function(){i=!1;var e=arguments;a(n,function(t){t.callback&&t.callback.apply(null,e)}),c()})}},length:function(){return s.length},running:function(){return i}};return o};var w=function(e){return function(t){var i=Array.prototype.slice.call(arguments,1);t.apply(null,i.concat([function(t){var i=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&a(i,function(t){console[e](t)}))}]))}};n.log=w("log"),n.dir=w("dir"),n.memoize=function(e,t){var i={},n={};t=t||function(e){return e};var a=function(){var a=Array.prototype.slice.call(arguments),r=a.pop(),s=t.apply(null,a);s in i?r.apply(null,i[s]):s in n?n[s].push(r):(n[s]=[r],e.apply(null,a.concat([function(){i[s]=arguments;var e=n[s];delete n[s];for(var t=0,a=e.length;a>t;t++)e[t].apply(null,arguments)}])))};return a.memo=i,a.unmemoized=e,a},n.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},n.times=function(e,t,i){for(var a=[],r=0;e>r;r++)a.push(r);return n.map(a,t,i)},n.timesSeries=function(e,t,i){for(var a=[],r=0;e>r;r++)a.push(r);return n.mapSeries(a,t,i)},n.compose=function(){var e=Array.prototype.reverse.call(arguments);return function(){var t=this,i=Array.prototype.slice.call(arguments),a=i.pop();n.reduce(e,i,function(e,i,n){i.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);n(e,t)}]))},function(e,i){a.apply(t,[e].concat(i))})}};var b=function(e,t){var i=function(){var i=this,n=Array.prototype.slice.call(arguments),a=n.pop();return e(t,function(e,t){e.apply(i,n.concat([t]))},a)};if(arguments.length>2){var n=Array.prototype.slice.call(arguments,2);return i.apply(this,n)}return i};n.applyEach=h(b),n.applyEachSeries=d(b),n.forever=function(e,t){function i(n){if(n){if(t)return t(n);throw n}e(i)}i()},"undefined"!=typeof define&&define.amd?define([],function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:t.async=n}();var spriteDefs={dragon:{name:"dragon",parentOnly:!0,byStep:3,startFrame:1,endFrame:780,targetRadius:100,step:1,animations:{move:{start:178,end:188,delay:.1,type:0},attack:{start:206,end:230,delay:.1,type:1},dead:{start:242,end:255,delay:.1,type:1},idle:{start:178,end:188,delay:.1,type:0}},behavior:"range"},dragonFire:{name:"dragonFire",formalName:"Fire Dragon",details:"These small dragons are aerial terrors that do massive damage to the ground units below them. However, they have a difficulty targeting other air born units. Fire Dragons inflict additional burn damage to targets and splash damage to surrounding units.",elementType:"fire",unitType:2,damageMods:{splashDamage:{damage:50,radius:100},burn:{damage:50,duration:1,interval:.25}},gameProperties:{MaxHP:500,speed:150,damage:250,missile:"fireball",missileOffset:{x:0,y:10},flightAug:{x:25,y:100},missleTarget:"base",movementType:0,targets:1,actionDelays:{attack:5},effectDelays:{attack:1},targetRadius:100,seekRadius:25},inherit:"dragon"},dragonVoid:{name:"dragonVoid",formalName:"Void Dragon",details:"These small dragons are aerial terrors doing massive damage to ground units below but they have a difficulty targeting other air born units.",elementType:"void",unitType:1,special:"None",gameProperties:{MaxHP:700,speed:250,movementType:0,missile:"greenbullet",missileOffset:{x:0,y:10},missleTarget:"base",targets:1,damage:300,actionDelays:{attack:1},effectDelays:{attack:1},targetRadius:100,seekRadius:25},inherit:"dragon"},dwarvenKnight:{name:"dwarvenKnight",parentOnly:!0,targetRadius:20,animations:{move:{start:70,end:93,delay:.02,type:0},attack:{start:100,end:145,delay:.025,type:1},attack2:{start:140,end:180,delay:.025,type:1},attack3:{start:180,end:250,delay:.025,type:1},idle:{start:1,end:60,delay:.02,type:0},dead:{start:300,end:370,delay:.02,type:1}},behavior:"tank"},dwarvenKnightEarth:{name:"dwarvenKnightEarth",formalName:"Dwarven Knight - Earth",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with earth magic these dwarves are particularly hard to kill.",elementType:"earth",unitType:3,gameProperties:{MaxHP:1300,speed:100,movementType:1,targets:1,damage:25,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"dwarvenKnight"},dwarvenKnightFire:{name:"dwarvenKnightFire",formalName:"Dwarven Knight - Fire",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with fire magic, this dwarf is completely immune to fire element attackers.",elementType:"fire",unitType:3,gameProperties:{MaxHP:700,speed:50,movementType:1,targets:1,damage:25,defense:{fire:100},actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"dwarvenKnight"},dwarvenKnightLife:{name:"dwarvenKnightLife",formalName:"Dwarven Knight - Life",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with life magic, this dwarf is immune to poison and life based attackers.",elementType:"life",unitType:3,gameProperties:{MaxHP:700,speed:50,damage:25,movementType:1,targets:1,defense:{life:100},actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"dwarvenKnight"},dwarvenKnightVoid:{name:"dwarvenKnightVoid",formalName:"Dwarven Knight - Void",details:"Dwarven Knights are known for being very difficult to kill. His armor embued with void magic, this dwarf is immune to void powers and drains the life of his targets.",elementType:"void",unitType:3,damageMods:{vampireDrain:{heal:20,damage:20}},gameProperties:{MaxHP:700,speed:50,damage:35,movementType:1,targets:1,defense:{"void":100},actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"dwarvenKnight"},dwarvenKnightWater:{name:"dwarvenKnightWater",formalName:"Dwarven Knight - Water",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with water magic, this dwarf regenerates health over time.",elementType:"water",unitType:3,powers:{regeneration:{heal:20,interval:.5}},gameProperties:{MaxHP:700,speed:50,damage:25,movementType:1,targets:1,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"dwarvenKnight"},elemental1:{name:"elemental1",byStep:2,startFrame:1,endFrame:550,parentOnly:!0,targetRadius:20,animations:{move:{start:41,end:65,delay:.08,type:0},attack:{start:71,end:92,delay:.08,type:1},attack2:{start:101,end:125,delay:.08,type:1},idle:{start:1,end:37,delay:.08,type:0},dead:{start:131,end:152,delay:.08,type:1}},behavior:"tank"},elemental2:{name:"elemental2",parentOnly:!0,targetRadius:20,animations:{move:{start:91,end:126,delay:.02,type:0},attack:{start:131,end:190,delay:.025,type:1},idle:{start:1,end:75,delay:.02,type:0},dead:{start:271,end:330,delay:.02,type:1}},behavior:"range"},elementalEarth:{name:"elementalEarth",formalName:"Stone Elemental",details:"Extraordinarily powerful, but slow moving.",elementType:"earth",unitType:3,special:"None",gameProperties:{MaxHP:2e3,speed:20,damage:100,movementType:1,targets:1,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"elemental1"},elementalFire:{name:"elementalFire",formalName:"Fire Elemental",details:"Extraordinarily powerful, but slow moving. These elementals inflict additional burn damage.",elementType:"fire",unitType:3,damageMods:{burn:{damage:20,duration:1,interval:.25}},gameProperties:{MaxHP:1e3,speed:20,damage:250,movementType:1,targets:1,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"elemental1"},elementalWater:{name:"elementalWater",formalName:"Water Elemental",details:"Fast elemental creatures that fire at range. Water elementals also have regenerative abilities.",elementType:"water",unitType:3,special:"None",powers:{regeneration:{heal:20,interval:.5}},gameProperties:{MaxHP:200,speed:50,damage:75,movementType:1,targets:2,actionDelays:{attack:2},effectDelays:{attack:1},targetRadius:250,seekRadius:25},inherit:"elemental2"},elementalWind:{name:"elementalWind",formalName:"Wind Elemental",details:"Fast elemental creatures that fire at range. Wind elementals have knock back capability.",elementType:"air",unitType:3,damageMods:{knockBack:{distance:30}},gameProperties:{MaxHP:500,speed:70,damage:50,movementType:1,targets:2,actionDelays:{attack:2},effectDelays:{attack:1},targetRadius:250,seekRadius:25},inherit:"elemental2"},elf:{name:"elf",parentOnly:!0,targetRadius:600,byStep:3,startFrame:1,endFrame:1820,animations:{move:{start:244,end:251,delay:.08,type:0},attack:{start:454,end:471,delay:.08,type:1},idle:{start:422,end:432,delay:.08,type:0},dead:{start:287,end:298,delay:.08,type:1}},behavior:"range"},elfEarth:{name:"elfEarth",formalName:"Plains Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. Plains Elves are heartier and faster then their other elven cousins.",elementType:"earth",unitType:4,special:"None",gameProperties:{MaxHP:300,movementType:1,targets:2,damage:35,speed:85,actionDelays:{attack:.5},effectDelays:{attack:1},targetRadius:600},inherit:"elf"},elfFire:{name:"elfFire",formalName:"Fire Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. These elves have arrows that burn their targets alive.",elementType:"earth",unitType:4,special:"None",damageMods:{burn:{damage:25,duration:1,interval:.5}},gameProperties:{MaxHP:100,movementType:1,targets:2,damage:35,speed:55,actionDelays:{attack:.5},effectDelays:{attack:1},targetRadius:600},inherit:"elf"},elfLife:{name:"elfLife",formalName:"Forest Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. Forest Elves deal poison damage with each arrow.",elementType:"life",unitType:4,damageMods:{poison:{damage:10,duration:5,interval:.25}},gameProperties:{MaxHP:100,damage:25,movementType:1,targets:2,missile:"greenbullet",poisonDamage:10,speed:55,actionDelays:{attack:.5},effectDelays:{attack:1},targetRadius:600,seekRadius:25},inherit:"elf"},elfVoid:{name:"elfVoid",formalName:"Dark Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. Touched with Void magic, Dark Elves have the magic arrows that steal life from targets and give it to all allies on the board.",elementType:"void",unitType:4,damageMods:{vampireDistro:{heal:10,damage:20}},gameProperties:{MaxHP:200,damage:45,movementType:1,targets:2,speed:55,actionDelays:{attack:.5},effectDelays:{attack:1},targetRadius:600},inherit:"elf"},gargoyle:{name:"gargoyle",parentOnly:!0,byStep:3,startFrame:1,endFrame:787,flip:!0,animations:{move:{start:1,end:8,delay:.08,type:0},attack:{start:34,end:49,delay:.08,type:1},dead:{start:58,end:73,delay:.08,type:1},idle:{start:1,end:8,delay:.08,type:0}},behavior:"range"},gargoyleFire:{name:"gargoyleFire",formalName:"Fire Demon",details:"An winged creature embued with elemental fire. It possesses magic that it uses to attack other air or ground targets. Fire demons inflict additional burn damage to enemies.",elementType:"fire",unitType:0,special:"Splash Damage, Burn Damage",damageMods:{burn:{damage:5,duration:1,interval:.25}},gameProperties:{MaxHP:200,speed:100,movementType:0,targets:2,damage:50,missile:"greenbullet",splashDamage:5,actionDelays:{attack:.05},effectDelays:{attack:.01},flightAug:{x:25,y:100},targetRadius:25},inherit:"gargoyle"},gargoyleVoid:{name:"gargoyleVoid",formalName:"Void Demon",details:"An winged creature embued with the void. It possesses magic that it uses to destroy other air targets.",elementType:"void",special:"None",gameProperties:{MaxHP:200,movementType:0,targets:2,speed:100,damage:100,missile:"greenbullet",vsAirDamage:5,actionDelays:{attack:.01},effectDelays:{attack:.01},flightAug:{x:25,y:100},targetRadius:25,seekRadius:25},inherit:"gargoyle"},goblin:{name:"goblin",cardIndex:0,portraitXy:{x:181,y:72},formalName:"Goblin Demolition Expert",details:"Goblin demolition experts hurl explosives at enemies. While they don't have an impressive range, they can inflict massive damage on groups of ground enemies.",elementType:"fire",unitType:3,flip:!0,special:"Splash Damage",damageMods:{splashDamage:{damage:100,radius:100},burn:{damage:40,duration:1,interval:.5}},deathMods:{explodeFire:{damage:25,radius:50,burn:{damage:50,duration:5,interval:.5}}},gameProperties:{MaxHP:50,movementType:1,targets:1,missile:"greenbullet",damage:80,speed:55,actionDelays:{attack:.5},effectDelays:{attack:.5},targetRadius:75},animations:{move:{start:80,end:90,delay:.03,type:0},attack:{start:315,end:353,delay:.03,type:1},idle:{start:1,end:60,delay:.05,type:0},dead:{start:450,end:550,delay:.01,type:1}},behavior:"range"},goblinKnight:{name:"goblinKnight",parentOnly:!0,targetRadius:20,animations:{move:{start:70,end:93,delay:.02,type:0},attack:{start:100,end:145,delay:.025,type:1},attack2:{start:140,end:180,delay:.025,type:1},attack3:{start:180,end:250,delay:.025,type:1},idle:{start:1,end:60,delay:.02,type:0},dead:{start:300,end:370,delay:.02,type:1}},behavior:"tank"},goblinKnightBile:{name:"goblinKnightBile",formalName:"Goblin Knight - Plains",details:"Goblin Knights are fast and do reasonable damage. Plains goblins are incredibly fast runners.",elementType:"none",unitType:3,special:"Burn Damage",gameProperties:{MaxHP:200,speed:170,movementType:1,targets:1,damage:25,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"goblinKnight"},goblinKnightBlood:{name:"goblinKnightBlood",cardIndex:0,portraitXy:{x:186,y:265},formalName:"Goblin Knight - Blood",details:"Goblin Knights are fast and do reasonable damage. These blood goblins are tougher, faster then their cousins.",elementType:"none",unitType:3,special:"Burn Damage",gameProperties:{MaxHP:500,speed:80,movementType:1,targets:1,damage:35,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"goblinKnight"},goblinKnightFire:{name:"goblinKnightFire",formalName:"Goblin Knight - Fire",details:"Goblin Knights are fast and do reasonable damage. These fire goblins live near magma in deep caves are resist immune to fire based damage.",elementType:"fire",unitType:3,special:"Resist Fire",gameProperties:{MaxHP:200,speed:80,movementType:1,targets:1,defense:{fire:100},damage:35,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"goblinKnight"},goblinKnightNormal:{name:"goblinKnightNormal",formalName:"Goblin Knight",details:"Goblin Knights are fast and do reasonable damage.",elementType:"none",unitType:3,special:"Resist Fire",gameProperties:{MaxHP:250,speed:70,movementType:1,targets:1,damage:25,actionDelays:{attack:.5},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"goblinKnight"},knight:{name:"knight",parentOnly:!0,targetRadius:200,startFrame:1,endFrame:2050,flip:!0,byStep:3,animations:{move:{start:4,end:27,delay:.08,type:0},attack:{start:144,end:174,delay:.08,type:1},attack2:{start:174,end:206,delay:.08,type:1},dead:{start:387,end:419,delay:.08,type:1},idle:{start:461,end:486,delay:.08,type:0}},behavior:"tank"},knightEarth:{name:"knightEarth",formalName:"Elemental Knight - Earth",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of earth, this unit has almost 2x the health of other elemental knights.",elementType:"earth",unitType:3,special:"None",gameProperties:{MaxHP:1e3,speed:20,damage:160,movementType:1,targets:1,actionDelays:{attack:1},effectDelays:{attack:.05},targetRadius:25},inherit:"knight"},knightFire:{name:"knightFire",formalName:"Elemental Knight - Fire",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of fire, this unit deals additional burn damage to its targets.",elementType:"fire",unitType:3,damageMods:{burn:{damage:50,duration:2,interval:.25}},gameProperties:{MaxHP:500,speed:20,damage:200,movementType:1,targets:1,actionDelays:{attack:1},effectDelays:{attack:.05},targetRadius:20,seekRadius:25},inherit:"knight"},knightVoid:{name:"knightVoid",formalName:"Elemental Knight - Void",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of the void, this unit saps life from nearby enemies, healing itself.",elementType:"void",unitType:3,effect:"blueRadius",powers:{vampireRadius:{damage:10,radius:100,interval:.25}},gameProperties:{MaxHP:500,speed:20,movementType:1,targets:1,damage:160,actionDelays:{attack:1},effectDelays:{attack:.05},targetRadius:25},inherit:"knight"},knightWater:{name:"knightWater",formalName:"Elemental Knight - Water",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of water, this unit also heals any units nearby.",elementType:"water",unitType:3,effect:"blueRadius",gameProperties:{MaxHP:500,movementType:1,targets:1,speed:20,damage:160,actionDelays:{attack:.05},effectDelays:{attack:.05},targetRadius:20,seekRadius:25,heal:30},powers:{healingRadius:{heal:5,interval:.25,radius:100}},inherit:"knight"},monsterbase:{name:"monsterbase",parentOnly:!0,startFrame:1,endFrame:48,byStep:1,animations:{move:{start:145,end:167,delay:.02,type:0},attack:{start:1,end:24,delay:.02,type:1},attack2:{start:25,end:48,delay:.02,type:1},idle:{start:121,end:137,delay:.02,type:0},damage:{start:49,end:60,delay:.02,type:1},dead:{start:72,end:120,delay:.02,type:1}}},ogre:{name:"ogre",formalName:"Ogre",byStep:1,flip:!0,cardIndex:0,portraitXy:{x:241,y:122},details:"Ogres are massive, powerful creatures. Though they are slow movers, you do not want to be at the wrong end of their weapons.",elementType:"none",unitType:3,special:"None",targetRadius:75,startFrame:1,endFrame:204,gameProperties:{movementType:1,targets:1,MaxHP:1500,speed:50,damage:300,actionDelays:{attack:1},effectDelays:{attack:.9},targetRadius:30},animations:{move:{start:50,end:72,delay:.06,type:0},attack:{start:74,end:115,delay:.04,type:1},attack2:{start:122,end:151,delay:.04,type:1},idle:{start:1,end:48,delay:.02,type:0},dead:{start:169,end:203,delay:.06,type:1}},behavior:"tank"},orc:{name:"orc",flip:!0,formalName:"Orc Warrior",details:"Orcs are fast, fierce attackers. What they lack in heavy armor, they make up for in pure tenacity.",elementType:"none",unitType:3,special:"None",gameProperties:{MaxHP:400,speed:55,movementType:1,targets:1,damage:50,actionDelays:{attack:.25},effectDelays:{attack:.5},targetRadius:30},baseOffset:{x:-20,y:-5},byStep:1,animations:{move:{start:18,end:41,delay:.04,type:0},attack:{start:42,end:64,delay:.03,type:1},attack2:{start:66,end:90,delay:.03,type:1},idle:{start:1,end:12,delay:.04,type:0},dead:{start:103,end:130,delay:.04,type:1}},behavior:"tank"},scowerer:{name:"scowerer",formalName:"Void Scavenger",details:"Weak, dog-like creatures that are trained to rush archers and healers. When killed the scowerer will burst and a poison acid will cover anyone nearby.",elementType:"life",unitType:3,flip:!0,special:"None",deathMods:{explodePoison:{damage:200,radius:100,poison:{damage:25,duration:5,interval:.25}}},gameProperties:{MaxHP:10,movementType:1,targets:1,speed:200,damage:25,actionDelays:{attack:.01},effectDelays:{attack:.01},targetRadius:20},animations:{move:{start:170,end:190,delay:.03,type:0},attack:{start:245,end:320,delay:.025,type:1},idle:{start:1,end:1,delay:.03,type:0},dead:{start:460,end:560,delay:.03,type:1}},behavior:"flanker"},shellback:{name:"shellback",formalName:"Shellback Raider",details:"Heavily armored and fast, shellbacks are mindless attack animals trained to lock onto and kill weaker archers and healers.",elementType:"none",unitType:3,special:"None",gameProperties:{MaxHP:400,movementType:1,targets:1,speed:200,damage:25,actionDelays:{attack:.01},effectDelays:{attack:.01},targetRadius:20},animations:{move:{start:70,end:88,delay:.02,type:0},attack:{start:198,end:249,delay:.025,type:1},idle:{start:91,end:151,delay:.02,type:0},dead:{start:283,end:340,delay:.02,type:1}},behavior:"flanker"},snakeThing:{name:"snakeThing",formalName:"Serpent Guardian",details:"Heavily armored and fast, serpent guardians were once summoned to the defense of powerful mages. When summoned, the guardian will attach itself to a range or support unit and guard it until death.",elementType:"none",unitType:3,special:"None",gameProperties:{MaxHP:150,speed:140,movementType:1,targets:1,damage:45,actionDelays:{attack:.2},effectDelays:{attack:.5},targetRadius:20,seekRadius:150},animations:{move:{start:53,end:84,delay:.02,type:0},attack:{start:90,end:150,delay:.025,type:1},idle:{start:10,end:45,delay:.02,type:0},dead:{start:275,end:315,delay:.02,type:1}},behavior:"defender"},spider:{name:"spider",formalName:"Arachnon Guardian",details:"These guardians will choose and defend a target to death dealing heavy damage from their bladed legs and injecting enemies with poison. They do not however, have much armor and are easily killed.",elementType:"life",unitType:3,flip:!0,special:"Poison",damageMods:{poison:{damage:50,duration:5,interval:.5}},gameProperties:{MaxHP:100,speed:200,movementType:1,targets:1,damage:55,actionDelays:{attack:.2},effectDelays:{attack:.5},targetRadius:20,seekRadius:150},animations:{move:{start:164,end:189,delay:.02,type:0},attack:{start:192,end:221,delay:.025,type:1},idle:{start:1,end:32,delay:.02,type:0},dead:{start:332,end:400,delay:.02,type:1}},behavior:"defender"},troll:{name:"troll",formalName:"Goblin Cleric",details:"These small trolls are expert in healing magic. They will stay back, supporting your warriors and healing them in battle.",elementType:"none",unitType:3,special:"Healing",gameProperties:{MaxHP:100,speed:100,movementType:1,targets:2,damage:10,heal:70,actionDelays:{attack:.5,heal:.4},effectDelays:{attack:.05,heal:.05},targetRadius:25},baseOffset:{x:0,y:10},byStep:1,animations:{move:{start:25,end:49,delay:.025,type:0},attack:{start:50,end:71,delay:.02,type:1},idle:{start:1,end:24,delay:.02,type:0},dead:{start:109,end:145,delay:.06,type:1}},behavior:"healer"},wizard:{name:"wizard",formalName:"Goblin Wizard",details:"These goblins are masters of destructive magic and can do serious damage at an impressive range.",elementType:"none",unitType:4,special:"None",gameProperties:{MaxHP:100,movementType:1,targets:2,speed:50,damage:80,missile:"greenbullet",actionDelays:{attack:.05},effectDelays:{attack:.05},targetRadius:300},baseOffset:{x:0,y:10},animations:{move:{start:26,end:48,delay:.05,type:0},attack:{start:49,end:72,delay:.05,type:1},attack2:{start:73,end:97,delay:.05,type:1},idle:{start:1,end:24,delay:.05,type:0},dead:{start:110,end:155,delay:.06,type:1}},behavior:"range"}},missileConfig={greenbullet:{png:"art/greenbullet.png",plist:"art/greenbullet.plist",start:"greenbullet.1.png",effect:"greenBang",frames:27,delay:.02,first:9,speed:400},fireball:{png:"art/fireball.png",plist:"art/fireball.plist",start:"fireball.1.png",effect:"explosion",frames:10,delay:.01,speed:500}},effectsConfig={greenBang:{png:"art/greenBang.png",plist:"art/greenBang.plist",start:"greenBang.1.png",placement:"center",frames:28,delay:.02,times:1},explosion:{png:"art/explosion.png",plist:"art/explosion.plist",start:"explosion.1.png",placement:"bottom",zorder:"behind",frames:27,delay:.01,offset:{x:0,y:50},times:1},blueRadius:{png:"art/blueRadius.png",plist:"art/blueRadius.plist",start:"blueRadius.1.png",frames:23,delay:.05,zorder:"behind",placement:"bottom",offset:{x:0,y:0}},heal:{png:"art/heal.png",plist:"art/heal.plist",start:"heal.5.png",frames:17,delay:.05,placement:"bottom",times:5},teleport:{png:"art/teleport.png",plist:"art/teleport.plist",start:"teleport.1.png",frames:14,delay:.02,placement:"base2base",times:1},movement:{png:"art/touch-iphone4.png",plist:"art/touch-iphone4.plist",start:"movement.1.png",frames:8,delay:.05,placement:"bottom",times:2},characterSelect:{png:"art/touch-iphone4.png",plist:"art/touch-iphone4.plist",start:"characterSelect.1.png",frames:7,delay:.05,placement:"bottom",zorder:"behind"},enemySelection:{png:"art/touch-iphone4.png",plist:"art/touch-iphone4.plist",start:"enemySelection.1.png",frames:7,delay:.05,placement:"base2base",zorder:"behind",times:2},allySelection:{png:"art/touch-iphone4.png",plist:"art/touch-iphone4.plist",start:"allySelection.1.png",frames:7,delay:.05,placement:"base2base",zorder:"behind",times:2},fire:{png:"art/fire.png",plist:"art/fire.plist",start:"fire.1.png",frames:44,delay:.02,placement:"bottom",zorder:"behind",offset:{x:0,y:65}},fire:{name:"fire",png:"art/fire.png",plist:"art/fire.plist",start:"fire.1.png",frames:44,delay:.02,placement:"bottom",zorder:"behind",times:15},poison:{png:"art/poison.png",plist:"art/poison.plist",start:"poison.1.png",frames:50,delay:.02,placement:"bottom"}},powerTiles={fireBall:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Fire4.png",cooldown:2e3,type:"direct",offense:"fireBall"},poisonCloud:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Poison4.png",cooldown:2e3,type:"direct",offense:"poisonCloud"},lightningBolt:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Holy1.png",cooldown:2e3,type:"direct",offense:"lightningBolt"},healing:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Holy5.png",cooldown:2e3,type:"global",offense:"healAll"},leech:{png:"art/powerTiles.png",plist:"art/powerTiles.plist",icon:"Shadow4.png",cooldown:2e3,type:"global",offense:"leechAll"},iceStorm:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Frost5.png",cooldown:2e3,type:"global",offense:"iceStorm"}},globalPowers={fireBall:function(){},poisonCloud:function(e){var t=hotr.arenaScene.layer.teams.a[0].behavior,i=t.allFoesWithinRadiusOfPoint(150,e),n=jc.playEffectAtLocation("explosion",e,1,hotr.arenaScene.layer),a=n.getPosition(),r=n.getTextureRect();
a.y+=r.height,n.setPosition(a);var s=new cc.Color3B;s.r=0,s.b=0,s.g=255,n.setColor(s);for(var o=0;o<i.length;o++)jc.genericPower("poison",void 0,void 0,i[o],{damage:50,duration:5,interval:.5},"life")},lightningBolt:function(){},healAll:function(){},leech:function(){},iceStorm:function(){}},powerAnimationsRequired={healingRadius:["heal"],vampireRadius:["fire","heal"],regeneration:["heal"],splashDamage:["explosion"],vampireDistro:["fire","heal"],vampireDrain:["fire","heal"],knockBack:["greenBang"],burn:["fire"],poison:["poison"],explodePoison:["explosion"],poisonCloud:["explosion","poison"],explodeFire:["explosion"]},powerConfig={healingRadius:function(e){jc.checkPower(e,"healingRadius");for(var t=spriteDefs[e].powers.healingRadius,i=this.allFriendsWithinRadius(t.radius),n=0;n<i.length;n++)GeneralBehavior.heal(this.owner,i[n],t.heal)&&jc.playEffectOnTarget("heal",i[n],this.owner.layer)},vampireRadius:function(e){jc.checkPower(e,"vampireRadius");for(var t=spriteDefs[e].powers.vampireRadius,i=this.allFoesWithinRadius(t.radius),n=0,a=0;a<i.length;a++)GeneralBehavior.applyDamage(i[a],this.owner,t.damage)&&(jc.playTintedEffectOnTarget("fire",i[a],this.owner.layer,!0,255,255,0),n+=t.damage);0!=n&&GeneralBehavior.heal(this.owner,this.owner,n)&&jc.playEffectOnTarget("heal",this.owner,this.owner.layer)},regeneration:function(e){jc.checkPower(e,"regeneration");var t=spriteDefs[e].powers.regeneration;GeneralBehavior.heal(this.owner,this.owner,t.heal)&&jc.playEffectOnTarget("heal",this.owner,this.owner.layer)},splashDamage:function(e){jc.checkPower(e,"splashDamage");var t=spriteDefs[e].damageMods.splashDamage;jc.playEffectOnTarget("explosion",this.locked,this.owner.layer);for(var i=this.allFoesWithinRadiusOfPoint(t.radius,this.locked.getBasePosition()),n=0;n<i.length;n++)GeneralBehavior.applyDamage(i[n],this.owner,t.damage)},explodeFire:function(e){var t=spriteDefs[e].deathMods.explodeFire,i=this.allFoesWithinRadiusOfPoint(t.radius,this.owner.getBasePosition());jc.playEffectOnTarget("explosion",this.locked,this.owner.layer);for(var n=0;n<i.length;n++)GeneralBehavior.applyDamage(i[n],this.owner,t.damage)&&jc.genericPower("burn",e,this.owner,i[n],t.burn)},explodePoison:function(e){var t=spriteDefs[e].deathMods.explodePoison,i=jc.playEffectOnTarget("explosion",this.locked,this.owner.layer),n=new cc.Color3B;n.r=0,n.b=0,n.g=255,i.setColor(n);for(var a=this.allFoesWithinRadiusOfPoint(t.radius,this.locked.getBasePosition()),r=0;r<a.length;r++)GeneralBehavior.applyDamage(a[r],this.owner,t.damage)&&jc.genericPower("poison",e,this.owner,a[r],t.poison)},vampireDistro:function(e){jc.checkPower(e,"vampireDistro");var t=spriteDefs[e].damageMods.vampireDistro,i=this.owner.homeTeam();GeneralBehavior.applyDamage(this.locked,this.owner,t.damage)&&jc.playTintedEffectOnTarget("fire",this.locked,this.owner.layer,!0,255,0,255);for(var n=0;n<i.length;n++)i[n]!=this.owner&&GeneralBehavior.heal(this.owner,i[n],t.heal)&&jc.playEffectOnTarget("heal",i[n],this.owner.layer)},vampireDrain:function(e){jc.checkPower(e,"vampireDrain");var t=spriteDefs[e].damageMods.vampireDrain;GeneralBehavior.applyDamage(this.locked,this.owner,t.damage)&&jc.playTintedEffectOnTarget("fire",this.locked,this.owner.layer,!0,255,0,255),GeneralBehavior.heal(this.owner,this.owner,t.heal)&&jc.playEffectOnTarget("heal",this.owner,this.owner.layer)},knockBack:function(e){jc.checkPower(e,"knockBack");var t=spriteDefs[e].damageMods.knockBack,i=t.distance;this.owner.isFlippedX()&&(i*=-1);var n=this.locked.getBasePosition();n.x+=i;var a=cc.p(this.owner.layer.winSize.width/2,this.owner.layer.winSize.height/2);jc.insideEllipse(jc.elMajor,jc.elMinor,n,a)&&this.locked.setBasePosition(n),jc.playEffectOnTarget("greenBang",this.locked,this.owner.layer)},burn:function(e){jc.genericPower("burn",e,this.owner,this.locked)},"burn-apply":function(e){var t=new cc.Color3B;t.r=255,t.b=0,t.g=0,this.owner.setColor(t),jc.genericPowerApply(e,"fire","burnEffect",this)},"burn-remove":function(){var e=new cc.Color3B;e.r=255,e.b=255,e.g=255,this.owner.setColor(e),jc.genericPowerRemove("burnEffect","fire",this)},poison:function(e){jc.genericPower("poison",e,this.owner,this.locked)},"poison-apply":function(e){var t=new cc.Color3B;t.r=0,t.b=0,t.g=255,this.owner.setColor(t),jc.genericPowerApply(e,"poison","poisonEffect",this)},"poison-remove":function(){var e=new cc.Color3B;e.r=255,e.b=255,e.g=255,this.owner.setColor(e),jc.genericPowerRemove("poisonEffect","poison",this)}},jc=jc||{};jc.assetWildCard="{v}",jc.resolutions={},jc.resolutions.iphone=cc.size(480,320),jc.resolutions.iphone4=cc.size(960,640),jc.setDesignSize=function(e){jc.designSize=e},jc.setActualSize=function(e){jc.actualSize=e},jc.bestAssetDirectory=function(){return jc.isBrowser?jc.bestAssetDirectoryWeb(window,screen):jc.bestAssetDirectoryNative()},jc.bestAssetDirectoryNative=function(){var e=cc.Director.getInstance().getWinSize();return jc.log(["resource"],"director winSize returned: "),jc.log(["resource"],e),jc.bestAssetDirectoryWorker(e)},jc.bestAssetDirectoryWeb=function(e,t){var i,n=Math.ceil(e.devicePixelRatio);return i=e.orientation?cc.size(t.height*n,t.width*n):cc.size(t.width*n,t.height*n),jc.bestAssetDirectoryWorker(i)},jc.bestAssetDirectoryWorker=function(e){var t="",i=0;for(var n in jc.resolutions)jc.resolutions[n].width<=e.width&&jc.resolutions[n].width>i&&(i=jc.resolutions[n].width,t=n);return jc.log(["resource"],"selected: "+t+" for assets dir."),t};var dirImg="art/",dirMusic="sounds/";jc.setDesignSize(jc.resolutions.iphone4),jc.assetCategory=jc.bestAssetDirectory();var arenaSheet=transformAsset(dirImg+"arena.png"),landingPng=transformAsset(dirImg+"landing{v}.png"),landingPlist=transformAsset(dirImg+"landing{v}.plist"),loadingPng=transformAsset(dirImg+"loading{v}.png"),loadingPlist=transformAsset(dirImg+"loading{v}.plist"),cardsPngs=[transformAsset(dirImg+"cards{v}.png")],cardsPlists=[transformAsset(dirImg+"cards{v}.plist")],uiPng=transformAsset(dirImg+"uiElements{v}.png"),uiPlist=transformAsset(dirImg+"uiElements{v}.plist"),shadowPlist=transformAsset(dirImg+"shadowSheet.plist"),shadowPng=transformAsset(dirImg+"shadowSheet.png"),powerTilesPng=transformAsset(dirImg+"powerTiles.png"),powerTilesPlist=transformAsset(dirImg+"powerTiles.plist"),g_characterPngs={},g_characterPlists={},g_maingame=[{src:loadingPlist},{src:arenaSheet},{src:loadingPng},{src:landingPng},{src:landingPlist},{fontName:jc.mainFont,src:[{src:dirImg+"GODOFWAR.TTF",type:"truetype"}]}];for(var entry in spriteDefs)!spriteDefs[entry].parentOnly&&spriteDefs[entry].name&&(g_characterPngs[entry]=transformAsset(dirImg+entry+"Sheet{v}.png"),g_characterPlists[entry]=transformAsset(dirImg+entry+"Sheet{v}.plist"));for(var entry in missileConfig)g_characterPngs[entry]=transformAsset(missileConfig[entry].png),g_characterPlists[entry]=transformAsset(missileConfig[entry].plist);for(var entry in effectsConfig)g_characterPngs[entry]=transformAsset(effectsConfig[entry].png),g_characterPlists[entry]=transformAsset(effectsConfig[entry].plist);var g_battleStuff=[{src:g_characterPngs.teleport},{src:g_characterPlists.teleport},{src:g_characterPngs.characterSelect},{src:g_characterPlists.characterSelect},{src:powerTilesPlist},{src:powerTilesPng},{src:shadowPlist},{src:shadowPng}],g_ui=[{src:uiPlist},{src:uiPng}],g_everything=[];g_everything=g_everything.concat(_.map(g_characterPngs,function(e){return{src:e}})),g_everything=g_everything.concat(_.map(g_characterPlists,function(e){return{src:e}})),g_everything=g_everything.concat(_.map(g_battleStuff,function(e){return e}));var hotr=hotr||{};hotr.blobOperations={},hotr.scratchBoard={},hotr.formationSize=12,hotr.authTokenLocalStoreKey="x1xauthTokenx1x",hotr.haveSeenLocalStoreKey="x1xhaveseenx1x",hotr.userNameKey="x1xusernamex1x","undefined"!=typeof blobApi&&(jc.blobApi||(jc.blobApi=blobApi)),hotr.blobOperations.getBlob=function(e){var t=hotr.blobOperations.getCachedAuthToken();jc.blobApi.getBlob(t.token,function(t,i){void 0!=i?(hotr.playerBlob=i,e(!0)):e(!1)})},hotr.blobOperations.saveBlob=function(e){var t=hotr.blobOperations.getCachedAuthToken();hotr.playerBlob.version++,jc.blobApi.saveBlob(t.token,hotr.playerBlob,function(t,i){e(t,i)})},hotr.blobOperations.getFormation=function(){return"4x4x4a"},hotr.blobOperations.getTeam=function(){var e={};_.each(hotr.playerBlob.myguys,function(t){e[t.id]=t});for(var t=hotr.playerBlob.formation,i=[],n=0;n<t.length;n++)void 0!=t[n]&&e[t[n]]&&(i[n]=e[t[n]]);return i},hotr.blobOperations.createNewPlayer=function(e,t,i,n){jc.blobApi.createNewPlayer(e,t,i,function(e,i){hotr.playerBlob=e,hotr.blobOperations.setAuthToken(i),hotr.blobOperations.setHasPlayed(),hotr.blobOperations.setUserName(t),n()})},hotr.blobOperations.getNewAuthTokenAndBlob=function(e,t,i,n){jc.blobApi.getNewAuthTokenAndBlob(e,t,i,function(e,t){hotr.playerBlob=t,hotr.blobOperations.setAuthToken(e),n()})},hotr.blobOperations.getNewAuthToken=function(e,t,i,n){jc.blobApi.getAuthToken(e,t,i,n)},hotr.blobOperations.setAuthToken=function(e){jc.setLocalStorage(hotr.authTokenLocalStoreKey,e)},hotr.blobOperations.getCachedAuthToken=function(){return jc.getLocalStorage(hotr.authTokenLocalStoreKey)},hotr.blobOperations.hasToken=function(){var e=hotr.blobOperations.getCachedAuthToken();return e?e.expires-Date.now()<0?!1:!0:!1},hotr.blobOperations.getUserName=function(){return jc.getLocalStorage(hotr.userNameKey)},hotr.blobOperations.setUserName=function(e){return jc.setLocalStorage(hotr.userNameKey,e)},hotr.blobOperations.hasPlayed=function(){return void 0!=jc.getLocalStorage(hotr.haveSeenLocalStoreKey)},hotr.blobOperations.setHasPlayed=function(){jc.setLocalStorage(hotr.haveSeenLocalStoreKey,{haveSeenMe:!0})},hotr.blobOperations.getLevel=function(){return 0},hotr.blobOperations.getPowers=function(){return["poisonCloud","healing"]},hotr.blobOperations.indexToId=function(e){return hotr.blobOperations.validate(),hotr.playerBlob.myguys[e]?hotr.playerBlob.myguys[e].id:void 0},hotr.blobOperations.getFormationOrder=function(){return hotr.blobOperations.validate(),hotr.playerBlob.formation||(hotr.playerBlob.formation=[]),hotr.playerBlob.formation},hotr.blobOperations.getCurrentFormationPosition=function(e){return hotr.blobOperations.validate(),hotr.playerBlob.formation?hotr.playerBlob.formation.indexOf(e):-1},hotr.blobOperations.clearFormationPosition=function(e){hotr.playerBlob.formation[e]=void 0},hotr.blobOperations.placeCharacterFormation=function(e,t){hotr.blobOperations.validate();var i={};_.each(hotr.playerBlob.myguys,function(e){i[e.id]=e}),hotr.playerBlob.formation||(hotr.playerBlob.formation=[]);var n=hotr.playerBlob.formation.indexOf(e);if(-1!=n&&(hotr.playerBlob.formation[n]=void 0),!i[e])throw"Id: "+e+" not valid for player";hotr.playerBlob.formation[t]=e},hotr.blobOperations.validate=function(){if(!hotr.playerBlob)throw"Blob not initialized, call getBlob first."},hotr.blobOperations.getEntryWithId=function(e){hotr.blobOperations.validate();var t=_.find(hotr.playerBlob.myguys,function(t){return t.id==e});if(!t)throw"Could not locate a character with id:"+e;return t},hotr.blobOperations.getCharacterIdsAndTypes=function(){return hotr.blobOperations.validate(),hotr.playerBlob.myguys},hotr.blobOperations.getCharacterNames=function(){return hotr.blobOperations.validate(),_.pluck(hotr.playerBlob.myguys,"name")};var hotr=hotr||{};hotr.levelLogic={};var temp=[{name:"ogre",id:"id1",data:{}},{name:"ogre",id:"id2",data:{}},{name:"ogre",id:"id3",data:{}},{name:"ogre",id:"id4",data:{}},{name:"orc",id:"id5",data:{}},{name:"goblin",data:{}},{name:"goblin",data:{}},{name:"orc",data:{}},{name:"wizard",data:{}},{name:"wizard",data:{}},{name:"wizard",data:{}},{name:"wizard",data:{}}];hotr.levelLogic.getTeamForLevel=function(){return temp},hotr.levelLogic.getFormationForLevel=function(){return"4x4x4b"},hotr.levelLogic.getPowers=function(){return["poisonCloud","healing"]};var jc=jc||{};jc.isBrowser&&(cc.Sprite.prototype.setColor=function(){jc.log(["console"],"setColor called on the web - don't do it man.")},jc.dumpStack=function(e){jc.log(e,console.trace())}),jc.isBrowser||(cc.Sprite.prototype.setScale=function(e,t){this.setScaleX(e),this.setScaleY(t)},cc.Sprite.prototype.nativeBoundingBox=cc.Sprite.prototype.getBoundingBox,cc.Sprite.prototype.getBoundingBox=function(){var e=this.nativeBoundingBox();return e.origin=cc.p(e.x,e.y),e},jc.dumpStack=function(e){var t=(new Error).stack;jc.log(e,t)},cc.Sprite.prototype.setFlippedX=cc.Sprite.prototype.setFlipX),jc.cardScale=.85,jc.scaleCard=function(e){e.setScale(e.getScaleX()*jc.cardScale,e.getScaleY()*jc.cardScale)},jc.makeStats=function(e){if(e){var t=spriteDefs[e],i={};return i.hp=t.gameProperties.MaxHP,i.damage=jc.valuePerSecond(t.gameProperties.damage,t.gameProperties.actionDelays.attack),i.armor=0,i.speed=t.gameProperties.speed,i.power=jc.getPowerRating(t),i.range=t.gameProperties.targetRadius,i}var i={};return i.hp=0,i.damage=0,i.armor=0,i.speed=0,i.power=0,i.range=0,i},jc.getPowerRating=function(){return 10},jc.valuePerSecond=function(e,t){return t||(t=1),e*(1/t)},jc.getCapability=function(e){var t=spriteDefs[e],i={};return 1==t.gameProperties.targets&&(i.ground=jc.makeSpriteWithPlist(uiPlist,uiPng,"canAttackGround.png"),i.air=void 0),0==t.gameProperties.targets&&(i.ground=void 0,i.air=jc.makeSpriteWithPlist(uiPlist,uiPng,"canAttackAir.png")),2==t.gameProperties.targets&&(i.ground=jc.makeSpriteWithPlist(uiPlist,uiPng,"canAttackGround.png"),i.air=jc.makeSpriteWithPlist(uiPlist,uiPng,"canAttackAir.png")),i},jc.elementSprite=function(e){if("void"==e)return jc.makeSpriteWithPlist(uiPlist,uiPng,"elements_0000_void.png");if("water"==e)return jc.makeSpriteWithPlist(uiPlist,uiPng,"elements_0001_water.png");if("fire"==e)return jc.makeSpriteWithPlist(uiPlist,uiPng,"elements_0002_fire.png");if("life"==e)return jc.makeSpriteWithPlist(uiPlist,uiPng,"elements_0003_life.png");if("earth"==e)return jc.makeSpriteWithPlist(uiPlist,uiPng,"elements_0004_earth.png");if("air"==e)return jc.makeSpriteWithPlist(uiPlist,uiPng,"elements_0005_air.png");if("none"==e)return void 0;throw"Illegal element type: "+e},jc.moveActionWithCallback=function(e,t,i){var n=cc.MoveTo.create(t,e);return jc.actionWithCallback(n,i)},jc.cap=function(e,t){e.x<t.x&&(e.x=t.x),e.y<t.y&&(e.y=t.y),e.x>t.width&&(e.x=t.width),e.y>t.height&&(e.y=t.height)},jc.makeSimpleSprite=function(e){var t=new cc.Sprite;return t.initWithSpriteFrameName(e),t.retain(),t},jc.makeSpriteWithPlist=function(e,t,i){var n=new cc.Sprite;cc.SpriteFrameCache.getInstance().addSpriteFrames(e),cc.SpriteBatchNode.create(t);var a=cc.SpriteFrameCache.getInstance().getSpriteFrame(i);return n.initWithSpriteFrame(a),n.retain(),n},jc.shade=function(e,t){e.shade||(e.shade=cc.LayerColor.create(cc.c4(15,15,15,255)),e.getParent().addChild(e.shade));var i=e.getPosition(),n=e.getBoundingBox().size;i.x-=n.width/2,i.y-=n.height/2,e.shade.setPosition(i),e.shade.setContentSize(n),e.shade.setOpacity(0),e.getParent().reorderChild(e.shade,0),void 0==t&&(t=jc.defaultFadeLevel),jc.fadeIn(e.shade,t)},jc.unshade=function(e){jc.fadeOut(e.shade)},jc.fadeIn=function(e,t,i,n){jc.dumpStack(["fadeOut"]),i||(i=jc.defaultTransitionTime),t||(t=jc.defaultFadeLevel),e||(e=this);var a=cc.FadeTo.create(i,t);if(n){var r=cc.CallFunc.create(n),s=cc.Sequence.create(a,r);e.runAction(s)}else e.runAction(a)},jc.swapFade=function(e,t){function i(){t.setOpacity(0),this.addChild(t),jc.fadeIn(t,255,jc.defaultTransitionTime/4)}jc.log(["utilEffects"],"fade out name:"+e.name),jc.log(["utilEffects"],"fade in name:"+t.name),e?jc.fadeOut(e,jc.defaultTransitionTime/4,function(){this.removeChild(e,!1),i.bind(this)()}.bind(this)):i.bind(this)()},jc.fadeOut=function(e,t,i){jc.dumpStack(["fadeOut"]),t||(t=jc.defaultTransitionTime),e||(e=this);var n=cc.FadeTo.create(t,0);if(i){var a=cc.CallFunc.create(i),r=cc.Sequence.create(n,a);e.runAction(r)}else e.runAction(n)},jc.getVectorTo=function(e,t){if(!e||!t)throw"To and From positions required!";var i=cc.pSub(e,t),n=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y),r=cc.pLength(i);return{direction:i,distance:r,xd:n,yd:a}},jc.makeAnimationFromRange=function(e,t){t.name&&(e=t.name);var i=[],n=1;t.first&&(n=t.first);for(var a=n;a<=t.frames;a++){var r=cc.SpriteFrameCache.getInstance().getSpriteFrame(e+"."+a+".png");if(!r)throw"Couldn't get a frame for: "+e+"."+a+".png is your naming convention off?";i.push(r)}if(t.rev)for(var a=t.frames;a>=n;a--){var r=cc.SpriteFrameCache.getInstance().getSpriteFrame(e+"."+a+".png");i.push(r)}var s=cc.Animation.create(i,t.delay);if(t.times){var o=cc.Repeat.create(cc.Animate.create(s),t.times);return o.retain(),o}var c=cc.RepeatForever.create(cc.Animate.create(s));return c.retain(),c},jc.playTintedEffectOnTarget=function(e,t,i,n,a,r,s){var o=jc.playEffectOnTarget(e,t,i,n);if(o){var c=new cc.Color3B;c.r=a,c.b=s,c.g=r,o.setColor(c)}return o},jc.playEffectOnTarget=function(e,t,i,n){var a=effectsConfig[e];if(t.effectAnimations||(t.effectAnimations={}),t.effectAnimations[e]||(t.effectAnimations[e]={sprite:jc.makeSpriteWithPlist(a.plist,a.png,a.start),animation:jc.makeAnimationFromRange(e,a)}),!t.effectAnimations[e].playing){var r;r=n?t:i;var s=t.effectAnimations[e].sprite,o=t.effectAnimations[e].animation;if(s.setVisible(!0),r.addChild(s),"behind"!=a.zorder||n?"behind"==a.zorder&&n?r.reorderChild(s,-1):r.reorderChild(s,t.getZOrder()):r.reorderChild(s,t.getZOrder()-1),n?jc.setChildEffectPosition(s,t,a):jc.setEffectPosition(s,t,a),a.times){var c=cc.CallFunc.create(function(){r.removeChild(s,!1),t.effectAnimations[e].playing=!1}.bind(this)),h=cc.Sequence.create(o,c);s.runAction(h)}else s.runAction(o);return t.effectAnimations[e].playing=!0,s}},jc.playEffectAtLocation=function(e,t,i,n){var a=effectsConfig[e],r=jc.makeSpriteWithPlist(a.plist,a.png,a.start),s=(r.getTextureRect(),jc.makeAnimationFromRange(e,a));if(r.setPosition(t),r.setVisible(!0),n.addChild(r),n.reorderChild(r,i),a.times){var o=cc.CallFunc.create(function(){n.removeChild(r,!1)}.bind(this)),c=cc.Sequence.create(s,o);r.runAction(c)}else r.runAction(s);return r},jc.setChildEffectPosition=function(e,t,i){var n=i.placement,a=cc.p(0,0),r=t.getContentSize(),s=(t.getTextureRect(),e.getContentSize());if(n)if("bottom"==n)a.x+=r.width/2;else if("ground"==n)a.y+=s.height/2,a.x+=r.width/2,t.reorderChild(e,jc.groundEffectZOrder);else if("center"==n)a.x+=r.width/2,a.y+=s.height;else{if("base2base"!=n)throw"Unknown effect placement.";a.x+=r.width/2,a.y-=r.height/2,a.y+=s.height}if(i.offset){var o=cc.pAdd(a,i.offset);e.setPosition(o)}else e.setPosition(a)},jc.setEffectPosition=function(e,t,i){var n=i.placement,a=t.getBasePosition(),r=t.getTextureRect(),s=e.getTextureRect();if(n)if("bottom"==n)a.y+=s.height/2;else if("center"==n)a.y+=r.height/2;else if("top"==n)e.setPosition(a);else{if("base2base"!=n)throw"Unknown effect placement.";a.y+=s.height}if(i.offset){var o=cc.pAdd(a,i.offset);e.setPosition(o)}else e.setPosition(a)},jc.genericPower=function(e,t,i,n,a,r){a||(a=spriteDefs[t].damageMods[e]);var s={};s=_.extend(s,a),s.name=e,i?s.origin=i:s.element=r,n.addEffect(s)},jc.genericPowerApply=function(e,t,i,n){GeneralBehavior.applyDamage(n.owner,e.origin,e.damage,e.element)&&(n.owner[i]||(n.owner[i]=jc.playEffectOnTarget(t,n.owner,n.owner.getZOrder(),n.owner.layer,!0)))},jc.genericPowerRemove=function(e,t,i){i.owner[e]&&i.owner.removeChild(i.owner[e],!1),delete i.owner[e],i.owner.effectAnimations[t].playing=!1},jc.movementType={air:0,ground:1},jc.targetType={air:0,ground:1,both:2},jc.elementTypes={"void":0,water:1,fire:2,life:3,none:4,earth:5,air:7},jc.getElementType=function(e){for(var t in jc.elementTypes)if(jc.elementTypes[t]==e)return t},jc.checkPower=function(){},jc.elMajor=600,jc.elMinor=300,jc.insideEllipse=function(e,t,i,n){var a=i.x-n.x,r=i.y-n.y,s=e*e,o=t*t,c=a*a/s+r*r/o;return 1>c},jc.getCharacterPortrait=function(e,t){var i=jc.getCharacterCard(e);return i},jc.getCharacterCardFrame=function(e){var t=e+".pic.png",i=spriteDefs[e].cardIndex;return void 0==i&&(i=0),cc.SpriteFrameCache.getInstance().addSpriteFrames(cardsPlists[i]),cc.SpriteBatchNode.create(cardsPngs[i]),cc.SpriteFrameCache.getInstance().getSpriteFrame(t)},jc.getCorrectPortraitPosition=function(e){var t=cc.p(e.x,e.y),i=.234375*t.x,n=.234375*t.y;return t.x=i,t.y=n,t},jc.portraitFromCard=function(e,t,i){var n=jc.getCorrectPortraitPosition(spriteDefs[e].portraitXy);if(!n){var a=t.getContentSize();n=cc.p(a.width/2,a.height/2)}var r=t.getTextureRect(),s=t.getContentSize(),o=s.width-r.width,c=s.height-r.height;n.x-=o,n.y-=c;var h=cc.rect(n.x,n.y,i.width,i.height);return t.setTextureRect(h),t.setContentSize(i),t},jc.getCharacterCard=function(e){var t=e+"_bg.png",i=spriteDefs[e].cardIndex;return void 0==i&&(i=0),jc.makeSpriteWithPlist(cardsPlists[i],cardsPngs[i],t)},jc.formations={"4x3":[{x:225,y:225},{x:225,y:375},{x:225,y:525},{x:225,y:675},{x:75,y:300},{x:75,y:450},{x:75,y:600}],"4x4x4a":[{x:800,y:400},{x:800,y:500},{x:800,y:600},{x:800,y:700},{x:700,y:400},{x:700,y:500},{x:700,y:600},{x:700,y:700},{x:550,y:400},{x:550,y:500},{x:550,y:600},{x:550,y:700}],"4x4x4b":[{x:1100,y:400},{x:1100,y:500},{x:1100,y:600},{x:1100,y:700},{x:1200,y:400},{x:1200,y:500},{x:1200,y:600},{x:1200,y:700},{x:1350,y:400},{x:1350,y:500},{x:1350,y:600},{x:1350,y:700}]},jc.backDropZOrder=-99999999,jc.shadowZOrder=-99999998,jc.groundEffectZOrder=-99999997;var jc=jc||{};jc.localstorage={},jc.setLocalStorage=function(e,t){jc.getLocalStorage(e),sys.localStorage.setItem(e,JSON.stringify(t))},jc.getLocalStorage=function(e){var t;if(t=jc.localstorage[e],!t){try{t=JSON.parse(sys.localStorage.getItem(e))}catch(i){return void 0}t&&(jc.localstorage[e]=t)}return t},jc.log(["camera"],"cc undefined:"+(void 0==cc)),jc.log(["camera"],"cc.ActionInterval undefined:"+(void 0==cc.ActionInterval)),jc.log(["camera"],"cc.ActionInterval looks like:"+cc.ActionInterval),jc.isBrowser?(jc.PanAndZoom=cc.ActionInterval.extend({initWithDuration:function(e,t,i,n){if(void 0==t.x||void 0==t.y)throw"Position is not a point";return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(t.x=t.x*i,t.y=t.y*n,this._endPosition=t,this._endScaleX=i,this._endScaleY=null!=n?n:i,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._previousPosition=this._startPosition=e.getPosition(),this._delta=cc.pSub(this._endPosition,this._startPosition),this._startScaleX=e.getScaleX(),this._startScaleY=e.getScaleY(),this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(e){if(this._target){var t=this._target.getPosition(),i=cc.pSub(t,this._previousPosition);this._startPosition=cc.pAdd(this._startPosition,i);var n=cc.p(this._startPosition.x+this._delta.x*e,this._startPosition.y+this._delta.y*e);this._target.setPosition(n),this._previousPosition=n,this._target.setScale(this._startScaleX+this._deltaX*e,this._startScaleY+this._deltaY*e)}},_endPosition:cc.p(0,0),_startPosition:cc.p(0,0),_delta:cc.p(0,0),_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0}),jc.PanAndZoom.create=function(e,t,i,n){var a=new jc.PanAndZoom;return a.initWithDuration(e,t,i,n),a}):(jc.PanAndZoom={},jc.PanAndZoom.create=function(){});var jc=jc||{},LayerManager=function(){this.layers=[]};LayerManager.prototype.pushLayer=function(e,t){e.resume(),this.currentLayer?(this.currentLayer.darken(),this.currentLayer.pause(),this.currentLayer.addChild(e,t)):this.currentLayer=e,e.setPosition(cc.p(0,0)),this.layers.push(e)},LayerManager.prototype.popLayer=function(){var e=this.layers.pop();if(!(this.layers.length>0))throw"No Layers";this.currentLayer=this.layers[this.layers.length-1],e.pause(),this.currentLayer.removeChild(e,!1),this.currentLayer.undarken(),this.currentLayer.resume(),this.currentLayer.onShow()},jc.layerManager=new LayerManager;var jc=jc||{};jc.CompositeButton=cc.Sprite.extend({initWithDefinition:function(e,t,i){if(!e)throw"Must supply a definition";if(!e.main)throw"Must supply main button state.";if(!e.pressed)throw"Must supply pressed button state.";if(this.def=e,this.onTouch=t,this.onPress=i,this.initWithSpriteFrameName(e.main),this.def.subs)for(var n=0;n<e.subs.length;n++){var a=cc.Sprite.create();a.initWithSpriteFrameName(e.subs[n].name),this.addChild(a),a.setPosition(cc.p(e.subs[n].x,e.subs[n].y))}if(this.def.text){this.label=cc.LabelTTF.create(this.def.text,this.def.font,this.def.fontSize),this.addChild(this.label);var r=this.getContentSize();this.label.setPosition(cc.p(r.width/2,r.height/2))}this.scheduleUpdate()},onEnter:function(){"mouse"in sys.capabilities?cc.Director.getInstance().getMouseDispatcher().addMouseDelegate(this,0):cc.registerTargetedDelegate(0,!0,this)},onExit:function(){"mouse"in sys.capabilities?cc.Director.getInstance().getMouseDispatcher().removeMouseDelegate(this):cc.unregisterTouchDelegate(this)},onTouchBegan:function(e){if(this.frameCheck(e)){var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(this.def.pressed);return this.setDisplayFrame(t),this.onPress&&this.onPress(),!0}return!1},frameCheck:function(e){return this.isVisible()&&this.isTouchInside(e)?!0:!1},getTouchLocation:function(e){var t=this.getParent().convertToNodeSpace(e);return t},isTouchInside:function(e){return e=e instanceof Array?e[0].getLocation():e.getLocation(),cc.rectContainsPoint(this.getBoundingBox(),this.getTouchLocation(e))},onTouchMoved:function(){return!1},onTouchEnded:function(e){if(this.frameCheck(e)){var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(this.def.main);return this.setDisplayFrame(t),this.onTouch&&!this.paused&&this.onTouch(),!0}return!1},onMouseDown:function(e){return this.onTouchBegan(e)},onMouseUp:function(e){return this.onTouchEnded(e)},setTouchDelegate:function(e){this.onTouch=e},pause:function(){this.paused=!0},resume:function(){this.paused=!1}}),jc.PowerTile=jc.CompositeButton.extend({tileSize:cc.size(50,50),borderPos:cc.p(130,130),coolCheck:.05,initTile:function(){this.initWithSpriteFrameName("EmptyIcon.png");var e=this.getContentSize();this.setScale(this.tileSize.width/e.width,this.tileSize.height/e.height),this.border=jc.makeSimpleSprite("Border5.png"),this.addChild(this.border,10),this.border.setPosition(this.borderPos),this.onTouchBegan=this.touchBeganOverride,this.onTouchEnded=this.touchEndedOverride},initFromName:function(e,t){if(e){this.parentLayer=t,this.name=e,cc.SpriteFrameCache.getInstance().addSpriteFrames(powerTiles[e].plist);var i=cc.SpriteFrameCache.getInstance().getSpriteFrame(powerTiles[e].icon);this.setDisplayFrame(i),this.on=!0}},setSelected:function(){var e=cc.SpriteFrameCache.getInstance().getSpriteFrame("Border3.png");this.border.setDisplayFrame(e)},setUnselected:function(){var e=cc.SpriteFrameCache.getInstance().getSpriteFrame("Border5.png");this.border.setDisplayFrame(e)},onTouch:function(){if(!this.cooling&&this.on){this.cooling=!0;var e=225;this.parentLayer.setSelected(this);var t=powerTiles[this.name];this.executed=Date.now();var i=globalPowers[t.offense].bind(this);if("direct"==t.type)hotr.arenaScene.layer.nextTouchDo(function(t,n){i(t,n),jc.shade(this,e),this.parentLayer.scheduleThisOnce(this.doCoolDown.bind(this),this.coolCheck)}.bind(this));else{if("global"!=t.type)throw"Unknown power type.";i(),jc.shade(this,e),this.parentLayer.scheduleThisOnce(this.doCoolDown.bind(this),this.coolCheck)}return!1}},doCoolDown:function(){var e=powerTiles[this.name],t=Date.now()-this.executed,i=t/e.cooldown;if(i>=1)this.shade.setContentSize(cc.size(this.tileSize.width,this.tileSize.height)),this.cooling=!1,jc.unshade(this);else{var n=this.shade.getBoundingBox().size;n.height=this.tileSize.height-this.tileSize.height*i,this.shade.setContentSize(n),this.parentLayer.scheduleThisOnce(this.doCoolDown.bind(this),this.coolCheck)}},touchBeganOverride:function(e){return this.frameCheck(e)?!0:void 0},touchEndedOverride:function(e){return this.frameCheck(e)?(this.onTouch&&!this.paused&&this.onTouch(),!0):!1}});var jc=jc||{};jc.defaultTransitionTime=.25,jc.defaultFadeLevel=140,jc.defaultNudge=10,jc.touchEnded="end",jc.touchBegan="began",jc.touchMoved="moved",jc.touchCancelled="cancel",jc.TouchLayer=cc.Layer.extend({init:function(){return this._super()?(this.winSize=cc.Director.getInstance().getWinSize(),this.superDraw=this.draw,this.draw=this.childDraw,this.superOnEnter=this.onEnter,this.onEnter=this.childOnEnter,this.superOnExit=this.onExit,this.onExit=this.childOnExit,this.touchTargets=[],this.retain(),!0):!1},bubbleAllTouches:function(e){this.bubbleAll=e},childOnEnter:function(){this.superOnEnter(),this.wireInput(!0),this.onShow()},hackOn:function(){this.wireInput(!0),this.onShow()},hackOff:function(){this.wireInput(!1),this.onHide()},childOnExit:function(){this.superOnExit(),this.wireInput(!1),this.onHide()},onShow:function(){},onHide:function(){},wireInput:function(e){"mouse"in sys.capabilities?e?cc.Director.getInstance().getMouseDispatcher().addMouseDelegate(this,1):cc.Director.getInstance().getMouseDispatcher().removeMouseDelegate(this):e?cc.registerTargetedDelegate(0,!0,this):cc.unregisterTouchDelegate(this)},onTouchBegan:function(e){return this.hitSpriteTarget(jc.touchBegan,e)},onTouchMoved:function(e){return this.hitSpriteTarget(jc.touchMoved,e)},onTouchEnded:function(e){return this.hitSpriteTarget(jc.touchEnded,e)},onMouseDown:function(e){return this.onTouchBegan(e)},onMouseDragged:function(e){return this.onTouchMoved(e)},onMouseUp:function(e){return this.onTouchEnded(e)},onTouchCancelled:function(e){return this.hitSpriteTarget(jc.touchCancelled,e)},targetTouchHandler:function(){throw"child must implement!"},hitSpriteTarget:function(e,t){jc.log(["touchcore"],"Raw Touch:"+JSON.stringify(t)),t=this.touchToPoint(t),jc.log(["touchcore"],"Raw Touch Point:"+JSON.stringify(t));var i=this.convertToNodeSpace(t);jc.log(["touchcore"],"Converted Touch:"+JSON.stringify(i)),this.doConvert&&(jc.log(["touchcore"],"Using converted touch."),t=i);for(var n=[],a=0;a<this.touchTargets.length;a++){if(this.touchTargets[a]instanceof jc.Sprite){var r=this.touchTargets[a].getTextureRect(),s=this.touchTargets[a].getBasePosition(),o={};o.width=1.4*r.width,o.height=1.4*r.height,o.x=s.x-o.width/2,o.y=s.y}else var o=this.touchTargets[a].getBoundingBox();jc.log(["touchcore"],"Sprite:"+this.touchTargets[a].name),jc.log(["touchcore"],"Position:"+JSON.stringify(o));var c=cc.rectContainsPoint(o,t);c&&n.push(this.touchTargets[a])}return(n.length>0||this.bubbleAll)&&!this.isPaused?this.targetTouchHandler(e,t,n):!1},touchToPoint:function(e){return e instanceof Array?e[0].getLocation():e.getLocation()},darken:function(){this.shade||(this.shade=cc.LayerColor.create(cc.c4(15,15,15,255)),this.addChild(this.shade)),this.shade.setPosition(new cc.p(0,0)),this.shade.setOpacity(0),this.reorderChild(this.shade,0),this.fadeIn(this.shade,jc.defaultFadeLevel)},undarken:function(){this.fadeOut(this.shade)},fadeIn:function(e,t,i){i||(i=jc.defaultTransitionTime),t||(t=jc.defaultFadeLevel),e||(e=this);var n=cc.FadeTo.create(i,t);e.runAction(n)},fadeOut:function(e,t){t||(t=jc.defaultTransitionTime),e||(e=this);var i=cc.FadeTo.create(t,0);e.runAction(i)},slide:function(e,t,i,n,a,r,s){n||(n=jc.defaultTransitionTime),e.setPosition(t),e.setVisible(!0);var o,c=cc.MoveTo.create(n,i);s||(s=function(){});var h=cc.CallFunc.create(s);if(a&&"before"==r){var l=cc.pAdd(t,a);o=cc.MoveTo.create(n/2,l)}else if(a&&"after"==r){var l=cc.pAdd(i,a);o=cc.MoveTo.create(n/2,l)}if(o&&"before"==r)action=cc.Sequence.create(o,c,h),e.runAction(action);else if(o&&"after"==r)action=cc.Sequence.create(c,o,h),e.runAction(action);else{if(o)throw"when var must be before or after";action=cc.Sequence.create(c,h),e.runAction(action)}},slideInFromTop:function(e,t,i,n){var a=this.getCorrectRect(e),r=this.winSize.width/2,s=this.winSize.height+a.height/2;if(!i){var o=r,c=this.winSize.height-(a.height/2+jc.defaultNudge);i=cc.p(o,c)}this.slide(e,cc.p(r,s),i,t,cc.p(0,jc.defaultNudge),"after",n)},slideTopToMid:function(e,t,i){var n=this.mainFrame.getTextureRect(),a=this.winSize.width/2,r=this.winSize.height+n.width,s=a,o=this.winSize.height/2,c=cc.p(s,o);this.slide(this.mainFrame,cc.p(a,r),c,jc.defaultTransitionTime,cc.p(0,jc.defaultNudge),"after",i)
},slideOutToTop:function(e,t,i,n){var a=this.getCorrectRect(e);if(!i){var r=this.winSize.width/2,s=this.winSize.height+a.height/2;i=cc.p(r,s)}this.slide(e,e.getPosition(),i,t,cc.p(0,-1*jc.defaultNudge),"before",n)},slideInFromBottom:function(e,t,i,n){var a=this.getCorrectRect(e),r=this.winSize.width/2,s=0-a.height;if(!i){var o=r,c=a.height/2+jc.defaultNudge;i=cc.p(o,c)}this.slide(e,cc.p(r,s),i,t,cc.p(0,-1*jc.defaultNudge),"after",n)},slideOutToBottom:function(e,t,i,n){var a=this.getCorrectRect(e);if(!i){var r=this.winSize.width/2,s=0-a.height;i=cc.p(r,s)}this.slide(e,e.getPosition(),i,t,cc.p(0,jc.defaultNudge),"before",n)},slideInFromLeft:function(e,t,i,n){var a=this.getCorrectRect(e),r=0-a.width,s=this.winSize.height/2;if(!i){var o=a.width/2+jc.defaultNudge,c=s;i=cc.p(o,c)}this.slide(e,cc.p(r,s),i,t,cc.p(-1*jc.defaultNudge,0),"after",n)},slideOutToLeft:function(e,t,i,n){var a=this.getCorrectRect(e);if(!i){var r=0-a.width,s=this.winSize.height/2;i=cc.p(r,s)}this.slide(e,e.getPosition(),i,t,cc.p(jc.defaultNudge,0),"before",n)},slideInFromRight:function(e,t,i,n){var a=this.getCorrectRect(e),r=this.winSize.width+a.width,s=this.winSize.height/2;if(!i){var o=this.winSize.width-(a.width/2+jc.defaultNudge),c=s;i=cc.p(o,c)}this.slide(e,cc.p(r,s),i,t,cc.p(jc.defaultNudge,0),"after",n)},slideOutToRight:function(e,t,i,n){var a=this.getCorrectRect(e);if(!i){var r=this.winSize.width+a.width,s=this.winSize.height/2;i=cc.p(r,s)}this.slide(e,e.getPosition(),i,t,cc.p(-1*jc.defaultNudge,0),"before",n)},getCorrectRect:function(e){return e instanceof jc.Sprite?e.getTextureRect():e.getContentSize()},generateSprite:function(e){var t;return t=jc.Sprite.spriteGenerator(spriteDefs,e,this)},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1},centerPoint:function(){return cc.p(this.getContentSize().width*this.getAnchorPoint().x,this.getContentSize().height*this.getAnchorPoint().y)},centerPointOffset:function(e){return cc.pAdd(this.centerPoint(),e)},makeWindow:function(e,t,i){if(!t)throw"A window needs a sprite backdrop and a scale9 rect";i||(i=cc.rect(45,45,350,600));var n=cc.Scale9Sprite.create();return n.initWithSpriteFrameName(t,i),n.setContentSize(e),n.setVisible(!1),n},childDraw:function(){this.superDraw()},drawBorder:function(e,t,i){var n=e.getPosition(),a=e.getTextureRect();this.drawNode||(this.drawNode=cc.DrawNode.create(),this.addChild(this.drawNode)),n.x=n.x-a.width/2,n.y=n.y-a.height/2,this.drawNode.setPosition(n);var r=cc.c4f(0,0,0,0),s=t;this.drawNode.clear(),this.drawRect(this.drawNode,a,r,s,i)},drawRect:function(e,t,i,n,a){var r=t.height,s=t.width,o=[cc.p(0,0),cc.p(0,r),cc.p(s,r),cc.p(s,0)];e.drawPoly(o,i,a,n)},runActionWithCallback:function(e,t){var i=cc.CallFunc.create(t),n=cc.Sequence.create(e,i);this.runAction(n)}});var jc=jc||{};jc.UiConf={},jc.woodRect=cc.rect(105,105,140,140),jc.UiElementsLayer=jc.TouchLayer.extend({windowConfig:{window:{cell:8,type:"scale9",anchor:["top"],transitionIn:"top",transitionOut:"bottom",size:{width:50,height:50},scaleRect:jc.UiConf.frame19Rect,sprite:"frame 19.png",padding:{all:0},kids:{subwindow1:{cell:8,type:"scale9",input:!0,size:{width:50,height:50},scaleRect:jc.UiConf.frame20Rect,sprite:"frame 20.png",padding:{all:0}},subwindow2:{cell:2,type:"scale9",input:!0,size:{width:50,height:50},scaleRect:jc.UiConf.frame20Rect,sprite:"frame 20.png",padding:{all:0}}}}},init:function(){return this._super()?(this.windowConfigs=[],!0):!1},done:function(){this.runningType="out";for(var e=0;e<this.windowConfigs.length;e++){var t=this.windowConfigs[e];t.config.transitionOut?this.doTransitionOut(t,this.onTransitionComplete.bind(this)):(t.window.setVisible(!1),this.onTransitionComplete())}},letterBoxVertical:function(){var e=jc.designSize,t=(this.winSize.width-e.width)/2;this.leftBar=cc.DrawNode.create(),this.rightBar=cc.DrawNode.create(),this.addChild(this.leftBar),this.addChild(this.rightBar);var i=cc.c4f(0,0,0,1),n=cc.c4f(0,0,0,1);this.leftBar.clear(),this.rightBar.clear(),this.leftBar.setPosition(cc.p(0,0)),this.leftBar.setPosition(cc.p(this.winSize.width-t,0)),this.drawRect(this.leftBar,cc.rect(0,0,t,this.winSize.height),i,n,1),this.drawRect(this.rightBar,cc.rect(0,0,t,this.winSize.height),i,n,1),this.leftBar.setZOrder(100),this.rightBar.setZOrder(100)},drawRect:function(e,t,i,n,a){var r=t.height,s=t.width,o=[cc.p(0,0),cc.p(0,r),cc.p(s,r),cc.p(s,0)];e.drawPoly(o,i,a,n)},onTransitionComplete:function(){this.incTransition(),this.checkTransitionsDone()},incTransition:function(){this.transitions||(this.transitions=0),this.transitions++},checkTransitionsDone:function(){this.transitions==this.windowConfigs.length&&(this.transitions=0,"out"==this.runningType?this.outTransitionsComplete():this.inTransitionsComplete())},outTransitionsComplete:function(){},inTransitionsComplete:function(){},start:function(){this.runningType="in";for(var e=0;e<this.windowConfigs.length;e++){var t=this.windowConfigs[e];t.config.transitionIn?this.doTransitionIn(t,this.onTransitionComplete.bind(this)):(t.window.setPosition(t.position),t.window.setVisible(!0),this.onTransitionComplete())}},doTransitionIn:function(e,t){switch(e.config.transitionIn){case"right":this.slideInFromRight(e.window,e.config.transitionInTime,e.position,t);break;case"left":this.slideInFromLeft(e.window,e.config.transitionInTime,e.position,t);break;case"top":this.slideInFromTop(e.window,e.config.transitionInTime,e.position,t);break;case"topToMid":this.slideTopToMid(e.window,e.config.transitionInTime,t);break;case"bottom":this.slideInFromBottom(e.window,e.config.transitionInTime,e.position,t);break;case"topToMid":break;case"custom":this[e.config.executeIn](t)}},doTransitionOut:function(e,t){switch(e.config.transitionOut){case"right":this.slideOutToRight(e.window,e.config.transitionOutTime,void 0,t);break;case"left":this.slideOutToLeft(e.window,e.config.transitionOutTime,void 0,t);break;case"top":this.slideOutToTop(e.window,e.config.transitionOutTime,void 0,t);break;case"bottom":this.slideOutToBottom(e.window,e.config.transitionOutTime,void 0,t);break;case"custom":this[e.config.executeOut](t)}},initFromConfig:function(e,t){for(var i in e)if(config=e[i],t||(t=this),config.isGroup)this.initFromGroupConfig(i,config,t);else{var n=void 0;"scale9"==config.type&&(n=this.calculateSize(config,t),jc.log(["ui"],"scale9 size:"+JSON.stringify(n)));var a=this.makeWindowByType(config,n);n||(n=a.getTextureRect(),jc.log(["ui"],"TextureRect size:"+JSON.stringify(n)));var r=this.getAnchorPosition(config,n,t);a.setPosition(cc.p(-1e3,-1e3)),this[i]=a,a.name=i,this.windowConfigs.push({window:a,config:config,position:r}),t.addChild(a),config.z=0|config.z,t.reorderChild(a,config.z),config.input&&this.touchTargets.push(a),config.kids&&this.initFromConfig(config.kids,a)}},makeWindowByType:function(e,t){var i;if("scale9"==e.type)i=this.makeWindow(t,e.sprite,e.scaleRect);else if("sprite"==e.type)i=cc.Sprite.create(),i.initWithSpriteFrameName(e.sprite),e.scale&&(i.setScaleX(e.scale/100),i.setScaleY(e.scale/100));else if("button"==e.type){if(i=new jc.CompositeButton,!this[e.touchDelegateName])throw"supplied:"+e.touchDelegateName+" for button click but it doesn't exist.";i.initWithDefinition(e,this[e.touchDelegateName].bind(this)),e.scale&&(i.setScaleX(e.scale/100),i.setScaleY(e.scale/100))}else if("label"==e.type){var n=cc.size(e.width,e.height);i=cc.LabelTTF.create(e.text,e.font,e.fontSize,n,cc.TEXT_ALIGNMENT_LEFT),i.setColor(e.color)}else"tile"==e.type&&(i=new jc.PowerTile,i.initTile());return i},initFromGroupConfig:function(e,t,i){if(t.members){var n=t.membersTotal|t.members.length;switch(t.type){case"line":this.initGrid(e,t,i,1,n);break;case"stack":this.initGrid(e,t,i,n,1);break;case"grid":this.initGrid(e,t,i,n/t.cols,t.cols)}}},initGrid:function(e,t,i,n,a){var r,s,o=t.membersTotal||t.members.length,c=i.getContentSize(),h=!1;if(t.itemSize){var l=c.width*t.itemSize.width/100,d=c.height*t.itemSize.height/100;r=cc.size(l,d),h=!0,jc.log(["ui"],"initGrid itemSize hard set:"+JSON.stringify(r))}for(var u,p=-1,f=-1,g=0,m=0,v=0;o>v;v++){var y;y=t.membersTotal?t.members[0]:t.members[v];var w=this.makeWindowByType(y,r),b=w.getTextureRect();jc.log(["ui"],"element itemSize from boundingBox:"+JSON.stringify(b)),h||(jc.log(["ui"],"element itemSize not hard set, using elementSize"),r=b),-1==p&&-1==f?(u=this.getAnchorPosition(t,r,i),p=u.x,f=u.y):0!=m&&(p+=r.width/2),jc.log(["ui"],"adding child:"+w.name),void 0==t.z&&(t.z=0),jc.log(["ui"],"reordering child:"+t.z),this.addChild(w),0!=t.z&&this.reorderChild(w,t.z);var S;S=y.name?y.name:e+v,w.name=S,this[S]=w,t.input&&this.touchTargets.push(w),t.itemPadding&&(t.itemPadding.all?p+=t.itemPadding.all:t.itemPadding.left&&(p+=t.itemPadding.left));var T=cc.p(p,f);"label"==y.type&&(T.x+=w.getContentSize().width/2),this.windowConfigs.push({window:w,config:y,position:T}),m++,m>=a?(g++,p=u.x,f-=r.height,t.itemPadding&&(t.itemPadding.all?f-=t.itemPadding.all:t.itemPadding.top&&(f-=t.itemPadding.top)),m=0):(p+=r.width/2,s=r)}},calculateSize:function(e,t){var i=t.getContentSize();if(!e.size)throw"Size must be specified.";var n=e.size.width/100*i.width,a=e.size.height/100*i.height;return e.padding&&(void 0!=e.padding.all?(n-=e.padding.all,a-=e.padding.all):(e.padding.right&&(n-=e.padding.right),e.padding.bottom&&(a-=e.padding.bottom))),cc.size(n,a)},getAnchorPosition:function(e,t){if(!e)throw"Need a config!";if(!t)throw"Need a size!";if(!e.cell)throw"Need a cell";e.anchor||(e.anchor=[]);for(var i=this.winSize,n=this.getRow(e.cell),a=this.getCol(e.cell),r=i.width/3,s=i.height/3,o=r*a+r/2,c=s*n+s/2,h=0;h<e.anchor.length;h++){var l=e.anchor[h];switch(l){case"top":c+=s/2,c-=t.height/2;break;case"left":o-=r/2,o+=t.width/2;break;case"right":o+=r/2,o-=t.width/2;break;case"bottom":c-=r/2,c+=t.height/2;break;case"center":}}return e.padding&&(void 0!=e.padding.all?(o+=e.padding.all,c+=e.padding.all):(e.padding.left&&(o+=e.padding.left),e.padding.top&&(c-=e.padding.top))),cc.p(o,c)},getRow:function(e){if(3>=e)return 0;if(6>=e)return 1;if(9>=e)return 2;throw"Cell must be 1-9"},getCol:function(e){if(1==e||4==e||7==e)return 0;if(2==e||5==e||8==e)return 1;if(3==e||6==e||9==e)return 2;throw"Cell must be 1-9"},centerThisPeer:function(e,t){e.setPosition(t.getPosition())},centerThisChild:function(e){e.setPosition(cc.p(50,50))},scaleTo:function(e,t){var i=e.getContentSize(),n=t.getContentSize(),a=n.width/i.width,r=n.height/i.height;e.setScaleX(a),e.setScaleY(r)}}),jc.UiElementsLayer.create=function(){var e=new jc.UiElementsLayer;if(e&&e.init())return e;throw"Couldn't create the main layer of the game. Something is wrong."},jc.UiElementsLayer.scene=function(){var e=cc.Scene.create(),t=jc.UiElementsLayer.create();return e.addChild(t),e};var jc=jc||{};jc.ScrollingLayer=jc.TouchLayer.extend({init:function(e){if(this._super()){this.def=e,this.sprites=this.def.sprites,this.metaData=this.def.metaData,this.doConvert=!0,this.name="JCScrollingLayer";for(var t=0,i=0;i<this.sprites.length;i++){this.touchTargets.push(this.sprites[i]),this.addChild(this.sprites[i]);var n=this.def.cellWidth/2*i+this.def.cellWidth;this.sprites[i].setPosition(cc.p(n,0)),this.sprites[i].getTextureRect().height>t&&(t=this.sprites[i].getTextureRect().height),this.reorderChild(this.sprites[i],3)}var a=this.sprites.length*this.def.cellWidth;return this.midPoint=this.def.width/2,this.setContentSize(cc.size(a,t)),this.selectedIndex=1,this.doUpdate=!1,this.scheduleUpdate(),!0}return!1},setIndex:function(e){return jc.log(["scroller"],"set on: "+e),this.doUpdate=!1,void 0==e?(jc.log(["scroller"],"Bad val for setIndex:"),jc.dumpStack(["scroller"]),void 0):(this.selectedIndex=e,this.centerOn(this.sprites[e]),void 0)},left:function(){if(0!=this.selectedIndex){var e=this.selectedIndex-1;this.setIndex(e)}},right:function(){if(this.selectedIndex<this.sprites.length-1){var e=this.selectedIndex+1;this.setIndex(e)}},targetTouchHandler:function(e,t,i){return this.isVisible()?(this.drawNode&&this.drawNode.clear(),e==jc.touchBegan&&(jc.log(["scroller"],"touchbegan"),this.initialTouch=t,this.scrollDistance=void 0),e==jc.touchEnded&&this.initialTouch&&(jc.log(["scroller"],"touchend"),this.fling(t,i)),e==jc.touchMoved&&this.initialTouch&&(jc.log(["scroller"],"touchmove"),this.scroll(t)),!0):void 0},fling:function(e,t){if(this.isMoving=!1,jc.log(["scroller"],"fling"),void 0==this.scrollDistance){if(jc.log(["scroller"],"fling touch"),t[0]){var i=this.sprites.indexOf(t[0]);this.setIndex(i)}}else this.doUpdate=!this.edgeAdjust()},edgeAdjust:function(){var e=this.calcAbsolutePos(0).x;if(e>this.midPoint)return this.doUpdate=!1,this.isMoving=!1,this.setIndex(0),jc.log(["scroller"],"edge"),!0;var t=this.calcAbsolutePos(this.sprites.length-1).x;return t<this.midPoint?(this.doUpdate=!1,this.isMoving=!1,this.setIndex(this.sprites.length-1),jc.log(["scroller"],"edge2"),!0):!1},centerOn:function(e){var t=e.getPosition(),i=this.convertToWorldSpace(t),n=this.midPoint-i.x;jc.log(["scroller"],"Center needs:"+n),0!=n?this.runEndingAdjustment(cc.p(n,0)):this.raiseSelected()},runEndingAdjustment:function(e){if(!this.endAdjustmentRunning){this.endAdjustmentRunning=!0,jc.log(["scroller"],"runEndingAdjustment:"+this.doUpdate);var t=cc.CallFunc.create(this.raiseSelected.bind(this)),i=cc.MoveBy.create(jc.defaultTransitionTime/2,e),n=cc.Sequence.create(i,t);this.runAction(n)}},raiseSelected:function(){jc.log(["scroller"],"raiseSelected:"+this.doUpdate),this.doUpdate=!1,this.endAdjustmentRunning=!1,this.applyHighlight(this.sprites[this.selectedIndex]),this.def.selectionCallback(this.selectedIndex,this.sprites[this.selectedIndex],this.metaData[this.selectedIndex])},applyHighlight:function(e){var t=cc.c4f(1,1,0,1);this.drawBorder(e,t,2)},update:function(){if(this.doUpdate){if(jc.log(["scroller"],"updating"),!this.scrollDistance)return this.doUpdate=!1,void 0;if(this.scrollDistance.x/this.def.cellWidth>3&&(this.scrollDistance.x=3*this.def.cellWidth),this.setPosition(cc.pAdd(this.getPosition(),this.scrollDistance)),!this.isMoving){var e=.75;this.scrollDistance=cc.pMult(this.scrollDistance,e),Math.abs(this.scrollDistance.x)<=1&&(this.doUpdate=!1,this.adjust())}this.doUpdate=!this.edgeAdjust()}},calcAbsolutePos:function(e){return this.convertToWorldSpace(this.sprites[e].getPosition())},adjust:function(){var e,t=-1;jc.log(["scroller"],"adjust");for(var i=0;i<this.sprites.length;i++){var n=this.sprites[i],a=n.getBoundingBox();a.origin=this.convertToWorldSpace(a.origin);var r=Math.abs(a.origin.x-this.midPoint);if((-1==t||t>r)&&(t=r,e=i),cc.rectContainsPoint(a,cc.p(this.midPoint,a.origin.y)))return this.setIndex(i),void 0}this.setIndex(e)},scroll:function(e){jc.log(["scroller"],"scroll");var t=(this.getBoundingBox(),cc.pSub(e,this.initialTouch)),i=cc.p(t.x,0);this.scrollDistance=i,this.doUpdate=!0,this.isMoving=!0}});var jc=jc||{};jc.WorldLayer=jc.TouchLayer.extend({init:function(e){if(this._super()){this.backDrop=cc.Sprite.create(e),this.addChild(this.backDrop),this.backDrop.setPosition(this.winSize.width/2,this.winSize.height/2),this.reorderChild(this.backDrop,jc.backDropZOrder),this.worldSize=this.backDrop.getContentSize();var t=this.worldSize.width/2,i=this.worldSize.height/2;this.worldMidPoint=cc.p(t,i),this.screenMidPoint=cc.p(this.winSize.width/2,this.winSize.height/2),this.worldBoundary=cc.rect(this.worldSize.width/4,this.worldSize.height/4,this.worldSize.width/2+this.worldSize.width/4,this.worldSize.height/2+this.worldSize.height/4),this.setViewCenter(cc.p(this.worldSize.width/2,this.worldSize.height/2)),this.bubbleAllTouches(!0),this.worldScale={x:this.winSize.width/this.worldSize.width,y:this.winSize.height/this.worldSize.height};var n=0;this.aspectRatio=this.winSize.width/this.winSize.height,this.scaleTable=[];for(var a=1,r=.2;1>=n;){var s=0;n=parseFloat((this.winSize.width/(this.worldSize.width/a)).toFixed(2)),s=n>1?1:n,this.scaleTable.push({x:s,y:s/this.aspectRatio}),a+=r}return!0}return!1},getOkayScale:function(e,t){var i=e/this.aspectRatio;if(i>=t)return this.getScale(e,i);for(;t>i;)e+=10,i=e/this.aspectRatio;return this.getScale(e,i)},panToWorldPoint:function(e,t,i,n){var a=this.convertToLayerPosition(e);this.doScale(t,a,i,n)},fullZoomOut:function(e,t){var i=this.getScaleWorld();i=this.getClosestCorrectScale(i);var n=this.convertToLayerPosition(cc.p(this.worldSize.width/2,this.worldSize.height/2));if(jc.isBrowser){var a=jc.PanAndZoom.create(e,n,i.x,i.y);this.runActionWithCallback(a,t)}},doScale:function(e,t,i,n){if(jc.isBrowser){var a=jc.PanAndZoom.create(i,t,e.x,e.y);this.runActionWithCallback(a,n)}else n()},getClosestCorrectScale:function(e){for(var t=void 0,i=0;i<this.scaleTable.length;i++){var n=this.scaleTable[i];n.x<=e.x&&n.y<=e.y&&(t?n.x>t.x&&n.y>t.y&&(t=n):t=n)}return t||(t=this.scaleTable[this.scaleTable.length-1]),t},getScale:function(e,t){var i={x:this.winSize.width/e,y:this.winSize.height/t};return i.x>2&&(i.x=2),i.y>2&&(i.y=2),i},getScaleOne:function(){return{x:1,y:1}},getScale2x:function(){return this.getScale(this.worldSize.width/2,this.worldSize.height/2)},getScale4x:function(){return this.getScale(this.worldSize.width/4,this.worldSize.height/4)},getScale8x:function(){return this.getScale(this.worldSize.width/16,this.worldSize.height/16)},getScaleWorld:function(){return this.getScale(.9*this.worldSize.width,.9*this.worldSize.height)},convertToLayerPosition:function(e){jc.cap(e,this.worldBoundary);var t=cc.pMult(e,-1);return cc.pAdd(t,this.worldMidPoint)},convertToItemPosition:function(e){var t=this.worldToScreen(e),i=this.convertToNodeSpace(t);return i},worldToScreen:function(e){var t=this.screenToWorld(this.screenMidPoint),i=cc.pSub(t,e);i.x*=this.getScaleX(),i.y*=this.getScaleY();var n=cc.pSub(this.screenMidPoint,i);return n},screenToWorld:function(e){return this.backDrop.convertToNodeSpace(e)},setViewCenter:function(e){var t=this.convertToLayerPosition(e);this.setPosition(t)},targetTouchHandler:function(){}});var jc=jc||{};jc.GameObject=function(){},jc.GameObject.prototype.init=function(){this.hp=this.MaxHP},jc.inherit=function(e,t){for(var i in t)void 0==e[i]&&(e[i]=t[i]);return e};var jc=jc||{};jc.AnimationTypeOnce=1,jc.AnimationTypeLoop=0,String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,i){return"undefined"!=typeof e[i]?e[i]:t})}),jc.Sprite=cc.Sprite.extend({layer:void 0,alive:!0,initWithPlist:function(e,t,i,n){this.HealthBarWidth=20,this.HealthBarHeight=5,this.animations={},this.batch=null,this.state=-1,this.moving=0,this.currentMove=null,this.idle=0,this.name=n.name,this.baseOffset=n.baseOffset,cc.SpriteFrameCache.getInstance().addSpriteFrames(e),this.batch=cc.SpriteBatchNode.create(t),this.batch.retain(),this.effects={};var a=cc.SpriteFrameCache.getInstance().getSpriteFrame(i);if(!a)throw i+" for sprite: "+n.name+" was not found.";this.initWithSpriteFrame(a),this.retain(),this.type=n.type,"background"!=this.type&&(this.superDraw=this.draw,this.draw=this.customDraw,this.initHealthBar(),this.initShadow()),this.debug=!1,n.behavior||(n.behavior="tank");var r=BehaviorMap[n.behavior];if(!r)throw"Unrecognized behavior name: "+n.behavior;var s=new r(this);return this.behavior=s,this.behaviorType=n.behavior,this.gameObject=new jc.GameObject,n.gameProperties&&_.extend(this.gameObject,n.gameProperties),this.gameObject.init(),this},die:function(){this.imdeadman=!0,this.layer.removeChild(this,!0),this.layer.removeChild(this.shadow,!0),this.layer.removeChild(this.healthBar,!0),this.cleanUp()},fallToShadow:function(){this.noShadowUpdate=!0;var e=this.shadow.getPosition(),t=cc.pSub(e,this.getPosition()),i=cc.pLength(t),n=i/this.gameObject.speed,a=cc.MoveTo.create(e,n);this.runAction(a)},disableHealthBar:function(){this.hideHealthbar=!0},initShadow:function(){this.shadow=new cc.Sprite,cc.SpriteFrameCache.getInstance().addSpriteFrames(shadowPlist),cc.SpriteBatchNode.create(shadowPng);var e=cc.SpriteFrameCache.getInstance().getSpriteFrame("shadowSmall.png");this.shadow.initWithSpriteFrame(e),this.shadow.setScaleX(.5),this.shadow.retain(),this.layer.addChild(this.shadow),this.layer.reorderChild(this.shadow,jc.shadowZOrder),this.updateShadowPosition()},initHealthBar:function(){this.healthBar=cc.DrawNode.create(),this.healthBar.retain(),this.healthBar.contentSize=cc.size(this.HealthBarWidth,this.HealthBarHeight),this.layer.addChild(this.healthBar),this.updateHealthBarPos()},cleanUp:function(){this.currentMove&&(this.stopAction(this.currentMove),this.currentMove.release(),this.currentMove=void 0),this.state=-1,this.layer.removeChild(this.shadow,!0),this.layer.removeChild(this.healthBar,!0);for(var e=0;e<this.animations.length;e++)this.animations[e].action.release();this.batch.release()},addDef:function(e){if(void 0==e.nameFormat)throw"Nameformat is required in a sprite definition.";if(void 0==e.state)throw"State is required in a sprite definition.";if(void 0==e.type)throw"Animation type 'type' is required in a sprite definition.";if(void 0==e.delay)throw"Animation delay 'delay' is required in a sprite definition.";var t=this.makeAction(e);t.retain(),e.action=t,this.animations[e.state]=e},makeAction:function(e){var t,i=[],n="",a=e.start,r=e.end;if(void 0==a&&(a=0),void 0==r){if(void 0==e.frames)throw"You must provide either an end range or a number of frames when creating an entry.";r=e.frames-1}for(var s=a;r>=s;s++){if(n=e.nameFormat.format(s),t=cc.SpriteFrameCache.getInstance().getSpriteFrame(n),!t)throw"Couldn't get frame. What is: "+n;i.push(t)}var o,c=cc.Animation.create(i,e.delay);if(e.type==jc.AnimationTypeLoop)o=cc.RepeatForever.create(cc.Animate.create(c)),o.retain(),o.tag=e.state;else{var h=cc.Animate.create(c),l=cc.Repeat.create(h,1),d=cc.CallFunc.create(this.animationDone,this);o=cc.Sequence.create(l,d),o.tag=e.state}return o},getTargetRadius:function(){return this.gameObject.targetRadius},getTargetRadiusY:function(){return"range"==this.behaviorType?this.gameObject.targetRadius:this.gameObject.targetRadius/2},getSeekRadius:function(){return this.gameObject.seekRadius},getBasePosition:function(){var e=this.getPosition(),t=this.getContentSize();return e.y-=t.height/2,e},setBasePosition:function(e){var t=this.getContentSize();e.y+=t.height/2,this.setPosition(e),this.layer.reorderChild(this,-1*e.y),this.updateHealthBarPos(),this.updateShadowPosition()},moveTo:function(e,t,i,n){jc.log(["sprite","move"],"Moving:"+this.name);var a=cc.pSub(e,this.getPosition()),r=cc.pLength(a),s=r/i;void 0!=this.currentMove&&(jc.log(["sprite","move"],"Stopping move in process."),this.stopAction(this.currentMove),this.currentMove.release(),this.currentMove=void 0),jc.log(["sprite","move"],"Setting state to required move."),this.setState(t),n||(n=this.moveEnded.bind(this));var o=cc.MoveTo.create(s,e);jc.log(["sprite","move"],"creating the move sequence"),this.currentMove=cc.Sequence.create(o,cc.CallFunc.create(n)),this.currentMove.retain(),jc.log(["sprite","move"],"running move sequence"),this.runAction(this.currentMove)},isAlive:function(){return this.gameObject.hp>0?!0:!1},moveEnded:function(){this.setState(this.idle),this.stopAction(this.currentMove)},animationDone:function(){var e;this.animations[this.state].callback&&(e=this.animations[this.state].callback),e&&e(this.nextState)},getState:function(){return this.state},addEffect:function(e){this.effects[e.name]=e},removeEffect:function(e){delete this.effects[e]},setState:function(e,t){if(!e)throw"Undefined state passed to setState";var i=this.state;if(this.state=e,jc.log(["sprite","state"],"State Change For:"+this.name+" from:"+i+" to:"+this.state),this.state==i)return jc.log(["sprite","state"],"Trying to set a state already set, exit"),void 0;this.nextState=this.isAlive()?"idle":"dead";var n=this.animations[this.state],a=this.animations[i];if(!n)throw"Couldn't start state. What is state: "+this.state+" currentState:"+i;if(n.callback=t,-1!=i){if(!a)throw"Couldn't stop state. What is currentState:"+i;jc.log(["sprite","state"],"Stopping action."),a.action&&this.stopAction(a.action)}jc.log(["sprite","state"],"Starting action."),n.action&&this.runAction(n.action),"background"!=this.type&&(this.updateHealthBarPos(),this.updateShadowPosition())},centerOnScreen:function(){var e=cc.Director.getInstance().getWinSize(),t=e.width/2,i=e.height/2;this.setPosition(cc.p(t,i))},setBehavior:function(e){var t=BehaviorMap[e];if(!t)throw"Unrecognized behavior name: "+e;this.behavior=new t(this)},think:function(e){this.behavior.think(e)},customDraw:function(){this.imdeadman||(this.superDraw(),this.debug&&this.drawBorders(),this.drawHealthBar())},drawBorders:function(){var e=this.getBasePosition(),t=this.getTextureRect();this.debugTextureBorder||(this.debugTextureBorder=cc.DrawNode.create(),this.layer.addChild(this.debugTextureBorder),e.x=e.x-t.width/2,this.debugTextureBorder.setPosition(e));var i=cc.c4f(0,0,0,0),n=cc.c4f(35/255,28/255,40/255,1);this.debugTextureBorder.clear(),this.drawRect(this.debugTextureBorder,this.getTextureRect(),i,n,4)},drawRect:function(e,t,i,n,a){var r=t.height,s=t.width,o=[cc.p(0,0),cc.p(0,r),cc.p(s,r),cc.p(s,0)];e.drawPoly(o,i,a,n)},drawHealthBar:function(){if(!this.hideHealthbar){this.healthBar.clear();var e=[];e[0]=cc.p(0,0),e[1]=cc.p(0,this.HealthBarHeight-1),e[2]=cc.p(this.HealthBarWidth-1,this.HealthBarHeight-1),e[3]=cc.p(this.HealthBarWidth-1,0);var t=cc.c4f(1,0,0,1),i=cc.c4f(26/255,245/255,15/255,1),n=cc.c4f(35/255,28/255,40/255,1);this.healthBar.drawPoly(e,t,.7,n);var a=[],r=this.gameObject.hp/this.gameObject.MaxHP;0>r&&(r=0),a[0]=cc.p(0,0),a[1]=cc.p(0,this.HealthBarHeight-1),a[2]=cc.p((this.HealthBarWidth-2)*r+.5,this.HealthBarHeight-1),a[3]=cc.p((this.HealthBarWidth-2)*r+.5,0),this.healthBar.drawPoly(a,i,.7,n)}},updateHealthBarPos:function(){if("background"!=this.type){var e=this.getBasePosition(),t=this.getTextureRect();e.y+=t.height+10,e.x-=this.HealthBarWidth/2,this.healthBar.setPosition(e)}},updateShadowPosition:function(){if("background"!=this.type){var e=this.getBasePosition(),t=this.getContentSize();e.y+=5,e.x=this.isFlippedX()?e.x-t.width+250:e.x-t.width+240,this.gameObject&&this.gameObject.flightAug&&(e.y-=this.gameObject.flightAug.y/2),this.shadow.setPosition(e)}}}),jc.Sprite.getMinMax=function(e){var t=99999,i=-1;for(var n in e.animations)e.animations[n].start<t&&(t=e.animations[n].start),e.animations[n].end>i&&(i=e.animations[n].end);if(99999==t)throw"something wrong...";if(99999==i)throw"something wrong...";e.startFrame=t,e.endFrame=i},jc.Sprite.spriteGenerator=function(e,t,i){var n=e[t];if(!n)throw"Character not found: "+t;var a=new jc.Sprite;a.layer=i;var r=n.name+".{0}.png";if(n.inherit){var s=n.name;_.extend(n,e[n.inherit]),n.name=s,n.parentOnly=void 0}if(void 0==n.animations)throw t+" has a malformed configation. Animation property missing.";var o=n.animations.idle.start,c=new jc.GameObject;_.extend(c,n.gameProperties),n.type="character",a.initWithPlist(g_characterPlists[t],g_characterPngs[t],r.format(o),n);for(var h in n.animations){var l=jc.clone(n.animations[h]);l.nameFormat=r,l.state=h,a.addDef(l),"idle"==h&&(a.idle=h),"move"==h&&(a.moving=h)}return n.effect&&jc.playEffectOnTarget(n.effect,a,i,!0),a},jc.randomNum=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},!function(e){function t(){this._events={},this._conf&&i.call(this,this._conf)}function i(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function n(e){this._events={},this.newListener=!1,i.call(this,e)}function a(e,t,i,n){if(!i)return[];var r,s,o,c,h,l,d,u=[],p=t.length,f=t[n],g=t[n+1];if(n===p&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(r=0,s=i._listeners.length;s>r;r++)e&&e.push(i._listeners[r]);return[i]}if("*"===f||"**"===f||i[f]){if("*"===f){for(o in i)"_listeners"!==o&&i.hasOwnProperty(o)&&(u=u.concat(a(e,t,i[o],n+1)));return u}if("**"===f){d=n+1===p||n+2===p&&"*"===g,d&&i._listeners&&(u=u.concat(a(e,t,i,p)));for(o in i)"_listeners"!==o&&i.hasOwnProperty(o)&&("*"===o||"**"===o?(i[o]._listeners&&!d&&(u=u.concat(a(e,t,i[o],p))),u=u.concat(a(e,t,i[o],n))):u=o===g?u.concat(a(e,t,i[o],n+2)):u.concat(a(e,t,i[o],n)));return u}u=u.concat(a(e,t,i[f],n+1))}if(c=i["*"],c&&a(e,t,c,n+1),h=i["**"])if(p>n){h._listeners&&a(e,t,h,p);for(o in h)"_listeners"!==o&&h.hasOwnProperty(o)&&(o===g?a(e,t,h[o],n+2):o===f?a(e,t,h[o],n+1):(l={},l[o]=h[o],a(e,t,{"**":l},n+1)))}else h._listeners?a(e,t,h,p):h["*"]&&h["*"]._listeners&&a(e,t,h["*"],p);return u}function r(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var i=0,n=e.length;n>i+1;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var a=this.listenerTree,r=e.shift();r;){if(a[r]||(a[r]={}),a=a[r],0===e.length){if(a._listeners){if("function"==typeof a._listeners)a._listeners=[a._listeners,t];else if(s(a._listeners)&&(a._listeners.push(t),!a._listeners.warned)){var c=o;"undefined"!=typeof this._events.maxListeners&&(c=this._events.maxListeners),c>0&&a._listeners.length>c&&(a._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",a._listeners.length),console.trace())}}else a._listeners=t;return!0}r=e.shift()}return!0}var s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=10;n.prototype.delimiter=".",n.prototype.setMaxListeners=function(e){this._events||t.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},n.prototype.event="",n.prototype.once=function(e,t){return this.many(e,1,t),this},n.prototype.many=function(e,t,i){function n(){0===--t&&a.off(e,n),i.apply(this,arguments)}var a=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");return n._origin=i,this.on(e,n),a},n.prototype.emit=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var i=arguments.length,n=new Array(i-1),r=1;i>r;r++)n[r-1]=arguments[r];for(r=0,i=this._all.length;i>r;r++)this.event=e,this._all[r].apply(this,n)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o="string"==typeof e?e.split(this.delimiter):e.slice();a.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s){if(this.event=e,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var i=arguments.length,n=new Array(i-1),r=1;i>r;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){for(var i=arguments.length,n=new Array(i-1),r=1;i>r;r++)n[r-1]=arguments[r];for(var c=s.slice(),r=0,i=c.length;i>r;r++)this.event=e,c[r].apply(this,n);return c.length>0||this._all}return this._all},n.prototype.on=function(e,i){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof i)throw new Error("on only accepts instances of Function");if(this._events||t.call(this),this.emit("newListener",e,i),this.wildcard)return r.call(this,e,i),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],i];else if(s(this._events[e])&&(this._events[e].push(i),!this._events[e].warned)){var n=o;"undefined"!=typeof this._events.maxListeners&&(n=this._events.maxListeners),n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=i;return this},n.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");
var i,n=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();n=a.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],n.push({_listeners:i})}for(var o=0;o<n.length;o++){var c=n[o];if(i=c._listeners,s(i)){for(var h=-1,l=0,d=i.length;d>l;l++)if(i[l]===t||i[l].listener&&i[l].listener===t||i[l]._origin&&i[l]._origin===t){h=l;break}if(0>h)return this;this.wildcard?c._listeners.splice(h,1):this._events[e].splice(h,1),0===i.length&&(this.wildcard?delete c._listeners:delete this._events[e])}else(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete c._listeners:delete this._events[e])}return this},n.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&this._all.length>0){for(t=this._all,i=0,n=t.length;n>i;i++)if(e===t[i])return t.splice(i,1),this}else this._all=[];return this},n.prototype.removeListener=n.prototype.off,n.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||t.call(this),this;if(this.wildcard)for(var i="string"==typeof e?e.split(this.delimiter):e.slice(),n=a.call(this,null,i,this.listenerTree,0),r=0;r<n.length;r++){var s=n[r];s._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},n.prototype.listeners=function(e){if(this.wildcard){var i=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return a.call(this,i,n,this.listenerTree,0),i}return this._events||t.call(this),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},n.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return n}):e.EventEmitter2=n}(jc);var jc=jc||{},RequestManager=function(){this.gameQueue=[],this.resourceQueue=[],jc.log(["requestManager"],"scheduling updates"),cc.Director.getInstance().getScheduler().scheduleCallbackForTarget(this,this.worker,.01)};RequestManager.gameQId="game.queue.storage",RequestManager.resQId="resource.queue.storage",RequestManager.events={},RequestManager.types={},RequestManager.events.GameRequestQueued="game.req.queued",RequestManager.events.ResourceRequestQueued="res.req.queued",RequestManager.events.GameRequestSuccess="game.req.success",RequestManager.events.GameRequestFailed="game.req.failed",RequestManager.events.GameRequestStarted="game.req.started",RequestManager.events.ResourceRequestSuccess="resource.req.success",RequestManager.events.ResourceRequestFailed="resource.req.failed",RequestManager.events.ResourceRequestStarted="resource.req.started",RequestManager.types.game="game",RequestManager.types.res="res",RequestManager.prototype.queueGameRequest=function(e){e.type=RequestManager.types.game,this.gameQueue.push(e),jc.log(["requestManager"],"gameRequest queued"),this.emit("game.request.queued"),this.serializeGameQueue()},RequestManager.prototype.queueResourceRequest=function(e){e.type=RequestManager.types.res,this.resourceQueue.push(e),jc.log(["requestManager"],"resRequest queued"),this.serializeResQueue()},RequestManager.prototype.getGameReq=function(){var e=this.gameQueue.shift();return this.serializeGameQueue(),e},RequestManager.prototype.getResourceReq=function(){var e=this.resourceQueue.shift();return this.serializeResQueue(),e},RequestManager.prototype.serializeToLocalStorage=function(e,t){sys.localStorage[e]=JSON.stringify(t)},RequestManager.prototype.serializeGameQueue=function(){this.serializeToLocalStorage(this.gameQid,this.gameQueue)},RequestManager.prototype.serializeResQueue=function(){this.serializeToLocalStorage(this.resQId,this.resourceQueue)},RequestManager.prototype.testEventFire=function(e,t){this._instance.emit(e,t)},RequestManager.prototype.worker=function(){cc.Director.getInstance().getScheduler().pauseTarget(this);var e=this.getGameReq();e?this.emit(RequestManager.events.GameRequestStarted,e):(e=this.getResourceReq(),e&&this.emit(RequestManager.events.GameRequestStarted,e)),e&&(e.success=this.success.bind(this),e.failure=this.failure.bind(this),jc.log(["requestManager"],"sending request"),ajax(e)),cc.Director.getInstance().getScheduler().resumeTarget(this)},RequestManager.prototype.success=function(e,t){var i;if(jc.log(["requestManager"],"Request success"),e.type==RequestManager.types.game)i=RequestManager.events.GameRequestSuccess;else{if(e.type!=RequestManager.types.res)throw"unknown request type in request manager";i=RequestManager.events.ResourceRequestSuccess}this.emit(i,{req:e,res:t})},RequestManager.prototype.failure=function(e,t){var i;if(jc.log(["requestManager"],"Request failure"),e.type==RequestManager.types.game)i=RequestManager.events.GameRequestFailure;else{if(e.type!=RequestManager.types.res)throw"unknown request type in request manager";i=RequestManager.events.ResourceRequestFailure}this.emit(i,{req:e,res:t})},RequestManager.getInstance=function(){return this._instance||(this._instance=new RequestManager,_.extend(this._instance,new jc.EventEmitter2({wildcard:!1,newListener:!1}))),this._instance},jc.RequestManager=RequestManager;var GeneralBehavior=cc.Node.extend({});GeneralBehavior.prototype.getState=function(){return this.brainState||this.setState("idle"),this.animationState||this.owner.setState("idle"),{brain:this.brainState,anim:this.animationState}},GeneralBehavior.prototype.resume=function(){this.setState(this.lastBrain,this.lastAnim)},GeneralBehavior.prototype.setState=function(e,t,i){this.lastBrain=this.brainState,this.lastAnim=this.animationState,e&&(this.brainState=e),t&&(this.animationState=t,this.owner.setState(this.animationState,function(e){"damage"==this.animationState?this.resume():(this.animationState=e,this.owner.setState(this.animationState)),i&&i()}.bind(this)))},GeneralBehavior.prototype.init=function(e){this.owner=e,this.directions=[0,45,90,135,180,225,270],this.stateQueue=[],this.owner=e},GeneralBehavior.prototype.targetWithinRadius=function(e){return this.withinRadius(e.getBasePosition())},GeneralBehavior.prototype.targetWithinVariableRadius=function(e,t){return this.withinThisRadius(t.getBasePosition(),e,e)},GeneralBehavior.prototype.targetWithinVariableRadiusAndLocation=function(e,t,i){return this.withinThisRadiusOf(i.getBasePosition(),t,e,e)},GeneralBehavior.prototype.withinRadius=function(e){return this.withinThisRadius(e,this.owner.getTargetRadius(),this.owner.getTargetRadiusY())},GeneralBehavior.prototype.whosCloser=function(e,t){var i=this.getVectorTo(e.getBasePosition(),this.owner.getBasePosition()),n=this.getVectorTo(t.getBasePosition(),this.owner.getBasePosition());return n.distance<i.distance?-1:i.distance<n.distance?1:0},GeneralBehavior.prototype.withinThisRadiusOf=function(e,t,i,n){var a=this.getVectorTo(t,e);return a.xd<=i&&a.yd<=n?!0:!1},GeneralBehavior.prototype.withinThisRadius=function(e,t,i){var n=this.owner.getBasePosition(),a=this.getVectorTo(e,n);return a.xd<=t&&a.yd<=i?!0:!1},GeneralBehavior.prototype.targetWithinSeekRadius=function(e){var t=this.owner.getBasePosition(),i=this.getVectorTo(e.getBasePosition(),t);return i.distance<=this.owner.getSeekRadius()?!0:!1},GeneralBehavior.prototype.lockOnEnemyInRadius=function(){return this.lockOnClosest(this.targetWithinSeekRadius.bind(this),this.owner.enemyTeam())},GeneralBehavior.prototype.lockOnClosestUnlocked=function(){return this.lockOnClosest(this.isUnlocked.bind(this),this.owner.enemyTeam())},GeneralBehavior.prototype.lockOnClosestFriendlyNonTank=function(){return this.lockOnClosest(this.is.bind(this,["healer","range"]),this.owner.homeTeam())},GeneralBehavior.prototype.lockOnClosestNonTank=function(){return this.lockOnClosest(this.is.bind(this,["healer","range"]),this.owner.enemyTeam())},GeneralBehavior.prototype.isNot=function(e,t){return-1==e.indexOf(t.behaviorType)?!0:!1},GeneralBehavior.prototype.is=function(e,t){return-1!=e.indexOf(t.behaviorType)?!0:!1},GeneralBehavior.prototype.getClosestFriendToSupport=function(){return this.lockOnClosest(this.is.bind(this,["tank","range"]),this.owner.homeTeam())},GeneralBehavior.prototype.isUnlocked=function(e){for(var t=0;t<this.owner.homeTeam().length;t++){var i=this.owner.homeTeam()[t];if(i!=this.owner&&i.behavior.locked==e)return!1}return!0},GeneralBehavior.prototype.lockOnClosest=function(e,t){for(var i=void 0,n=this.getWorldSize(),a=n.width,r=0;r<t.length;r++){var s=t[r];if(s.isAlive()&&this.canTarget(s)){var o=this.getVectorTo(s.getBasePosition(),this.owner.getBasePosition());o.distance<a&&(void 0!=e?e(s)&&(a=o.distance,i=s):(a=o.distance,i=s))}}return i},GeneralBehavior.prototype.canTarget=function(e){return e.gameObject.movementType==this.owner.gameObject.targets||this.owner.gameObject.targets==jc.targetType.both?!0:!1},GeneralBehavior.prototype.allPassCheck=function(e,t){for(var i=[],n=0;n<t.length;n++){var a=t[n];a.isAlive()&&a!=this.owner&&e(a)&&i.push(a)}return i},GeneralBehavior.prototype.allFriendsWithinRadius=function(e){return this.allPassCheck(this.targetWithinVariableRadius.bind(this,e),this.owner.homeTeam())},GeneralBehavior.prototype.allFoesWithinRadius=function(e){return this.allPassCheck(this.targetWithinVariableRadius.bind(this,e),this.owner.enemyTeam())},GeneralBehavior.prototype.allFoesWithinRadiusOfPoint=function(e,t){return this.allPassCheck(this.targetWithinVariableRadiusAndLocation.bind(this,e,t),this.owner.enemyTeam())},GeneralBehavior.prototype.seekEnemy=function(){if(this.locked){var e=this.getWhereIShouldBe("front","facing",this.locked);if(e=this.adjustFlock(e),this.owner.gameObject.flightAug&&(this.owner.isFlippedX()||(this.owner.gameObject.flightAug.x*=-1),e=cc.pAdd(e,this.owner.gameObject.flightAug)),this.owner.gameObject.movementType==jc.movementType.ground){var t=cc.p(this.owner.layer.winSize.width/2,this.owner.layer.winSize.height/2);jc.insideEllipse(jc.elMajor,jc.elMinor,e,t)||(e=t)}return this.seek(e)}},GeneralBehavior.prototype.getWhereIShouldBe=function(e,t,i){if(!i)return this.owner.getBasePosition();var n,a=this.owner.getTextureRect(),r=i.getBasePosition();return"front"==e&&(n=i.isFlippedX()?cc.p(r.x-a.width,r.y):cc.p(r.x+a.width,r.y)),"behind"==e&&(n=i.isFlippedX()?cc.p(r.x+a.width,r.y):cc.p(r.x-a.width,r.y)),"facing"==t&&"front"==e&&this.owner.setFlippedX(!i.isFlippedX()),"facing"==t&&"behind"==e&&this.owner.setFlippedX(i.isFlippedX()),"away"==t&&"font"==e&&this.owner.setFlippedX(i.isFlippedX()),"away"==t&&"behind"==e&&this.owner.setFlippedX(!i.isFlippedX()),n},GeneralBehavior.prototype.adjustFlock=function(e){var t=this.allFriendsWithinRadius(10),i=this.owner.getBasePosition();if(0!=t.length)for(var n=0;n<t.length;n++){var a=Math.abs(t[n].getBasePosition().y-i.y);if(10>a&&this.owner.flockedOff!=t[n]){t[n].flockedOff=this.owner,e.y+=25;break}}return e},GeneralBehavior.prototype.seek=function(e){if(!this.owner)throw"Owning game object required";if(this.followPoint){if(this.withinThisRadius(e,25,25))return this.followPoint=void 0,cc.p(0,0)}else if(this.withinRadius(e))return cc.p(0,0);var t=this.owner.getBasePosition(),i=this.getVectorTo(e,t),n=this.owner.gameObject.speed;if(!n)throw"Character: "+this.owner.name+" speed not defined.";var a=cc.pMult(cc.pNormalize(i.direction),n);return a},GeneralBehavior.prototype.getVectorTo=function(e,t){return jc.getVectorTo(e,t)},GeneralBehavior.prototype.moveToward=function(e,t){var i=cc.pAdd(this.owner.getBasePosition(),cc.pMult(e,t));this.owner.setBasePosition(i)},GeneralBehavior.prototype.getRandomFleePosition=function(){var e=jc.randomNum(0,this.directions.length),t=cc.pForAngle(e),i=cc.pMult(t,this.owner.getTargetRadius());return this.clamp(i)},GeneralBehavior.prototype.getWorldSize=function(){return this.owner.layer.worldSize},GeneralBehavior.prototype.clamp=function(e){var t=this.getWorldSize(),i=this.owner.getTextureRect(),n=t.width-i.width,a=i.width,r=t.height-i.height,s=i.height;return e.x>n&&(e.x=n),e.x<a&&(e.x=a),e.y>r&&(e.y=r),e.y<s&&(e.y=s),e},GeneralBehavior.prototype.healLogic=function(){this.support&&GeneralBehavior.heal(this.owner,this.support,this.owner.gameObject.heal)},GeneralBehavior.heal=function(e,t,i){return t.gameObject.hp<0||t.gameObject.hp>=t.gameObject.MaxHP?!1:(t.gameObject.hp+i<t.gameObject.MaxHP?t.gameObject.hp+=i:t.gameObject.hp=t.gameObject.MaxHP,!0)},GeneralBehavior.prototype.hitLogic=function(){this.locked&&(GeneralBehavior.applyDamage(this.locked,this.owner,this.owner.gameObject.damage),this.damageEffects())},GeneralBehavior.prototype.damageEffects=function(){var e=spriteDefs[this.owner.name],t=e.damageMods;for(var i in t)t[i].name=i,this.doDamageMod(t[i])},GeneralBehavior.prototype.deathEffects=function(){var e=spriteDefs[this.owner.name],t=e.deathMods;for(var i in t)t[i].name=i,this.doDamageMod(t[i])},GeneralBehavior.prototype.doDamageMod=function(e){var t=powerConfig[e.name].bind(this);t(this.owner.name)},GeneralBehavior.applyDamage=function(e,t,i,n){if(!n&&!t)throw"must supply an attacker or an elementType";if(!n){var a=spriteDefs[t.name];n=a.elementType}if(e.gameObject.defense)for(var r in e.gameObject.defense)if(r==n){var s=i*(e.gameObject.defense[r]/100);i-=s,0>i&&(i=0)}return t&&e.behavior.locked!=t&&"range"!=t.behaviorType&&(i+=.2*i),GeneralBehavior.applyGenericDamage(e,t,i)},GeneralBehavior.applyGenericDamage=function(e,t,i){return e.gameObject.hp>0?(e.gameObject.hp-=i,e.gameObject.hp<=0?e.behavior.setState("dead","dead"):t&&(e.behavior.damager=t),!0):!1},GeneralBehavior.prototype.think=function(e){this.handleState(e)},GeneralBehavior.prototype.handleDeath=function(){if(this.callbacksDisabled)1==this.callbacksDisabled&&(this.owner.scheduleOnce(this.deadForGood.bind(this),3),this.callbacksDisabled++);else{var e=this.getState();this.owner.isAlive()||"dead"==e.brain||(this.setState("dead","dead"),this.owner.movementType==jc.movementType.air&&this.owner.fallToShadow()),this.owner.isAlive()||(this.owner.unscheduleAllCallbacks(),this.deathEffects(),this.callbacksDisabled=1)}},GeneralBehavior.prototype.deadForGood=function(){this.owner.die()},GeneralBehavior.prototype.handleState=function(e){this.handleDeath();var t=this.getState();switch(t.brain){case"idle":this.handleIdle(e);break;case"fighting":this.handleFight(e);break;case"damage":this.handleDamage(e);break;case"followUserCommand":this.followUserCommand(e)}this.afterEffects()},GeneralBehavior.prototype.handleDamage=function(){},GeneralBehavior.prototype.handleFight=function(e){var t=this.getState();if(!this.locked)return this.setState("idle",t.anim),void 0;if(!this.locked.isAlive())return this.setState("idle",t.anim),void 0;var i=this.owner.gameObject.actionDelays.attack,n=this.owner.gameObject.effectDelays.attack;void 0==this.lastAttack&&(this.lastAttack=i),this.lastAttack>=i&&-1==t.anim.indexOf("attack")?(this.setAttackAnim("fighting",function(){var e=this.seekEnemy();return e?0!=e.x||0!=e.y?(this.setState("move","move"),void 0):void 0:(this.setState("move","move"),void 0)}.bind(this)),this.owner.scheduleOnce(this.hitLogic.bind(this),n),this.lastAttack=0):this.lastAttack+=e},GeneralBehavior.prototype.setAttackAnim=function(e,t){if(void 0==this.attackSequence&&(this.attackSequence=1),1==this.attackSequence)this.setState(e,"attack");else{var i="attack"+this.attackSequence;this.owner.animations[i]?this.setState(e,i,t):(this.attackSequence=0,this.setState(e,"attack",t))}this.attackSequence++},GeneralBehavior.prototype.handleIdle=function(){if(this.locked&&this.damager&&this.locked!=this.damager){var e=this.whosCloser(this.locked,this.damager);1==e&&(this.damager=void 0),-1==e&&(this.locked=this.damager,this.damager=void 0)}this.locked&&this.withinRadius(this.locked.getBasePosition())||(this.forceLocked=!1,this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam())),this.locked&&!this.locked.isAlive()&&(this.forceLocked=!1,this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam())),this.locked&&this.setState("move","move")},GeneralBehavior.prototype.handleMove=function(e){var t=this.getState();if("move"==t.brain){this.forceLocked||this.handleIdle(e);var i=this.seekEnemy();return i?0==i.x&&0==i.y?(this.setState("fighting","move"),void 0):(this.moveToward(i,e),void 0):(this.setState("idle","idle"),this.forceLocked=!1,void 0)}},GeneralBehavior.prototype.followUserCommand=function(e){var t=this.seek(this.followPoint);return 0==t.x&&0==t.y?(this.setState("idle","idle"),void 0):(this.moveToward(t,e),void 0)},GeneralBehavior.prototype.separate=function(){for(var e=cc.p(0,0),t=this.owner.homeTeam(),i=0;i<t.length;i++)if(t[i]!=this.owner){var n=t[i],a=this.getVectorTo(this.owner.getBasePosition(),n.getBasePosition()),r=100;(a.xd<r||a.yd<r)&&(e=cc.pAdd(e,a.direction))}return e},GeneralBehavior.prototype.doPower=function(e){var t=powerConfig[e.name].bind(this);t(this.owner.name)},GeneralBehavior.prototype.afterEffects=function(){if(this.owner.isAlive()){this.scheduledPowers||(this.scheduledPowers={});var e=spriteDefs[this.owner.name],t=e.powers;for(var i in t)if(!this.scheduledPowers[i]){t[i].name=i;var n=this.doPower.bind(this,t[i]);this.owner.schedule(n,t[i].interval),this.scheduledPowers[i]=t[i]}this.scheduledEffects||(this.scheduledEffects={});for(var a in this.owner.effects){var r=this.owner.effects[a];if(!this.scheduledEffects[a]){var s=this.applyEffects.bind(this,r),o=this.removeEffects.bind(this,r,s,a);this.owner.schedule(s,r.interval,r.duration/r.interval-2,void 0),r.duration&&this.owner.scheduleOnce(o,r.duration),this.scheduledEffects[a]=r}}}},GeneralBehavior.prototype.followCommand=function(e){this.followPoint=e,this.setState("followUserCommand","move")},GeneralBehavior.prototype.attackCommand=function(e){this.locked=e,this.forceLocked=!0,this.setState("move","move")},GeneralBehavior.prototype.supportCommand=function(e){this.support=e,this.setState("move","move")},GeneralBehavior.prototype.removeEffects=function(e,t,i){var n=powerConfig[e.name+"-remove"].bind(this);n(e),this.owner.unschedule(t),this.owner.removeEffect(i),this.scheduledEffects[i]=void 0},GeneralBehavior.prototype.applyEffects=function(e){var t=powerConfig[e.name+"-apply"].bind(this);t(e)};var RangeBehavior=function(e){_.extend(this,new GeneralBehavior),this.init(e),this.handleIdle=this.handleRangeIdle,this.handleFight=this.handleRangeFight,this.withinRadius=this.withinRangeRadius};RangeBehavior.prototype.handleRangeFight=function(e){this.forceLocked||(this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam()));var t=this.getState();if(!this.locked)return this.setState("idle",t.anim),void 0;if(!this.locked.isAlive())return this.setState("idle",t.anim),void 0;if(!this.locked.isAlive()&&-1==t.anim.indexOf("attack"))return this.setState("idle",t.anim),void 0;var i=this.owner.gameObject.actionDelays.attack,n=this.owner.gameObject.effectDelays.attack;void 0==this.lastAttack&&(this.lastAttack=i),this.lastAttack>=i&&-1==t.anim.indexOf("attack")?(this.setAttackAnim("fighting"),this.owner.scheduleOnce(this.doMissile.bind(this),n),this.lastAttack=0):this.lastAttack+=e},RangeBehavior.prototype.doMissile=function(){if(this.locked&&!this.firing){this.firing=!0;var e=this.owner.gameObject.missile;e||(e="greenbullet");var t=missileConfig[e],i=this.getVectorTo(this.locked.getBasePosition(),this.owner.getBasePosition()),n=i.distance/t.speed;this.missile||(this.missile=jc.makeSpriteWithPlist(t.plist,t.png,t.start),this.missileAnimation=jc.makeAnimationFromRange(e,t),this.missile.runAction(this.missileAnimation)),this.owner.layer.addChild(this.missile);var a=this.owner.getBasePosition(),r=this.owner.getTextureRect();this.owner.isFlippedX()?a.x-=r.width/2:a.x+=r.width/2,a.y+=r.height/2,t.offset&&(a=cc.pAdd(a,t.offset)),this.owner.gameObject.missileOffset&&(a=cc.pAdd(a,this.owner.gameObject.missileOffset)),this.missile.setFlippedX(this.owner.isFlippedX()),this.missile.setPosition(a);var s;if("base"==this.owner.gameObject.missleTarget)s=this.locked.getBasePosition();else{s=this.locked.getBasePosition();var o=this.locked.getTextureRect();s.y+=o.height/2}var c=cc.MoveTo.create(n,s),h=cc.CallFunc.create(function(){this.hitLogic(),this.owner.layer.removeChild(this.missile,!1),this.firing=!1,this.locked&&jc.playEffectOnTarget(t.effect,this.locked,this.owner.layer)}.bind(this)),l=cc.Sequence.create(c,h);this.missile.runAction(l)}},RangeBehavior.prototype.handleRangeIdle=function(){this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam()),this.locked&&this.setState("move","move")},RangeBehavior.prototype.withinRangeRadius=function(e){return this.withinThisRadius(e,this.owner.getTargetRadius(),this.owner.getTargetRadius())};var DefenderBehavior=function(e){_.extend(this,new GeneralBehavior),this.init(e),this.handleTankIdle=this.handleIdle,this.handleIdle=this.handleDefenderIdle,this.think=this.defendThink};DefenderBehavior.prototype.handleSeek=function(){return this.support&&this.support.behavior.damager&&this.support.behavior.damager.isAlive()?(this.locked=this.support.behavior.damager,this.setState("attackmove","move"),void 0):(this.locked=this.lockOnEnemyInRadius(),this.locked?(this.setState("attackmove","move"),void 0):(this.support&&(this.targetWithinSeekRadius(this.support)||this.setState("move","move")),void 0))},DefenderBehavior.prototype.handleDefenderMove=function(e){var t=this.getWhereIShouldBe("front","away",this.support);return t=this.seek(t),0==t.x&&0==t.y?(this.setState("seek","idle"),void 0):(this.setState("idle","move"),this.moveToward(t,e),void 0)},DefenderBehavior.prototype.handleDefenderDamage=function(){this.damager&&this.damager.isAlive()&&this.damager!=this.locked&&this.isNot(["range","mage"],this.damager)?(this.locked=this.damager,this.setState("attackmove","move")):this.resume()},DefenderBehavior.prototype.defendThink=function(e){var t=this.getState();switch(this.handleDeath(),t.brain){case"idle":this.handleDefenderIdle(e);break;case"move":this.handleDefenderMove(e);break;case"attackmove":this.handleMove(e);break;case"fighting":this.handleFight(e);break;case"seek":this.handleSeek(e);break;case"damage":this.handleDefenderDamage(e)}this.afterEffects()},DefenderBehavior.prototype.handleDefenderIdle=function(e){this.support||(this.support=this.lockOnClosestFriendlyNonTank()),this.support&&this.support.isAlive()||(this.support=void 0,this.locked=this.lockOnClosestFriendlyNonTank()),this.support?this.setState("move","move"):this.handleTankIdle(e)};var FlankerBehavior=function(e){_.extend(this,new GeneralBehavior),this.init(e),this.handleTankIdle=this.handleIdle,this.handleIdle=this.handleFlankerIdle};FlankerBehavior.prototype.handleFlankerIdle=function(){this.locked||(this.locked=this.lockOnClosestNonTank()),this.locked&&!this.locked.isAlive()&&(this.locked=void 0,this.locked=this.lockOnClosestNonTank()),this.locked?this.setState("move","move"):this.handleTankIdle()};var HealerBehavior=function(e){_.extend(this,new GeneralBehavior),this.handleTankIdle=this.handleIdle,this.think=this.healThink,this.init(e)};HealerBehavior.prototype.healThink=function(e){var t=this.getState();switch(this.handleDeath(),t.brain){case"idle":this.handleHealerIdle(e);break;case"move":this.support?this.handleHealMove(e):this.handleMove(e);break;case"fighting":this.handleFight(e);break;case"healing":this.handleHeal(e);break;case"damage":this.handleDamage(e)}this.afterEffects()},HealerBehavior.prototype.handleHealerIdle=function(e){if(this.support&&this.support.isAlive()||(this.support=this.getClosestFriendToSupport()),this.support){if(!this.withinThisRadius(this.support.getBasePosition(),2*this.owner.getTargetRadius(),this.owner.getTargetRadiusY()/2))return this.setState("move","move"),void 0;if(this.support.gameObject.hp>0&&this.support.gameObject.hp<this.support.gameObject.MaxHP){{this.getState()}this.setState("healing","attack")}}else this.handleTankIdle(e)},HealerBehavior.prototype.handleHealMove=function(e){var t=this.getWhereIShouldBe("behind","facing",this.support);return t=this.seek(t),0==t.x&&0==t.y?(this.setState("healing","idle"),void 0):(this.setState("move","move"),this.moveToward(t,e),void 0)},HealerBehavior.prototype.handleHeal=function(e){var t=this.getState();if("attack"!=t.anim){if(!this.support)return this.setState("idle","idle"),void 0;if(!this.support.isAlive())return this.setState("idle","idle"),void 0;this.support.gameObject.hp>=this.support.gameObject.MaxHP&&this.setState("idle","idle");var i=this.owner.gameObject.actionDelays.heal,n=this.owner.gameObject.effectDelays.heal;return void 0==this.lastHeal&&(this.lastHeal=i),this.support.gameObject.hp<0||this.support.gameObject.hp>=this.support.gameObject.MaxHP?(this.setState("idle","idle"),this.lastHeal+=e,void 0):(this.lastHeal>=i&&"attack"!=t.anim?(this.owner.scheduleOnce(this.healLogic.bind(this),n),this.setState("healing","attack"),this.lastHeal=0):(this.lastHeal+=e,this.setState("healing",t.anim)),void 0)}};var TankBehavior=function(e){_.extend(this,new GeneralBehavior),this.init(e)},BehaviorMap={tank:TankBehavior,range:RangeBehavior,healer:HealerBehavior,flanker:FlankerBehavior,defender:DefenderBehavior},PanZoomTest=jc.WorldLayer.extend({init:function(){return this._super(shrine1Png)?(this.firstTouch=!0,!0):!1},targetTouchHandler:function(e,t){if(e==jc.touchEnded&&this.firstTouch);else if(e==jc.touchEnded&&!this.firstTouch){console.log(t);var i=this.screenToWorld(t);console.log(i);var n=this.worldToScreen(i);console.log(n)}}});PanZoomTest.create=function(){var e=new PanZoomTest;if(e&&e.init())return e;throw"Couldn't create the main layer of the game. Something is wrong."},PanZoomTest.scene=function(){return jc.panZoomTest||(jc.panZoomTest=cc.Scene.create(),jc.panZoomTest.layer=PanZoomTest.create(),jc.panZoomTest.addChild(jc.panZoomTest.layer)),jc.panZoomTest};var SelectTeam=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:140,cells:20,cardLayer:void 0,playMap:{},cellPrefix:"gridCells",init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.highlight=jc.makeSpriteWithPlist(uiPlist,uiPng,"portraitSmallSelected.png"),this.highlight.setVisible(!1),this.addChild(this.highlight),this.name="SelectTeam",jc.layerManager.pushLayer(this),this.first=!1,!0):!1},onShow:function(){if(this.nextEnabled=!0,this.first){if(void 0!=hotr.scratchBoard.selectedCharacter&&void 0!=hotr.scratchBoard.currentCell){var e=hotr.blobOperations.indexToId(hotr.scratchBoard.selectedCharacter),t=parseInt(hotr.scratchBoard.currentCell.replace(this.cellPrefix,""));e?(this.removeExistingVisual(e,t),this.doSelectionData(e,t),this.doSelectionVisual(e,t,hotr.scratchBoard.currentCell),hotr.scratchBoard.selectedCharacter=void 0,hotr.scratchBoard.currentCell=void 0):this[hotr.scratchBoard.currentCell].pic&&(jc.fadeOut(this[hotr.scratchBoard.currentCell].pic),hotr.blobOperations.clearFormationPosition(t))}}else{this.start();for(var i=hotr.blobOperations.getFormationOrder(),n=0;n<i.length;n++)if(void 0!=i[n]){var t=n;this.doSelectionData(i[n],t),this.doSelectionVisual(i[n],t,this.cellPrefix+n)}this.first=!0}},removeExistingVisual:function(e){var t=hotr.blobOperations.getCurrentFormationPosition(e);if(-1!=t){var i=this.cellPrefix+t;this[i].pic&&jc.fadeOut(this[i].pic)}},doSelectionVisual:function(e,t,i){var n=hotr.blobOperations.getEntryWithId(e),a=jc.getCharacterCard(n.name);this.scaleTo(a,this[i]),jc.scaleCard(a),this.centerThisPeer(a,this[i]),this[i].pic?jc.swapFade.bind(this)(this[i].pic,a):(this.addChild(a),jc.fadeIn(a,255)),this[i].pic=a,this.reorderChild(a,this[i].getZOrder()),this[i].border||(this[i].border=jc.makeSpriteWithPlist(uiPlist,uiPng,"portraitSmall.png"),this.addChild(this[i].border),this.centerThisPeer(this[i].border,this[i]),this.reorderChild(this[i].border,this[i].pic.getZOrder()+1))},doSelectionData:function(e,t){hotr.blobOperations.placeCharacterFormation(e,t)},previousFormation:function(){jc.log(["selectTeam"],"previousButton")},nextFormation:function(){jc.log(["selectTeam"],"nextButton")},fightStart:function(){this.nextEnabled&&hotr.mainScene.layer.arenaPre()},kikStart:function(){this.nextEnabled&&cards.kik.pickUsers(function(e){var t=(hotr.blobOperations.getLevel(),hotr.blobOperations.getTeam()),i=hotr.blobOperations.getFormation(),n=hotr.blobOperations.getPowers(),a={team:t,teamFormation:i,teamPowers:n};if(e)for(var r=0;r<e.length;r++)cards.kik.send(e[r].username,{title:"Get some",text:"My army will crush you",data:a})})},close:function(){jc.log(["selectTeam"],"close")},targetTouchHandler:function(e,t,i){if(i[0]&&e==jc.touchEnded){this.highlight.setVisible(!0);var n=i[0].getPosition();this.highlight.setPosition(n),this.reorderChild(this.highlight,i[0].getZOrder()+1),hotr.scratchBoard.currentCell=i[0].name,this.nextEnabled=!1,jc.layerManager.pushLayer(EditTeam.getInstance(),10)}return!0},windowConfig:{mainFrame:{cell:5,type:"sprite",transitionIn:"top",transitionOut:"top",sprite:"genericBackground.png",padding:{top:-10,left:0},z:1,kids:{gridCells:{isGroup:!0,z:2,type:"grid",cols:4,cell:7,anchor:["top"],padding:{top:50,left:10},itemPadding:{top:3,left:4},input:!0,members:[{type:"sprite",input:!0,sprite:"portraitSmallDarkBackground.png"}],membersTotal:12},formation:{cell:9,anchor:["left"],padding:{top:50,left:-200},type:"sprite",sprite:"formationFrame.png",z:2},description:{cell:5,anchor:["right"],padding:{top:40,left:123},type:"sprite",sprite:"descriptionWindow.png"},fightButton:{cell:2,anchor:["right"],padding:{top:0,left:0},type:"button",main:"buttonFight.png",pressed:"buttonFight.png",touchDelegateName:"fightStart"},kikButton:{cell:3,anchor:["left"],padding:{top:0,left:-10},type:"button",main:"buttonKikNormal.png",pressed:"buttonKikPressed.png",touchDelegateName:"kikStart"}}}}});SelectTeam.scene=function(){return hotr.selectTeamScene||(hotr.selectTeamScene=cc.Scene.create(),hotr.selectTeamScene.retain(),hotr.selectTeamScene.layer=new SelectTeam,hotr.selectTeamScene.layer.retain(),hotr.selectTeamScene.addChild(hotr.selectTeamScene.layer),jc.isBrowser||(hotr.selectTeamScene.layer.windowConfig.mainFrame.kids.gridCells.padding.left=-35,hotr.selectTeamScene.layer.windowConfig.mainFrame.kids.formation.padding.left=-100,hotr.selectTeamScene.layer.windowConfig.mainFrame.kids.description.padding.left=225,hotr.selectTeamScene.layer.windowConfig.mainFrame.kids.fightButton.padding.left=125,hotr.selectTeamScene.layer.windowConfig.mainFrame.padding.top=0,delete hotr.selectTeamScene.layer.windowConfig.mainFrame.kids.kikButton),hotr.selectTeamScene.layer.init()),hotr.selectTeamScene};var EditTeam=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:200,cells:20,cardLayer:void 0,playMap:{},init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.name="EditTeam",!0):!1},onShow:function(){if(this.letterBoxVertical(),this.start(),this.infoDialog=jc.makeSpriteWithPlist(uiPlist,uiPng,"titleDescription.png"),this.addChild(this.infoDialog),this.infoPos=jc.isBrowser?cc.p(this.winSize.width/2+230,this.winSize.height/2+145):cc.p(this.winSize.width/2+160,this.winSize.height/2+145),this.infoDialog.setPosition(this.infoPos),jc.fadeOut(this.infoDialog),!this.tableView){this.tableView=new jc.ScrollingLayer,this.characterPortraitsFrame.addChild(this.tableView);var e=this.getDisplaySpritesAndMetaData();this.tableView.init({sprites:e.sprites,metaData:e.ids,cellWidth:this.cellWidth,selectionCallback:this.selectionCallback.bind(this),width:this.winSize.width});var t=this.tableView.getPosition();t.y+=56,this.tableView.setPosition(t),this.reorderChild(this.tableView,3),this.tableView.hackOn(),this.tableView.setIndex(0)}},inTransitionsComplete:function(){this.statsFrame.card&&jc.fadeIn(this.statsFrame.card,255),this.characterPortraitsLeft.setZOrder(9),this.characterPortraitsRight.setZOrder(9),this.mainFrame.setZOrder(-1),this.statsFrame.setZOrder(2)},outTransitionsComplete:function(){jc.layerManager.popLayer()},makeScrollSprites:function(e){var t=_.map(e,function(e){return this.makeScrollSprite(e)}.bind(this)),i=jc.makeSimpleSprite("characterPortraitFrame.png");return t.push(i),t},makeScrollSprite:function(e){var t=jc.makeSimpleSprite("characterPortraitFrame.png");return t.pic=jc.getCharacterPortrait(e,t.getContentSize()),t.addChild(t.pic),this.scaleTo(t.pic,t),jc.scaleCard(t.pic),this.centerThisChild(t.pic,t),t.pic.setZOrder(-1),t
},getDisplaySpritesAndMetaData:function(){var e=hotr.blobOperations.getCharacterIdsAndTypes(),t=_.pluck(e,"name"),i=_.pluck(e,"id"),n=this.makeScrollSprites(t);return{ids:i,sprites:n}},getEmptyCells:function(e){for(var t=[],i=0;e>i;i++){var n=jc.makeSimpleSprite("characterPortraitFrame.png");this.cellWidth||(this.cellWidth=n.getTextureRect().width+100),t.push(n)}return t},targetTouchHandler:function(){return!0},trainPower:function(){jc.log(["editTeam"],"train")},doneButton:function(){hotr.scratchBoard.selectedCharacter=this.tableView.selectedIndex,this.close()},selectionCallback:function(e,t,i){if(i){var n=hotr.blobOperations.getEntryWithId(i);this.lastSelection=n;var a=jc.getCharacterCard(n.name);this.swapCharacterCard(a),this.placeElement(n),this.placeAttackTypes(n),this.updateStats(n)}else this.mainFrame.removeChild(this.statsFrame.card,!1),this.lastSelection=void 0,this.statsFrame.card=void 0,this.removeChild(this.statsFrame.element,!1),this.removeChild(this.statsFrame.info,!1),this.clearStats(),this.clearAttackTypes()},clearAttackTypes:function(){this.ground&&this.removeChild(this.ground,!1),this.air&&this.removeChild(this.air,!1)},placeAttackTypes:function(e){this.clearAttackTypes();var t=jc.getCapability(e.name);t.ground&&(this.ground=t.ground,this.addChild(t.ground),jc.isBrowser&&this.ground.setPosition(cc.p(205,545)),this.ground.setPosition(cc.p(105,520))),t.air&&(this.air=t.air,this.addChild(t.air),jc.isBrowser?this.air.setPosition(cc.p(275,545)):this.air.setPosition(cc.p(175,520)))},clearStats:function(){var e=jc.makeStats(),t="lbl";for(var i in e){var n=t+i;this[n]&&this.removeChild(this[n],!1)}},updateStats:function(e){var t=jc.makeStats(e.name);t=this.makeStringStats(t);var i=cc.size(80,20),n=cc.TEXT_ALIGNMENT_LEFT,a=16,r=jc.mainFont;if(jc.isBrowser)var s=cc.p(230,490);else var s=cc.p(160,470);var o=37,c=this.statsFrame.getZOrder()+1,h="lbl";for(var l in t){var d=h+l;this[d]&&this.removeChild(this[d],!1),this[d]=this.makeAndPlaceLabel(t[l],r,a,i,n,s,c),s.y-=o}},makeStringStats:function(e){for(var t in e)if(e[t]=e[t].toString(),e[t].length<7)for(var i=0;i<7-e[t].length;i++)e[t]+=" ";return e},makeAndPlaceLabel:function(e,t,i,n,a,r,s,o){o&&(o=this);var c=cc.LabelTTF.create(e,t,i,n,a);return this.addChild(c),c.setPosition(r),c.setZOrder(s),c},placeElement:function(e){var t=spriteDefs[e.name].elementType,i=jc.elementSprite(t);if(this.statsFrame.element&&this.removeChild(this.statsFrame.element,!1),this.statsFrame.info?this.statsFrame.info.setZOrder(this.statsFrame.getZOrder()+2):(this.statsFrame.info=new jc.CompositeButton,this.statsFrame.info.initWithDefinition({main:"infoButton.png",pressed:"infoButton.png"},this.infoTouch.bind(this),this.infoPress.bind(this)),jc.isBrowser?this.statsFrame.info.setPosition(cc.p(330,555)):this.statsFrame.info.setPosition(cc.p(240,535)),this.addChild(this.statsFrame.info)),i){this.statsFrame.element=i,this.addChild(this.statsFrame.element);{var n=(this.statsFrame.getPosition(),this.statsFrame.getZOrder());this.statsFrame.card.getTextureRect()}jc.isBrowser?i.setPosition(cc.p(580,275)):i.setPosition(cc.p(510,275)),i.setZOrder(n+2)}},infoPress:function(){this.buildInfoDialogForSelectedCharacter()},buildInfoDialogForSelectedCharacter:function(){var e=cc.size(200,20),t=cc.size(330,200),i=cc.TEXT_ALIGNMENT_CENTER,n=16,a=jc.mainFont,r=cc.p(795,600),s=cc.p(800,440),o=1,c=spriteDefs[this.lastSelection.name];this.infoDialog.title&&this.infoDialog.removeChild(this.infoDialog.title,!1),this.infoDialog.desc&&this.infoDialog.removeChild(this.infoDialog.desc,!1),this.infoDialog.title=this.makeAndPlaceLabel(c.formalName,a,n,e,i,r,o),this.infoDialog.desc=this.makeAndPlaceLabel(c.details,a,n,t,i,s,o),jc.fadeIn(this.infoDialog,255,2*jc.defaultTransitionTime,function(){this.scheduleOnce(this.infoFade.bind(this),2)}.bind(this))},infoTouch:function(){this.doInfoFadeOut=!0},infoFade:function(){this.doInfoFadeOut?(jc.fadeOut(this.infoDialog,2*jc.defaultTransitionTime),jc.fadeOut(this.infoDialog.title,2*jc.defaultTransitionTime),jc.fadeOut(this.infoDialog.desc,2*jc.defaultTransitionTime),this.doInfoFadeOut=!1):this.scheduleOnce(this.infoFade.bind(this),2)},swapCharacterCard:function(e){var t=this.statsFrame.getPosition();if(e.setPosition(cc.p(360,t.y-10)),this.statsFrame.card){var i=jc.swapFade.bind(this.mainFrame);i(this.statsFrame.card,e,!1)}else this.mainFrame.addChild(e);this.statsFrame.card=e,e.setZOrder(1),this.statsFrame.setZOrder(2)},previousChar:function(){this.tableView.left()},nextChar:function(){this.tableView.right()},close:function(){this.done(),this.statsFrame.card&&jc.fadeOut(this.statsFrame.card,1)},windowConfig:{mainFrame:{cell:5,type:"sprite",transitionIn:"top",transitionOut:"top",sprite:"genericBackground.png",padding:{top:-10,left:0},kids:{closeButton:{cell:9,anchor:["center","right"],padding:{top:0,left:0},type:"button",main:"closeButton.png",pressed:"closeButtonPressed.png",touchDelegateName:"close"},statsFrame:{cell:4,anchor:["center","left"],type:"sprite",sprite:"statsFrame.png",padding:{top:-125,left:55}},powerLevels:{isGroup:!0,type:"grid",cols:5,cell:8,anchor:["center"],padding:{top:9,left:65},itemPadding:{top:0,left:11},members:[{type:"sprite",sprite:"level_0000_Layer-6.png"}],membersTotal:5},powerIcons:{isGroup:!0,type:"grid",cols:5,cell:8,anchor:["center","bottom"],padding:{top:-60,left:77},itemPadding:{top:0,left:-2},input:!0,members:[{type:"sprite",input:!0,sprite:"powerIconSmallFrame.png"}],membersTotal:5},powerDesc:{type:"sprite",sprite:"powerIconsDescription.png",cell:5,anchor:["left"],padding:{top:-45,left:145}},nextLevel:{cell:5,anchor:["right"],padding:{top:45,left:5},type:"sprite",sprite:"nextLevelCostFrame.png"},trainButton:{type:"button",main:"buttonTrain.png",pressed:"buttonTrainPressed.png",touchDelegateName:"trainPower",cell:6,anchor:["left"],padding:{top:50,left:5}},doneButton:{type:"button",main:"buttonDone.png",pressed:"buttonDonePressed.png",touchDelegateName:"doneButton",cell:3,anchor:["left"],padding:{top:25,left:-30}},characterPortraitsFrame:{type:"sprite",sprite:"characterPortraitsFrame.png",cell:2,anchor:["top"],padding:{top:-20,left:-90}},characterPortraitsLeft:{type:"button",main:"characterPortraitsButtonLeft.png",pressed:"characterPortraitsButtonLeftPressed.png",touchDelegateName:"previousChar",cell:1,anchor:["top","left"],padding:{top:-15,left:0},z:10},characterPortraitsRight:{type:"button",main:"characterPortraitsButtonRight.png",pressed:"characterPortraitsButtonRightPressed.png",touchDelegateName:"nextChar",cell:3,anchor:["top"],padding:{top:-20,left:-30},z:10}}}}});EditTeam.getInstance=function(){return hotr.editTeam||(hotr.editTeam=new EditTeam,hotr.editTeam.retain(),jc.isBrowser||(hotr.editTeam.windowConfig.mainFrame.padding.top=0,hotr.editTeam.windowConfig.mainFrame.kids.characterPortraitsRight.padding.left=116,hotr.editTeam.windowConfig.mainFrame.kids.characterPortraitsFrame.padding.left=0,hotr.editTeam.windowConfig.mainFrame.kids.powerDesc.padding.left=200,hotr.editTeam.windowConfig.mainFrame.kids.powerDesc.padding.top=-45,hotr.editTeam.windowConfig.mainFrame.kids.nextLevel.padding.left=110,hotr.editTeam.windowConfig.mainFrame.kids.trainButton.padding.left=110,hotr.editTeam.windowConfig.mainFrame.kids.nextLevel.padding.top=25,hotr.editTeam.windowConfig.mainFrame.kids.trainButton.padding.top=35,hotr.editTeam.windowConfig.mainFrame.kids.powerLevels.padding.top=30,hotr.editTeam.windowConfig.mainFrame.kids.powerIcons.padding.top=-5,hotr.editTeam.windowConfig.mainFrame.kids.closeButton.padding.top=-100),hotr.editTeam.init()),hotr.editTeam};var Victory=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:200,cells:20,cardLayer:void 0,playMap:{},init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.name="Victory",!0):!1},onShow:function(){this.start()},inTransitionsComplete:function(){jc.log(["victory"],"in transition complete")},outTransitionsComplete:function(){jc.log(["victory"],"out transition complete")},targetTouchHandler:function(e,t,i){return console.log(i[0].name),!1},close:function(){this.onDone()},onDone:function(){},windowConfig:{mainFrame:{cell:5,type:"sprite",transitionIn:"topToMid",transitionOut:"top",sprite:"victoryScreenWindow.png",kids:{okButton:{cell:1,anchor:["center"],padding:{top:70,left:53},type:"button",main:"buttonOk.png",pressed:"buttonOk.png",touchDelegateName:"close",z:1}}}}}),Defeat=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:200,cells:20,cardLayer:void 0,playMap:{},init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.name="Defeat",!0):!1},onShow:function(){this.start()},inTransitionsComplete:function(){jc.log(["defeatdialog"],"oh noes")},outTransitionsComplete:function(){jc.log(["defeatdialog"],"oh noes")},targetTouchHandler:function(){return jc.log(["defeatdialog","touchcore"],"oh noes"),!1},close:function(){this.onDone()},onDone:function(){},windowConfig:{mainFrame:{cell:5,type:"sprite",transitionIn:"topToMid",transitionOut:"top",sprite:"defeatWindow.png",kids:{okButton:{cell:1,anchor:["center"],padding:{top:70,left:53},type:"button",main:"buttonOk.png",pressed:"buttonOk.png",touchDelegateName:"close",z:1}}}}}),Consts={};Consts.idle=0,Consts.walk=1,Consts.attack=2,Consts.intro=2,Consts.dead=3,Consts.powerup=4;var ArenaGame=jc.WorldLayer.extend({teamASprites:[],teamBSprites:[],sprites:[],teams:{},teamAPowers:void 0,teamBPowers:void 0,presentationSpeed:.2,timeLimit:6e4,init:function(){return this.name="Arena",this._super(arenaSheet)?(this.teams.a=[],this.teams.b=[],this.scheduleUpdate(),this.doConvert=!0,!0):!1},onShow:function(){hotr.arenaScene.data?this.runScenario():this.runScenario0()},runScenario:function(){this.teamASprites=hotr.arenaScene.data.teamA,this.teamAFormation=jc.formations[hotr.arenaScene.data.teamAFormation],this.teamAPowers=hotr.arenaScene.data.teamAPowers,this.teamBSprites=hotr.arenaScene.data.teamB,this.teamBFormation=jc.formations[hotr.arenaScene.data.teamBFormation],this.teamBPowers=hotr.arenaScene.data.teamBPowers,this.setUp()},runScenario0:function(){this.teamASprites.push("orge"),this.teamASprites.push("orge"),this.teamASprites.push("orge"),this.teamASprites.push("orge"),this.teamASprites.push("orge"),this.teamASprites.push("blueKnight"),this.teamASprites.push("blueKnight"),this.teamASprites.push("orge"),this.teamASprites.push("voidElf"),this.teamASprites.push("forestElf"),this.teamASprites.push("voidElf"),this.teamASprites.push("forestElf"),this.teamAFormation=jc.formations["4x4x4a"],this.teamBSprites.push("elementalStone"),this.teamBSprites.push("elementalStone"),this.teamBSprites.push("elementalStone"),this.teamBSprites.push("elementalStone"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBSprites.push("voidElf"),this.teamBFormation=jc.formations["4x4x4b"],this.setUp()},getSprite:function(e){var t;return t=jc.Sprite.spriteGenerator(spriteDefs,e,this),t.setState("idle"),this.addChild(t.batch),this.addChild(t),t.layer=this,t},setUp:function(){for(var e,t=0;t<this.teamASprites.length;t++)this.teamASprites[t]&&(e=this.getSprite(this.teamASprites[t].name),e.homeTeam=this.getTeam.bind(this,"a"),e.enemyTeam=this.getTeam.bind(this,"b"),e.team="a",e.setVisible(!1),this.teams.a[t]=e,this.touchTargets.push(e));for(var t=0;t<this.teamBSprites.length;t++)this.teamBSprites[t]&&(e=this.getSprite(this.teamBSprites[t].name),e.setFlippedX(!0),e.homeTeam=this.getTeam.bind(this,"b"),e.enemyTeam=this.getTeam.bind(this,"a"),e.team="b",e.setVisible(!1),this.teams.b[t]=e,this.touchTargets.push(e));this.present(function(){function e(e){return void 0!=e}this.teams.a=_.filter(this.teams.a,e),this.teams.b=_.filter(this.teams.b,e),this.sprites=this.teams.a.concat(this.teams.b),this.startedAt=Date.now(),this.started=!0,this.schedule(function(){this.doUpdate(.1)},.1)}.bind(this))},getTeam:function(e){return this.teams[e]},present:function(e){this.presentTeam(this.teams.a,this.teamAFormation,cc.p(this.worldSize.width/4,this.worldSize.height/2),function(){this.presentTeam(this.teams.b,this.teamBFormation,cc.p(this.worldSize.width/4*3,this.worldSize.height/2),function(){this.presentHud(this.teamAPowers,function(){e()}.bind(this))}.bind(this))}.bind(this))},nextTouchDo:function(e){this.nextTouchAction=e},presentHud:function(e,t){this.panToWorldPoint(this.worldMidPoint,this.getScaleOne(),jc.defaultTransitionTime,function(){this.placePowerTokens(e,t)}.bind(this))},placePowerTokens:function(e,t){t()},presentTeam:function(e,t,i,n){this.placeNextCharacter(e,t,n)},placeNextCharacter:function(e,t,i){void 0==this.nextChar&&(this.nextChar=0),this.placeCharacter(e[this.nextChar],t[this.nextChar],function(){this.nextChar++,this.nextChar>=e.length?(this.nextChar=void 0,i()):this.placeNextCharacter(e,t,i)}.bind(this))},placeCharacter:function(e,t,i){e?this.scheduleOnce(function(){this.panToWorldPoint(t,this.getScaleOne(),jc.defaultTransitionTime,function(){var n=t,a=this.convertToItemPosition(n);e.setBasePosition(a),e.setVisible(!0),jc.playEffectOnTarget("teleport",e,this),i()}.bind(this))},this.presentationSpeed):i()},update:function(e){for(var t=0;t<this.sprites.length;t++)this.sprites[t].behavior.handleMove(e)},doUpdate:function(e){var t=this.worldSize.width,i=0,n=this.worldSize.height,a=0,r=!1;if(this.started){if(this.checkWinner())return;for(var s=0;s<this.sprites.length;s++){if(this.sprites[s].getParent()==this){var o=this.sprites[s].getBasePosition(),r=!0,c=this.sprites[s].getTextureRect(),h=this.convertToWorldSpace(o),l=this.screenToWorld(h),d=l.x+c.width,u=l.x-c.width,p=l.y+1.5*c.height,f=l.y-c.height/2;d>i&&(i=d),t>u&&(t=u),p>a&&(a=p),n>f&&(n=f)}this.sprites[s].think(e)}var g=50;if(!this.scaleGate&&r){var m=cc.pMidpoint(cc.p(t,n),cc.p(i,a)),v=this.getOkayScale(i-t,a-n);if(this.lastPan)var y=cc.pSub(this.lastPan,m);else{this.lastPan=m;var y=cc.p(g+1,g+1)}(Math.abs(y.x)>g||Math.abs(y.y)>g)&&(this.lastPan=m,this.panToWorldPoint(m,v,jc.defaultTransitionTime,function(){this.scaleGate=!1}.bind(this)))}}},doBlood:function(){},getRandomBloodSpot:function(e){var t=e.getPosition(),i=e.getTextureRect(),n=jc.randomNum(i.width/2*-1,i.width/2);return t.x+=n,n=jc.randomNum(i.height/2*-1,i.height/2),t.y+=n,t},setSpriteTargetLocation:function(e,t){function i(t){jc.playEffectAtLocation("enemySelection",e,jc.shadowZOrder,this),this.selectedSprite.removeChild(this.selectedSprite.effectAnimations.characterSelect.sprite),this.selectedSprite.effectAnimations.characterSelect.playing=!1,this.nextTouchAction=void 0,this.selectedSprite.behavior.attackCommand(t)}function n(){jc.playEffectAtLocation("movement",e,jc.shadowZOrder,this),this.selectedSprite.removeChild(this.selectedSprite.effectAnimations.characterSelect.sprite),this.selectedSprite.effectAnimations.characterSelect.playing=!1,this.nextTouchAction=void 0,this.selectedSprite.behavior.followCommand(e)}if(t){var a=[];a=a.concat(this.getTeam("b")),a=a.concat(this.getTeam("a"));var r=this.getBestSpriteForTouch(e,t,a);r&&-1!=this.getTeam("b").indexOf(r)&&this.selectedSprite.behavior.canTarget(r)?i.bind(this)(r):r&&-1!=this.getTeam("a").indexOf(r)&&this.selectedSprite.behavior.canTarget(r)?n.bind(this)():n.bind(this)()}else n.bind(this)()},targetTouchHandler:function(e,t,i){if(e==jc.touchEnded){var n=t;if(this.nextTouchAction)this.nextTouchAction(n,i),this.nextTouchAction=void 0;else if(i){var a=this.getBestSpriteForTouch(n,i,this.getTeam("a"));a&&(jc.playEffectOnTarget("characterSelect",a,this,!0),this.selectedSprite=a,this.nextTouchAction=this.setSpriteTargetLocation.bind(this))}}return!0},getBestSpriteForTouch:function(e,t,i){for(var n,a=this.winSize.width,r=0;r<t.length;r++)if(t[r].getParent()==this&&-1!=i.indexOf(t[r])){var s=jc.getVectorTo(e,t[r].getPosition());s.distance<a&&(a=s.distance,n=t[r])}return n},checkWinner:function(){for(var e=!0,t=!0,i=0,n=0,a=this.getTeam("a"),r=this.getTeam("b"),s=0;s<a.length;s++)a[s].getParent()==this&&(e=!1),i++;for(var s=0;s<r.length;s++)r[s].getParent()==this&&(t=!1),n++;return t?(this.showVictory(),!0):e?(this.showDefeat(),!0):(this.timeExpired(),void 0)},showVictory:function(){this.started=!1,this.setScale(1),this.setPosition(cc.p(0,0)),this.victory=new Victory,this.victory.onDone=function(){this.removeChild(this.victory,!1),hotr.mainScene.layer.selectEditTeamPre()}.bind(this),this.victory.init(),this.addChild(this.victory)},showDefeat:function(){this.started=!1,this.setScale(1),this.setPosition(cc.p(0,0)),this.defeat=new Defeat,this.defeat.onDone=function(){this.removeChild(this.defeat,!1),hotr.mainScene.layer.selectEditTeamPre()}.bind(this),this.defeat.init(),this.addChild(this.defeat)},timeExpired:function(){var e=Date.now()-this.startedAt;return e>this.timeLimit?!0:!1}});ArenaGame.create=function(){var e=new ArenaGame;if(e&&e.init())return e;throw"Couldn't create the main layer of the game. Something is wrong."},ArenaGame.scene=function(){return hotr.arenaScene&&(hotr.arenaScene.layer.release(),hotr.arenaScene.release()),hotr.arenaScene=cc.Scene.create(),hotr.arenaScene.retain(),hotr.arenaScene.layer=ArenaGame.create(),hotr.arenaScene.layer.retain(),hotr.arenaScene.addChild(hotr.arenaScene.layer),hotr.arenaScene};var Consts={};Consts.idle=0,Consts.walk=1,Consts.attack=2,Consts.intro=2,Consts.dead=3,Consts.powerup=4;var AnimationTest=jc.TouchLayer.extend({character:"shadowKnight",effect:"select",init:function(){if(this._super()){if(MainGame.scene(),AnimationTest.loaded)this.go(),jc.playEffectOnTarget(this.effect,this.sprite,this,!1),this.bubbleAllTouches(!0);else{AnimationTest.loaded=!0;var e=[];this.character&&hotr.mainScene.layer.addAssetChain(e,this.character),this.effect&&(e.pushUnique(g_characterPlists[this.effect]),e.pushUnique(g_characterPngs[this.effect])),this.missile&&(e.pushUnique(g_characterPlists[this.missile]),e.pushUnique(g_characterPngs[this.missile]));for(var t=0;t<e.length;t++)e[t]={src:e[t]};for(var t=0;t<g_battleStuff.length;t++)e.push(g_battleStuff[t]);var i={assets:e,nextScene:"animationTest"},n=new Loading,a=cc.Director.getInstance().getRunningScene();a.addChild(n),n.init(i)}return!0}return!1},go:function(){if(this.sprite&&(this.removeChild(this.sprite,!1),this.sprite.cleanUp&&this.sprite.cleanUp(),this.sprite=void 0),this.character)this.makeChar(this.character);else if(this.effect)this.makeEffect(this.effect);else{if(!this.missile)throw"must set character, missile or effect";this.makeMissile(this.missile)}},makeChar:function(){this.sprite=jc.Sprite.spriteGenerator(spriteDefs,this.character,this),this.addChild(this.sprite),this.sprite.setBasePosition(cc.p(this.winSize.width/2,this.winSize.height/2)),this.sprite.setState("idle")},makeIt:function(e,t){var i=t;this.sprite=jc.makeSpriteWithPlist(i.plist,i.png,i.start),this.sprite.setPosition(cc.p(this.winSize.width/2,this.winSize.height/2)),this.sprite.setVisible(!0),this.addChild(this.sprite);var n=jc.makeAnimationFromRange(e,i);this.sprite.runAction(n)},makeEffect:function(){this.makeIt(this.effect,effectsConfig[this.effect])},makeMissile:function(){this.makeIt(this.missile,missileConfig[this.missile])},targetTouchHandler:function(){return this.go(),!0}});AnimationTest.create=function(){var e=new AnimationTest;if(e&&e.init())return e;throw"Couldn't create the main layer of the game. Something is wrong."},AnimationTest.scene=function(){var e=cc.Scene.create(),t=AnimationTest.create();return e.addChild(t),jc.animationTest=t,e};var Landing=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:140,cells:20,cardLayer:void 0,playMap:{},cellPrefix:"gridCells",init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(landingPlist),this.initFromConfig(this.windowConfig),!0):!1},onShow:function(){this.start()},quest:function(){},battle:function(){hotr.mainScene.layer.selectEditTeamPre()},summon:function(){},store:function(){},windowConfig:{mainFrame:{cell:5,type:"sprite",sprite:"landingScreen.png",padding:{top:-10,left:0},z:1,kids:{questButton:{cell:2,anchor:["left","top"],padding:{top:-55,left:-110},type:"button",main:"questButton.png",pressed:"questButtonPressed.png",touchDelegateName:"quest",z:2},battleButton:{cell:2,anchor:["right","top"],padding:{top:-55,left:-35},type:"button",main:"battleButton.png",pressed:"battleButtonPressed.png",touchDelegateName:"battle",z:2},summonButton:{cell:2,anchor:["left","center"],padding:{top:0,left:-110},type:"button",main:"summonButton.png",pressed:"summonPressed.png",touchDelegateName:"summon",z:2},storeButton:{cell:2,anchor:["right","center"],padding:{top:0,left:-35},type:"button",main:"storeButton.png",pressed:"storeButtonPressed.png",touchDelegateName:"summon",z:2}}}}});Landing.scene=function(){return hotr.landingScene||(hotr.landingScene=cc.Scene.create(),hotr.landingScene.layer=new Landing,jc.isBrowser||(hotr.landingScene.layer.windowConfig.mainFrame.kids.battleButton.padding.left=83,hotr.landingScene.layer.windowConfig.mainFrame.kids.storeButton.padding.left=83,hotr.landingScene.layer.windowConfig.mainFrame.kids.questButton.padding.left=-49,hotr.landingScene.layer.windowConfig.mainFrame.kids.summonButton.padding.left=-49),hotr.landingScene.addChild(hotr.landingScene.layer),hotr.landingScene.layer.init()),hotr.landingScene};var Loading=jc.UiElementsLayer.extend({init:function(e){return this.assets=e.assets,this.nextScene=e.nextScene,this.apiCalls=e.apiCalls,this.assetFunc=e.assetFunc,this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(loadingPlist),this.initFromConfig(this.windowConfig),this.start(),this.letterBoxVertical(),!0):!1},inTransitionsComplete:function(){this.animationDone=!0,this.spinner=jc.makeSpriteWithPlist(loadingPlist,loadingPng,"loader1.png"),this.addChild(this.spinner),this.spinner.setPosition(cc.p(this.winSize.width/2-3,this.winSize.height/2+51)),this.startLoading()},startLoading:function(){this.totalItemsToLoad=0,this.totalItemsCompleted=0,this.assets?this.totalItemsToLoad+=this.assets.length:this.assetFunc&&this.totalItemsToLoad++,this.apiCalls&&(this.totalItemsToLoad+=this.apiCalls.length),this.assetFunc?this.assetFunc(function(e){this.totalItemsCompleted++,this.assets=this.assets?this.assets.concat(e):e,this.totalItemsToLoad+=e.length,this.startLoadingAssets()}.bind(this)):this.startLoadingAssets(),this.apiCalls&&this.startLoadingApiCalls(),this.schedule(this.checkPercent)},startLoadingAssets:function(){cc.Loader.preload(this.assets,function(){this.ccLoaderDone=!0}.bind(this))},startLoadingApiCalls:function(){for(var e=async.queue(function(e,t){e.action(t)}.bind(this),2),t=0;t<this.apiCalls.length;t++)e.push({name:t,action:this.apiCalls[t]},function(){this.totalItemsCompleted++}.bind(this));e.drain=function(){jc.log(["loader"],"apiCalls done")}.bind(this)},raiseComplete:function(){this.done(),this.unschedule(this.checkPercent),hotr.changeScene(this.nextScene)},slideWallLeft:function(e){var t=this.leftDoor.getTextureRect(),i=0-t.width,n=this.winSize.height/2,a=this.winSize.width/2-t.width/2,r=n,s=cc.p(a,r);this.slide(this.leftDoor,cc.p(i,n),s,jc.defaultTransitionTime,void 0,void 0,e)},slideWallRight:function(e){var t=this.rightDoor.getTextureRect(),i=this.winSize.width+t.width,n=this.winSize.height/2,a=this.winSize.width/2+t.width/2,r=n,s=cc.p(a,r);this.slide(this.rightDoor,cc.p(i,n),s,jc.defaultTransitionTime,void 0,void 0,e)},getPercentage:function(){return 100},checkPercent:function(){if(this.animationDone){var e,t=20;e=jc.isBrowser?cc.Loader.getInstance().getPercentage:this.getPercentage;var i=0,n=0;this.assets?(1==this.ccLoaderDone?i=100:(i=e(),i>100&&(i=100)),n=i*this.assets.length/100):n=0;var a=n+this.totalItemsCompleted,r=Math.floor(a/this.totalItemsToLoad*100),s=Math.floor(r*t/100);1>s&&(s=1),s>t&&(s=t);var o=cc.SpriteFrameCache.getInstance().getSpriteFrame("loader"+s+".png");if(this.spinner.setDisplayFrame(o),a>=this.totalItemsToLoad){var o=cc.SpriteFrameCache.getInstance().getSpriteFrame("loader20.png");this.spinner.setDisplayFrame(o),this.scheduleOnce(this.raiseComplete.bind(this))}}},windowConfig:{leftDoor:{type:"sprite",transitionIn:"custom",executeIn:"slideWallLeft",transitionOut:"left",cell:4,anchor:["left"],sprite:"leftDoor.png",padding:{left:10}},rightDoor:{type:"sprite",transitionIn:"custom",executeIn:"slideWallRight",transitionOut:"right",cell:6,anchor:["right"],sprite:"rightDoor.png",padding:{left:-10}}}});Array.prototype.pushUnique=function(e){if(!e)throw"Attempting to load undefined value.";-1==this.indexOf(e)&&this.push(e)};var MainGame=cc.Layer.extend({state:0,signThis:"yoyoyoyoyosignthissonsignitsignitsignit",init:function(){return this._super()?!0:!1},changeScene:function(e){switch(this.loader&&cc.Director.getInstance().getRunningScene().removeChild(this.loader,!0),e){case"selectTeam":cc.Director.getInstance().replaceScene(SelectTeam.scene());break;case"editTeam":cc.Director.getInstance().replaceScene(EditTeam.scene());break;case"arena":cc.Director.getInstance().replaceScene(hotr.arenaScene);break;case"landing":cc.Director.getInstance().replaceScene(Landing.scene());break;case"animationTest":cc.Director.getInstance().replaceScene(AnimationTest.scene())}},showLoader:function(e){this.loader=new Loading;var t=cc.Director.getInstance().getRunningScene();t.addChild(this.loader),this.loader.init(e)},selectEditTeamPre:function(){var e=this.makeCardDictionary();e=e.concat(g_ui),this.showLoader({assets:e,nextScene:"selectTeam"})},arenaPre:function(){ArenaGame.scene();var e=hotr.blobOperations.getTeam(),t=hotr.blobOperations.getLevel(),i=hotr.blobOperations.getFormation(),n=hotr.blobOperations.getPowers();if(cards.kik.message)var a=cards.kik.message.team,r="4x4x4b",s=cards.kik.message.powers;else var a=hotr.levelLogic.getTeamForLevel(t),r=hotr.levelLogic.getFormationForLevel(t),s=hotr.levelLogic.getPowers();var o={teamA:e,teamAFormation:i,teamB:a,teamBFormation:r,teamAPowers:n,teamBPowers:s,offense:"a"};this.doArena(o)},doArena:function(e){hotr.arenaScene.data=e;var t=this.makeAssetDictionary(e.teamA,e.teamB,e.teamAPowers,e.teamBPowers);this.showLoader({assets:t,apiCalls:[function(e){hotr.blobOperations.saveBlob(function(){e()})}],nextScene:"arena"})},onEnter:function(){jc.log(["mainLayer"],"main starting"),cards.kik.getUser(function(e){jc.log(["mainLayer"],"getUser:"+e),this.startGame(e)}.bind(this))},doArenaDev:function(){ArenaGame.scene();var e=[{name:"dragonRed"}],t="4x4x4a",i=[{name:"orge"}],n="4x4x4b",a={teamA:e,teamAFormation:t,teamB:i,teamBFormation:n,teamAPowers:[],teamBPowers:[],offense:"a"};hotr.arenaScene.data=a;var r=this.makeAssetDictionary(a.teamA,a.teamB,a.teamAPowers,a.teamBPowers);this.showLoader({assets:r,nextScene:"arena"})},startGame:function(e){var t=hotr.blobOperations.hasPlayed(),i=hotr.blobOperations.hasToken(),n=hotr.blobOperations.getUserName();i&&e==n?(jc.log(["mainLayer"],"hasToken"),this.initGame(e)):t&&e==n?(jc.log(["mainLayer"],"hasPlayed"),this.authorizeAndInitGame()):(jc.log(["mainLayer"],"newPlayer"),this.authorizeNewPlayer(e))},authorizeNewPlayer:function(){jc.log(["mainLayer"],"authorizeNewPlayer"),cards.kik.sign(this.signThis,function(e,t,i){jc.log(["mainLayer"],"sign"),jc.log(["mainLayer"],"signedData:"+JSON.stringify(e)),jc.log(["mainLayer"],"username:"+JSON.stringify(t)),jc.log(["mainLayer"],"host:"+JSON.stringify(i)),hotr.blobOperations.createNewPlayer(e,t,i,function(){this.startingScene()}.bind(this))}.bind(this))},authorizeAndInitGame:function(){cards.kik.sign(this.signThis,function(e,t,i){hotr.blobOperations.getNewAuthTokenAndBlob(e,t,i,function(){this.startingScene()}.bind(this))}.bind(this))},initGame:function(e){hotr.blobOperations.getBlob(function(t){t?this.startingScene():this.authorizeNewPlayer(e)}.bind(this))},startingScene:function(){this.changeScene("landing")},makeCardDictionary:function(){var e=hotr.blobOperations.getCharacterNames(),t=[];_.map(e,function(e){var i=this.getCardAssets(e);t.pushUnique(i.cardPng),t.pushUnique(i.cardPlist)}.bind(this));for(var i=0;i<t.length;i++)t[i]={src:t[i]};return t},getCardAssets:function(e){var t=spriteDefs[e].cardIndex;return void 0==t&&(t=0),{cardPng:cardsPngs[t],cardPlist:cardsPlists[t]}},makeAssetDictionary:function(e,t,i){for(var n=[],a=0;a<e.length;a++)if(e[a]){var r=e[a].name;this.addAssetChain(n,r)}for(var a=0;a<t.length;a++)if(t[a]){var r=t[a].name;this.addAssetChain(n,r)}for(var a=0;a<i.length;a++){var r=i[a];this.addPowerAssets(n,r)}for(var a=0;a<i.length;a++){var r=i[a];this.addPowerAssets(n,r)}n.pushUnique(g_characterPlists.greenbullet),n.pushUnique(g_characterPngs.greenbullet),n.pushUnique(g_characterPlists.greenBang),n.pushUnique(g_characterPngs.greenBang);for(var a=0;a<n.length;a++)n[a]={src:n[a]};for(var a=0;a<g_battleStuff.length;a++)n.pushUnique(g_battleStuff[a]);return n},addPowerAssets:function(e,t){var i=powerAnimationsRequired[t];if(i)for(var n=0;n<i.length;n++)e.pushUnique(g_characterPlists[i[n]]),e.pushUnique(g_characterPngs[i[n]])},addAssetChain:function(e,t){if(e.pushUnique(g_characterPlists[t]),e.pushUnique(g_characterPngs[t]),spriteDefs[t].effect&&(e.pushUnique(g_characterPlists[spriteDefs[t].effect]),e.pushUnique(g_characterPngs[spriteDefs[t].effect])),spriteDefs[t].gameProperties&&spriteDefs[t].gameProperties.missile){e.pushUnique(g_characterPlists[spriteDefs[t].gameProperties.missile]),e.pushUnique(g_characterPngs[spriteDefs[t].gameProperties.missile]);var i=missileConfig[spriteDefs[t].gameProperties.missile];i.effect&&(e.pushUnique(g_characterPlists[i.effect]),e.pushUnique(g_characterPngs[i.effect]))}if(spriteDefs[t].powers){var n=spriteDefs[t].powers;for(var a in n)for(var r=powerAnimationsRequired[a],s=0;s<r.length;s++)e.pushUnique(g_characterPlists[r[s]]),e.pushUnique(g_characterPngs[r[s]])}if(spriteDefs[t].damageMods){var n=spriteDefs[t].damageMods;for(var a in n)for(var r=powerAnimationsRequired[a],s=0;s<r.length;s++)e.pushUnique(g_characterPlists[r[s]]),e.pushUnique(g_characterPngs[r[s]])}if(spriteDefs[t].deathMods){var n=spriteDefs[t].deathMods;for(var a in n)for(var r=powerAnimationsRequired[a],s=0;s<r.length;s++)e.pushUnique(g_characterPlists[r[s]]),e.pushUnique(g_characterPngs[r[s]])}}}),hotr=hotr||{};MainGame.create=function(){var e=new MainGame;if(e&&e.init())return e;throw"Couldn't create the main layer of the game. Something is wrong."},MainGame.scene=function(){return hotr.mainScene||(hotr.mainScene=cc.Scene.create(),hotr.mainScene.layer=MainGame.create(),hotr.mainScene.layer.retain(),hotr.mainScene.addChild(hotr.mainScene.layer)),hotr.changeScene=hotr.mainScene.layer.changeScene.bind(hotr.mainScene.layer),hotr.mainScene};var PowerHud=jc.UiElementsLayer.extend({tiles:3,init:function(e){if(this.name="powerHud",this.myTiles=[],this._super()){cc.SpriteFrameCache.getInstance().addSpriteFrames(powerTilesPlist),cc.SpriteFrameCache.getInstance().addSpriteFrames(windowPlist),this.initFromConfig(PowerHud.windowConfig);for(var t=this.tiles>e.length?e.length:this.tiles,i=0;t>i;i++){var n="tile"+i;this[n].initFromName(e[i],this),this.myTiles.push(this[n])}return!0}return!1},setSelected:function(e){for(var t=0;t<this.tiles;t++)this["tile"+t]!=e&&this["tile"+t].setUnselected();e.setSelected()},scheduleThisOnce:function(e,t){this.scheduleOnce(e,t)},targetTouchHandler:function(){return!1},onShow:function(){jc.log(["powerHud"],"show")}});PowerHud.windowConfig={portraitFrame:{cell:1,anchor:["left"],type:"scale9",transitionIn:"bottom",transitionOut:"bottom",scaleRect:jc.UiConf.frame19Rect,size:{width:50,height:25},sprite:"frame 19.png",padding:{left:0},kids:{tiles:{isGroup:!0,type:"line",cell:1,size:{width:33,height:33},anchor:["left"],padding:{left:15,top:-3},itemPadding:{left:10,top:-25},members:[{type:"tile",name:"tile0"},{type:"tile",name:"tile1"},{type:"tile",name:"tile2"}]}}}};