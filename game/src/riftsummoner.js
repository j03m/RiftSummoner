var jc=jc||{};jc.isBrowser="undefined"===typeof window?!1:!0;jc=jc||{};
if(!jc.isBrowser){var runBrowserMock=function(){window=jc;jc.addEventListener=function(a,c){c()};jc.removeEventListener=function(){};document={};"complete"===document.readyState;if("undefined"===typeof a)var a=jc;"undefined"===typeof setTimeout&&(setTimeout=function(a,c){c/=1E4;cc.Director.getInstance().getScheduler().scheduleCallbackForTarget(this,a,0,0,c,void 0)});"undefined"===typeof setInterval&&(setInterval=function(a,c){c/=1E4;cc.Director.getInstance().getScheduler().scheduleCallbackForTarget(this,a,
c,0,0,void 0)});"undefined"===typeof console&&(console={log:function(a){jc.log(["console"],a)}});cc.Color3B=function(a,c,d){return cc.c4f(a,c,d,1)};cc.white=function(){return new cc.Color3B(255,255,255)};cc.yellow=function(){return new cc.Color3B(255,255,0)};cc.blue=function(){return new cc.Color3B(0,0,255)};cc.green=function(){return new cc.Color3B(0,255,0)};cc.red=function(){return new cc.Color3B(255,0,0)};cc.magenta=function(){return new cc.Color3B(255,0,255)};cc.black=function(){return new cc.Color3B(0,
0,0)};cc.orange=function(){return new cc.Color3B(255,127,0)};cc.gray=function(){return new cc.Color3B(166,166,166)}};runBrowserMock()};!function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=d.push,g=d.slice,k=d.concat,n=e.toString,p=e.hasOwnProperty,s=d.forEach,t=d.map,r=d.reduce,q=d.reduceRight,m=d.filter,l=d.every,w=d.some,y=d.indexOf,G=d.lastIndexOf,e=Array.isArray,J=Object.keys,A=Function.prototype.bind,h=function(a){return a instanceof h?a:this instanceof h?(this._wrapped=a,void 0):new h(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports._=h):a._=
h;h.VERSION="1.5.1";var u=h.each=h.forEach=function(a,b,d){if(null!=a)if(s&&a.forEach===s)a.forEach(b,d);else if(a.length===+a.length)for(var e=0,f=a.length;f>e&&b.call(d,a[e],e,a)!==c;e++);else for(e in a)if(h.has(a,e)&&b.call(d,a[e],e,a)===c)break};h.map=h.collect=function(a,b,c){var d=[];return null==a?d:t&&a.map===t?a.map(b,c):(u(a,function(a,e,v){d.push(b.call(c,a,e,v))}),d)};h.reduce=h.foldl=h.inject=function(a,b,c,d){var e=2<arguments.length;if(null==a&&(a=[]),r&&a.reduce===r)return d&&(b=
h.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(u(a,function(a,v,h){e?c=b.call(d,c,a,v,h):(c=a,e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");return c};h.reduceRight=h.foldr=function(a,b,c,d){var e=2<arguments.length;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=h.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f)var l=h.keys(a),f=l.length;if(u(a,function(h,k,g){k=l?l[--f]:--f;e?c=b.call(d,c,a[k],k,g):(c=a[k],e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");
return c};h.find=h.detect=function(a,b,c){var d;return z(a,function(a,e,v){return b.call(c,a,e,v)?(d=a,!0):void 0}),d};h.filter=h.select=function(a,b,c){var d=[];return null==a?d:m&&a.filter===m?a.filter(b,c):(u(a,function(a,e,v){b.call(c,a,e,v)&&d.push(a)}),d)};h.reject=function(a,b,c){return h.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)};h.every=h.all=function(a,b,d){b||(b=h.identity);var e=!0;return null==a?e:l&&a.every===l?a.every(b,d):(u(a,function(a,v,h){return(e=e&&b.call(d,a,v,h))?
void 0:c}),!!e)};var z=h.some=h.any=function(a,b,d){b||(b=h.identity);var e=!1;return null==a?e:w&&a.some===w?a.some(b,d):(u(a,function(a,v,h){return e||(e=b.call(d,a,v,h))?c:void 0}),!!e)};h.contains=h.include=function(a,b){return null==a?!1:y&&a.indexOf===y?-1!=a.indexOf(b):z(a,function(a){return a===b})};h.invoke=function(a,b){var c=g.call(arguments,2),d=h.isFunction(b);return h.map(a,function(a){return(d?b:a[b]).apply(a,c)})};h.pluck=function(a,b){return h.map(a,function(a){return a[b]})};h.where=
function(a,b,c){return h.isEmpty(b)?c?void 0:[]:h[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})};h.findWhere=function(a,b){return h.where(a,b,!0)};h.max=function(a,b,c){if(!b&&h.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&h.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return u(a,function(a,e,v){e=b?b.call(c,a,e,v):a;e>d.computed&&(d={value:a,computed:e})}),d.value};h.min=function(a,b,c){if(!b&&h.isArray(a)&&a[0]===+a[0]&&
65535>a.length)return Math.min.apply(Math,a);if(!b&&h.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return u(a,function(a,e,v){e=b?b.call(c,a,e,v):a;e<d.computed&&(d={value:a,computed:e})}),d.value};h.shuffle=function(a){var b,c=0,d=[];return u(a,function(a){b=h.random(c++);d[c-1]=d[b];d[b]=a}),d};var B=function(a){return h.isFunction(a)?a:function(b){return b[a]}};h.sortBy=function(a,b,c){var d=B(b);return h.pluck(h.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,
b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var H=function(a,b,c,d){var e={},f=B(null==b?h.identity:b);return u(a,function(b,h){var l=f.call(c,b,h,a);d(e,l,b)}),e};h.groupBy=function(a,b,c){return H(a,b,c,function(a,b,c){(h.has(a,b)?a[b]:a[b]=[]).push(c)})};h.countBy=function(a,b,c){return H(a,b,c,function(a,b){h.has(a,b)||(a[b]=0);a[b]++})};h.sortedIndex=function(a,b,c,d){c=null==c?h.identity:B(c);b=c.call(d,
b);for(var e=0,f=a.length;f>e;){var l=e+f>>>1;c.call(d,a[l])<b?e=l+1:f=l}return e};h.toArray=function(a){return a?h.isArray(a)?g.call(a):a.length===+a.length?h.map(a,h.identity):h.values(a):[]};h.size=function(a){return null==a?0:a.length===+a.length?a.length:h.keys(a).length};h.first=h.head=h.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:g.call(a,0,b)};h.initial=function(a,b,c){return g.call(a,0,a.length-(null==b||c?1:b))};h.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-
1]:g.call(a,Math.max(a.length-b,0))};h.rest=h.tail=h.drop=function(a,b,c){return g.call(a,null==b||c?1:b)};h.compact=function(a){return h.filter(a,h.identity)};var I=function(a,b,c){return b&&h.every(a,h.isArray)?k.apply(c,a):(u(a,function(a){h.isArray(a)||h.isArguments(a)?b?f.apply(c,a):I(a,b,c):c.push(a)}),c)};h.flatten=function(a,b){return I(a,b,[])};h.without=function(a){return h.difference(a,g.call(arguments,1))};h.uniq=h.unique=function(a,b,c,d){h.isFunction(b)&&(d=c,c=b,b=!1);c=c?h.map(a,c,
d):a;var e=[],f=[];return u(c,function(c,d){(b?d&&f[f.length-1]===c:h.contains(f,c))||(f.push(c),e.push(a[d]))}),e};h.union=function(){return h.uniq(h.flatten(arguments,!0))};h.intersection=function(a){var b=g.call(arguments,1);return h.filter(h.uniq(a),function(a){return h.every(b,function(b){return 0<=h.indexOf(b,a)})})};h.difference=function(a){var b=k.apply(d,g.call(arguments,1));return h.filter(a,function(a){return!h.contains(b,a)})};h.zip=function(){for(var a=h.max(h.pluck(arguments,"length").concat(0)),
b=Array(a),c=0;a>c;c++)b[c]=h.pluck(arguments,""+c);return b};h.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c};h.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=h.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(y&&a.indexOf===y)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1};h.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(G&&a.lastIndexOf===
G)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=d?c:a.length;c--;)if(a[c]===b)return c;return-1};h.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,h=Array(d);d>e;)h[e++]=a,a+=c;return h};var C=function(){};h.bind=function(a,b){var c,d;if(A&&a.bind===A)return A.apply(a,g.call(arguments,1));if(!h.isFunction(a))throw new TypeError;return c=g.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(g.call(arguments)));
C.prototype=a.prototype;var e=new C;C.prototype=null;var h=a.apply(e,c.concat(g.call(arguments)));return Object(h)===h?h:e}};h.partial=function(a){var b=g.call(arguments,1);return function(){return a.apply(this,b.concat(g.call(arguments)))}};h.bindAll=function(a){var b=g.call(arguments,1);if(0===b.length)throw Error("bindAll must be passed function names");return u(b,function(b){a[b]=h.bind(a[b],a)}),a};h.memoize=function(a,b){var c={};return b||(b=h.identity),function(){var d=b.apply(this,arguments);
return h.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}};h.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};h.defer=function(a){return h.delay.apply(h,[a,1].concat(g.call(arguments,1)))};h.throttle=function(a,b,c){var d,e,h,f=null,l=0;c||(c={});var k=function(){l=!1===c.leading?0:new Date;f=null;h=a.apply(d,e)};return function(){var g=new Date;l||!1!==c.leading||(l=g);var w=b-(g-l);return d=this,e=arguments,0>=w?(clearTimeout(f),f=null,l=g,h=a.apply(d,
e)):f||!1===c.trailing||(f=setTimeout(k,w)),h}};h.debounce=function(a,b,c){var d,e=null;return function(){var h=this,f=arguments,l=c&&!e;return clearTimeout(e),e=setTimeout(function(){e=null;c||(d=a.apply(h,f))},b),l&&(d=a.apply(h,f)),d}};h.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}};h.wrap=function(a,b){return function(){var c=[a];return f.apply(c,arguments),b.apply(this,c)}};h.compose=function(){var a=arguments;return function(){for(var b=
arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};h.after=function(a,b){return function(){return 1>--a?b.apply(this,arguments):void 0}};h.keys=J||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)h.has(a,c)&&b.push(c);return b};h.values=function(a){var b=[],c;for(c in a)h.has(a,c)&&b.push(a[c]);return b};h.pairs=function(a){var b=[],c;for(c in a)h.has(a,c)&&b.push([c,a[c]]);return b};h.invert=function(a){var b={},c;for(c in a)h.has(a,c)&&(b[a[c]]=
c);return b};h.functions=h.methods=function(a){var b=[],c;for(c in a)h.isFunction(a[c])&&b.push(c);return b.sort()};h.extend=function(a){return u(g.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a};h.pick=function(a){var b={},c=k.apply(d,g.call(arguments,1));return u(c,function(c){c in a&&(b[c]=a[c])}),b};h.omit=function(a){var b={},c=k.apply(d,g.call(arguments,1)),e;for(e in a)h.contains(c,e)||(b[e]=a[e]);return b};h.defaults=function(a){return u(g.call(arguments,1),function(b){if(b)for(var c in b)void 0===
a[c]&&(a[c]=b[c])}),a};h.clone=function(a){return h.isObject(a)?h.isArray(a)?a.slice():h.extend({},a):a};h.tap=function(a,b){return b(a),a};var D=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof h&&(a=a._wrapped);b instanceof h&&(b=b._wrapped);var e=n.call(a);if(e!=n.call(b))return!1;switch(e){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==
+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var f=a.constructor,l=b.constructor;if(f!==l&&!(h.isFunction(f)&&f instanceof f&&h.isFunction(l)&&l instanceof l))return!1;c.push(a);d.push(b);f=0;l=!0;if("[object Array]"==e){if(f=a.length,l=f==b.length)for(;f--&&(l=D(a[f],b[f],c,d)););}else{for(var k in a)if(h.has(a,k)&&(f++,
!(l=h.has(b,k)&&D(a[k],b[k],c,d))))break;if(l){for(k in b)if(h.has(b,k)&&!f--)break;l=!f}}return c.pop(),d.pop(),l};h.isEqual=function(a,b){return D(a,b,[],[])};h.isEmpty=function(a){if(null==a)return!0;if(h.isArray(a)||h.isString(a))return 0===a.length;for(var b in a)if(h.has(a,b))return!1;return!0};h.isElement=function(a){return!(!a||1!==a.nodeType)};h.isArray=e||function(a){return"[object Array]"==n.call(a)};h.isObject=function(a){return a===Object(a)};u("Arguments Function String Number Date RegExp".split(" "),
function(a){h["is"+a]=function(b){return n.call(b)=="[object "+a+"]"}});h.isArguments(arguments)||(h.isArguments=function(a){return!(!a||!h.has(a,"callee"))});"function"!=typeof/./&&(h.isFunction=function(a){return"function"==typeof a});h.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};h.isNaN=function(a){return h.isNumber(a)&&a!=+a};h.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==n.call(a)};h.isNull=function(a){return null===a};h.isUndefined=function(a){return void 0===
a};h.has=function(a,b){return p.call(a,b)};h.noConflict=function(){return a._=b,this};h.identity=function(a){return a};h.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d};h.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var x={escape:{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"}};x.unescape=h.invert(x.escape);var K={escape:RegExp("["+h.keys(x.escape).join("")+"]",
"g"),unescape:RegExp("("+h.keys(x.unescape).join("|")+")","g")};h.each(["escape","unescape"],function(a){h[a]=function(b){return null==b?"":(""+b).replace(K[a],function(b){return x[a][b]})}});h.result=function(a,b){if(null!=a){var c=a[b];return h.isFunction(c)?c.call(a):c}};h.mixin=function(a){u(h.functions(a),function(b){var c=h[b]=a[b];h.prototype[b]=function(){var a=[this._wrapped];return f.apply(a,arguments),E.call(this,c.apply(h,a))}})};var L=0;h.uniqueId=function(a){var b=++L+"";return a?a+
b:b};h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;h.template=function(a,b,c){var d;c=h.defaults({},c,h.templateSettings);var e=RegExp([(c.escape||F).source,(c.interpolate||F).source,(c.evaluate||F).source].join("|")+"|$","g"),f=0,l="__p+\x3d'";a.replace(e,function(b,c,d,e,h){return l+=a.slice(f,h).replace(N,function(a){return"\\"+
M[a]}),c&&(l+="'+\n((__t\x3d("+c+"))\x3d\x3dnull?'':_.escape(__t))+\n'"),d&&(l+="'+\n((__t\x3d("+d+"))\x3d\x3dnull?'':__t)+\n'"),e&&(l+="';\n"+e+"\n__p+\x3d'"),f=h+b.length,b});l+="';\n";c.variable||(l="with(obj||{}){\n"+l+"}\n");l="var __t,__p\x3d'',__j\x3dArray.prototype.join,print\x3dfunction(){__p+\x3d__j.call(arguments,'');};\n"+l+"return __p;\n";try{d=new Function(c.variable||"obj","_",l)}catch(k){throw k.source=l,k;}if(b)return d(b,h);b=function(a){return d.call(this,a,h)};return b.source=
"function("+(c.variable||"obj")+"){\n"+l+"}",b};h.chain=function(a){return h(a).chain()};var E=function(a){return this._chain?h(a).chain():a};h.mixin(h);u("pop push reverse shift sort splice unshift".split(" "),function(a){var b=d[a];h.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],E.call(this,c)}});u(["concat","join","slice"],function(a){var b=d[a];h.prototype[a]=function(){return E.call(this,b.apply(this._wrapped,arguments))}});
h.extend(h.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);(function(){function a(a){var b=!1;return function(){if(b)throw Error("Callback was already called.");b=!0;a.apply(c,arguments)}}var b={},c,d;c=this;null!=c&&(d=c.async);b.noConflict=function(){c.async=d;return b};var e=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},f=function(a,b){if(a.map)return a.map(b);var c=[];e(a,function(a,d,e){c.push(b(a,d,e))});return c},g=function(a,b,c){if(a.reduce)return a.reduce(b,c);e(a,function(a,d,e){c=b(c,a,d,e)});return c},
k=function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!==typeof process&&process.nextTick?(b.nextTick=process.nextTick,b.setImmediate="undefined"!==typeof setImmediate?setImmediate:b.nextTick):(b.nextTick="function"===typeof setImmediate?function(a){setImmediate(a)}:function(a){setTimeout(a,0)},b.setImmediate=b.nextTick);b.each=function(b,c,d){d=d||function(){};if(!b.length)return d();var f=0;e(b,function(e){c(e,a(function(a){a?
(d(a),d=function(){}):(f+=1,f>=b.length&&d(null))}))})};b.forEach=b.each;b.eachSeries=function(a,b,c){c=c||function(){};if(!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})};e()};b.forEachSeries=b.eachSeries;b.eachLimit=function(a,b,c,d){n(b).apply(null,[a,c,d])};b.forEachLimit=b.eachLimit;var n=function(a){return function(b,c,d){d=d||function(){};if(!b.length||0>=a)return d();var e=0,f=0,h=0;(function z(){if(e>=b.length)return d();
for(;h<a&&f<b.length;)f+=1,h+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,h-=1,e>=b.length?d():z())})})()}},p=function(a){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,[b.each].concat(c))}},s=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[n(a)].concat(c))}},t=function(a){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,[b.eachSeries].concat(c))}},r=function(a,b,c,d){var e=
[];b=f(b,function(a,b){return{index:b,value:a}});a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d;b(c)})},function(a){d(a,e)})};b.map=p(r);b.mapSeries=t(r);b.mapLimit=function(a,b,c,d){return s(b,r)(a,c,d)};b.reduce=function(a,c,d,e){b.eachSeries(a,function(a,b){d(c,a,function(a,d){c=d;b(a)})},function(a){e(a,c)})};b.inject=b.reduce;b.foldl=b.reduce;b.reduceRight=function(a,c,d,e){a=f(a,function(a){return a}).reverse();b.reduce(a,c,d,e)};b.foldr=b.reduceRight;var q=function(a,b,c,d){var e=[];
b=f(b,function(a,b){return{index:b,value:a}});a(b,function(a,b){c(a.value,function(c){c&&e.push(a);b()})},function(a){d(f(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};b.filter=p(q);b.filterSeries=t(q);b.select=b.filter;b.selectSeries=b.filterSeries;q=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}});a(b,function(a,b){c(a.value,function(c){c||e.push(a);b()})},function(a){d(f(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};
b.reject=p(q);b.rejectSeries=t(q);q=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};b.detect=p(q);b.detectSeries=t(q);b.some=function(a,c,d){b.each(a,function(a,b){c(a,function(a){a&&(d(!0),d=function(){});b()})},function(a){d(!1)})};b.any=b.some;b.every=function(a,c,d){b.each(a,function(a,b){c(a,function(a){a||(d(!1),d=function(){});b()})},function(a){d(!0)})};b.all=b.every;b.sortBy=function(a,c,d){b.map(a,function(a,b){c(a,function(c,d){c?b(c):
b(null,{value:a,criteria:d})})},function(a,b){if(a)return d(a);d(null,f(b.sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),function(a){return a.value}))})};b.auto=function(a,c){c=c||function(){};var d=k(a);if(!d.length)return c(null);var f={},t=[],q=function(a){t.unshift(a)},h=function(){e(t.slice(0),function(a){a()})};q(function(){k(f).length===d.length&&(c(null,f),c=function(){})});e(d,function(d){var r=a[d]instanceof Function?[a[d]]:a[d],m=function(a){var l=Array.prototype.slice.call(arguments,
1);1>=l.length&&(l=l[0]);if(a){var g={};e(k(f),function(a){g[a]=f[a]});g[d]=l;c(a,g);c=function(){}}else f[d]=l,b.setImmediate(h)},s=r.slice(0,Math.abs(r.length-1))||[],p=function(){return g(s,function(a,b){return a&&f.hasOwnProperty(b)},!0)&&!f.hasOwnProperty(d)};if(p())r[r.length-1](m,f);else{var n=function(){if(p()){a:for(var a=n,b=0;b<t.length;b+=1)if(t[b]===a){t.splice(b,1);break a}r[r.length-1](m,f)}};q(n)}})};b.waterfall=function(a,c){c=c||function(){};if(a.constructor!==Array)return c(Error("First argument to waterfall must be an array of functions"));
if(!a.length)return c();var d=function(a){return function(e){if(e)c.apply(null,arguments),c=function(){};else{var f=Array.prototype.slice.call(arguments,1),h=a.next();h?f.push(d(h)):f.push(c);b.setImmediate(function(){a.apply(null,f)})}}};d(b.iterator(a))()};var m=function(a,b,c){c=c||function(){};if(b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);b.call(null,a,c)})},c);else{var d={};a.each(k(b),function(a,c){b[a](function(b){var e=
Array.prototype.slice.call(arguments,1);1>=e.length&&(e=e[0]);d[a]=e;c(b)})},function(a){c(a,d)})}};b.parallel=function(a,c){m({map:b.map,each:b.each},a,c)};b.parallelLimit=function(a,b,c){m({map:s(b,r),each:n(b)},a,c)};b.series=function(a,c){c=c||function(){};if(a.constructor===Array)b.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);b.call(null,a,c)})},c);else{var d={};b.eachSeries(k(a),function(b,c){a[b](function(a){var e=Array.prototype.slice.call(arguments,
1);1>=e.length&&(e=e[0]);d[b]=e;c(a)})},function(a){c(a,d)})}};b.iterator=function(a){var b=function(c){var d=function(){a.length&&a[c].apply(null,arguments);return d.next()};d.next=function(){return c<a.length-1?b(c+1):null};return d};return b(0)};b.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};q=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]);b(a)})},function(a){d(a,
e)})};b.concat=p(q);b.concatSeries=t(q);b.whilst=function(a,c,d){a()?c(function(e){if(e)return d(e);b.whilst(a,c,d)}):d()};b.doWhilst=function(a,c,d){a(function(e){if(e)return d(e);c()?b.doWhilst(a,c,d):d()})};b.until=function(a,c,d){a()?d():c(function(e){if(e)return d(e);b.until(a,c,d)})};b.doUntil=function(a,c,d){a(function(e){if(e)return d(e);c()?d():b.doUntil(a,c,d)})};b.queue=function(c,d){function f(a,c,k,l){c.constructor!==Array&&(c=[c]);e(c,function(c){c={data:c,callback:"function"===typeof l?
l:null};k?a.tasks.unshift(c):a.tasks.push(c);a.saturated&&a.tasks.length===d&&a.saturated();b.setImmediate(a.process)})}void 0===d&&(d=1);var k=0,g={tasks:[],concurrency:d,saturated:null,empty:null,drain:null,push:function(a,b){f(g,a,!1,b)},unshift:function(a,b){f(g,a,!0,b)},process:function(){if(k<g.concurrency&&g.tasks.length){var b=g.tasks.shift();g.empty&&0===g.tasks.length&&g.empty();k+=1;var d=a(function(){k-=1;b.callback&&b.callback.apply(b,arguments);g.drain&&0===g.tasks.length+k&&g.drain();
g.process()});c(b.data,d)}},length:function(){return g.tasks.length},running:function(){return k}};return g};b.cargo=function(a,c){var d=!1,k=[],g={tasks:k,payload:c,saturated:null,empty:null,drain:null,push:function(a,d){a.constructor!==Array&&(a=[a]);e(a,function(a){k.push({data:a,callback:"function"===typeof d?d:null});g.saturated&&k.length===c&&g.saturated()});b.setImmediate(g.process)},process:function h(){if(!d)if(0===k.length)g.drain&&g.drain();else{var b="number"===typeof c?k.splice(0,c):
k.splice(0),t=f(b,function(a){return a.data});g.empty&&g.empty();d=!0;a(t,function(){d=!1;var a=arguments;e(b,function(b){b.callback&&b.callback.apply(null,a)});h()})}},length:function(){return k.length},running:function(){return d}};return g};q=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!==typeof console&&(b?console.error&&console.error(b):console[a]&&e(c,function(b){console[a](b)}))}]))}};
b.log=q("log");b.dir=q("dir");b.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),k=b.apply(null,e);k in c?f.apply(null,c[k]):k in d?d[k].push(f):(d[k]=[f],a.apply(null,e.concat([function(){c[k]=arguments;var a=d[k];delete d[k];for(var b=0,e=a.length;b<e;b++)a[b].apply(null,arguments)}])))};e.memo=c;e.unmemoized=a;return e};b.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}};b.times=
function(a,c,d){for(var e=[],f=0;f<a;f++)e.push(f);return b.map(e,c,d)};b.timesSeries=function(a,c,d){for(var e=[],f=0;f<a;f++)e.push(f);return b.mapSeries(e,c,d)};b.compose=function(){var a=Array.prototype.reverse.call(arguments);return function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();b.reduce(a,d,function(a,b,d){b.apply(c,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,b){e.apply(c,[a].concat(b))})}};q=function(a,b){var c=
function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};b.applyEach=p(q);b.applyEachSeries=t(q);b.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d;}a(c)}c()};"undefined"!==typeof define&&define.amd?define([],function(){return b}):"undefined"!==typeof module&&module.exports?module.exports=b:c.async=b})();var spriteDefs={dragon:{name:"dragon",parentOnly:!0,byStep:3,startFrame:1,endFrame:780,targetRadius:100,step:1,animations:{move:{start:178,end:188,delay:0.1,type:0},attack:{start:206,end:230,delay:0.1,type:1},dead:{start:242,end:255,delay:0.1,type:1},idle:{start:178,end:188,delay:0.1,type:0}},behavior:"range"},dragonFire:{name:"dragonFire",formalName:"Fire Dragon",details:"These small dragons are aerial terrors that do massive damage to the ground units below them. However, they have a difficulty targeting other air born units. Fire Dragons inflict additional burn damage to targets and splash damage to surrounding units.",
elementType:"fire",unitType:2,damageMods:{splashDamage:{damage:50,radius:200},burn:{damage:50,duration:1,interval:0.25}},gameProperties:{MaxHP:500,speed:160,damage:250,missile:"ballFire",missileOffset:{x:0,y:10},flightAug:{x:25,y:100},missleTarget:"base",movementType:0,targets:1,actionDelays:{attack:5},effectDelays:{attack:1},targetRadius:200,seekRadius:50},inherit:"dragon"},dragonVoid:{name:"dragonVoid",formalName:"Void Dragon",details:"These small dragons are aerial terrors doing massive damage to ground units below but they have a difficulty targeting other air born units.",
elementType:"void",unitType:1,special:"None",gameProperties:{MaxHP:700,speed:260,movementType:0,missile:"ballVoid",missileOffset:{x:0,y:10},missleTarget:"base",targets:1,damage:300,actionDelays:{attack:1},effectDelays:{attack:1},targetRadius:200,seekRadius:50},inherit:"dragon"},dwarvenKnight:{name:"dwarvenKnight",parentOnly:!0,animations:{move:{start:70,end:93,delay:0.02,type:0},attack:{start:100,end:145,delay:0.025,type:1},attack2:{start:140,end:180,delay:0.025,type:1},attack3:{start:180,end:250,
delay:0.025,type:1},idle:{start:1,end:60,delay:0.02,type:0},dead:{start:300,end:370,delay:0.02,type:1}},behavior:"tank"},dwarvenKnightEarth:{name:"dwarvenKnightEarth",formalName:"Dwarven Knight - Earth",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with earth magic these dwarves are particularly hard to kill.",elementType:"earth",unitType:3,gameProperties:{MaxHP:1300,speed:50,movementType:1,targets:1,damage:25,actionDelays:{attack:0.5},effectDelays:{attack:0.05},
targetRadius:100,seekRadius:100},inherit:"dwarvenKnight"},dwarvenKnightFire:{name:"dwarvenKnightFire",formalName:"Dwarven Knight - Fire",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with fire magic, this dwarf is completely immune to fire element attackers.",elementType:"fire",unitType:3,gameProperties:{MaxHP:700,speed:50,movementType:1,targets:1,damage:25,defense:{fire:100},actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},
inherit:"dwarvenKnight"},dwarvenKnightLife:{name:"dwarvenKnightLife",formalName:"Dwarven Knight - Life",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with life magic, this dwarf is immune to poison and life based attackers.",elementType:"life",unitType:3,gameProperties:{MaxHP:700,speed:50,damage:25,movementType:1,targets:1,defense:{life:100},actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"dwarvenKnight"},dwarvenKnightVoid:{name:"dwarvenKnightVoid",
formalName:"Dwarven Knight - Void",details:"Dwarven Knights are known for being very difficult to kill. His armor embued with void magic, this dwarf is immune to void powers and drains the life of his targets.",elementType:"void",unitType:3,damageMods:{vampireDrain:{heal:20,damage:20}},gameProperties:{MaxHP:700,speed:50,damage:35,movementType:1,targets:1,defense:{"void":100},actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"dwarvenKnight"},dwarvenKnightWater:{name:"dwarvenKnightWater",
formalName:"Dwarven Knight - Water",details:"Dwarven Knights are known for being very difficult to kill. With armor embued with water magic, this dwarf regenerates health over time.",elementType:"water",unitType:3,powers:{regeneration:{heal:20,interval:0.5}},gameProperties:{MaxHP:700,speed:50,damage:25,movementType:1,targets:1,actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"dwarvenKnight"},elemental1:{name:"elemental1",byStep:2,startFrame:1,endFrame:550,
parentOnly:!0,animations:{move:{start:41,end:65,delay:0.08,type:0},attack:{start:71,end:92,delay:0.08,type:1},attack2:{start:101,end:125,delay:0.08,type:1},idle:{start:1,end:37,delay:0.08,type:0},dead:{start:131,end:152,delay:0.08,type:1}},behavior:"tank"},elemental2:{name:"elemental2",parentOnly:!0,animations:{move:{start:91,end:126,delay:0.02,type:0},attack:{start:131,end:190,delay:0.025,type:1},idle:{start:1,end:75,delay:0.02,type:0},dead:{start:271,end:330,delay:0.02,type:1}},behavior:"range"},
elementalEarth:{name:"elementalEarth",formalName:"Stone Elemental",details:"Extraordinarily powerful, but slow moving.",elementType:"earth",unitType:3,special:"None",gameProperties:{MaxHP:2E3,speed:20,damage:100,movementType:1,targets:1,actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"elemental1"},elementalFire:{name:"elementalFire",formalName:"Fire Elemental",details:"Extraordinarily powerful, but slow moving. These elementals inflict additional burn damage.",
elementType:"fire",unitType:3,damageMods:{burn:{damage:20,duration:1,interval:0.25}},gameProperties:{MaxHP:1E3,speed:20,damage:250,movementType:1,targets:1,actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"elemental1"},elementalWater:{name:"elementalWater",formalName:"Water Elemental",details:"Fast elemental creatures that fire at range. Water elementals also have regenerative abilities.",elementType:"water",unitType:3,special:"None",powers:{regeneration:{heal:20,
interval:0.5}},gameProperties:{MaxHP:200,speed:50,damage:75,movementType:1,targets:2,actionDelays:{attack:2},effectDelays:{attack:1},targetRadius:500,seekRadius:100},inherit:"elemental2"},elementalWind:{name:"elementalWind",formalName:"Wind Elemental",details:"Fast elemental creatures that fire at range. Wind elementals have knock back capability.",elementType:"air",unitType:3,damageMods:{knockBack:{distance:30}},gameProperties:{MaxHP:500,speed:70,damage:50,movementType:1,targets:2,actionDelays:{attack:2},
effectDelays:{attack:1},targetRadius:500,seekRadius:100},inherit:"elemental2"},elf:{name:"elf",parentOnly:!0,byStep:3,startFrame:1,endFrame:1820,animations:{move:{start:244,end:251,delay:0.08,type:0},attack:{start:454,end:471,delay:0.08,type:1},idle:{start:422,end:432,delay:0.08,type:0},dead:{start:287,end:298,delay:0.08,type:1}},behavior:"range"},elfEarth:{name:"elfEarth",formalName:"Plains Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. Plains Elves are heartier and faster then their other elven cousins.",
elementType:"earth",unitType:4,special:"None",gameProperties:{MaxHP:300,resistsRange:50,movementType:1,targets:2,missile:"arrowNormal",damage:35,speed:85,actionDelays:{attack:0.5},effectDelays:{attack:1},targetRadius:1200},inherit:"elf"},elfFire:{name:"elfFire",formalName:"Fire Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. These elves have arrows that burn their targets alive.",elementType:"earth",unitType:4,special:"None",damageMods:{burn:{damage:25,
duration:1,interval:0.5}},gameProperties:{MaxHP:100,movementType:1,targets:2,missile:"arrowFire",damage:35,speed:55,actionDelays:{attack:0.5},effectDelays:{attack:1},targetRadius:1200},inherit:"elf"},elfLife:{name:"elfLife",formalName:"Forest Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. Forest Elves deal poison damage with each arrow.",elementType:"life",unitType:4,damageMods:{poison:{damage:10,duration:5,interval:0.25}},gameProperties:{MaxHP:100,
damage:25,movementType:1,targets:2,missile:"arrowPoison",poisonDamage:10,speed:55,actionDelays:{attack:0.5},effectDelays:{attack:1},targetRadius:1200,seekRadius:50},inherit:"elf"},elfVoid:{name:"elfVoid",formalName:"Dark Elf",details:"Elves are powerful archers dealing decent damage while they stay safely at range. Touched with Void magic, Dark Elves have the magic arrows that steal life from targets and give it to all allies on the board.",elementType:"void",unitType:4,damageMods:{vampireDistro:{heal:10,
damage:20}},gameProperties:{MaxHP:200,damage:45,movementType:1,missile:"arrowVoid",targets:2,speed:55,actionDelays:{attack:0.5},effectDelays:{attack:1},targetRadius:1200},inherit:"elf"},gargoyle:{name:"gargoyle",parentOnly:!0,byStep:3,startFrame:1,endFrame:787,flip:!0,animations:{move:{start:1,end:8,delay:0.08,type:0},attack:{start:34,end:49,delay:0.08,type:1},dead:{start:58,end:73,delay:0.08,type:1},idle:{start:1,end:8,delay:0.08,type:0}},behavior:"range"},gargoyleFire:{name:"gargoyleFire",formalName:"Fire Demon",
details:"An winged creature embued with elemental fire. It possesses magic that it uses to attack other air or ground targets. Fire demons inflict additional burn damage to enemies.",elementType:"fire",unitType:0,special:"Splash Damage, Burn Damage",damageMods:{burn:{damage:5,duration:1,interval:0.25}},gameProperties:{MaxHP:200,speed:100,movementType:0,targets:2,damage:50,resistsRange:25,missile:"magicFire",splashDamage:5,actionDelays:{attack:0.05},effectDelays:{attack:0.01},flightAug:{x:25,y:100},
targetRadius:200},inherit:"gargoyle"},gargoyleVoid:{name:"gargoyleVoid",formalName:"Void Demon",details:"An winged creature embued with the void. It possesses magic that it uses to destroy other air targets.",elementType:"void",special:"None",gameProperties:{MaxHP:200,movementType:0,targets:2,speed:100,damage:100,missile:"magicVoid",resistsRange:25,vsAirDamage:5,actionDelays:{attack:0.01},effectDelays:{attack:0.01},flightAug:{x:25,y:100},targetRadius:200,seekRadius:200},inherit:"gargoyle"},goblin:{name:"goblin",
cardIndex:0,portraitXy:{x:181,y:72},formalName:"Goblin Demolition Expert",details:"Goblin demolition experts hurl explosives at enemies. While they don't have an impressive range, they can inflict massive damage on groups of ground enemies.",elementType:"fire",unitType:3,flip:!0,special:"Splash Damage",damageMods:{splashDamage:{damage:100,radius:200}},deathMods:{explodeFire:{damage:25,radius:200,burn:{damage:50,duration:5,interval:0.5}}},gameProperties:{MaxHP:50,movementType:1,targets:1,missile:"bomb",
damage:80,speed:55,actionDelays:{attack:0.5},effectDelays:{attack:0.5},targetRadius:300},animations:{move:{start:80,end:90,delay:0.03,type:0},attack:{start:315,end:353,delay:0.03,type:1},idle:{start:1,end:60,delay:0.05,type:0},dead:{start:450,end:550,delay:0.01,type:1}},behavior:"range"},goblinKnight:{name:"goblinKnight",parentOnly:!0,animations:{move:{start:70,end:93,delay:0.02,type:0},attack:{start:100,end:145,delay:0.025,type:1},attack2:{start:140,end:180,delay:0.025,type:1},attack3:{start:180,
end:250,delay:0.025,type:1},idle:{start:1,end:60,delay:0.02,type:0},dead:{start:300,end:370,delay:0.02,type:1}},behavior:"tank"},goblinKnightBile:{name:"goblinKnightBile",formalName:"Goblin Knight - Plains",details:"Goblin Knights are fast and do reasonable damage. Plains goblins are incredibly fast runners.",elementType:"none",unitType:3,special:"Burn Damage",gameProperties:{MaxHP:200,speed:170,movementType:1,targets:1,resistsRange:50,damage:25,actionDelays:{attack:0.5},effectDelays:{attack:0.05},
targetRadius:100,seekRadius:100},inherit:"goblinKnight"},goblinKnightBlood:{name:"goblinKnightBlood",cardIndex:0,portraitXy:{x:186,y:265},formalName:"Goblin Knight - Blood",details:"Goblin Knights are fast and do reasonable damage. These blood goblins are tougher, faster then their cousins.",elementType:"none",unitType:3,special:"Burn Damage",gameProperties:{MaxHP:500,speed:80,movementType:1,targets:1,damage:35,actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},
inherit:"goblinKnight"},goblinKnightFire:{name:"goblinKnightFire",formalName:"Goblin Knight - Fire",details:"Goblin Knights are fast and do reasonable damage. These fire goblins live near magma in deep caves are resist immune to fire based damage.",elementType:"fire",unitType:3,special:"Resist Fire",gameProperties:{MaxHP:200,speed:80,movementType:1,targets:1,defense:{fire:100},damage:35,actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"goblinKnight"},goblinKnightNormal:{name:"goblinKnightNormal",
formalName:"Goblin Knight",details:"Goblin Knights are fast and do reasonable damage.",elementType:"none",unitType:3,special:"Resist Fire",gameProperties:{MaxHP:250,speed:70,movementType:1,targets:1,damage:25,actionDelays:{attack:0.5},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"goblinKnight"},knight:{name:"knight",parentOnly:!0,startFrame:1,endFrame:2050,flip:!0,byStep:3,animations:{move:{start:4,end:27,delay:0.08,type:0},attack:{start:144,end:174,delay:0.08,type:1},attack2:{start:174,
end:206,delay:0.08,type:1},dead:{start:387,end:419,delay:0.08,type:1},idle:{start:461,end:486,delay:0.08,type:0}},behavior:"tank"},knightEarth:{name:"knightEarth",formalName:"Elemental Knight - Earth",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of earth, this unit has almost 2x the health of other elemental knights.",elementType:"earth",unitType:3,special:"None",gameProperties:{MaxHP:1E3,speed:20,damage:160,movementType:1,
targets:1,actionDelays:{attack:1},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"knight"},knightFire:{name:"knightFire",formalName:"Elemental Knight - Fire",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of fire, this unit deals additional burn damage to its targets.",elementType:"fire",unitType:3,damageMods:{burn:{damage:50,duration:2,interval:0.25}},gameProperties:{MaxHP:500,speed:20,damage:200,
movementType:1,targets:1,actionDelays:{attack:1},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"knight"},knightVoid:{name:"knightVoid",formalName:"Elemental Knight - Void",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of the void, this unit saps life from nearby enemies, healing itself.",elementType:"void",unitType:3,effect:"vampireRadius",powers:{vampireRadius:{damage:10,radius:200,interval:0.25}},
gameProperties:{MaxHP:500,speed:20,movementType:1,targets:1,damage:160,actionDelays:{attack:1},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100},inherit:"knight"},knightWater:{name:"knightWater",formalName:"Elemental Knight - Water",details:"Elemental Knights are heavy tank units that are slow, but deal massive amounts of damage. Embued with the elemental power of water, this unit also heals any units nearby.",elementType:"water",unitType:3,effect:"healingRadius",gameProperties:{MaxHP:500,
movementType:1,targets:1,speed:20,damage:160,actionDelays:{attack:0.05},effectDelays:{attack:0.05},targetRadius:100,seekRadius:100,heal:30},powers:{healingRadius:{heal:5,interval:0.25,radius:300}},inherit:"knight"},monsterbase:{name:"monsterbase",parentOnly:!0,startFrame:1,endFrame:48,byStep:1,animations:{move:{start:145,end:167,delay:0.02,type:0},attack:{start:1,end:24,delay:0.02,type:1},attack2:{start:25,end:48,delay:0.02,type:1},idle:{start:121,end:137,delay:0.02,type:0},damage:{start:49,end:60,
delay:0.02,type:1},dead:{start:72,end:120,delay:0.02,type:1}}},ogre:{name:"ogre",formalName:"Ogre",byStep:1,flip:!0,cardIndex:0,portraitXy:{x:241,y:122},details:"Ogres are massive, powerful creatures. Though they are slow movers, you do not want to be at the wrong end of their weapons.",elementType:"none",unitType:3,special:"None",targetRadius:150,startFrame:1,endFrame:204,gameProperties:{movementType:1,targets:1,MaxHP:1500,speed:15,damage:300,actionDelays:{attack:1},effectDelays:{attack:0.9},targetRadius:60},
animations:{move:{start:50,end:72,delay:0.06,type:0},attack:{start:74,end:115,delay:0.04,type:1},attack2:{start:122,end:151,delay:0.04,type:1},idle:{start:1,end:48,delay:0.02,type:0},dead:{start:169,end:203,delay:0.06,type:1}},behavior:"tank"},orc:{name:"orc",flip:!0,formalName:"Orc Warrior",details:"Orcs are fast, fierce attackers. What they lack in heavy armor, they make up for in pure tenacity.",elementType:"none",unitType:3,special:"None",gameProperties:{MaxHP:400,speed:55,movementType:1,targets:1,
damage:50,actionDelays:{attack:0.25},effectDelays:{attack:0.5},targetRadius:100},baseOffset:{x:-20,y:-5},byStep:1,animations:{move:{start:18,end:40,delay:0.04,type:0},attack:{start:42,end:63,delay:0.03,type:1},attack2:{start:66,end:89,delay:0.03,type:1},idle:{start:1,end:17,delay:0.04,type:0},dead:{start:102,end:130,delay:0.04,type:1}},behavior:"tank"},scowerer:{name:"scowerer",formalName:"Void Scavenger",details:"Weak, dog-like creatures that are trained to rush archers and healers. When killed the scowerer will burst and a poison acid will cover anyone nearby.",
elementType:"life",unitType:3,special:"None",deathMods:{explodePoison:{damage:200,radius:300,poison:{damage:25,duration:5,interval:0.25}}},gameProperties:{MaxHP:10,movementType:1,targets:1,speed:200,damage:25,actionDelays:{attack:0.01},effectDelays:{attack:0.01},targetRadius:100},animations:{move:{start:11,end:30,delay:0.03,type:0},attack:{start:31,end:70,delay:0.025,type:1},idle:{start:1,end:1,delay:0.03,type:0},dead:{start:71,end:95,delay:0.03,type:1}},behavior:"flanker"},shellback:{name:"shellback",
formalName:"Shellback Raider",details:"Heavily armored and fast, shellbacks are mindless attack animals trained to lock onto and kill weaker archers and healers.",elementType:"none",unitType:3,special:"None",gameProperties:{MaxHP:400,movementType:1,targets:1,speed:200,damage:25,actionDelays:{attack:0.01},effectDelays:{attack:0.01},targetRadius:100},animations:{move:{start:72,end:88,delay:0.02,type:0},attack:{start:198,end:249,delay:0.025,type:1},idle:{start:91,end:151,delay:0.02,type:0},dead:{start:283,
end:320,delay:0.02,type:1}},behavior:"flanker"},snakeThing:{name:"snakeThing",formalName:"Serpent Guardian",details:"Heavily armored and fast, serpent guardians were once summoned to the defense of powerful mages. When summoned, the guardian will attach itself to a range or support unit and guard it until death.",elementType:"none",unitType:3,special:"None",gameProperties:{MaxHP:150,speed:140,movementType:1,targets:1,damage:45,actionDelays:{attack:0.2},effectDelays:{attack:0.5},targetRadius:100,seekRadius:150},
animations:{move:{start:53,end:84,delay:0.02,type:0},attack:{start:90,end:150,delay:0.025,type:1},idle:{start:10,end:45,delay:0.02,type:0},dead:{start:275,end:315,delay:0.02,type:1}},behavior:"defender"},spider:{name:"spider",formalName:"Arachnon Guardian",details:"These guardians will choose and defend a target to death dealing heavy damage from their bladed legs and injecting enemies with poison. They do not however, have much armor and are easily killed.",elementType:"life",unitType:3,flip:!0,
special:"Poison",damageMods:{poison:{damage:50,duration:5,interval:0.5}},gameProperties:{MaxHP:500,speed:200,movementType:1,targets:1,resistsRange:50,damage:55,actionDelays:{attack:0.2},effectDelays:{attack:0.5},targetRadius:100,seekRadius:300},animations:{move:{start:164,end:189,delay:0.02,type:0},attack:{start:192,end:221,delay:0.025,type:1},idle:{start:1,end:32,delay:0.02,type:0},dead:{start:332,end:400,delay:0.02,type:1}},behavior:"defender"},troll:{name:"troll",formalName:"Goblin Cleric",details:"These small trolls are expert in healing magic. They will stay back, supporting your warriors and healing them in battle.",
elementType:"none",unitType:3,special:"Healing",gameProperties:{MaxHP:100,speed:100,movementType:1,targets:2,damage:10,heal:70,actionDelays:{attack:0.5,heal:0.4},effectDelays:{attack:0.05,heal:0.05},targetRadius:200},baseOffset:{x:0,y:10},byStep:1,animations:{move:{start:25,end:49,delay:0.025,type:0},attack:{start:50,end:71,delay:0.02,type:1},idle:{start:1,end:24,delay:0.02,type:0},dead:{start:109,end:145,delay:0.06,type:1}},behavior:"healer"},wizard:{name:"wizard",formalName:"Goblin Wizard",details:"These goblins are masters of destructive magic and can do serious damage at an impressive range.",
elementType:"none",unitType:4,special:"None",gameProperties:{MaxHP:100,movementType:1,targets:2,speed:50,damage:80,missile:"magicNormal",actionDelays:{attack:0.05},effectDelays:{attack:0.05},targetRadius:600},baseOffset:{x:0,y:10},animations:{move:{start:26,end:48,delay:0.05,type:0},attack:{start:49,end:72,delay:0.05,type:1},attack2:{start:73,end:97,delay:0.05,type:1},idle:{start:1,end:24,delay:0.05,type:0},dead:{start:110,end:155,delay:0.06,type:1}},behavior:"range"}};var missileConfig={greenbullet:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"greenbullet.1.png",effect:"hit",frames:27,delay:0.02,first:9,speed:300,height:150},arrowFire:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"arrowFire.1.png",hasDirection:!0,rotation:"arrow",initialAngle:-45,path:"arrow",speed:350,height:200,frames:6,delay:0.02},arrowPoison:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"arrowPoison.1.png",hasDirection:!0,rotation:"arrow",initialAngle:-45,
path:"arrow",speed:350,height:200,frames:6,delay:0.02},arrowVoid:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"arrowVoid.1.png",hasDirection:!0,rotation:"arrow",initialAngle:-45,path:"arrow",speed:350,height:200,frames:6,delay:0.02},arrowNormal:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"arrowNormal.1.png",hasDirection:!0,initialAngle:-45,path:"arrow",rotation:"arrow",speed:350,frames:2,delay:0.02},bomb:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"bomb.1.png",
frames:8,delay:0.1,path:"jump",effect:"explo",speed:170},magicFire:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"magicFire.1.png",frames:6,delay:0.03,path:"bullet",speed:800,hasDirection:!0,effect:"hit"},magicVoid:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"magicVoid.1.png",frames:6,delay:0.03,speed:800,hasDirection:!0,path:"bullet",effect:"hit"},magicNormal:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"magicNormal.1.png",frames:6,delay:0.03,speed:800,
hasDirection:!0,path:"bullet",effect:"hit"},ballFire:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"ballFire.1.png",frames:7,delay:0.01,effect:"explo",speed:300},ballVoid:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"ballVoid.1.png",frames:6,delay:0.01,speed:300},cannonball:{png:"art/missiles{v}.png",plist:"art/missiles.plist",start:"cannonball.1.png",frames:6,delay:0.05,effect:"explo",speed:170,path:"jump"}};var effectsConfig={greenBang:{png:"art/greenBang.png",plist:"art/greenBang.plist",start:"greenBang.1.png",placement:"center",frames:28,delay:0.02,times:1},explo:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"explo.1.png",placement:"bottom",zorder:"behind",frames:23,delay:0.03,offset:{x:0,y:0},times:1,flash:!0,shake:!0},healingRadius:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"healingRadius.1.png",frames:39,delay:0.05,zorder:"behind",placement:"center",offset:{x:0,
y:0}},heal:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"heal.1.png",frames:50,delay:0.03,placement:"center",zorder:"behind",times:1},arrow:{png:"art/uiElements{v}.png",plist:"art/uiElements{v}.plist",start:"arrow.1.png",frames:16,delay:0.04,placement:"center"},teleport:{png:"art/teleport.png",plist:"art/teleport.plist",start:"teleport.1.png",frames:14,delay:0.02,placement:"base2base",times:1},movement:{png:"art/touch{v}.png",plist:"art/touch{v}.plist",start:"movement.1.png",frames:8,
delay:0.05,placement:"center",times:4},characterSelect:{png:"art/touch{v}.png",plist:"art/touch{v}.plist",start:"characterSelect.1.png",frames:16,delay:0.05,placement:"bottom"},enemySelection:{png:"art/touch{v}.png",plist:"art/touch{v}.plist",start:"enemySelection.1.png",frames:16,delay:0.05,placement:"base2base",zorder:"behind"},allySelection:{png:"art/touch{v}.png",plist:"art/touch{v}.plist",start:"allySelection.1.png",frames:16,delay:0.05,placement:"base2base",zorder:"behind"},burning:{png:"art/effects{v}.png",
plist:"art/effects{v}.plist",start:"burning.1.png",frames:33,delay:0.02,placement:"bottom",zorder:"behind",offset:{x:0,y:65},times:6},poisoned2:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"poisoned2.1.png",frames:24,delay:0.05,placement:"center",zorder:"behind",scaleToTarget:2,offset:{x:0,y:25},times:5},lifeDrain:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"lifeDrain.1.png",frames:38,delay:0.05,placement:"center",zorder:"front",scaleToTarget:2,offset:{x:0,y:25},times:5},
vampireRadius:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"vampireRadius.1.png",frames:30,delay:0.05,placement:"bottom",zorder:"behind",scaleToTarget:2,offset:{x:0,y:25}},voidFire:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"voidFire.1.png",frames:32,delay:0.05,placement:"center",zorder:"behind",scaleToTarget:2,offset:{x:0,y:25},times:5},hit:{png:"art/effects{v}.png",plist:"art/effects{v}.plist",start:"hit.1.png",frames:20,delay:0.05,placement:"center",zorder:"front",
times:1,offset:{x:0,y:25}}};var questLevels={1:[{name:"goblinKnightNormal"},{name:"goblinKnightNormal"}],2:[{name:"goblinKnightNormal"},{name:"goblinKnightNormal"},{name:"goblinKnightNormal"},{name:"orc"},{name:"orc"}],3:[{name:"ogre"},{name:"orc"},{name:"dragonFire"},{name:"orc"},{name:"elfFire"},{name:"orc"},{name:"elementalFire"},{name:"knightWater"},{name:"knightFire"},{name:"elementalEarth"},{name:"dragonFire"},{name:"ogre"},{name:"dragonFire"},{name:"knightVoid"},{name:"gargoyleFire"},{name:"elfFire"},{name:"dragonFire"},
{name:"gargoyleVoid"}]};var powerTiles={fireBall:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Fire4.png",cooldown:2E3,type:"direct",offense:"fireBall"},poisonCloud:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Poison4.png",cooldown:2E3,type:"direct",offense:"poisonCloud"},lightningBolt:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Holy1.png",cooldown:2E3,type:"direct",offense:"lightningBolt"},healing:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",
icon:"Holy5.png",cooldown:2E3,type:"global",offense:"healAll"},leech:{png:"art/powerTiles.png",plist:"art/powerTiles.plist",icon:"Shadow4.png",cooldown:2E3,type:"global",offense:"leechAll"},iceStorm:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"Frost5.png",cooldown:2E3,type:"global",offense:"iceStorm"},cannon:{png:"art/powerTiles{v}.png",plist:"art/powerTiles{v}.plist",icon:"cannonballTile.png",cooldown:2E3,type:"direct",offense:"cannon",defense:"tripleCannon"}},globalPowers=
{fireBall:function(){},cannon:function(a){var b=hotr.arenaScene.layer,c=hotr.arenaScene.layer.teams.a[0].behavior,d=missileConfig.cannonball,e=jc.makeSpriteWithPlist(d.plist,d.png,d.start),f=jc.makeAnimationFromRange("cannonball",d);e.setScale(0.5,0.5);e.runAction(f);var g=jc.playEffectAtLocation("enemySelection",a,jc.shadowZOrder,b),k=jc.makeSpriteWithPlist(touchUiPlist,touchUiPng,"swordsIcon.png");b.addChild(k);k.setPosition(a);k.setZOrder(jc.topMost);f=cc.p(0,b.winSize.height/2);jc.playEffectAtLocation("explo",
f,1,b);b.addChild(e);e.setPosition(f);f=c.getVectorTo(f,a);d=cc.JumpTo.create(f.distance/d.speed,a,f.distance/2,1);a=cc.CallFunc.create(function(a,d){jc.playEffectAtLocation("explo",d,1,a);var f=100*jc.assetScaleFactor,t=cc.p(d.x,d.y+f),r=cc.p(d.x,d.y-f),q=cc.p(d.x+f,d.y),m=cc.p(d.x-f,d.y);jc.playEffectAtLocation("explo",d,1,a);b.scheduleOnce(function(){jc.playEffectAtLocation("explo",t,1,a)},0.2);b.scheduleOnce(function(){jc.playEffectAtLocation("explo",r,1,a)},0.5);b.scheduleOnce(function(){jc.playEffectAtLocation("explo",
q,1,a)},0.05);b.scheduleOnce(function(){jc.playEffectAtLocation("explo",m,1,a)},0.3);a.removeChild(e,!0);a.removeChild(k,!0);a.removeChild(g,!0);for(var f=c.allFoesWithinRadiusOfPoint(400*jc.assetScaleFactor,d),l=0;l<f.length;l++)GeneralBehavior.applyDamage(f[l],void 0,200,jc.elementTypes.none)}.bind(void 0,b,a));a=cc.Sequence.create(d,a);e.runAction(a)},poisonCloud:function(a,b){var c=hotr.arenaScene.layer.teams.a[0].behavior.allFoesWithinRadiusOfPoint(150*jc.characterScaleFactor,a),d=jc.playEffectAtLocation("explo",
a,1,hotr.arenaScene.layer),e=d.getPosition(),f=d.getTextureRect();e.y+=f.height;d.setPosition(e);e=new cc.Color3B;e.r=0;e.b=0;e.g=255;d.setColor(e);for(d=0;d<c.length;d++)jc.genericPower("poison",void 0,void 0,c[d],{damage:20,duration:2,interval:0.25},"life")},lightningBolt:function(){},healAll:function(){},leech:function(){},iceStorm:function(){}};var powerAnimationsRequired={healingRadius:["heal"],vampireRadius:["lifeDrain","heal"],regeneration:["heal"],heal:["heal"],splashDamage:["explo"],vampireDistro:["lifeDrain","heal"],vampireDrain:["lifeDrain","heal"],knockBack:["hit"],burn:["burning"],poison:["poisoned2"],explodePoison:["explo"],poisonCloud:["explo","poisoned2"],explodeFire:["explo"]},powerConfig={healingRadius:function(a){jc.checkPower(a,"healingRadius");a=spriteDefs[a].powers.healingRadius;for(var b=this.allFriendsWithinRadius(a.radius*
jc.characterScaleFactor),c=0;c<b.length;c++)GeneralBehavior.heal(this.owner,b[c],a.heal)&&jc.playEffectOnTarget("heal",b[c],this.owner.layer)},vampireRadius:function(a){jc.checkPower(a,"vampireRadius");a=spriteDefs[a].powers.vampireRadius;for(var b=this.allFoesWithinRadius(a.radius*jc.characterScaleFactor),c=0,d=0;d<b.length;d++)GeneralBehavior.applyDamage(b[d],this.owner,a.damage)&&(jc.playTintedEffectOnTarget("lifeDrain",b[d],this.owner.layer,!0,cc.magenta()),c+=a.damage);0!=c&&GeneralBehavior.heal(this.owner,
this.owner,c)&&jc.playEffectOnTarget("heal",this.owner,this.owner.layer)},regeneration:function(a){jc.checkPower(a,"regeneration");GeneralBehavior.heal(this.owner,this.owner,spriteDefs[a].powers.regeneration.heal)&&jc.playEffectOnTarget("heal",this.owner,this.owner.layer)},splashDamage:function(a){jc.checkPower(a,"splashDamage");a=spriteDefs[a].damageMods.splashDamage;jc.playEffectOnTarget("explo",this.locked,this.owner.layer);for(var b=this.allFoesWithinRadiusOfPoint(a.radius*jc.characterScaleFactor,
this.locked.getBasePosition()),c=0;c<b.length;c++)GeneralBehavior.applyDamage(b[c],this.owner,a.damage)},explodeFire:function(a){var b=spriteDefs[a].deathMods.explodeFire,c=this.allFoesWithinRadiusOfPoint(b.radius*jc.characterScaleFactor,this.owner.getBasePosition());jc.playEffectOnTarget("explo",this.locked,this.owner.layer);for(var d=0;d<c.length;d++)GeneralBehavior.applyDamage(c[d],this.owner,b.damage)&&jc.genericPower("burn",a,this.owner,c[d],b.burn)},explodePoison:function(a){var b=spriteDefs[a].deathMods.explodePoison;
jc.playTintedEffectOnTarget("explo",this.locked,this.owner.layer,!1,cc.green());for(var c=this.allFoesWithinRadiusOfPoint(b.radius*jc.characterScaleFactor,this.locked.getBasePosition()),d=0;d<c.length;d++)GeneralBehavior.applyDamage(c[d],this.owner,b.damage)&&jc.genericPower("poison",a,this.owner,c[d],b.poison)},vampireDistro:function(a){jc.checkPower(a,"vampireDistro");a=spriteDefs[a].damageMods.vampireDistro;var b=this.owner.homeTeam();GeneralBehavior.applyDamage(this.locked,this.owner,a.damage)&&
jc.playTintedEffectOnTarget("lifeDrain",this.locked,this.owner.layer,!0,cc.magenta());for(var c=0;c<b.length;c++)b[c]!=this.owner&&GeneralBehavior.heal(this.owner,b[c],a.heal)&&jc.playEffectOnTarget("heal",b[c],this.owner.layer)},vampireDrain:function(a){jc.checkPower(a,"vampireDrain");a=spriteDefs[a].damageMods.vampireDrain;GeneralBehavior.applyDamage(this.locked,this.owner,a.damage)&&jc.playTintedEffectOnTarget("lifeDrain",this.locked,this.owner.layer,!0,cc.magenta());GeneralBehavior.heal(this.owner,
this.owner,a.heal)&&jc.playEffectOnTarget("heal",this.owner,this.owner.layer)},knockBack:function(a){jc.checkPower(a,"knockBack");var b=spriteDefs[a].damageMods.knockBack.distance;this.owner.isFlippedX()&&(b*=-1);a=this.locked.getBasePosition();a.x+=b;b=cc.p(this.owner.layer.worldSize.width/2,this.owner.layer.worldSize.height/2);jc.insideEllipse(a,b)&&this.locked.setBasePosition(a);jc.playEffectOnTarget("greenBang",this.locked,this.owner.layer)},burn:function(a){jc.genericPower("burn",a,this.owner,
this.locked)},"burn-apply":function(a){this.owner.setColor(cc.orange());jc.genericPowerApply(a,"burning","burnEffect",this)},"burn-remove":function(){var a=new cc.Color3B;a.r=255;a.b=255;a.g=255;this.owner.setColor(a);jc.genericPowerRemove("burnEffect","burning",this)},poison:function(a){jc.genericPower("poison",a,this.owner,this.locked)},"poison-apply":function(a){this.owner.setColor(cc.green());jc.genericPowerApply(a,"poisoned2","poisonEffect",this)},"poison-remove":function(){var a=new cc.Color3B;
a.r=255;a.b=255;a.g=255;this.owner.setColor(a);jc.genericPowerRemove("poisonEffect","poison",this)}};var jc=jc||{},tracers={general:0,touch:0,touchcore:0,touchlayer:0,touchid:0,touchout:0,mouse:0,states:0,sprite:0,healthbar:0,move:0,updatetime:0,memory:0,tests:0,arena:0,requestManager:0,gameplay:0,mainLayer:0,resource:0,camera:0,console:0,zerverpipe:0,resource:0,ui:0,scroller:0,utilEffects:0,rangeBehavior:0,defenderBehavior:0,designerout:0,"jc.shade":0,setText:0,missile:0,map:0,bubble:0,tutorials:0,blobOperations:0,selectTeam:0,Arena:1};
jc.log=function(a,b){for(var c=0;c<a.length;c++)if(1!=tracers[a[c]])return;"string"==typeof b||b instanceof String?cc.log(JSON.stringify(a)+": "+b):cc.log(JSON.stringify(a)+": "+JSON.stringify(b,null,"\t"))};jc.clone=function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor(),c;for(c in a)b[c]=jc.clone(a[c]);return b};jc=jc||{};jc.assetWildCard="{v}";jc.resolutions={};jc.resolutions.iphone=cc.size(480,320);jc.resolutions.iphone.scale=0.234375;jc.resolutions.iphone.charScale=0.1171875;jc.resolutions.iphone.adjusty=-20;jc.resolutions.iphone.adjustx=0;jc.resolutions.iphone5=cc.size(1136,640);jc.resolutions.iphone5.scale=0.554688;jc.resolutions.iphone5.charScale=0.277344;jc.resolutions.iphone5.adjusty=-110;jc.resolutions.iphone5.adjustx=0;jc.resolutions.iphone4=cc.size(960,640);jc.resolutions.iphone4.scale=0.46875;
jc.resolutions.iphone4.charScale=0.234375;jc.resolutions.iphone4.adjusty=-50;jc.resolutions.iphone4.adjustx=0;jc.resolutions.ipadhd=cc.size(2048,1536);jc.resolutions.ipadhd.scale=1;jc.resolutions.ipadhd.charScale=0.5;jc.resolutions.ipadhd.adjusty=0;jc.resolutions.ipadhd.adjustx=0;jc.setDesignSize=function(a){jc.designSize=a};
jc.bestAssetDirectory=function(){if(jc.isBrowser){var a=Math.ceil(window.devicePixelRatio);jc.screenSize=window.orientation?cc.size(screen.height*a,screen.width*a):cc.size(screen.width*a,screen.height*a);a=window.document.getElementById("gameCanvas");jc.actualSize=cc.size(a.width,a.height)}else jc.actualSize=cc.Director.getInstance().getWinSize(),jc.screenSize=jc.actualSize;var a=jc.actualSize,b="",c=0,d,e,f;for(f in jc.resolutions)jc.resolutions[f].width<=a.width&&jc.resolutions[f].width>c&&(c=jc.resolutions[f].width,
b=f,d=jc.resolutions[f].scale,e=jc.resolutions[f].charScale);jc.log(["resource"],"selected: "+b+" for assets dir.");jc.assetCategory=b;jc.assetScaleFactor=d;jc.characterScaleFactor=e;jc.assetCategoryData=jc.resolutions[b]};jc.isBrowser||jc.bestAssetDirectory();var dirImg="art/",dirMusic="sounds/";jc.bestAssetDirectory();jc.setDesignSize(cc.size(2048,1154));
var arenaSheet=transformAsset(dirImg+"arena{v}.png"),landingPng=transformAsset(dirImg+"landing{v}.png"),landingPlist=transformAsset(dirImg+"landing{v}.plist"),loadingPng=transformAsset(dirImg+"loading{v}.png"),loadingPlist=transformAsset(dirImg+"loading{v}.plist"),cardsPngs=[transformAsset(dirImg+"cards{v}.png")],cardsPlists=[transformAsset(dirImg+"cards{v}.plist")],uiPng=transformAsset(dirImg+"uiElements{v}.png"),uiPlist=transformAsset(dirImg+"uiElements{v}.plist"),tutorialPng=transformAsset(dirImg+
"tutorial{v}.png"),tutorialPlist=transformAsset(dirImg+"tutorial{v}.plist"),shadowPlist=transformAsset(dirImg+"shadowSheet.plist"),shadowPng=transformAsset(dirImg+"shadowSheet.png"),powerTilesPng=transformAsset(dirImg+"powerTiles{v}.png"),powerTilesPlist=transformAsset(dirImg+"powerTiles{v}.plist"),touchUiPlist=transformAsset(dirImg+"touch{v}.plist"),touchUiPng=transformAsset(dirImg+"touch{v}.png"),g_characterPngs={},g_characterPlists={},g_maingame=[{src:loadingPlist},{src:arenaSheet},{src:loadingPng},
{src:landingPng},{src:landingPlist},{fontName:"GODOFWAR",src:[{src:dirImg+"GODOFWAR.TTF",type:"truetype"}]}];jc.mainFont="GODOFWAR";jc.font={};jc.font.labelSize=cc.size(400*jc.assetScaleFactor,80*jc.assetScaleFactor);jc.font.alignment=0;jc.font.fontSize=jc.isBrowser?35*jc.assetScaleFactor:45*jc.assetScaleFactor;jc.font.fontSizeRaw=40;jc.font.fontName="GODOFWAR";
if(jc.designMode)var cardsPngs=[transformAsset(dirImg+"cards-ipadhd.png")],cardsPlists=[transformAsset(dirImg+"cards-ipadhd.plist")],uiPng=transformAsset(dirImg+"uiElements-ipadhd.png"),uiPlist=transformAsset(dirImg+"uiElements-ipadhd.plist"),landingPng=transformAsset(dirImg+"landing-ipadhd.png"),landingPlist=transformAsset(dirImg+"landing-ipadhd.plist"),loadingPng=transformAsset(dirImg+"loading-ipadhd.png"),loadingPlist=transformAsset(dirImg+"loading-ipadhd.plist"),guide=dirImg+"multiplayerScreen.png",
g_maingame=[{src:guide},{src:uiPng},{src:uiPlist},{src:touchUiPng},{src:touchUiPlist},{src:cardsPlists[0]},{src:cardsPngs[0]},{src:landingPng},{src:landingPlist},{src:loadingPng},{src:loadingPlist},{src:arenaSheet},{src:powerTilesPlist},{src:powerTilesPng},{fontName:jc.mainFont,src:[{src:dirImg+"GODOFWAR.TTF",type:"truetype"}]}];
for(var entry in spriteDefs)!spriteDefs[entry].parentOnly&&spriteDefs[entry].name&&(g_characterPngs[entry]=transformAsset(dirImg+entry+"Sheet{v}.png"),g_characterPlists[entry]=transformAsset(dirImg+entry+"Sheet{v}.plist"));
for(entry in missileConfig){var png=transformAsset(missileConfig[entry].png);g_characterPngs[entry]=png;missileConfig[entry].png=png;if(missileConfig[entry].plist){var missile=transformAsset(missileConfig[entry].plist);g_characterPlists[entry]=missile;missileConfig[entry].plist=missile}}
for(entry in effectsConfig)if(png=transformAsset(effectsConfig[entry].png),g_characterPngs[entry]=png,effectsConfig[entry].png=png,effectsConfig[entry].plist){var effect=transformAsset(effectsConfig[entry].plist);g_characterPlists[entry]=effect;effectsConfig[entry].plist=effect}
for(entry in powerTiles)png=transformAsset(powerTiles[entry].png),g_characterPngs[entry]=png,powerTiles[entry].png=png,powerTiles[entry].plist&&(effect=transformAsset(powerTiles[entry].plist),g_characterPlists[entry]=effect,powerTiles[entry].plist=effect);
var g_battleStuff=[{src:g_characterPngs.teleport},{src:g_characterPlists.teleport},{src:touchUiPlist},{src:touchUiPng},{src:powerTilesPlist},{src:powerTilesPng},{src:shadowPlist},{src:shadowPng}],g_ui=[{src:uiPlist},{src:uiPng},{src:cardsPlists[0]},{src:cardsPngs[0]},{src:tutorialPng},{src:tutorialPlist}];function transformAsset(a){if(a){var b="-"+jc.assetCategory;"-iphone"==b&&(b="");return a.replace(jc.assetWildCard,b)}};(function(){md5=function(a){function b(a,b,c,d,e,f){b=n(n(b,a),n(d,f));return n(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,k,g){return b(c&d|~c&e,a,c,f,k,g)}function d(a,c,d,e,f,k,g){return b(c&e|d&~e,a,c,f,k,g)}function e(a,c,d,e,f,k,g){return b(d^(c|~e),a,c,f,k,g)}function f(a,f){var k=a[0],g=a[1],m=a[2],l=a[3],k=c(k,g,m,l,f[0],7,-680876936),l=c(l,k,g,m,f[1],12,-389564586),m=c(m,l,k,g,f[2],17,606105819),g=c(g,m,l,k,f[3],22,-1044525330),k=c(k,g,m,l,f[4],7,-176418897),l=c(l,k,g,m,f[5],12,1200080426),m=
c(m,l,k,g,f[6],17,-1473231341),g=c(g,m,l,k,f[7],22,-45705983),k=c(k,g,m,l,f[8],7,1770035416),l=c(l,k,g,m,f[9],12,-1958414417),m=c(m,l,k,g,f[10],17,-42063),g=c(g,m,l,k,f[11],22,-1990404162),k=c(k,g,m,l,f[12],7,1804603682),l=c(l,k,g,m,f[13],12,-40341101),m=c(m,l,k,g,f[14],17,-1502002290),g=c(g,m,l,k,f[15],22,1236535329),k=d(k,g,m,l,f[1],5,-165796510),l=d(l,k,g,m,f[6],9,-1069501632),m=d(m,l,k,g,f[11],14,643717713),g=d(g,m,l,k,f[0],20,-373897302),k=d(k,g,m,l,f[5],5,-701558691),l=d(l,k,g,m,f[10],9,38016083),
m=d(m,l,k,g,f[15],14,-660478335),g=d(g,m,l,k,f[4],20,-405537848),k=d(k,g,m,l,f[9],5,568446438),l=d(l,k,g,m,f[14],9,-1019803690),m=d(m,l,k,g,f[3],14,-187363961),g=d(g,m,l,k,f[8],20,1163531501),k=d(k,g,m,l,f[13],5,-1444681467),l=d(l,k,g,m,f[2],9,-51403784),m=d(m,l,k,g,f[7],14,1735328473),g=d(g,m,l,k,f[12],20,-1926607734),k=b(g^m^l,k,g,f[5],4,-378558),l=b(k^g^m,l,k,f[8],11,-2022574463),m=b(l^k^g,m,l,f[11],16,1839030562),g=b(m^l^k,g,m,f[14],23,-35309556),k=b(g^m^l,k,g,f[1],4,-1530992060),l=b(k^g^m,l,
k,f[4],11,1272893353),m=b(l^k^g,m,l,f[7],16,-155497632),g=b(m^l^k,g,m,f[10],23,-1094730640),k=b(g^m^l,k,g,f[13],4,681279174),l=b(k^g^m,l,k,f[0],11,-358537222),m=b(l^k^g,m,l,f[3],16,-722521979),g=b(m^l^k,g,m,f[6],23,76029189),k=b(g^m^l,k,g,f[9],4,-640364487),l=b(k^g^m,l,k,f[12],11,-421815835),m=b(l^k^g,m,l,f[15],16,530742520),g=b(m^l^k,g,m,f[2],23,-995338651),k=e(k,g,m,l,f[0],6,-198630844),l=e(l,k,g,m,f[7],10,1126891415),m=e(m,l,k,g,f[14],15,-1416354905),g=e(g,m,l,k,f[5],21,-57434055),k=e(k,g,m,l,
f[12],6,1700485571),l=e(l,k,g,m,f[3],10,-1894986606),m=e(m,l,k,g,f[10],15,-1051523),g=e(g,m,l,k,f[1],21,-2054922799),k=e(k,g,m,l,f[8],6,1873313359),l=e(l,k,g,m,f[15],10,-30611744),m=e(m,l,k,g,f[6],15,-1560198380),g=e(g,m,l,k,f[13],21,1309151649),k=e(k,g,m,l,f[4],6,-145523070),l=e(l,k,g,m,f[11],10,-1120210379),m=e(m,l,k,g,f[2],15,718787259),g=e(g,m,l,k,f[9],21,-343485551);a[0]=n(k,a[0]);a[1]=n(g,a[1]);a[2]=n(m,a[2]);a[3]=n(l,a[3])}function g(a){txt="";var b=a.length,c=[1732584193,-271733879,-1732584194,
271733878],d;for(d=64;d<=b;d+=64){for(var e=c,k=a.substring(d-64,d),g=[],p=void 0,p=0;64>p;p+=4)g[p>>2]=k.charCodeAt(p)+(k.charCodeAt(p+1)<<8)+(k.charCodeAt(p+2)<<16)+(k.charCodeAt(p+3)<<24);f(e,g)}a=a.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];k=a.length;for(d=0;d<k;d++)e[d>>2]|=a.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(f(c,e),d=16;d--;)e[d]=0;e[14]=8*b;f(c,e);return c}function k(a){for(var b=a.length,c=0;c<b;c++){for(var d=a,e=c,f=a[c],k="",g=0;4>g;g++)k+=p[f>>8*g+4&
15]+p[f>>8*g&15];d[e]=k}return a.join("")}function n(a,b){return a+b&4294967295}var p="0123456789abcdef".split("");"5d41402abc4b2a76b9719d911017c592"!=k(g("hello"))&&(n=function(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535});return k(g(a))}})();var hotr=hotr||{};hotr.blobOperations={};hotr.scratchBoard={};hotr.teamformationSize=18;hotr.authTokenLocalStoreKey="x1xauthTokenx1x";hotr.haveSeenLocalStoreKey="x1xhaveseenx1x";hotr.userNameKey="x1xusernamex1x";hotr.credsKey="x1xcredsx1x";makeGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};makeSig=function(a){var b=makeGuid();a=md5(b+a.pass);return{data:b,hash:a}};
hotr.blobOperations.getCreds=function(){return jc.getLocalStorage(hotr.credsKey)};hotr.blobOperations.generateCreds=function(){var a={};a.id=makeGuid();a.pass=makeGuid();jc.setLocalStorage(hotr.credsKey,a);return a};hotr.blobOperations.getBlob=function(a){var b=hotr.blobOperations.getCachedAuthToken();hotr.api.getBlob(b.token,function(b,d){if(b)throw b;void 0!=d?(hotr.playerBlob=d,a(!0)):a(!1)})};
hotr.blobOperations.saveBlob=function(a){var b=hotr.blobOperations.getCachedAuthToken();hotr.playerBlob.version++;hotr.api.saveBlob(b.token,hotr.playerBlob,function(b,d){if(b)throw b;a&&a(d)})};hotr.blobOperations.getFormation=function(){return"4x4x4a"};
hotr.blobOperations.getTeam=function(){jc.log(["bloboperations"],"getteam");var a={};jc.log(["bloboperations"],"characterMap");_.each(hotr.playerBlob.myguys,function(b){jc.log(["bloboperations"],"characterMap:"+b.name);a[b.id]=b});jc.log(["bloboperations"],"teamformation");hotr.playerBlob.teamformation||(hotr.playerBlob.teamformation=[]);var b=hotr.playerBlob.teamformation,c=[];jc.log(["bloboperations"],"team loop");for(var d=0;d<b.length;d++)void 0!=b[d]&&a[b[d]]&&(c[d]=a[b[d]]);jc.log(["bloboperations"],
"return");return c};hotr.blobOperations.createNewPlayer=function(a){var b=hotr.blobOperations.generateCreds();hotr.api.createNewPlayer(b.id,b.pass,function(b,d){if(b)throw b;hotr.playerBlob=d.blob;hotr.blobOperations.setAuthToken(d.token);hotr.blobOperations.setHasPlayed();a()})};
hotr.blobOperations.getNewAuthTokenAndBlob=function(a){var b=hotr.blobOperations.getCreds(),c=makeSig(b);hotr.api.getNewAuthTokenAndBlob(b.id,c.data,c.hash,function(b,c){if(b)throw b;if(!c.blob)throw"getNewAuthTokenAndBlob failed to provide blob";hotr.playerBlob=c.blob;hotr.blobOperations.setAuthToken(c.token);a()})};hotr.blobOperations.setAuthToken=function(a){jc.setLocalStorage(hotr.authTokenLocalStoreKey,a)};hotr.blobOperations.getCachedAuthToken=function(){return jc.getLocalStorage(hotr.authTokenLocalStoreKey)};
hotr.blobOperations.hasToken=function(){var a=hotr.blobOperations.getCachedAuthToken();return!a||0>a.expires-Date.now()?!1:!0};hotr.blobOperations.getUserName=function(){return jc.getLocalStorage(hotr.userNameKey)};hotr.blobOperations.setUserName=function(a){return jc.setLocalStorage(hotr.userNameKey,a)};hotr.blobOperations.hasPlayed=function(){return void 0!=jc.getLocalStorage(hotr.haveSeenLocalStoreKey)};hotr.blobOperations.setHasPlayed=function(){jc.setLocalStorage(hotr.haveSeenLocalStoreKey,{haveSeenMe:!0})};
hotr.blobOperations.getLevel=function(){hotr.playerBlob.questLevel||(hotr.playerBlob.questLevel=0);return hotr.playerBlob.questLevel};hotr.inMultiplayer=0;hotr.blobOperations.getTutorialLevel=function(){if(hotr.inMultiplayer)return-1;hotr.playerBlob.questLevel||(hotr.playerBlob.questLevel=1);return hotr.playerBlob.questLevel};hotr.blobOperations.getTutorialStep=function(){hotr.playerBlob.tutortialStep||(hotr.playerBlob.tutortialStep=1);return hotr.playerBlob.tutortialStep};
hotr.blobOperations.setTutorialStep=function(a){hotr.playerBlob.tutortialStep=a};hotr.blobOperations.incrementLevel=function(){hotr.playerBlob.questLevel||(hotr.playerBlob.questLevel=0);hotr.playerBlob.questLevel++};hotr.blobOperations.getPowers=function(){return["poisonCloud","cannon"]};hotr.blobOperations.indexToId=function(a){hotr.blobOperations.validate();if(hotr.playerBlob.myguys[a])return hotr.playerBlob.myguys[a].id};
hotr.blobOperations.getFormationOrder=function(){hotr.blobOperations.validate();hotr.playerBlob.teamformation||(hotr.playerBlob.teamformation=[]);return hotr.playerBlob.teamformation};hotr.blobOperations.getCurrentFormationPosition=function(a){hotr.blobOperations.validate();return hotr.playerBlob.teamformation?hotr.playerBlob.teamformation.indexOf(a):-1};hotr.blobOperations.clearFormationPosition=function(a){hotr.playerBlob.teamformation[a]=void 0};
hotr.blobOperations.setSquadLocations=function(a,b){hotr.playerBlob.squadPositions||(hotr.playerBlob.squadPositions={});hotr.playerBlob.squadPositions[a]=b};
hotr.blobOperations.placeCharacterFormation=function(a,b){hotr.blobOperations.validate();var c={};_.each(hotr.playerBlob.myguys,function(a){c[a.id]=a});hotr.playerBlob.teamformation||(hotr.playerBlob.teamformation=[]);var d=hotr.playerBlob.teamformation.indexOf(a);-1!=d&&(hotr.playerBlob.teamformation[d]=void 0);if(c[a])hotr.playerBlob.teamformation[b]=a;else throw"Id: "+a+" not valid for player";};
hotr.blobOperations.validate=function(){if(!hotr.playerBlob)throw"Blob not initialized, call getBlob first.";};hotr.blobOperations.getEntryWithId=function(a){hotr.blobOperations.validate();var b=_.find(hotr.playerBlob.myguys,function(b){return b.id==a});if(!b)throw"Could not locate a character with id:"+a;return b};hotr.blobOperations.getCharacterIdsAndTypes=function(){hotr.blobOperations.validate();return hotr.playerBlob.myguys};
hotr.blobOperations.getCharacterNames=function(){hotr.blobOperations.validate();return _.pluck(hotr.playerBlob.myguys,"name")};hotr=hotr||{};hotr.multiplayerOperations={};hotr.multiplayerOperations.getGames=function(a){var b=hotr.blobOperations.getCachedAuthToken();hotr.api.getGames(b.token,function(b,d){hotr.multiplayerData=void 0!=d?d:void 0;a()})};hotr.multiplayerOperations.getTeam=function(a,b){var c=hotr.blobOperations.getCachedAuthToken();hotr.api.getTeam(c.token,a,b)};
hotr.multiplayerOperations.findGame=function(a){var b=hotr.blobOperations.getCachedAuthToken();hotr.api.findGame(b.token,function(b,d){void 0!=d?(hotr.newOpponent=d,a(!0)):a(!1)})};hotr.multiplayerOperations.victory=function(a,b,c){var d=hotr.blobOperations.getCachedAuthToken();hotr.api.victory(d.token,a,b,c)};hotr.multiplayerOperations.defeat=function(a,b){var c=hotr.blobOperations.getCachedAuthToken();hotr.api.defeat(c.token,a,data,b)};hotr=hotr||{};hotr.levelLogic={};hotr.levelLogic.getTeamForLevel=function(a){return(a=questLevels[a])?a:makeRandomTeam()};hotr.levelLogic.getFormationForLevel=function(a){return"4x4x4b"};hotr.levelLogic.getPowers=function(){return["poisonCloud","healing"]};function makeRandomTeam(){var a=[],b;for(b in spriteDefs)spriteDefs[b].parentOnly||a.push(b);b=[];for(var c=0;18>c;c++){var d=Math.floor(Math.random()*a.length-1+1),e=a[d];console.log("random char:"+e+d);b.push({name:e})}return b};jc=jc||{};cc.Sprite.prototype.adjustPosition=function(a,b){var c=this.getPosition();c.x+=a;c.y+=b;this.setPosition(c)};cc.LabelTTF.prototype.setText=function(a){this.setString(a);jc.log(["setText"],"setting text");jc.isBrowser?this.enableStroke(cc.black(),8*jc.assetScaleFactor):this.enableStroke(cc.black(),1*jc.assetScaleFactor);jc.log(["setText"],"enabled stroke")};jc.isBrowser&&(jc.dumpStack=function(a){jc.log(a,console.trace())},cc.Sprite.prototype.setColor=function(){jc.log(["console"],"setColor called on the web - don't do it man.")});
jc.isBrowser||(cc.Sprite.prototype.setScale=function(a,b){this.setScaleX(a);this.setScaleY(b)},cc.Sprite.prototype.nativeBoundingBox=cc.Sprite.prototype.getBoundingBox,cc.Sprite.prototype.getBoundingBox=function(){var a=this.nativeBoundingBox();a.origin=cc.p(a.x,a.y);a.size=cc.size(a.width,a.height);return a},jc.dumpStack=function(a){jc.log(a,Error().stack)},cc.Sprite.prototype.setFlippedX=cc.Sprite.prototype.setFlipX);jc.cardScale=0.85;
jc.scaleCard=function(a){a.setScale(a.getScaleX()*jc.cardScale,a.getScaleY()*jc.cardScale)};jc.makeStats=function(a){if(a){a=spriteDefs[a];var b={};b.hp=a.gameProperties.MaxHP;b.damage=a.gameProperties.damage;b.armor=0;b.speed=a.gameProperties.speed;b.power=jc.getPowerRating(a);b.range=a.gameProperties.targetRadius}else b={hp:0,damage:0,armor:0,speed:0,power:0,range:0};return b};jc.getPowerRating=function(a){return 10};jc.valuePerSecond=function(a,b){b||(b=1);return 1/b*a};
jc.swapSpriteFrameName=function(a,b){var c=cc.SpriteFrameCache.getInstance().getSpriteFrame(b);if(!c)throw"Frame: "+b+" not in cache.";a.setDisplayFrame(c)};jc.swapSpriteFrame=function(a,b){a.setDisplayFrame(b)};
jc.elementSprite=function(a){if("void"==a)return"elements_0000_void.png";if("water"==a)return"elements_0001_water.png";if("fire"==a)return"elements_0002_fire.png";if("life"==a)return"elements_0003_life.png";if("earth"==a)return"elements_0004_earth.png";if("air"==a)return"elements_0005_air.png";if("none"!=a)throw"Illegal element type: "+a;};jc.moveActionWithCallback=function(a,b,c){a=cc.MoveTo.create(b,a);return jc.actionWithCallback(a,c)};
jc.cap=function(a,b){a&&b?(a.x<b.x&&(a.x=b.x),a.y<b.y&&(a.y=b.y),a.x>b.width&&(a.x=b.width),a.y>b.height&&(a.y=b.height)):(console.log("Point or rect not passed to cap?"),console.log("point:"),console.log(a),console.log("rect:"),console.log(a),jc.dumpStack(["console"]))};jc.makeSimpleSprite=function(a){var b=new cc.Sprite;b.initWithSpriteFrameName(a);b.retain();return b};
jc.makeSpriteFromFile=function(a){cc.SpriteFrameCache.getInstance().addSpriteFrame();var b=new cc.Sprite;b.initWithFile(a);b.retain();return b};jc.parsed={};jc.makeSpriteWithPlist=function(a,b,c){var d=new cc.Sprite;jc.parsed[a]||(cc.SpriteFrameCache.getInstance().addSpriteFrames(a),cc.SpriteBatchNode.create(b),jc.parsed[a]=!0);a=cc.SpriteFrameCache.getInstance().getSpriteFrame(c);if(!a)throw"Frame: "+c+" not in cache.";d.initWithSpriteFrame(a);d.retain();return d};
jc.shadow=function(a,b){this.isBrowser?jc.shade(a,b):a.setColor(cc.black())};
jc.shade=function(a,b){if(!a.shade){jc.log(["jc.shade"],"layercolor creation");a.shade=cc.LayerColor.create(cc.c4(15,15,15,255));jc.log(["jc.shade"],"getParent");var c=a.getParent();jc.log(["jc.shade"],"is parent undefined? "+(void 0==c));c.addChild(a.shade)}var c=a.getPosition(),d=a.getBoundingBox().size;c.x-=d.width/2;c.y-=d.height/2;a.shade.setPosition(c);a.shade.setContentSize(d);a.shade.setOpacity(0);a.getParent().reorderChild(a.shade,0);void 0==b&&(b=jc.defaultFadeLevel);jc.fadeIn(a.shade,b)};
jc.unshade=function(a){jc.isBrowser?jc.fadeOut(a.shade):jc.unshadeNative(a)};jc.fadeIn=function(a,b,c,d){c||(c=jc.defaultTransitionTime);b||(b=jc.defaultFadeLevel);a||(a=this);b=cc.FadeTo.create(c,b);d?(d=cc.CallFunc.create(d),d=cc.Sequence.create(b,d),a.runAction(d)):a.runAction(b)};
jc.swapFade=function(a,b){function c(){b.setOpacity(0);this.addChild(b);jc.fadeIn(b,255,jc.defaultTransitionTime/4)}jc.log(["utilEffects"],"fade out name:"+a.name);jc.log(["utilEffects"],"fade in name:"+b.name);a?jc.fadeOut(a,jc.defaultTransitionTime/4,function(){this.removeChild(a,!1);c.bind(this)()}.bind(this)):c.bind(this)()};jc.fadeOut=function(a,b,c){b||(b=jc.defaultTransitionTime);a||(a=this);b=cc.FadeTo.create(b,0);c?(c=cc.CallFunc.create(c),c=cc.Sequence.create(b,c),a.runAction(c)):a.runAction(b)};
jc.getVectorTo=function(a,b){if(!a||!b)throw"To and From positions required!";var c=cc.pSub(a,b),d=Math.abs(a.x-b.x),e=Math.abs(a.y-b.y),f=cc.pLength(c);return{direction:c,distance:f,xd:d,yd:e}};
jc.makeAnimationFromRange=function(a,b){b.name&&(a=b.name);var c=[],d=1;b.first&&(d=b.first);for(var e=d;e<=b.frames;e++){var f=cc.SpriteFrameCache.getInstance().getSpriteFrame(a+"."+e+".png");if(!f)throw"Couldn't get a frame for: "+a+"."+e+".png is your naming convention off?";c.push(f)}if(b.rev)for(e=b.frames;e>=d;e--)f=cc.SpriteFrameCache.getInstance().getSpriteFrame(a+"."+e+".png"),c.push(f);c=cc.Animation.create(c,b.delay);if(b.times)return c=cc.Repeat.create(cc.Animate.create(c),b.times),c.retain(),
c;c=cc.RepeatForever.create(cc.Animate.create(c));c.retain();return c};jc.playTintedEffectOnTarget=function(a,b,c,d,e){(a=jc.playEffectOnTarget(a,b,c,d))&&a.setColor(e);return a};jc.centerThisPeer=function(a,b){a.setPosition(b.getPosition())};jc.centerThisChild=function(a,b){var c=b.getContentSize();a.setPosition(cc.p(c.width/2,c.height/2))};jc.scaleTo=function(a,b){var c=a.getBoundingBox().size,d=b.getBoundingBox().size,e=d.height/c.height;a.setScaleX(d.width/c.width);a.setScaleY(e)};
jc.scaleXTo=function(a,b){var c=a.getBoundingBox().size,c=b.getBoundingBox().size.width/c.width;a.setScaleX(c);a.setScaleY(c)};jc.scaleToCharacter=function(a,b,c){var d=a.getContentSize();b=b.getTextureRect().width*c/d.width;a.setScaleX(b);a.setScaleY(b)};
jc.playEffectOnTarget=function(a,b,c,d){if(b){var e=effectsConfig[a];b.effectAnimations||(b.effectAnimations={});b.effectAnimations[a]||(b.effectAnimations[a]={sprite:jc.makeSpriteWithPlist(e.plist,e.png,e.start),animation:jc.makeAnimationFromRange(a,e)});if(!b.effectAnimations[a].playing){var f;f=d?b:c;var g=b.effectAnimations[a].sprite,k=b.effectAnimations[a].animation;f.addChild(g);e.scaleToTarget&&jc.scaleToCharacter(g,b,e.scaleToTarget);g.setVisible(!0);"behind"!=e.zorder||d?"behind"==e.zorder&&
d?f.reorderChild(g,-1):"front"==e.zorder&&d?f.reorderChild(g,2):f.reorderChild(g,b.getZOrder()):f.reorderChild(g,b.getZOrder()-1);d?jc.setChildEffectPosition(g,b,e):jc.setEffectPosition(g,b,e);e.times&&(d=cc.CallFunc.create(function(){f.removeChild(g,!1);b.effectAnimations[a].playing=!1}.bind(this)),k=cc.Sequence.create(k,d));g.runAction(k);b.effectAnimations[a].playing=!0;e.flash&&c.flash();e.shake&&c.shake();return g}}};
jc.playEffectAtLocation=function(a,b,c,d){var e=effectsConfig[a],f=jc.makeSpriteWithPlist(e.plist,e.png,e.start);f.getTextureRect();a=jc.makeAnimationFromRange(a,e);f.setPosition(b);f.setVisible(!0);d.addChild(f);d.reorderChild(f,c);e.times?(b=cc.CallFunc.create(function(){d.removeChild(f,!1)}.bind(this)),b=cc.Sequence.create(a,b),f.runAction(b)):f.runAction(a);e.flash&&d.flash();e.shake&&d.shake();return f};
jc.setChildEffectPosition=function(a,b,c){var d=c.placement,e=cc.p(0,0),f=b.getContentSize(),g=b.getTextureRect(),k=a.getBoundingBox();if(d)if("bottom"==d)e.x+=f.width/2;else if("ground"==d)e.y+=k.height/2,e.x+=f.width/2,b.reorderChild(a,jc.groundEffectZOrder);else if("center"==d)e.x+=f.width/2,e.y+=g.height/2;else if("base2base"==d)e.x+=f.width/2,e.y-=f.height/2,e.y+=k.height;else throw"Unknown effect placement.";c.offset&&(b=cc.p(c.offset.x,c.offset.y),b.x*=jc.assetScaleFactor,b.y*=jc.assetScaleFactor,
e=cc.pAdd(e,b));a.setPosition(e)};jc.setEffectPosition=function(a,b,c){var d=c.placement,e=b.getBasePosition();b=b.getTextureRect();var f=a.getBoundingBox();if(d)if("bottom"==d)e.y+=f.height/2;else if("center"==d)e.y+=b.height/2;else if("top"==d)a.setPosition(e);else if("base2base"==d)e.y+=f.height;else throw"Unknown effect placement.";c.offset&&(c=cc.p(c.offset.x,c.offset.y),c.x*=jc.assetScaleFactor,c.y*=jc.assetScaleFactor,e=cc.pAdd(e,c));a.setPosition(e)};
jc.genericPower=function(a,b,c,d,e,f){e||(e=spriteDefs[b].damageMods[a]);b={};b=_.extend(b,e);b.name=a;c?b.origin=c:b.element=f;d.addEffect(b)};jc.toggleVisible=function(a){var b=a.isVisible();a.setVisible(!b)};jc.genericPowerApply=function(a,b,c,d){GeneralBehavior.applyDamage(d.owner,a.origin,a.damage,a.element)&&(d.owner[c]||(d.owner[c]=jc.playEffectOnTarget(b,d.owner,d.owner.getZOrder(),d.owner.layer,!0)))};
jc.genericPowerRemove=function(a,b,c){c.owner[a]&&c.owner.removeChild(c.owner[a],!1);delete c.owner[a];c.owner&&c.owner.effectAnimations&&c.owner.effectAnimations[b]&&(c.owner.effectAnimations[b].playing=!1)};jc.movementType={air:0,ground:1};jc.targetType={air:0,ground:1,both:2};jc.elementTypes={"void":0,water:1,fire:2,life:3,none:4,earth:5,air:7};jc.getElementType=function(a){for(var b in jc.elementTypes)if(jc.elementTypes[b]==a)return b};jc.checkPower=function(a,b){};jc.elMajor=3600;
jc.elMinor=1800;jc.insideEllipse=function(a,b){var c=jc.elMajor*jc.assetScaleFactor,d=jc.elMinor*jc.assetScaleFactor,e=a.x-b.x,f=a.y-b.y;return 1>e*e/(c*c)+f*f/(d*d)};jc.getCharacterCardFrame=function(a){var b=jc.getCardFrameName(a);a=spriteDefs[a].cardIndex;void 0==a&&(a=0);cc.SpriteFrameCache.getInstance().addSpriteFrames(cardsPlists[a]);cc.SpriteBatchNode.create(cardsPngs[a]);return cc.SpriteFrameCache.getInstance().getSpriteFrame(b)};
jc.getCorrectPortraitPosition=function(a){a=cc.p(a.x,a.y);var b=0.234375*a.y;a.x*=0.234375;a.y=b;return a};jc.getCharacterCard=function(a){var b=jc.getCardFrameName(a);a=spriteDefs[a].cardIndex;void 0==a&&(a=0);return jc.makeSpriteWithPlist(cardsPlists[a],cardsPngs[a],b)};jc.getCardFrameName=function(a){return a+"_bg.png"};jc.backDropZOrder=-99999999;jc.shadowZOrder=-99999998;jc.groundEffectZOrder=-99999997;jc=jc||{};jc.localstorage={};jc.setLocalStorage=function(a,b){jc.getLocalStorage(a);sys.localStorage.setItem(a,JSON.stringify(b))};jc.getLocalStorage=function(a){var b;b=jc.localstorage[a];if(!b){try{b=JSON.parse(sys.localStorage.getItem(a))}catch(c){return}b&&(jc.localstorage[a]=b)}return b};jc.log(["camera"],"cc undefined:"+(void 0==cc));jc.log(["camera"],"cc.ActionInterval undefined:"+(void 0==cc.ActionInterval));jc.log(["camera"],"cc.ActionInterval looks like:"+cc.ActionInterval);
jc.isBrowser?(jc.PanAndZoom=cc.ActionInterval.extend({initWithDuration:function(a,b,c,d){if(void 0==b.x||void 0==b.y)throw"Position is not a point";return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(b.x*=c,b.y*=d,this._endPosition=b,this._endScaleX=c,this._endScaleY=null!=d?d:c,!0):!1},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._previousPosition=this._startPosition=a.getPosition();this._delta=cc.pSub(this._endPosition,this._startPosition);
this._startScaleX=a.getScaleX();this._startScaleY=a.getScaleY();this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(a){if(this._target){var b=this._target.getPosition(),b=cc.pSub(b,this._previousPosition);this._startPosition=cc.pAdd(this._startPosition,b);b=cc.p(this._startPosition.x+this._delta.x*a,this._startPosition.y+this._delta.y*a);this._target.setPosition(b);this._previousPosition=b;this._target.setScale(this._startScaleX+this._deltaX*
a,this._startScaleY+this._deltaY*a)}},_endPosition:cc.p(0,0),_startPosition:cc.p(0,0),_delta:cc.p(0,0),_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0}),jc.PanAndZoom.create=function(a,b,c,d){var e=new jc.PanAndZoom;e.initWithDuration(a,b,c,d);return e}):(jc.PanAndZoom={},jc.PanAndZoom.create=function(){});var jc=jc||{},LayerManager=function(){this.layers=[]};LayerManager.prototype.pushLayer=function(a,b){a.resume();this.currentLayer?(this.currentLayer.darken(),this.currentLayer.pause(),this.currentLayer.addChild(a,b)):this.currentLayer=a;a.setPosition(cc.p(0,0));this.layers.push(a)};
LayerManager.prototype.popLayer=function(){var a=this.layers.pop();if(0<this.layers.length)this.currentLayer=this.layers[this.layers.length-1];else throw"No Layers";a.pause();this.currentLayer.removeChild(a,!1);this.currentLayer.undarken();this.currentLayer.resume();this.currentLayer.onShow()};jc.layerManager=new LayerManager;jc=jc||{};
jc.CompositeButton=cc.Sprite.extend({initWithDefinition:function(a,b,c){if(!a)throw"Must supply a definition";if(!a.main)throw"Must supply main button state.";a.pressed||(a.pressed=a.main);this.def=a;this.onTouch=b;this.onPress=c;this.initWithSpriteFrameName(a.main);if(this.def.subs)for(b=0;b<a.subs.length;b++)c=cc.Sprite.create(),c.initWithSpriteFrameName(a.subs[b].name),this.addChild(c),c.setPosition(cc.p(a.subs[b].x,a.subs[b].y));this.def.text&&(this.label=cc.LabelTTF.create(this.def.text,this.def.font,
this.def.fontSize),this.addChild(this.label),a=this.getContentSize(),this.label.setPosition(cc.p(a.width/2,a.height/2)));this.scheduleUpdate()},setData:function(a){this.data=a},onEnter:function(){"mouse"in sys.capabilities?cc.Director.getInstance().getMouseDispatcher().addMouseDelegate(this,0):cc.registerTargetedDelegate(0,!0,this)},onExit:function(){"mouse"in sys.capabilities?cc.Director.getInstance().getMouseDispatcher().removeMouseDelegate(this):cc.unregisterTouchDelegate(this)},onTouchBegan:function(a){if(this.frameCheck(a)){a=
cc.SpriteFrameCache.getInstance().getSpriteFrame(this.def.pressed);this.setDisplayFrame(a);if(this.onPress)this.onPress(this.data);return!0}return!1},frameCheck:function(a){return this.isVisible()&&this.isTouchInside(a)?!0:!1},getTouchLocation:function(a){return this.getParent().convertToNodeSpace(a)},isTouchInside:function(a){a=a instanceof Array?a[0].getLocation():a.getLocation();return cc.rectContainsPoint(this.getBoundingBox(),this.getTouchLocation(a))},onTouchMoved:function(a){return!1},onTouchEnded:function(a){if(this.frameCheck(a)){a=
cc.SpriteFrameCache.getInstance().getSpriteFrame(this.def.main);this.setDisplayFrame(a);if(this.onTouch&&!this.paused)this.onTouch(this.data);return!0}return!1},onMouseDown:function(a){return this.onTouchBegan(a)},onMouseUp:function(a){return this.onTouchEnded(a)},setTouchDelegate:function(a){this.onTouch=a},pause:function(){this.paused=!0},resume:function(){this.paused=!1}});jc.PowerTile=jc.CompositeButton.extend({tileSize:cc.size(50,50),borderPos:cc.p(130,130),coolCheck:0.05,initTile:function(){this.initWithSpriteFrameName("EmptyIcon.png");var a=this.getContentSize();this.setScale(this.tileSize.width/a.width,this.tileSize.height/a.height);this.border=jc.makeSimpleSprite("powerFrame.png");this.addChild(this.border,10);this.border.setPosition(this.borderPos);this.onTouchBegan=this.touchBeganOverride;this.onTouchEnded=this.touchEndedOverride},initFromName:function(a,b){if(a){this.parentLayer=
b;this.name=a;cc.SpriteFrameCache.getInstance().addSpriteFrames(powerTiles[a].plist);var c=cc.SpriteFrameCache.getInstance().getSpriteFrame(powerTiles[a].icon);this.setDisplayFrame(c);this.on=!0}},setSelected:function(){var a=cc.SpriteFrameCache.getInstance().getSpriteFrame("powerFrameSelected.png");this.border.setDisplayFrame(a)},setUnselected:function(){var a=cc.SpriteFrameCache.getInstance().getSpriteFrame("powerFrame.png");this.border.setDisplayFrame(a)},onTouch:function(){if(!this.cooling&&this.on){this.cooling=
!0;this.parentLayer.setSelected(this);var a=powerTiles[this.name];this.executed=Date.now();var b=globalPowers[a.offense].bind(this);if("direct"==a.type)hotr.arenaScene.layer.nextTouchDo(function(a,d){b(a,d);jc.shade(this,225);this.parentLayer.scheduleThisOnce(this.doCoolDown.bind(this),this.coolCheck)}.bind(this));else if("global"==a.type)b(),jc.shade(this,225),this.parentLayer.scheduleThisOnce(this.doCoolDown.bind(this),this.coolCheck);else throw"Unknown power type.";return!1}},doCoolDown:function(){var a=
powerTiles[this.name],a=(Date.now()-this.executed)/a.cooldown;if(1<=a)this.shade.setContentSize(cc.size(this.tileSize.width,this.tileSize.height)),this.cooling=!1,jc.unshade(this);else{var b=this.shade.getBoundingBox().size;b.height=this.tileSize.height-this.tileSize.height*a;this.shade.setContentSize(b);this.parentLayer.scheduleThisOnce(this.doCoolDown.bind(this),this.coolCheck)}},touchBeganOverride:function(a){if(this.frameCheck(a))return!0},touchEndedOverride:function(a){if(this.frameCheck(a)){if(this.onTouch&&
!this.paused)this.onTouch();return!0}return!1}});jc=jc||{};jc.defaultTransitionTime=0.25;jc.defaultFadeLevel=140;jc.defaultNudge=150*jc.assetScaleFactor;jc.touchEnded="end";jc.touchBegan="began";jc.touchMoved="moved";jc.touchCancelled="cancel";
jc.TouchLayer=cc.Layer.extend({init:function(){return this._super()?(this.winSize=jc.actualSize,this.superDraw=this.draw,this.draw=this.childDraw,this.superOnEnter=this.onEnter,this.onEnter=this.childOnEnter,this.superOnExit=this.onExit,this.onExit=this.childOnExit,this.touchTargets=[],this.retain(),!0):!1},bubbleAllTouches:function(a){this.bubbleAll=a},childOnEnter:function(){this.superOnEnter();this.wireInput(!0);this.onShow()},hackOn:function(){this.wireInput(!0);this.onShow()},hackOff:function(){this.wireInput(!1);
this.onHide()},childOnExit:function(){this.superOnExit();this.wireInput(!1);this.onHide()},onShow:function(){},onHide:function(){},wireInput:function(a){"mouse"in sys.capabilities?a?cc.Director.getInstance().getMouseDispatcher().addMouseDelegate(this,1):cc.Director.getInstance().getMouseDispatcher().removeMouseDelegate(this):a?cc.registerTargetedDelegate(0,!0,this):cc.unregisterTouchDelegate(this)},onTouchBegan:function(a){return this.hitSpriteTarget(jc.touchBegan,a)},onTouchMoved:function(a){return this.hitSpriteTarget(jc.touchMoved,
a)},onTouchEnded:function(a){return this.hitSpriteTarget(jc.touchEnded,a)},onMouseDown:function(a){return this.onTouchBegan(a)},onMouseDragged:function(a){return this.onTouchMoved(a)},onMouseUp:function(a){return this.onTouchEnded(a)},onTouchCancelled:function(a,b,c){return this.hitSpriteTarget(jc.touchCancelled,a)},targetTouchHandler:function(a,b,c){throw"child must implement!";},hitSpriteTarget:function(a,b,c){jc.log(["touchcore"],"Raw Touch:"+JSON.stringify(b));b=this.touchToPoint(b);jc.log(["touchcore"],
"Raw Touch Point:"+JSON.stringify(b));c=[];for(var d=0;d<this.touchTargets.length;d++){var e=this.touchTargets[d].getParent(),e=e?e.convertToNodeSpace(b):this.convertToNodeSpace(b);if(this.touchTargets[d]instanceof jc.Sprite){var f=this.touchTargets[d].getTextureRect(),g=this.touchTargets[d].getBasePosition(),k={};k.width=1.4*f.width;k.height=1.4*f.height;k.x=g.x-k.width/2;k.y=g.y}else this.touchTargets[d]instanceof cc.LabelTTF?(k=this.touchTargets[d].getBoundingBox(),k.width*=2,k.height*=2):k=this.touchTargets[d].getBoundingBox();
jc.log(["touchcore"],"Sprite:"+this.touchTargets[d].name);jc.log(["touchcore"],"Position:"+JSON.stringify(k));cc.rectContainsPoint(k,e)&&c.push(this.touchTargets[d])}return(0<c.length||this.bubbleAll)&&!this.isPaused?this.targetTouchHandler(a,b,c):!1},touchToPoint:function(a){return a instanceof Array?a[0].getLocation():a.getLocation()},darken:function(){this.shade||(this.shade=cc.LayerColor.create(cc.c4(15,15,15,255)),this.addChild(this.shade));this.shade.setPosition(new cc.p(0,0));this.shade.setOpacity(0);
this.reorderChild(this.shade,0);this.fadeIn(this.shade,jc.defaultFadeLevel)},undarken:function(){this.fadeOut(this.shade)},fadeIn:function(a,b,c){c||(c=jc.defaultTransitionTime);b||(b=jc.defaultFadeLevel);a||(a=this);b=cc.FadeTo.create(c,b);a.runAction(b)},fadeOut:function(a,b){b||(b=jc.defaultTransitionTime);a||(a=this);var c=cc.FadeTo.create(b,0);a.runAction(c)},slide:function(a,b,c,d,e,f,g){d||(d=jc.defaultTransitionTime);if(!b)throw"From point required.";if(!c)throw"To point required.";a.setPosition(b);
a.setVisible(!0);var k;g||(g=function(){});g=cc.CallFunc.create(g);e&&"before"==f?(e=cc.pAdd(b,e),c=cc.MoveTo.create(d,c),k=cc.MoveTo.create(d/2,e),c.retain(),k.retain()):(e&&"after"==f?(k=cc.p(-1*e.x,-1*e.y),c=cc.pAdd(c,k),e=cc.pAdd(c,e),c=cc.MoveTo.create(d,c),k=cc.MoveTo.create(d/2,e)):c=cc.MoveTo.create(d,c),c.retain());if(k&&"before"==f)action=cc.Sequence.create(k,c,g),a.runAction(action),jc.log(["touchlayer"],"running action - nudge before");else if(k&&"after"==f)action=cc.Sequence.create(c,
k,g),a.runAction(action),jc.log(["touchlayer"],"running action - nudge after");else{if(k)throw"when var must be before or after";action=cc.Sequence.create(c,g);jc.log(["touchlayer"],"running action - sans nudge");a.runAction(action)}},slideInFromTop:function(a,b,c,d){var e=this.getCorrectRect(a),f=this.winSize.width/2,g=this.winSize.height+e.height/2;c||(c=cc.p(f,this.winSize.height-(e.height/2+jc.defaultNudge)));this.slide(a,cc.p(f,g),c,b,cc.p(0,jc.defaultNudge),"after",d)},slideTopToMid:function(a,
b,c){b=this.mainFrame.getTextureRect();a=this.winSize.width/2;b=this.winSize.height+b.width;var d=cc.p(a,this.winSize.height/2);this.slide(this.mainFrame,cc.p(a,b),d,jc.defaultTransitionTime,cc.p(0,jc.defaultNudge),"after",c)},slideLeftToMid:function(a,b,c){var d=a.getTextureRect(),e=0-d.width,f=this.winSize.height/2,d=cc.p(this.winSize.width/2-d.width/2,f);this.slide(a,cc.p(e,f),d,b,cc.p(-1*jc.defaultNudge,0),"before",c)},slideRightToMid:function(a,b,c){var d=a.getTextureRect();a=this.winSize.width+
d.width;var e=this.winSize.height/2,d=cc.p(this.winSize.width/2+d.width/2,e);this.slide(this.rightDoor,cc.p(a,e),d,b,cc.p(jc.defaultNudge,0),"before",c)},slideOutToTop:function(a,b,c,d){var e=this.getCorrectRect(a);c||(c=cc.p(this.winSize.width/2,this.winSize.height+e.height/2));this.slide(a,a.getPosition(),c,b,cc.p(0,-1*jc.defaultNudge),"before",d)},slideInFromBottom:function(a,b,c,d){var e=this.getCorrectRect(a),f=this.winSize.width/2,g=0-e.height;c||(c=cc.p(f,e.height/2+jc.defaultNudge));this.slide(a,
cc.p(f,g),c,b,cc.p(0,-1*jc.defaultNudge),"after",d)},slideOutToBottom:function(a,b,c,d){var e=this.getCorrectRect(a);c||(c=cc.p(this.winSize.width/2,0-e.height));this.slide(a,a.getPosition(),c,b,cc.p(0,jc.defaultNudge),"before",d)},slideInFromLeft:function(a,b,c,d){var e=this.getCorrectRect(a),f=0-e.width,g=this.winSize.height/2;c||(c=cc.p(e.width/2+jc.defaultNudge,g));this.slide(a,cc.p(f,g),c,b,cc.p(-1*jc.defaultNudge,0),"after",d)},slideOutToLeft:function(a,b,c,d){var e=this.getCorrectRect(a),f=
a.getPosition();c||(c=cc.p(0-e.width,f.y));this.slide(a,f,c,b,cc.p(jc.defaultNudge,0),"before",d)},slideInFromRight:function(a,b,c,d){var e=this.getCorrectRect(a),f=this.winSize.width+e.width,g=this.winSize.height/2;c||(c=cc.p(this.winSize.width-(e.width/2+jc.defaultNudge),g));this.slide(a,cc.p(f,g),c,b,cc.p(jc.defaultNudge,0),"after",d)},slideOutToRight:function(a,b,c,d){var e=this.getCorrectRect(a),f=a.getPosition();c||(c=cc.p(this.winSize.width+e.width,f.y));this.slide(a,f,c,b,cc.p(-1*jc.defaultNudge,
0),"before",d)},getCorrectRect:function(a){return a instanceof jc.Sprite?a.getTextureRect():a.getContentSize()},generateSprite:function(a){return jc.Sprite.spriteGenerator(spriteDefs,a,this)},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1},centerPoint:function(){return cc.p(this.getContentSize().width*this.getAnchorPoint().x,this.getContentSize().height*this.getAnchorPoint().y)},centerPointOffset:function(a){return cc.pAdd(this.centerPoint(),a)},makeWindow:function(a,b,c){if(!b)throw"A window needs a sprite backdrop and a scale9 rect";
c||(c=cc.rect(45,45,350,600));var d=cc.Scale9Sprite.create();d.initWithSpriteFrameName(b,c);d.setContentSize(a);d.setVisible(!1);return d},childDraw:function(){this.superDraw()},drawBorder:function(a,b,c){var d=a.getPosition();a=a.getTextureRect();this.drawNode||(this.drawNode=cc.DrawNode.create(),this.addChild(this.drawNode));d.x-=a.width/2;d.y-=a.height/2;this.drawNode.setPosition(d);d=cc.c4f(0,0,0,0);this.drawNode.clear();this.drawRect(this.drawNode,a,d,b,c)},drawRect:function(a,b,c,d,e){var f=
b.height;b=b.width;f=[cc.p(0,0),cc.p(0,f),cc.p(b,f),cc.p(b,0)];a.drawPoly(f,c,e,d)},runActionWithCallback:function(a,b){var c=cc.CallFunc.create(b),c=cc.Sequence.create(a,c);this.runAction(c)},placeArrowOn:function(a,b){if("down"==b){var c=a.getPosition();this.arrow&&this.removeChild(this.arrow,!0);this.arrow=jc.playEffectAtLocation("arrow",cc.p(0,0),jc.topMost,this);"down"==b&&this.arrow.setRotation(90);var d=this.arrow.getContentSize();c.y+=d.height/2;c.y+=50*jc.assetScaleFactor;this.arrow.setPosition(c)}},
removeArrow:function(){this.arrow&&this.removeChild(this.arrow,!0)},placeArrow:function(a,b){this.arrow&&this.removeChild(this.arrow,!0);this.arrow=jc.playEffectAtLocation("arrow",a,jc.topMost,this);"down"==b&&this.arrow.setRotation(90);"left"==b&&this.arrow.setRotation(180);"up"==b&&this.arrow.setRotation(270)},getGuide:function(a){if("girl"==a)return"tutorialChar.png";if("orc"==a)return"orc_pose.png";if("demon"==a)return"gargoyleFire_pose.png";if("dwarf"==a)return"dwarvenKnightEarth_pose.png";throw"unknown tutorial character...";
},showTutorialStep:function(a,b,c,d,e,f){jc.log(["tutorials"],"showing:"+d);this.guideCharacters||(jc.log(["tutorials"],"init"),this.guideCharacters={});this.guideCharacters[d]||(jc.log(["tutorials"],"making:"+d),this.guideCharacters[d]=jc.makeSpriteWithPlist(tutorialPlist,tutorialPng,this.getGuide(d)),this.guideCharacters[d].setZOrder(jc.topMost),this.getParent().addChild(this.guideCharacters[d]));var g=this.guideCharacters[d].getContentSize(),k="girl"==d?4.5:3.5;if("right"==c){jc.log(["tutorials"],
"direction:right");var n=this.winSize.width+g.width;jc.log(["tutorials"],"fromX:"+n);var p=this.winSize.height/2-g.height/k;jc.log(["tutorials"],"fromY:"+p);var s=this.winSize.width-g.width;jc.log(["tutorials"],"toX:"+s);g=p-g.height/k;jc.log(["tutorials"],"toY:"+g);s=cc.p(s,g);g=cc.p(jc.defaultNudge,0)}else n=0-g.width,jc.log(["tutorials"],"fromX:"+n),p=this.winSize.height/2-g.height/k,jc.log(["tutorials"],"fromY:"+p),s=g.width-jc.defaultNudge,jc.log(["tutorials"],"toX:"+s),g=p-g.height/k,jc.log(["tutorials"],
"toY:"+g),s=cc.p(s,g),g=cc.p(-1*jc.defaultNudge,0);jc.log(["tutorials"],"nudge:"+jc.defaultNudge);jc.log(["tutorials"],"sliding");this.slide(this.guideCharacters[d],cc.p(n,p),s,jc.defaultTransitionTime,g,"after",function(){this.guideVisible=!0;this.attachMsgTo(a,this.guideCharacters[d],"left"==c?"right":"left");jc.log(["touchlayer"],"scheduling tutorial removal");e&&e();b&&this.scheduleOnce(function(){this.removeTutorialStep(void 0,f)}.bind(this),b)}.bind(this))},removeTutorialStep:function(a,b,c){a||
(a="girl");b||(b="left");this.guideCharacters[a]&&(this.shrinkBubble(),"right"==b&&this.slideOutToRight(this.guideCharacters[a],jc.defaultTransitionTime,void 0,function(){this.guideVisible=!1;c&&c()}.bind(this)),"left"==b&&this.slideOutToLeft(this.guideCharacters[a],jc.defaultTransitionTime,void 0,function(){this.guideVisible=!1;c&&c()}.bind(this)))},attachMsgTo:function(a,b,c){this.bubble?this.shrinkBubble(function(){this.doBubble(a,b,c)}.bind(this)):this.doBubble(a,b,c)},doBubble:function(a,b,c){this.bubble=
jc.makeSpriteWithPlist(uiPlist,uiPng,"dialog1.png");if(!b)throw"nope, need character now.";if(!c)throw"nope, need where now.";var d=b.getPosition();b=b.getContentSize();"left"==c?(this.bubble.setFlippedX(!0),c=cc.p(d.x-b.width,d.y)):c=cc.p(d.x+b.width,d.y);this.bubble.setPosition(c);this.bubble.adjustPosition(0,300*jc.assetScaleFactor);c=this.bubbleMsgSize(a);this.bubble.msg=cc.LabelTTF.create(a,jc.font.fontName,jc.font.fontSize,c,cc.TEXT_ALIGNMENT_CENTER);this.bubble.msg.setColor(cc.gray());this.bubble.msg.setText(a);
this.bubble.msg.retain();this.getParent().addChild(this.bubble);this.bubble.setZOrder(jc.topMost);this.getParent().addChild(this.bubble.msg);this.bubble.msg.setZOrder(jc.topMost+1);this.bubble.setScale(0.01,0.01);this.centerThisPeer(this.bubble.msg,this.bubble);this.popBubble()},bubbleMsgSize:function(a){var b=this.bubble.getContentSize();return jc.font.fontSize*a.length<b.width?cc.size(jc.font.fontSize*a.length,jc.font.fontSize):cc.size(b.width,jc.font.fontSize*a.length/b.width*jc.font.fontSize)},
msgSize:function(a){return cc.size(jc.font.fontSize*a.length,jc.font.fontSize)},popBubble:function(a){var b=this.bubble.getContentSize(),c=this.bubble.msg.getContentSize(),d=c.width/b.width,d=Math.max(d,c.height/(b.height-100*jc.assetScaleFactor));1.3>d&&(d=1.3);var e=cc.ScaleTo.create(1,d,d);e.retain();var f=cc.EaseElasticOut.create(e,0.3);f.retain();var g=cc.CallFunc.create(function(){a&&a();jc.log(["bubble"],"bubble popped!");e.release();f.release();k.release();g.release}.bind(this));g.retain();
var k=cc.Sequence.create(f,g);k.retain();this.bubble.runAction(k)},shrinkBubble:function(a){if(this.bubble){var b=cc.ScaleTo.create(0.25,0.01,0.01),b=cc.EaseElasticOut.create(b,0.3);this.getParent().removeChild(this.bubble.msg,!0);var c=cc.CallFunc.create(function(){this.getParent().removeChild(this.bubble,!0);this.bubble.msg.release();this.bubble.msg=void 0;this.bubble.release();this.bubble=void 0;jc.log(["bubble"],"bubble shrunk!");a&&a()}.bind(this)),c=cc.Sequence.create(b,c);this.bubble.runAction(c);
this.bubble.msg.runAction(b)}else a&&a()},floatMsg:function(a){this.msgStack||(this.msgStack=[]);var b=cc.LabelTTF.create(a,jc.font.fontName,jc.font.fontSize,this.msgSize(a),cc.TEXT_ALIGNMENT_CENTER);b.setColor(cc.red());b.setText(a);b.retain();0!=this.msgStack.length?(a=this.msgStack[this.msgStack.length-1].getPosition(),a=cc.p(a.x,a.y+50*jc.assetScaleFactor),b.setPosition(a)):b.setPosition(this.winSize.width/2,this.winSize.height/2);b.setZOrder(jc.topMost);this.addChild(b);this.scheduleOnce(function(){jc.fadeOut(b,
void 0,function(){b.release();this.removeChild(b,!0)}.bind(this))}.bind(this),1)},centerThisPeer:function(a,b){jc.centerThisPeer(a,b)},centerThisChild:function(a,b){jc.centerThisChild(a,b)},scaleTo:function(a,b){jc.scaleTo(a,b)}});jc=jc||{};jc.UiConf={};jc.woodRect=cc.rect(220,220,293,293);jc.topMost=1E4;
jc.UiElementsLayer=jc.TouchLayer.extend({windowConfig:{window:{type:"scale9",anchor:["top"],transitionIn:"top",transitionOut:"bottom",size:{width:50,height:50},scaleRect:jc.UiConf.frame19Rect,sprite:"frame 19.png",padding:{all:0},kids:{subwindow1:{cell:8,type:"scale9",input:!0,size:{width:50,height:50},scaleRect:jc.UiConf.frame20Rect,sprite:"frame 20.png",padding:{all:0}},subwindow2:{cell:2,type:"scale9",input:!0,size:{width:50,height:50},scaleRect:jc.UiConf.frame20Rect,sprite:"frame 20.png",padding:{all:0}}}}},
init:function(){return this._super()?(this.windowConfigs=[],!0):!1},done:function(){this.runningType="out";for(var a=0;a<this.windowConfigs.length;a++){var b=this.windowConfigs[a];b.config.transitionOut?this.doTransitionOut(b,this.onTransitionComplete.bind(this)):(b.window.setVisible(!1),this.onTransitionComplete())}},blackBoxElement:function(a){a=this[a].getContentSize();this.blackBox(a)},blackBox:function(a){var b=cc.size(a.width*jc.assetScaleFactor,a.height*jc.assetScaleFactor);a=(this.winSize.width-
b.width)/2;b=(this.winSize.height-b.height)/2;this.leftBar=cc.DrawNode.create();this.rightBar=cc.DrawNode.create();this.topBar=cc.DrawNode.create();this.bottomBar=cc.DrawNode.create();this.addChild(this.leftBar);this.addChild(this.rightBar);this.addChild(this.topBar);this.addChild(this.bottomBar);cc.c4f(0,0,0,1);var c=cc.c4f(0,0,0,1);this.leftBar.clear();this.rightBar.clear();this.topBar.clear();this.topBar.clear();this.leftBar.setPosition(cc.p(0,0));var d=cc.p(this.winSize.width-a,0);this.rightBar.setPosition(d);
var e=cc.p(0,this.winSize.height-b);this.topBar.setPosition(e);this.bottomBar.setPosition(cc.p(0,0));this.drawRect(this.leftBar,cc.rect(0,0,a,this.winSize.height),cc.black(),c,1);this.drawRect(this.rightBar,cc.rect(d.x,d.y,a,this.winSize.height),cc.black(),c,1);this.drawRect(this.topBar,cc.rect(e.x,e.y,this.winSize.width,b),cc.black(),c,1);this.drawRect(this.bottomBar,cc.rect(0,0,this.winSize.width,b),cc.black(),c,1);this.leftBar.setZOrder(jc.topMost);this.rightBar.setZOrder(jc.topMost);this.topBar.setZOrder(jc.topMost);
this.bottomBar.setZOrder(jc.topMost)},drawRect:function(a,b,c,d,e){var f=b.height;b=b.width;f=[cc.p(0,0),cc.p(0,f),cc.p(b,f),cc.p(b,0)];a.drawPoly(f,c,e,d)},onTransitionComplete:function(){this.incTransition();this.checkTransitionsDone()},incTransition:function(){this.transitions||(this.transitions=0);this.transitions++},checkTransitionsDone:function(){this.transitions==this.windowConfigs.length&&(this.transitions=0,"out"==this.runningType?this.outTransitionsComplete():this.inTransitionsComplete())},
outTransitionsComplete:function(){},inTransitionsComplete:function(){},start:function(){this.blackBox(jc.designSize);this.runningType="in";for(var a=0;a<this.windowConfigs.length;a++){var b=this.windowConfigs[a];b.z&&b.window.setZOrder(b.z);b.config.transitionIn?this.doTransitionIn(b,this.onTransitionComplete.bind(this)):(b.window.setPosition(b.position),b.window.setVisible(!0),this.onTransitionComplete())}},doTransitionIn:function(a,b){switch(a.config.transitionIn){case "right":this.slideInFromRight(a.window,
a.config.transitionInTime,a.position,b);break;case "left":this.slideInFromLeft(a.window,a.config.transitionInTime,a.position,b);break;case "top":this.slideInFromTop(a.window,a.config.transitionInTime,a.position,b);break;case "topToMid":this.slideTopToMid(a.window,a.config.transitionInTime,b);break;case "leftToMid":this.slideLeftToMid(a.window,a.config.transitionInTime,b);break;case "rightToMid":this.slideRightToMid(a.window,a.config.transitionInTime,b);break;case "bottom":this.slideInFromBottom(a.window,
a.config.transitionInTime,a.position,b);break;case "custom":this[a.config.executeIn](b)}},doTransitionOut:function(a,b){switch(a.config.transitionOut){case "right":this.slideOutToRight(a.window,a.config.transitionOutTime,void 0,b);break;case "left":this.slideOutToLeft(a.window,a.config.transitionOutTime,void 0,b);break;case "top":this.slideOutToTop(a.window,a.config.transitionOutTime,void 0,b);break;case "bottom":this.slideOutToBottom(a.window,a.config.transitionOutTime,void 0,b);break;case "custom":this[a.config.executeOut](b)}},
getWindowFromConfig:function(a){var b=this.makeWindowByType(a),c=a.kids,d;for(d in c){var c=a.kids[d],e=this.makeWindowByType(c);c.pos?e.setPosition(cc.p(c.pos.x*jc.assetCategoryData.scale,c.pos.y*jc.assetCategoryData.scale)):e.setPosition(cc.p(0,0));b[d]=e;b.addChild(e)}return b},initFromConfig:function(a,b){for(var c in a)if(config=a[c],b||(b=this),config.isGroup&&!this.designMode)this.initFromGroupConfig(c,config,b);else{config.isGroup&&(config.sprite=config.members[0].sprite);var d=void 0;"scale9"==
config.type&&(d=this.calculateSize(config,b),jc.log(["ui"],"scale9 size:"+JSON.stringify(d)));var e=this.makeWindowByType(config,d);d||(d=e.getTextureRect(),jc.log(["ui"],"TextureRect size:"+JSON.stringify(d)));d=this.getPos(config,d,b);e.setPosition(cc.p(-1E3,-1E3));this[c]=e;e.name=c;this.windowConfigs.push({window:e,config:config,position:d});b.addChild(e);config.z|=0;b.reorderChild(e,config.z);(config.input||this.designMode)&&this.touchTargets.push(e);config.kids&&this.initFromConfig(config.kids,
e)}},makeWindowByType:function(a,b){var c,d=a.type,e=a.sprite;this.designMode&&"button"==d?(d="sprite",e=a.main):this.designMode&&"sprite"!=d&&"label"!=d&&"scale9"!=d&&(d="sprite");if("scale9"==d)c=this.makeWindow(b,e,a.rect);else if("sprite"==d)c=cc.Sprite.create(),c.initWithSpriteFrameName(e),a.scale&&(c.setScaleX(a.scale/100),c.setScaleY(a.scale/100));else if("button"==d){c=new jc.CompositeButton;if(void 0!=a.touchDelegateName&&!this[a.touchDelegateName])throw"supplied:"+a.touchDelegateName+" for button click but it doesn't exist.";
if(void 0!=a.pressDelegateName&&!this[a.pressDelegateName])throw"supplied:"+a.pressDelegateName+" for button press but it doesn't exist.";var f,g;a.touchDelegateName&&(f=this[a.touchDelegateName].bind(this));a.pressDelegateName&&(g=this[a.pressDelegateName].bind(this));c.initWithDefinition(a,f,g);a.scale&&(c.setScaleX(a.scale/100),c.setScaleY(a.scale/100))}else"label"==d?(this.designMode?(c=a.fontSize,d=cc.size(a.width,a.height)):(c=a.fontSize*jc.assetScaleFactor,d=cc.size(a.width*jc.assetScaleFactor,
a.height*jc.assetScaleFactor)),c=cc.LabelTTF.create(a.text,a.fontName,c,d,a.alignment),a.color&&c.setColor(a.color)):"tile"==d&&(c=new jc.PowerTile,c.initTile());return c},initFromGroupConfig:function(a,b,c){if(b.members){var d=b.membersTotal|b.members.length;switch(b.type){case "line":this.initGrid(a,b,c,1,d);break;case "stack":this.initGrid(a,b,c,d,1);break;case "grid":this.initGrid(a,b,c,d/b.cols,b.cols)}}},initGrid:function(a,b,c,d,e){d=b.membersTotal||b.members.length;var f=c.getContentSize(),
g,k=!1;b.itemSize&&(g=cc.size(f.width*b.itemSize.width/100,f.height*b.itemSize.height/100),k=!0,jc.log(["ui"],"initGrid itemSize hard set:"+JSON.stringify(g)));for(var n=f=-1,p=0,s=0,t,r=0;r<d;r++){var q;q=b.membersTotal?b.members[0]:b.members[r];var m=this.makeWindowByType(q,g),l=m.getTextureRect();jc.log(["ui"],"element itemSize from boundingBox:"+JSON.stringify(l));k||(jc.log(["ui"],"element itemSize not hard set, using elementSize"),g=l);-1==f&&-1==n?(t=this.getPos(b,g,c),f=t.x,n=t.y):0!=s&&(f+=
g.width/2);jc.log(["ui"],"adding child:"+m.name);void 0==b.z&&(b.z=c.getZOrder()+1);jc.log(["ui"],"reordering child:"+b.z);c.addChild(m);0!=b.z&&this.reorderChild(m,b.z);l=q.name?q.name:a+r;m.name=l;this[l]=m;(b.input||this.designMode)&&this.touchTargets.push(m);0!=s&&b.itemPadding&&(b.itemPadding.all?f+=b.itemPadding.all*jc.assetScaleFactor:b.itemPadding.left&&(f+=b.itemPadding.left*jc.assetScaleFactor));l=cc.p(f,n);"label"==q.type&&(l.x+=m.getContentSize().width/2);this.windowConfigs.push({window:m,
config:q,position:l});s++;s>=e?(p++,f=t.x,n-=g.height,b.itemPadding&&(b.itemPadding.all?n-=b.itemPadding.all*jc.assetScaleFactor:b.itemPadding.top&&(n-=b.itemPadding.top*jc.assetScaleFactor)),s=0):f+=g.width/2}},calculateSize:function(a,b){var c=b.getContentSize();a.size||(a.size=c);this.designMode||(a.size.width*=jc.assetScaleFactor,a.size.height*=jc.assetScaleFactor,a.size.width>jc.actualSize.width&&(a.size.width=jc.actualSize.width),a.size.height>jc.actualSize.height&&(a.size.height=jc.actualSize.height));
return a.size},getPos:function(a,b,c){if(!a)throw"Need a config!";a.pos?(b=a.pos.x,c=a.pos.y):(b=this.winSize.width/2,c=this.winSize.height/2);!this.designMode&&a.pos&&(b*=jc.assetScaleFactor,c*=jc.assetScaleFactor);a.applyAdjustments&&(jc.assetCategoryData.adjustx&&(b+=jc.assetCategoryData.adjustx),jc.assetCategoryData.adjusty&&(c+=jc.assetCategoryData.adjusty));return cc.p(b,c)},getRow:function(a){if(3>=a)return 0;if(6>=a)return 1;if(9>=a)return 2;throw"Cell must be 1-9";},getCol:function(a){if(1==
a||4==a||7==a)return 0;if(2==a||5==a||8==a)return 1;if(3==a||6==a||9==a)return 2;throw"Cell must be 1-9";}});jc.UiElementsLayer.create=function(){var a=new jc.UiElementsLayer;if(a&&a.init())return a;throw"Couldn't create the main layer of the game. Something is wrong.";};jc.UiElementsLayer.scene=function(){var a=cc.Scene.create(),b=jc.UiElementsLayer.create();a.addChild(b);return a};jc=jc||{};
jc.Designer=jc.UiElementsLayer.extend({init:function(){if(this._super()){cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist);cc.SpriteFrameCache.getInstance().addSpriteFrames(touchUiPlist);var a=new cc.Sprite;a.initWithFile(guide);cc.SpriteFrameCache.getInstance().addSpriteFrame(a.displayFrame(),"guide");this.designMode=!0;this.initFromConfig(this.windowConfig);return!0}return!1},onShow:function(){this.start()},targetTouchHandler:function(a,b,c){c=_.sortBy(c,function(a){return a.getZOrder()})[c.length-1];
a==jc.touchBegan&&(jc.log(["console"],c.name),this.moving=c,this.startPos=c.getPosition(),this.lastTouch=b);if(a==jc.touchMoved&&this.moving){c=this.startPos.x+(b.x-this.lastTouch.x);var d=this.startPos.y+(b.y-this.lastTouch.y);this.lastTouch=b;this.startPos=cc.p(c,d);this.moving.setPosition(this.startPos)}a==jc.touchEnded&&(this.moving=void 0)},doClickOn:function(a){this.moving=a=this[a];this.startPos=a.getPosition();this.lastTouch=cc.p(0,0)},dump:function(){this.doDump(this,this.windowConfig);jc.log(["designerout"],
this.windowConfig)},doDump:function(a,b){for(var c=a.getChildren(),d=0;d<c.length;d++){var e=c[d];e.name&&(b[e.name].pos=e.getPosition(),b[e.name].z=e.getZOrder(),b[e.name].kids&&this.doDump(e,b[e.name].kids))}},windowConfig:{mainFrame:{type:"sprite",sprite:"map.png",z:1,pos:{x:1004,y:756}}}});jc.Designer.create=function(){var a=new jc.Designer;if(a&&a.init())return a;throw"Couldn't create the main layer of the game. Something is wrong.";};
jc.Designer.scene=function(){jc.Designer.scene=cc.Scene.create();jc.Designer.scene.layer=jc.Designer.create();jc.Designer.scene.layer.retain();jc.Designer.scene.addChild(jc.Designer.scene.layer);return jc.Designer.scene};jc=jc||{};
jc.ScrollingLayer=jc.TouchLayer.extend({init:function(a){return this._super()?(this.def=a,this.sprites=this.def.sprites,this.metaData=this.def.metaData,this.doConvert=!0,this.name="JCScrollingLayer",this.configure(),this.selectedIndex=1,this.doUpdate=!1,this.scheduleUpdate(),!0):!1},configure:function(){for(var a=0,b=0,b=this.def.isVertical?this.def.cellHeight:this.def.cellWidth,c=0;c<this.sprites.length;c++){this.touchTargets.push(this.sprites[c]);this.addChild(this.sprites[c]);var d=b/2*c+b;this.def.isVertical?
this.sprites[c].setPosition(cc.p(0,d)):this.sprites[c].setPosition(cc.p(d,0));this.def.isVertical?this.sprites[c].getTextureRect().width>a&&(a=this.sprites[c].getTextureRect().width):this.sprites[c].getTextureRect().height>a&&(a=this.sprites[c].getTextureRect().height);this.reorderChild(this.sprites[c],3)}this.def.isVertical?(b=this.sprites.length*this.def.cellHeight,this.midPoint=this.def.height/2,this.setContentSize(cc.size(a,b))):(b=this.sprites.length*this.def.cellWidth,this.midPoint=this.def.width/
2,this.setContentSize(cc.size(b,a)))},setIndex:function(a){jc.log(["scroller"],"set on: "+a);this.doUpdate=!1;void 0==a?(jc.log(["scroller"],"Bad val for setIndex:"),jc.dumpStack(["scroller"])):(this.selectedIndex=a,this.centerOn(this.sprites[a]))},previous:function(){0!=this.selectedIndex&&this.setIndex(this.selectedIndex-1)},next:function(){this.selectedIndex<this.sprites.length-1&&this.setIndex(this.selectedIndex+1)},left:function(){this.previous()},right:function(){this.next()},up:function(){this.previous()},
down:function(){this.next()},targetTouchHandler:function(a,b,c){if(this.isVisible())return this.drawNode&&this.drawNode.clear(),a==jc.touchBegan&&(jc.log(["scroller"],"touchbegan"),this.initialTouch=b,this.scrollDistance=void 0),a==jc.touchEnded&&this.initialTouch&&(jc.log(["scroller"],"touchend"),this.fling(b,c)),a==jc.touchMoved&&this.initialTouch&&(jc.log(["scroller"],"touchmove"),this.scroll(b)),!0},fling:function(a,b){this.isMoving=!1;jc.log(["scroller"],"fling");if(void 0==this.scrollDistance){if(jc.log(["scroller"],
"fling touch"),b[0]){var c=this.sprites.indexOf(b[0]);this.setIndex(c)}}else this.doUpdate=!this.edgeAdjust()},edgeAdjust:function(){var a=this.calcAbsolutePos(0),b=0,b=this.def.isVertical?a.y:a.x;if(b>this.midPoint)return this.isMoving=this.doUpdate=!1,this.setIndex(0),jc.log(["scroller"],"edge"),!0;a=this.calcAbsolutePos(this.sprites.length-1);b=0;b=this.def.isVertical?a.y:a.x;return b<this.midPoint?(this.isMoving=this.doUpdate=!1,this.setIndex(this.sprites.length-1),jc.log(["scroller"],"edge2"),
!0):!1},centerOn:function(a){a=a.getPosition();a=this.convertToWorldSpace(a);a=this.def.isVertical?this.midPoint-a.y:this.midPoint-a.x;jc.log(["scroller"],"Center needs:"+a);0!=a?this.def.isVertical?this.runEndingAdjustment(cc.p(0,a)):this.runEndingAdjustment(cc.p(a,0)):this.raiseSelected()},runEndingAdjustment:function(a){if(!this.endAdjustmentRunning){this.endAdjustmentRunning=!0;jc.log(["scroller"],"runEndingAdjustment:"+this.doUpdate);var b=cc.CallFunc.create(this.raiseSelected.bind(this));a=
cc.MoveBy.create(jc.defaultTransitionTime/2,a);b=cc.Sequence.create(a,b);this.runAction(b)}},raiseSelected:function(){jc.log(["scroller"],"raiseSelected:"+this.doUpdate);this.endAdjustmentRunning=this.doUpdate=!1;this.applyHighlight(this.sprites[this.selectedIndex]);var a;this.metaData&&(a=this.metaData[this.selectedIndex]);this.def.selectionCallback(this.selectedIndex,this.sprites[this.selectedIndex],a)},applyHighlight:function(a){var b=cc.c4f(1,1,0,1);this.drawBorder(a,b,2)},update:function(a){if(this.doUpdate)if(jc.log(["scroller"],
"updating"),this.scrollDistance){var b=a=0;this.def.isVertical?(a=this.scrollDistance.y,b=this.def.cellHeight):(a=this.scrollDistance.x,b=this.def.cellWidth);3<a/b&&(this.def.isVertical?this.scrollDistance.y=3*this.def.cellHeight:this.scrollDistance.x=3*this.def.cellWidth);this.setPosition(cc.pAdd(this.getPosition(),this.scrollDistance));this.isMoving||(this.scrollDistance=cc.pMult(this.scrollDistance,0.75),1>=Math.abs(a)&&(this.doUpdate=!1,this.adjust()));this.doUpdate=!this.edgeAdjust()}else this.doUpdate=
!1},calcAbsolutePos:function(a){return this.convertToWorldSpace(this.sprites[a].getPosition())},adjust:function(){var a=-1,b;jc.log(["scroller"],"adjust");for(var c=0;c<this.sprites.length;c++){var d=this.sprites[c].getBoundingBox();d.origin=this.convertToWorldSpace(d.origin);jc.log(["scroller"],"origin:"+JSON.stringify(d.origin));d=this.def.isVertical?Math.abs(d.origin.y+this.midPoint):Math.abs(d.origin.x-this.midPoint);jc.log(["scroller"],"diff:"+d);if(-1==a||a>d)a=d,b=c}this.setIndex(b)},scroll:function(a){jc.log(["scroller"],
"scroll");this.getBoundingBox();a=cc.pSub(a,this.initialTouch);this.scrollDistance=this.def.isVertical?cc.p(0,a.y):cc.p(a.x,0);this.isMoving=this.doUpdate=!0}});jc=jc||{};
jc.WorldLayer=jc.TouchLayer.extend({init:function(a){if(this._super()){this.backDrop=cc.Sprite.create(a);this.addChild(this.backDrop);this.backDrop.setPosition(this.winSize.width/2,this.winSize.height/2);this.reorderChild(this.backDrop,jc.backDropZOrder);this.worldSize=this.backDrop.getContentSize();this.worldMidPoint=cc.p(this.worldSize.width/2,this.worldSize.height/2);this.screenMidPoint=cc.p(this.winSize.width/2,this.winSize.height/2);this.worldBoundary=cc.rect(this.worldSize.width/4,this.worldSize.height/
4,this.worldSize.width/2+this.worldSize.width/4,this.worldSize.height/2+this.worldSize.height/4);this.setViewCenter(cc.p(this.worldSize.width/2,this.worldSize.height/2));this.bubbleAllTouches(!0);this.worldScale={x:this.winSize.width/this.worldSize.width,y:this.winSize.height/this.worldSize.height};a=0;this.aspectRatio=this.winSize.width/this.winSize.height;this.scaleTable=[];for(var b=1;1>=a;){var c=0;a=parseFloat((this.winSize.width/(this.worldSize.width/b)).toFixed(2));c=1<a?1:a;this.scaleTable.push({x:c,
y:c/this.aspectRatio});b+=0.2}this.whiteFlash=cc.LayerColor.create(cc.c4(255,255,255,255));a=cc.p(this.worldSize.width/2,this.worldSize.height/2);a.x-=this.winSize.width/2;a.y-=this.winSize.height/2;a=this.convertToItemPosition(a);this.whiteFlash.setPosition(a);this.whiteFlash.setContentSize(this.winSize);this.whiteFlash.setVisible(!1);this.addChild(this.whiteFlash);return!0}return!1},getOkayScale:function(a,b){var c=a/this.aspectRatio;if(!(c>=b))for(;c<b;)a+=10,c=a/this.aspectRatio;return this.getScale(a,
c)},panToWorldPoint:function(a,b,c,d){a=this.convertToLayerPosition(a);this.doScale(b,a,c,d)},fullZoomOut:function(a,b){var c=this.getScaleWorld(),d=this.convertToLayerPosition(cc.p(this.worldSize.width/2,this.worldSize.height/2));this.doScale(c,d,a,b)},doScale:function(a,b,c,d){b=cc.MoveTo.create(c,b);a=cc.ScaleTo.create(c,a.x,a.y);this.runActionWithCallback(b,d);this.runAction(a)},flash:function(){this.whiteFlash.setVisible(!0);this.whiteFlash.setOpacity(255);jc.fadeOut(this.whiteFlash,jc.defaultTransitionTime)},
shake:function(){if(!this.shaking){var a=cc.RotateBy.create(0.04,4),b=cc.RotateBy.create(0.04,-4),a=cc.Sequence.create(a,b),a=cc.Repeat.create(a,10),b=cc.DelayTime.create(0.05),c=cc.CallFunc.create(function(){console.log("shake done!");this.shaking=!1;this.setRotation(0)}.bind(this)),a=cc.Sequence.create(a,b,c);this.runAction(a);this.shaking=!0}},getClosestCorrectScale:function(a){for(var b=void 0,c=0;c<this.scaleTable.length;c++){var d=this.scaleTable[c];d.x<=a.x&&d.y<=a.y&&(b?d.x>b.x&&d.y>b.y&&
(b=d):b=d)}b||(b=this.scaleTable[this.scaleTable.length-1]);return b},getScale:function(a,b){var c={x:this.winSize.width/a,y:this.winSize.height/b};1.5<c.x&&(c.x=1.5);1.5<c.y&&(c.y=1.5);return c},getScaleOne:function(){return{x:1,y:1}},getScale2x:function(){return this.getScale(this.worldSize.width/2,this.worldSize.height/2)},getScale4x:function(){return this.getScale(this.worldSize.width/4,this.worldSize.height/4)},getScale8x:function(){return this.getScale(this.worldSize.width/16,this.worldSize.height/
16)},getScaleFloor:function(){return this.getScale(0.5*this.worldSize.width,0.5*this.worldSize.height)},getScaleWorld:function(){return this.getScale(0.7*this.worldSize.width,0.7*this.worldSize.height)},convertToLayerPosition:function(a){jc.cap(a,this.worldBoundary);a=cc.pMult(a,-1);return cc.pAdd(a,this.worldMidPoint)},convertToItemPosition:function(a){a=this.worldToScreen(a);return this.convertToNodeSpace(a)},worldToScreen:function(a){var b=this.screenToWorld(this.screenMidPoint);a=cc.pSub(b,a);
a.x*=this.getScaleX();a.y*=this.getScaleY();return cc.pSub(this.screenMidPoint,a)},screenToWorld:function(a){return this.backDrop.convertToNodeSpace(a)},setViewCenter:function(a){a=this.convertToLayerPosition(a);this.setPosition(a)},targetTouchHandler:function(a,b,c){}});jc=jc||{};jc.GameObject=function(){};jc.GameObject.prototype.init=function(){this.hp=this.MaxHP};jc.inherit=function(a,b){for(var c in b)void 0==a[c]&&(a[c]=b[c]);return a};jc=jc||{};jc.AnimationTypeOnce=1;jc.AnimationTypeLoop=0;String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})});
jc.Sprite=cc.Sprite.extend({layer:void 0,alive:!0,initWithPlist:function(a,b,c,d){this.HealthBarWidth=20;this.HealthBarHeight=5;this.animations={};this.batch=null;this.state=-1;this.moving=0;this.currentMove=null;this.idle=0;this.name=d.name;this.baseOffset=d.baseOffset;cc.SpriteFrameCache.getInstance().addSpriteFrames(a);this.batch=cc.SpriteBatchNode.create(b);this.batch.retain();this.effects={};a=cc.SpriteFrameCache.getInstance().getSpriteFrame(c);if(!a)throw c+" for sprite: "+d.name+" was not found.";
this.initWithSpriteFrame(a);this.retain();this.type=d.type;"background"!=this.type&&(this.initHealthBar(),this.initShadow(),this.scheduleUpdate());this.debug=!1;d.behavior||(d.behavior="tank");c=BehaviorMap[d.behavior];if(!c)throw"Unrecognized behavior name: "+d.behavior;this.gameObject=new jc.GameObject;d.gameProperties&&_.extend(this.gameObject,d.gameProperties);this.gameObject.init();this.behavior=new c(this);this.behaviorType=d.behavior;return this},ready:function(){this.isReady=!0;this.updateHealthBarPos();
this.updateShadowPosition();this.setVisible(!0)},die:function(){this.imdeadman=!0;this.layer.removeChild(this,!0);this.layer.removeChild(this.shadow,!0);this.layer.removeChild(this.healthBar,!0);this.cleanUp()},fallToShadow:function(){this.noShadowUpdate=!0;var a=this.shadow.getPosition(),b=cc.pSub(a,this.getPosition()),b=cc.pLength(b)/this.gameObject.speed,a=cc.MoveTo.create(a,b);this.runAction(a)},disableHealthBar:function(){this.hideHealthbar=!0},initShadow:function(){this.shadow=new cc.Sprite;
var a=cc.SpriteFrameCache.getInstance().getSpriteFrame("shadowSmall.png");this.shadow.initWithSpriteFrame(a);this.shadow.setScaleX(0.5);this.shadow.name="shadow";this.shadow.retain();this.layer.addChild(this.shadow);this.layer.reorderChild(this.shadow,jc.shadowZOrder);this.updateShadowPosition()},initHealthBar:function(){this.healthBar=cc.DrawNode.create();this.healthBar.retain();this.healthBar.contentSize=cc.size(this.HealthBarWidth,this.HealthBarHeight);this.healthBar.name="healthBar";this.layer.addChild(this.healthBar);
this.updateHealthBarPos()},cleanUp:function(){this.currentMove&&(this.stopAction(this.currentMove),this.currentMove.release(),this.currentMove=void 0);this.state=-1;this.layer.removeChild(this.shadow,!0);this.layer.removeChild(this.healthBar,!0);for(var a=0;a<this.animations.length;a++)this.animations[a].action.release();this.batch.release()},addDef:function(a){if(void 0==a.nameFormat)throw"Nameformat is required in a sprite definition.";if(void 0==a.state)throw"State is required in a sprite definition.";
if(void 0==a.type)throw"Animation type 'type' is required in a sprite definition.";if(void 0==a.delay)throw"Animation delay 'delay' is required in a sprite definition.";var b=this.makeAction(a);b.retain();a.action=b;this.animations[a.state]=a},makeAction:function(a){var b=[],c="",d,c=a.start,e=a.end;void 0==c&&(c=0);if(void 0==e){if(void 0==a.frames)throw"You must provide either an end range or a number of frames when creating an entry.";e=a.frames-1}for(var f=c;f<=e;f++){c=a.nameFormat.format(f);
d=cc.SpriteFrameCache.getInstance().getSpriteFrame(c);if(!d)throw"Couldn't get frame. What is: "+c;b.push(d)}b=cc.Animation.create(b,a.delay);a.type==jc.AnimationTypeLoop?(b=cc.RepeatForever.create(cc.Animate.create(b)),b.retain()):(b=cc.Animate.create(b),b=cc.Repeat.create(b,1),e=cc.CallFunc.create(this.animationDone,this),b=cc.Sequence.create(b,e));b.tag=a.state;return b},getTargetRadius:function(){return this.gameObject.targetRadius*jc.characterScaleFactor},getTargetRadiusY:function(){return"range"==
this.behaviorType?this.gameObject.targetRadius*jc.characterScaleFactor:this.gameObject.targetRadius/2*jc.characterScaleFactor},getSeekRadius:function(){return this.gameObject.seekRadius},getBasePosition:function(){var a=this.getPosition(),b=this.getContentSize();a.y-=b.height/2;return a},setBasePosition:function(a){var b=this.getContentSize();a.y+=b.height/2;this.setPosition(a);this.layer.reorderChild(this,-1*a.y);this.updateHealthBarPos();this.updateShadowPosition()},moveTo:function(a,b,c,d){jc.log(["sprite",
"move"],"Moving:"+this.name);var e=cc.pSub(a,this.getPosition());c=cc.pLength(e)/c;void 0!=this.currentMove&&(jc.log(["sprite","move"],"Stopping move in process."),this.stopAction(this.currentMove),this.currentMove.release(),this.currentMove=void 0);jc.log(["sprite","move"],"Setting state to required move.");this.setState(b);d||(d=this.moveEnded.bind(this));a=cc.MoveTo.create(c,a);jc.log(["sprite","move"],"creating the move sequence");this.currentMove=cc.Sequence.create(a,cc.CallFunc.create(d));this.currentMove.retain();
jc.log(["sprite","move"],"running move sequence");this.runAction(this.currentMove)},isAlive:function(){return 0<this.gameObject.hp?!0:!1},moveEnded:function(){this.setState(this.idle);this.stopAction(this.currentMove)},animationDone:function(){var a;this.animations[this.state].callback&&(a=this.animations[this.state].callback);a&&a(this.nextState)},getState:function(){return this.state},addEffect:function(a){this.effects[a.name]=a},removeEffect:function(a){delete this.effects[a]},setState:function(a,
b){if(!a)throw"Undefined state passed to setState";var c=this.state;this.state=a;jc.log(["sprite","state"],"State Change For:"+this.name+" from:"+c+" to:"+this.state);if(this.state==c)jc.log(["sprite","state"],"Trying to set a state already set, exit");else{this.isAlive()?this.nextState="idle":this.nextState="dead";var d=this.animations[this.state],e=this.animations[c];if(!d)throw"Couldn't start state. What is state: "+this.state+" currentState:"+c;d.callback=b;if(-1!=c){if(!e)throw"Couldn't stop state. What is currentState:"+
c;jc.log(["sprite","state"],"Stopping action.");e.action&&this.stopAction(e.action)}jc.log(["sprite","state"],"Starting action.");d.action&&this.runAction(d.action);"background"!=this.type&&(this.updateHealthBarPos(),this.updateShadowPosition())}},centerOnScreen:function(){var a=cc.Director.getInstance().getWinSize();this.setPosition(cc.p(a.width/2,a.height/2))},setBehavior:function(a){var b=BehaviorMap[a];if(!b)throw"Unrecognized behavior name: "+a;this.behavior=new b(this)},think:function(a){this.behavior.think(a)},
drawBorders:function(){var a=this.getBasePosition(),b=this.getTextureRect();this.debugTextureBorder||(this.debugTextureBorder=cc.DrawNode.create(),this.layer.addChild(this.debugTextureBorder),a.x-=b.width/2,this.debugTextureBorder.setPosition(a));a=cc.c4f(0,0,0,0);b=cc.c4f(35/255,28/255,40/255,1);this.debugTextureBorder.clear();this.drawRect(this.debugTextureBorder,this.getTextureRect(),a,b,4)},drawRect:function(a,b,c,d,e){var f=b.height;b=b.width;f=[cc.p(0,0),cc.p(0,f),cc.p(b,f),cc.p(b,0)];a.drawPoly(f,
c,e,d)},drawHealthBar:function(){jc.log(["healthbar"],"hide health bar?"+this.hideHealthbar);if(!this.hideHealthbar){jc.log(["healthbar"],"healthbar");this.healthBar.clear();var a=[];a[0]=cc.p(0,0);a[1]=cc.p(0,this.HealthBarHeight-1);a[2]=cc.p(this.HealthBarWidth-1,this.HealthBarHeight-1);a[3]=cc.p(this.HealthBarWidth-1,0);var b=cc.c4f(1,0,0,1),c;c=this.healthBarColor?this.healthBarColor:cc.c4f(26/255,245/255,15/255,1);var d=cc.c4f(35/255,28/255,40/255,1);this.healthBar.drawPoly(a,b,0.7,d);a=[];b=
this.gameObject.hp/this.gameObject.MaxHP;0>b&&(b=0);a[0]=cc.p(0,0);a[1]=cc.p(0,this.HealthBarHeight-1);a[2]=cc.p((this.HealthBarWidth-2)*b+0.5,this.HealthBarHeight-1);a[3]=cc.p((this.HealthBarWidth-2)*b+0.5,0);this.healthBar.drawPoly(a,c,0.7,d);jc.log(["healthbar"],"healthbar")}},update:function(){this.drawHealthBar()},updateHealthBarPos:function(){if("background"!=this.type&&this.isVisible()){var a=this.getBasePosition(),b=this.getTextureRect();a.y+=b.height+10;a.x-=this.HealthBarWidth/2;this.healthBar.setPosition(a)}},
updateShadowPosition:function(){if("background"!=this.type){var a=this.getBasePosition();this.gameObject&&this.gameObject.flightAug&&(a.y-=this.gameObject.flightAug.y/2);this.shadow.setPosition(a)}}});jc.Sprite.getMinMax=function(a){var b=99999,c=-1,d;for(d in a.animations)a.animations[d].start<b&&(b=a.animations[d].start),a.animations[d].end>c&&(c=a.animations[d].end);if(99999==b)throw"something wrong...";if(99999==c)throw"something wrong...";a.startFrame=b;a.endFrame=c};
jc.Sprite.spriteGenerator=function(a,b,c){var d=a[b];if(!d)throw"Character not found: "+b;var e=new jc.Sprite;e.layer=c;var f=d.name+".{0}.png";if(d.inherit){var g=d.name;_.extend(d,a[d.inherit]);d.name=g;d.parentOnly=void 0}if(void 0==d.animations)throw b+" has a malformed configation. Animation property missing.";a=d.animations.idle.start;g=new jc.GameObject;_.extend(g,d.gameProperties);d.type="character";e.initWithPlist(g_characterPlists[b],g_characterPngs[b],f.format(a),d);for(var k in d.animations)b=
jc.clone(d.animations[k]),b.nameFormat=f,b.state=k,e.addDef(b),"idle"==k&&(e.idle=k),"move"==k&&(e.moving=k);d.effect&&jc.playEffectOnTarget(d.effect,e,c,!0);return e};jc.randomNum=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};!function(a,b){function c(){this._events={};this._conf&&d.call(this,this._conf)}function d(a){a&&(this._conf=a,a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),a.newListener&&(this.newListener=a.newListener),this.wildcard&&(this.listenerTree={}))}function e(a){this._events={};this.newListener=!1;d.call(this,a)}function f(a,b,c,d){if(!c)return[];var e=[],g,q,m,l;m=b.length;l=b[d];var w=b[d+1];if(d===m&&c._listeners){if("function"===
typeof c._listeners)a&&a.push(c._listeners);else for(b=0,d=c._listeners.length;b<d;b++)a&&a.push(c._listeners[b]);return[c]}if("*"===l||"**"===l||c[l]){if("*"===l){for(g in c)"_listeners"!==g&&c.hasOwnProperty(g)&&(e=e.concat(f(a,b,c[g],d+1)));return e}if("**"===l){(l=d+1===m||d+2===m&&"*"===w)&&c._listeners&&(e=e.concat(f(a,b,c,m)));for(g in c)"_listeners"!==g&&c.hasOwnProperty(g)&&("*"===g||"**"===g?(c[g]._listeners&&!l&&(e=e.concat(f(a,b,c[g],m))),e=e.concat(f(a,b,c[g],d))):e=g===w?e.concat(f(a,
b,c[g],d+2)):e.concat(f(a,b,c[g],d)));return e}e=e.concat(f(a,b,c[l],d+1))}(q=c["*"])&&f(a,b,q,d+1);if(c=c["**"])if(d<m)for(g in c._listeners&&f(a,b,c,m),c)"_listeners"!==g&&c.hasOwnProperty(g)&&(g===w?f(a,b,c[g],d+2):g===l?f(a,b,c[g],d+1):(m={},m[g]=c[g],f(a,b,{"**":m},d+1)));else c._listeners?f(a,b,c,m):c["*"]&&c["*"]._listeners&&f(a,b,c["*"],m);return e}var g=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};e.prototype.delimiter=".";e.prototype.setMaxListeners=
function(a){this._events||c.call(this);this._events.maxListeners=a;this._conf||(this._conf={});this._conf.maxListeners=a};e.prototype.event="";e.prototype.once=function(a,b){this.many(a,1,b);return this};e.prototype.many=function(a,b,c){function d(){0===--b&&e.off(a,d);c.apply(this,arguments)}var e=this;if("function"!==typeof c)throw Error("many only accepts instances of Function");d._origin=c;this.on(a,d);return e};e.prototype.emit=function(){this._events||c.call(this);var a=arguments[0];if("newListener"===
a&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var b=arguments.length,d=Array(b-1),e=1;e<b;e++)d[e-1]=arguments[e];e=0;for(b=this._all.length;e<b;e++)this.event=a,this._all[e].apply(this,d)}if("error"===a&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error)){if(arguments[1]instanceof Error)throw arguments[1];throw Error("Uncaught, unspecified 'error' event.");}var g;this.wildcard?(g=[],b="string"===typeof a?a.split(this.delimiter):a.slice(),f.call(this,
g,b,this.listenerTree,0)):g=this._events[a];if("function"===typeof g){this.event=a;if(1===arguments.length)g.call(this);else if(1<arguments.length)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:b=arguments.length;d=Array(b-1);for(e=1;e<b;e++)d[e-1]=arguments[e];g.apply(this,d)}return!0}if(g){b=arguments.length;d=Array(b-1);for(e=1;e<b;e++)d[e-1]=arguments[e];g=g.slice();e=0;for(b=g.length;e<b;e++)this.event=a,g[e].apply(this,
d);return 0<g.length||this._all}return this._all};e.prototype.on=function(a,b){if("function"===typeof a)return this.onAny(a),this;if("function"!==typeof b)throw Error("on only accepts instances of Function");this._events||c.call(this);this.emit("newListener",a,b);if(this.wildcard){a:{for(var d=a,d="string"===typeof d?d.split(this.delimiter):d.slice(),e=0,f=d.length;e+1<f;e++)if("**"===d[e]&&"**"===d[e+1])break a;e=this.listenerTree;for(f=d.shift();f;){e[f]||(e[f]={});e=e[f];if(0===d.length){e._listeners?
"function"===typeof e._listeners?e._listeners=[e._listeners,b]:g(e._listeners)&&(e._listeners.push(b),e._listeners.warned||(d=10,"undefined"!==typeof this._events.maxListeners&&(d=this._events.maxListeners),0<d&&e._listeners.length>d&&(e._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",e._listeners.length),console.trace()))):e._listeners=b;break a}f=d.shift()}}return this}this._events[a]?
"function"===typeof this._events[a]?this._events[a]=[this._events[a],b]:g(this._events[a])&&(this._events[a].push(b),this._events[a].warned||(d=10,"undefined"!==typeof this._events.maxListeners&&(d=this._events.maxListeners),0<d&&this._events[a].length>d&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace()))):this._events[a]=b;return this};
e.prototype.onAny=function(a){this._all||(this._all=[]);if("function"!==typeof a)throw Error("onAny only accepts instances of Function");this._all.push(a);return this};e.prototype.addListener=e.prototype.on;e.prototype.off=function(a,b){if("function"!==typeof b)throw Error("removeListener only takes instances of Function");var c,d=[];if(this.wildcard)c="string"===typeof a?a.split(this.delimiter):a.slice(),d=f.call(this,null,c,this.listenerTree,0);else{if(!this._events[a])return this;c=this._events[a];
d.push({_listeners:c})}for(var e=0;e<d.length;e++){var r=d[e];c=r._listeners;if(g(c)){for(var q=-1,m=0,l=c.length;m<l;m++)if(c[m]===b||c[m].listener&&c[m].listener===b||c[m]._origin&&c[m]._origin===b){q=m;break}if(0>q)break;this.wildcard?r._listeners.splice(q,1):this._events[a].splice(q,1);0===c.length&&(this.wildcard?delete r._listeners:delete this._events[a])}else if(c===b||c.listener&&c.listener===b||c._origin&&c._origin===b)this.wildcard?delete r._listeners:delete this._events[a]}return this};
e.prototype.offAny=function(a){var b=0,c=0,d;if(a&&this._all&&0<this._all.length)for(d=this._all,b=0,c=d.length;b<c;b++){if(a===d[b]){d.splice(b,1);break}}else this._all=[];return this};e.prototype.removeListener=e.prototype.off;e.prototype.removeAllListeners=function(a){if(0===arguments.length)return!this._events||c.call(this),this;if(this.wildcard)for(var b="string"===typeof a?a.split(this.delimiter):a.slice(),b=f.call(this,null,b,this.listenerTree,0),d=0;d<b.length;d++)b[d]._listeners=null;else{if(!this._events[a])return this;
this._events[a]=null}return this};e.prototype.listeners=function(a){if(this.wildcard){var b=[];a="string"===typeof a?a.split(this.delimiter):a.slice();f.call(this,b,a,this.listenerTree,0);return b}this._events||c.call(this);this._events[a]||(this._events[a]=[]);g(this._events[a])||(this._events[a]=[this._events[a]]);return this._events[a]};e.prototype.listenersAny=function(){return this._all?this._all:[]};"function"===typeof define&&define.amd?define(function(){return e}):a.EventEmitter2=e}(jc);var GeneralBehavior=cc.Node.extend({});GeneralBehavior.prototype.getState=function(){this.brainState||this.setState("idle");this.animationState||this.owner.setState("idle");return{brain:this.brainState,anim:this.animationState}};GeneralBehavior.prototype.resume=function(){this.setState(this.lastBrain,this.lastAnim)};
GeneralBehavior.prototype.setState=function(a,b,c){this.lastBrain=this.brainState;this.lastAnim=this.animationState;a&&(this.brainState=a);b&&(this.animationState=b,this.owner.setState(this.animationState,function(a){"damage"==this.animationState?this.resume():(this.animationState=a,this.owner.setState(this.animationState));c&&c()}.bind(this)))};GeneralBehavior.prototype.init=function(a){this.owner=a;this.directions=[0,45,90,135,180,225,270];this.stateQueue=[];this.owner=a};
GeneralBehavior.prototype.targetWithinRadius=function(a){return this.withinRadius(a.getBasePosition())};GeneralBehavior.prototype.targetWithinVariableRadius=function(a,b){return this.withinThisRadius(b.getBasePosition(),a,a)};GeneralBehavior.prototype.targetWithinVariableRadiusAndLocation=function(a,b,c){return this.withinThisRadiusOf(c.getBasePosition(),b,a,a)};GeneralBehavior.prototype.withinRadius=function(a){return this.withinThisRadius(a,this.owner.getTargetRadius(),this.owner.getTargetRadiusY())};
GeneralBehavior.prototype.whosCloser=function(a,b){var c=this.getVectorTo(a.getBasePosition(),this.owner.getBasePosition()),d=this.getVectorTo(b.getBasePosition(),this.owner.getBasePosition());return d.distance<c.distance?-1:c.distance<d.distance?1:0};GeneralBehavior.prototype.withinThisRadiusOf=function(a,b,c,d){a=this.getVectorTo(b,a);return a.xd<=c&&a.yd<=d?!0:!1};
GeneralBehavior.prototype.withinThisRadius=function(a,b,c){var d=this.owner.getBasePosition();a=this.getVectorTo(a,d);return a.xd<=b&&a.yd<=c?!0:!1};GeneralBehavior.prototype.targetWithinSeekRadius=function(a){var b=this.owner.getBasePosition();return this.getVectorTo(a.getBasePosition(),b).distance<=this.owner.getSeekRadius()?!0:!1};GeneralBehavior.prototype.lockOnEnemyInRadius=function(){return this.lockOnClosest(this.targetWithinSeekRadius.bind(this),this.owner.enemyTeam())};
GeneralBehavior.prototype.lockOnClosestUnlocked=function(){return this.lockOnClosest(this.isUnlocked.bind(this),this.owner.enemyTeam())};GeneralBehavior.prototype.lockOnClosestFriendlyNonTank=function(){return this.lockOnClosest(this.isUndefended.bind(this),this.owner.homeTeam())};GeneralBehavior.prototype.lockOnClosestNonTank=function(){return this.lockOnClosest(this.is.bind(this,["healer","range"]),this.owner.enemyTeam())};
GeneralBehavior.prototype.isNot=function(a,b){return-1==a.indexOf(b.behaviorType)?!0:!1};GeneralBehavior.prototype.is=function(a,b){return-1!=a.indexOf(b.behaviorType)?!0:!1};GeneralBehavior.prototype.getClosestFriendToSupport=function(){return this.lockOnClosest(this.is.bind(this,["tank","range"]),this.owner.homeTeam())};GeneralBehavior.prototype.isUnlocked=function(a){for(var b=0;b<this.owner.homeTeam().length;b++){var c=this.owner.homeTeam()[b];if(c!=this.owner&&c.behavior.locked==a)return!1}return!0};
GeneralBehavior.prototype.isUndefended=function(a){if("range"!=a.behaviorType&&"healer"!=a.behaviorType)return!1;for(var b=0;b<this.owner.homeTeam().length;b++){var c=this.owner.homeTeam()[b];if(c!=this.owner&&c.behavior.support==a)return!1}return!0};
GeneralBehavior.prototype.lockOnClosest=function(a,b){for(var c=void 0,d=this.getWorldSize().width,e=0;e<b.length;e++){var f=b[e];if(f.isAlive()&&this.canTarget(f)){var g=this.getVectorTo(f.getBasePosition(),this.owner.getBasePosition());g.distance<d&&(void 0!=a?a(f)&&(d=g.distance,c=f):(d=g.distance,c=f))}}return c};GeneralBehavior.prototype.canTarget=function(a){return a.gameObject.movementType==this.owner.gameObject.targets||this.owner.gameObject.targets==jc.targetType.both?!0:!1};
GeneralBehavior.prototype.allPassCheck=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.isAlive()&&e!=this.owner&&a(e)&&c.push(e)}return c};GeneralBehavior.prototype.allFriendsWithinRadius=function(a){return this.allPassCheck(this.targetWithinVariableRadius.bind(this,a),this.owner.homeTeam())};GeneralBehavior.prototype.allFoesWithinRadius=function(a){return this.allPassCheck(this.targetWithinVariableRadius.bind(this,a),this.owner.enemyTeam())};
GeneralBehavior.prototype.allFoesWithinRadiusOfPoint=function(a,b){return this.allPassCheck(this.targetWithinVariableRadiusAndLocation.bind(this,a,b),this.owner.enemyTeam())};
GeneralBehavior.prototype.seekEnemy=function(){if(this.locked){var a=this.getWhereIShouldBe("front","facing",this.locked),a=this.adjustFlock(a);this.owner.gameObject.flightAug&&this.locked.gameObject.movementType==jc.movementType.ground&&(this.owner.isFlippedX()||(this.owner.gameObject.flightAug.x*=-1),a=cc.pAdd(a,this.owner.gameObject.flightAug));if(this.owner.gameObject.movementType==jc.movementType.ground){var b=cc.p(this.owner.layer.winSize.width/2,this.owner.layer.winSize.height/2);jc.insideEllipse(a,
b)||(a=b)}return this.seek(a)}};
GeneralBehavior.prototype.getWhereIShouldBe=function(a,b,c){if(!c)return this.owner.getBasePosition();var d=this.owner.getTextureRect(),e=c.getBasePosition(),f;"front"==a&&(f=c.isFlippedX()?cc.p(e.x-d.width,e.y):cc.p(e.x+d.width,e.y));"behind"==a&&(f=c.isFlippedX()?cc.p(e.x+d.width,e.y):cc.p(e.x-d.width,e.y));"facing"==b&&"front"==a&&this.owner.setFlippedX(!c.isFlippedX());"facing"==b&&"behind"==a&&this.owner.setFlippedX(c.isFlippedX());"away"==b&&"font"==a&&this.owner.setFlippedX(c.isFlippedX());"away"==
b&&"behind"==a&&this.owner.setFlippedX(!c.isFlippedX());return f};GeneralBehavior.prototype.adjustFlock=function(a){var b=this.allFriendsWithinRadius(10),c=this.owner.getBasePosition();if(0!=b.length)for(var d=0;d<b.length;d++)if(10>Math.abs(b[d].getBasePosition().y-c.y)&&this.owner.flockedOff!=b[d]){b[d].flockedOff=this.owner;a.y+=25;break}return a};
GeneralBehavior.prototype.seek=function(a){if(!this.owner)throw"Owning game object required";if(this.followPoint){if(this.withinThisRadius(a,25,25))return this.followPoint=void 0,cc.p(0,0)}else if(this.withinRadius(a))return cc.p(0,0);var b=this.owner.getBasePosition();a=this.getVectorTo(a,b);b=this.owner.gameObject.speed;if(!b)throw"Character: "+this.owner.name+" speed not defined.";return cc.pMult(cc.pNormalize(a.direction),b)};
GeneralBehavior.prototype.getVectorTo=function(a,b){return jc.getVectorTo(a,b)};GeneralBehavior.prototype.moveToward=function(a,b){var c=cc.pAdd(this.owner.getBasePosition(),cc.pMult(a,b));this.owner.setBasePosition(c)};GeneralBehavior.prototype.getRandomFleePosition=function(){var a=jc.randomNum(0,this.directions.length),a=cc.pForAngle(a),a=cc.pMult(a,this.owner.getTargetRadius());return this.clamp(a)};GeneralBehavior.prototype.getWorldSize=function(){return this.owner.layer.worldSize};
GeneralBehavior.prototype.clamp=function(a){var b=this.getWorldSize(),c=this.owner.getTextureRect(),d=b.width-c.width,e=c.width,b=b.height-c.height,c=c.height;a.x>d&&(a.x=d);a.x<e&&(a.x=e);a.y>b&&(a.y=b);a.y<c&&(a.y=c);return a};GeneralBehavior.prototype.healLogic=function(){this.support&&GeneralBehavior.heal(this.owner,this.support,this.owner.gameObject.heal)};
GeneralBehavior.heal=function(a,b,c){if(0>b.gameObject.hp||b.gameObject.hp>=b.gameObject.MaxHP)return!1;b.gameObject.hp=b.gameObject.hp+c<b.gameObject.MaxHP?b.gameObject.hp+c:b.gameObject.MaxHP;return!0};GeneralBehavior.prototype.hitLogic=function(){this.locked&&(GeneralBehavior.applyDamage(this.locked,this.owner,this.owner.gameObject.damage),this.damageEffects())};GeneralBehavior.prototype.damageEffects=function(){var a=spriteDefs[this.owner.name].damageMods,b;for(b in a)a[b].name=b,this.doDamageMod(a[b])};
GeneralBehavior.prototype.deathEffects=function(){var a=spriteDefs[this.owner.name].deathMods,b;for(b in a)a[b].name=b,this.doDamageMod(a[b])};GeneralBehavior.prototype.doDamageMod=function(a){powerConfig[a.name].bind(this)(this.owner.name)};
GeneralBehavior.applyDamage=function(a,b,c,d){if(!d&&!b)throw"must supply an attacker or an elementType";d||(d=spriteDefs[b.name].elementType);if(a.gameObject.defense)for(var e in a.gameObject.defense)if(e==d){var f=a.gameObject.defense[e]/100*c;c-=f;0>c&&(c=0)}b&&"range"==b.behaviorType&&a.gameObject.resistsRange&&(f=c*a.gameObject.resistsRange/100,c-=f,0>c&&(c=0));b&&a.behavior.locked!=b&&"range"!=b.behaviorType&&(c+=0.2*c);return GeneralBehavior.applyGenericDamage(a,b,c)};
GeneralBehavior.applyGenericDamage=function(a,b,c){return 0<a.gameObject.hp?(a.gameObject.hp-=c,0>=a.gameObject.hp?a.behavior.setState("dead","dead"):b&&(a.behavior.damager=b),!0):!1};GeneralBehavior.prototype.think=function(a){this.handleState(a)};
GeneralBehavior.prototype.handleDeath=function(){if(this.callbacksDisabled)1==this.callbacksDisabled&&(this.owner.scheduleOnce(this.deadForGood.bind(this),3),this.callbacksDisabled++);else{var a=this.getState();this.owner.isAlive()||"dead"==a.brain||(this.setState("dead","dead"),this.owner.movementType==jc.movementType.air&&this.owner.fallToShadow());this.owner.isAlive()||(this.owner.unscheduleAllCallbacks(),this.deathEffects(),this.callbacksDisabled=1)}};GeneralBehavior.prototype.deadForGood=function(){this.owner.die()};
GeneralBehavior.prototype.handleState=function(a){this.handleDeath();switch(this.getState().brain){case "idle":this.handleIdle(a);break;case "fighting":this.handleFight(a);break;case "damage":this.handleDamage(a)}this.afterEffects()};GeneralBehavior.prototype.handleDamage=function(a){};
GeneralBehavior.prototype.handleFight=function(a){var b=this.getState();if(this.locked)if(this.locked.isAlive()){var c=this.owner.gameObject.actionDelays.attack,d=this.owner.gameObject.effectDelays.attack;void 0==this.lastAttack&&(this.lastAttack=c);this.lastAttack>=c&&-1==b.anim.indexOf("attack")?(this.setAttackAnim("fighting",function(){var a=this.seekEnemy();a?0==a.x&&0==a.y||this.setState("move","move"):this.setState("move","move")}.bind(this)),this.owner.scheduleOnce(this.hitLogic.bind(this),
d),this.lastAttack=0):this.lastAttack+=a}else this.setState("idle",b.anim);else this.setState("idle",b.anim)};GeneralBehavior.prototype.setAttackAnim=function(a,b){void 0==this.attackSequence&&(this.attackSequence=1);if(1==this.attackSequence)this.setState(a,"attack");else{var c="attack"+this.attackSequence;this.owner.animations[c]?this.setState(a,c,b):(this.attackSequence=0,this.setState(a,"attack",b))}this.attackSequence++};
GeneralBehavior.prototype.handleIdle=function(a){this.locked&&this.damager&&this.locked!=this.damager&&(a=this.whosCloser(this.locked,this.damager),1==a&&(this.damager=void 0),-1==a&&(this.locked=this.damager,this.damager=void 0));this.locked&&this.withinRadius(this.locked.getBasePosition())||(this.forceLocked=!1,this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam()));this.locked&&!this.locked.isAlive()&&(this.forceLocked=!1,this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam()));this.locked&&
this.setState("move","move")};GeneralBehavior.prototype.handleMove=function(a){var b=this.getState();if("move"==b.brain||"followUserCommand"==b.brain)"followUserCommand"==b.brain?this.followUserCommand(a):(this.forceLocked||this.handleIdle(a),(b=this.seekEnemy())?0==b.x&&0==b.y?this.setState("fighting","move"):this.moveToward(b,a):(this.setState("idle","idle"),this.forceLocked=!1))};
GeneralBehavior.prototype.followUserCommand=function(a){var b=this.seek(this.followPoint);0==b.x&&0==b.y?(this.support=this.locked=void 0,this.setState("idle","idle")):this.moveToward(b,a)};GeneralBehavior.prototype.separate=function(){for(var a=cc.p(0,0),b=this.owner.homeTeam(),c=0;c<b.length;c++)if(b[c]!=this.owner){var d=b[c],d=this.getVectorTo(this.owner.getBasePosition(),d.getBasePosition());if(100>d.xd||100>d.yd)a=cc.pAdd(a,d.direction)}return a};GeneralBehavior.prototype.doPower=function(a){powerConfig[a.name].bind(this)(this.owner.name)};
GeneralBehavior.prototype.afterEffects=function(){if(this.owner.isAlive()){this.scheduledPowers||(this.scheduledPowers={});var a=spriteDefs[this.owner.name].powers,b;for(b in a)if(!this.scheduledPowers[b]){a[b].name=b;var c=this.doPower.bind(this,a[b]);this.owner.schedule(c,a[b].interval);this.scheduledPowers[b]=a[b]}this.scheduledEffects||(this.scheduledEffects={});for(var d in this.owner.effects)a=this.owner.effects[d],this.scheduledEffects[d]||(b=this.applyEffects.bind(this,a),c=this.removeEffects.bind(this,
a,b,d),this.owner.schedule(b,a.interval,a.duration/a.interval-2,void 0),a.duration&&this.owner.scheduleOnce(c,a.duration),this.scheduledEffects[d]=a)}};GeneralBehavior.prototype.followCommand=function(a){this.followPoint=a;this.setState("followUserCommand","move")};GeneralBehavior.prototype.attackCommand=function(a){this.locked=a;this.forceLocked=!0;this.setState("move","move")};GeneralBehavior.prototype.supportCommand=function(a){this.support=a;this.setState("move","move")};
GeneralBehavior.prototype.removeEffects=function(a,b,c){powerConfig[a.name+"-remove"].bind(this)(a);this.owner.unschedule(b);this.owner.removeEffect(c);this.scheduledEffects[c]=void 0};GeneralBehavior.prototype.applyEffects=function(a){powerConfig[a.name+"-apply"].bind(this)(a)};var RangeBehavior=function(a){_.extend(this,new GeneralBehavior);this.init(a);this.handleIdle=this.handleRangeIdle;this.handleFight=this.handleRangeFight;this.withinRadius=this.withinRangeRadius;if(!this.missile){(a=this.owner.gameObject.missile)||(a="greenbullet");var b=missileConfig[a];b.simple?this.missile=jc.makeSpriteWithPlist(b.plist,b.png,b.start):(this.missile=jc.makeSpriteWithPlist(b.plist,b.png,b.start),this.missileAnimation=jc.makeAnimationFromRange(a,b),this.missile.runAction(this.missileAnimation));
this.missile.setFlippedX(!this.owner.isFlippedX())}};
RangeBehavior.prototype.handleRangeFight=function(a){this.forceLocked||(this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam()));var b=this.getState();if(this.locked)if(this.locked.isAlive())if(this.locked.isAlive()||-1!=b.anim.indexOf("attack")){var c=this.owner.gameObject.actionDelays.attack,d=this.owner.gameObject.effectDelays.attack;void 0==this.lastAttack&&(this.lastAttack=c);b=this.getState();this.lastAttack>=c&&-1==b.anim.indexOf("attack")&&!this.firing?(this.setAttackAnim("fighting"),
this.owner.scheduleOnce(this.doMissile.bind(this),d),this.lastAttack=0):this.lastAttack+=a}else this.setState("idle",b.anim);else this.setState("idle",b.anim);else this.setState("idle",b.anim)};
RangeBehavior.prototype.doMissile=function(){if(this.locked)if(this.firing){var a=this.getState();this.setState(a.brain,"idle")}else{this.firing=!0;var b=this.owner.gameObject.missile;b||(b="greenbullet");var c=missileConfig[b],d=this.getVectorTo(this.locked.getBasePosition(),this.owner.getBasePosition()).distance/c.speed;this.missile||(jc.log(["rangeBehavior"],"Animating: "+this.owner.name+" missle: "+b),c.simple?this.missile=jc.makeSpriteWithPlist(c.plist,c.png,c.start):(this.missile=jc.makeSpriteWithPlist(c.plist,
c.png,c.start),this.missileAnimation=jc.makeAnimationFromRange(b,c),this.missile.runAction(this.missileAnimation)),this.missile.setFlippedX(!this.owner.isFlippedX()));this.owner.layer.addChild(this.missile);var b=this.owner.getBasePosition(),e=this.owner.getTextureRect();this.owner.isFlippedX()?b.x-=e.width/2:b.x+=e.width/2;b.y+=e.height/2;c.offset&&(b=cc.pAdd(b,c.offset));this.owner.gameObject.missileOffset&&(b=cc.pAdd(b,this.owner.gameObject.missileOffset));this.missile.setPosition(b);this.missile.setFlippedX(!this.owner.isFlippedX());
"base"==this.owner.gameObject.missleTarget?b=this.locked.getBasePosition():(b=this.locked.getBasePosition(),e=this.locked.getTextureRect(),b.y+=e.height/2);var e=this.missile.getPosition(),f=this.getVectorTo(b,e);if(c.path)if("bezier"==c.path){var g=[];g.push(e);e=cc.pMidpoint(e,b);e.y+=f.distance/2;g.push(e);g.push(b);b=cc.BezierTo.create(d,g)}else if("jump"==c.path)b=cc.JumpTo.create(d,b,f.distance/2,1);else if("arrow"==c.path)f=f.distance/2,e.y+f<=b.y&&(f=b.y+f/2),b=cc.JumpTo.create(d,b,f,1);else if("bullet"==
c.path)e=cc.pSub(e,cc.p(b.x,b.y)),e=Math.atan2(e.y,e.x),jc.log(["missile"],"angle raw atan2:"+e),e*=180/Math.PI,this.owner.isFlippedX()||(e+=180),e*=-1,jc.log(["missile"],"angle:"+e),this.missile.setRotation(e),b=cc.MoveTo.create(d,b);else throw c.path;else b=cc.MoveTo.create(d,b);c.rotation&&(this.owner.isFlippedX()?(this.missile.setRotation(-1*c.initialAngle),a=cc.RotateTo.create(d,-45)):(this.missile.setRotation(c.initialAngle),a=cc.RotateTo.create(d,45)));d=cc.CallFunc.create(function(){this.locked&&
(this.hitLogic(),c.effect&&jc.playEffectOnTarget(c.effect,this.locked,this.owner.layer));this.owner.layer.removeChild(this.missile,!1);this.firing=!1}.bind(this));b.retain();d=cc.Sequence.create(b,d);d.retain();this.missile.runAction(d);a&&(a.retain(),this.missile.runAction(a))}};RangeBehavior.prototype.handleRangeIdle=function(a){(this.locked=this.lockOnClosest(void 0,this.owner.enemyTeam()))&&this.setState("move","move")};
RangeBehavior.prototype.withinRangeRadius=function(a){return this.withinThisRadius(a,this.owner.getTargetRadius(),this.owner.getTargetRadius())};var DefenderBehavior=function(a){_.extend(this,new GeneralBehavior);this.init(a);this.handleTankIdle=this.handleIdle;this.handleIdle=this.handleDefenderIdle;this.handleMove=this.handleDefenderMove;this.think=this.defendThink};
DefenderBehavior.prototype.handleSeek=function(a){this.support&&this.support.behavior.damager&&this.support.behavior.damager.isAlive()?(this.locked=this.support.behavior.damager,this.setState("attackmove","move")):(this.locked=this.lockOnEnemyInRadius())?this.setState("attackmove","move"):this.support&&(a=this.getWhereIShouldBe("front","away",this.support),a=this.seek(a),0!=a.x&&0!=a.y&&this.setState("move","idle"))};
DefenderBehavior.prototype.handleDefenderMove=function(a){var b=this.getState();if("move"==b.brain||"attackmove"==b.brain||"followUserCommand"==b.brain)"followUserCommand"==b.brain?this.followUserCommand(a):"attackmove"==b.brain?(b=this.seekEnemy())?0==b.x&&0==b.y?this.setState("fighting","move"):this.moveToward(b,a):(this.setState("idle","idle"),this.forceLocked=!1):(b=this.getWhereIShouldBe("front","away",this.support),b=this.seek(b),0==b.x&&0==b.y?this.setState("seek","idle"):this.moveToward(b,
a))};DefenderBehavior.prototype.handleDefenderDamage=function(a){this.damager&&this.damager.isAlive()&&this.damager!=this.locked&&this.isNot(["range","mage"],this.damager)?(this.locked=this.damager,this.setState("attackmove","move")):this.resume()};DefenderBehavior.prototype.defendThink=function(a){var b=this.getState();this.handleDeath();switch(b.brain){case "idle":this.handleDefenderIdle(a);break;case "fighting":this.handleFight(a);break;case "seek":this.handleSeek(a);break;case "damage":this.handleDefenderDamage(a)}this.afterEffects()};
DefenderBehavior.prototype.handleDefenderIdle=function(a){this.support||(this.support=this.lockOnClosestFriendlyNonTank());this.support&&this.support.isAlive()||(this.support=void 0,this.locked=this.lockOnClosestFriendlyNonTank());this.support?this.setState("move","move"):this.handleTankIdle(a)};var FlankerBehavior=function(a){_.extend(this,new GeneralBehavior);this.init(a);this.handleTankIdle=this.handleIdle;this.handleIdle=this.handleFlankerIdle};FlankerBehavior.prototype.handleFlankerIdle=function(a){this.locked||(this.locked=this.lockOnClosestNonTank());this.locked&&!this.locked.isAlive()&&(this.locked=void 0,this.locked=this.lockOnClosestNonTank());this.locked?this.setState("move","move"):this.handleTankIdle()};var HealerBehavior=function(a){_.extend(this,new GeneralBehavior);this.handleTankIdle=this.handleIdle;this.think=this.healThink;this.handleNormalMove=this.handleMove;this.handleMove=this.handleHealerMove;this.init(a)};HealerBehavior.prototype.handleHealerMove=function(a){var b=this.getState();if("move"==b.brain||"followUserCommand"==b.brain)"followUserCommand"==b.brain?this.followUserCommand(a):this.support?this.handleHealMove(a):this.handleNormalMove(a)};
HealerBehavior.prototype.healThink=function(a){var b=this.getState();this.handleDeath();switch(b.brain){case "idle":this.handleHealerIdle(a);break;case "fighting":this.handleFight(a);break;case "healing":this.handleHeal(a);break;case "damage":this.handleDamage(a)}this.afterEffects()};
HealerBehavior.prototype.handleHealerIdle=function(a){this.support&&this.support.isAlive()||(this.support=this.getClosestFriendToSupport());this.support?this.withinThisRadius(this.support.getBasePosition(),2*this.owner.getTargetRadius(),this.owner.getTargetRadiusY()/2)?0<this.support.gameObject.hp&&this.support.gameObject.hp<this.support.gameObject.MaxHP&&(this.getState(),this.setState("healing","attack")):this.setState("move","move"):this.handleTankIdle(a)};
HealerBehavior.prototype.handleHealMove=function(a){var b=this.getState(),c=this.getWhereIShouldBe("behind","facing",this.support),c=this.seek(c);0==c.x&&0==c.y?this.setState("healing",b.anim):this.moveToward(c,a)};
HealerBehavior.prototype.handleHeal=function(a){var b=this.getState();if("attack"!=b.anim)if(this.support)if(this.support.isAlive()){var c=this.getWhereIShouldBe("behind","facing",this.support),c=this.seek(c);if(0!=c.x&&0!=c.y)this.setState("move","move");else{var c=this.owner.gameObject.actionDelays.heal,d=this.owner.gameObject.effectDelays.heal;void 0==this.lastHeal&&(this.lastHeal=c);this.lastHeal>=c&&"attack"!=b.anim?0>this.support.gameObject.hp||this.support.gameObject.hp>=this.support.gameObject.MaxHP?
this.lastHeal+=a:(this.owner.scheduleOnce(this.healLogic.bind(this),d),jc.playEffectOnTarget("heal",this.support,this.support.getZOrder(),this.owner.layer,!0),this.lastHeal=0,this.setState("healing","attack")):(this.lastHeal+=a,this.setState("healing",b.anim))}}else this.setState("idle","idle");else this.setState("idle","idle")};var TankBehavior=function(a){_.extend(this,new GeneralBehavior);this.init(a)};var BehaviorMap={tank:TankBehavior,range:RangeBehavior,healer:HealerBehavior,flanker:FlankerBehavior,defender:DefenderBehavior};hotr=hotr||{};hotr.api={};jc.isBrowser?(hotr.api.target=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),hotr.api.sTarget=hotr.api.target):(hotr.api.target="http://www.riftsummoner.com",hotr.api.sTarget="http://www.riftsummoner.com");hotr.api.get=function(a,b){hotr.api.do("GET",a,void 0,b)};hotr.api.post=function(a,b,c){hotr.api.do("POST",a,b,c)};
hotr.api.do=function(a,b,c,d){var e;try{e=new XMLHttpRequest}catch(f){throw"Couldn't create xmlhttp \x3d "+f;}e.onreadystatechange=function(){jc.log(["console"],"readystatechange");if(4==e.readyState){jc.log(["console"],"readystatechange 4");var a=e.responseText,b;try{b=JSON.parse(a)}catch(c){if(jc.log(["console"],"failed to parse:"+a+" with "+c),b=a,""==b||!1==b||null==b)b=void 0}200==e.status?d&&d(void 0,b):(0==e.status?(a=500,b="connection dropped."):a=e.status,d&&d(a,b))}};e.open(a,b);c?(e.setRequestHeader("Content-type",
"application/json"),a=JSON.stringify(c),e.send(a)):e.send()};hotr.api.makeUrl=function(a,b,c){for(var d=b.split("/"),e=0,f=0;f<d.length;f++)if(-1!=d[f].indexOf(":")){if(e>=c.length)throw"Insufficient number of params passed to make a url for: "+b;d[f]=c[e];e++}return a+d.join("/")};hotr.api.getBlob=function(a,b){var c=hotr.api.makeUrl(hotr.api.target,"/app/getblob/:token",arguments);hotr.api.get(c,b)};
hotr.api.createNewPlayer=function(a,b,c){var d=hotr.api.makeUrl(hotr.api.sTarget,"/app/createplayer/:id/:pass",arguments);hotr.api.get(d,c)};hotr.api.getNewAuthTokenAndBlob=function(a,b,c,d){var e=hotr.api.makeUrl(hotr.api.sTarget,"/app/gettokenandblob/:id/:data/:hash",arguments);hotr.api.get(e,d)};hotr.api.saveBlob=function(a,b,c){var d=hotr.api.makeUrl(hotr.api.target,"/app/saveblob/:token",arguments);hotr.api.post(d,b,c)};
hotr.api.getGames=function(a,b){var c=hotr.api.makeUrl(hotr.api.target,"/app/getgames/:token",arguments);hotr.api.get(c,b)};hotr.api.findGame=function(a,b){var c=hotr.api.makeUrl(hotr.api.target,"/app/findgame/:token",arguments);hotr.api.get(c,b)};hotr.api.getTeam=function(a,b,c){var d=hotr.api.makeUrl(hotr.api.target,"/app/getteam/:token/:opponent",arguments);hotr.api.get(d,c)};
hotr.api.victory=function(a,b,c,d){var e=hotr.api.makeUrl(hotr.api.target,"/app/victory/:token/:opponent",arguments);hotr.api.post(e,c,d)};hotr.api.defeat=function(a,b,c,d){var e=hotr.api.makeUrl(hotr.api.target,"/app/defeat/:token/:opponent",arguments);hotr.api.post(e,c,d)};var SelectTeam=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:140,cells:20,cardLayer:void 0,playMap:{},squad1Prefix:"squad1Cells",squad2Prefix:"squad2Cells",init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.highlight=jc.makeSpriteWithPlist(uiPlist,uiPng,"portraitSmallSelected.png"),this.highlight.setVisible(!1),this.mainFrame.addChild(this.highlight),this.name="SelectTeam",this.bubbleAllTouches(!0),
jc.layerManager.pushLayer(this),this.first=!1,!0):!1},onShow:function(){this.nextEnabled=!0;if(this.first)void 0!=hotr.scratchBoard.selectedCharacter&&void 0!=hotr.scratchBoard.currentCell&&(a=hotr.blobOperations.indexToId(hotr.scratchBoard.selectedCharacter),d=this.cellFromCellName(hotr.scratchBoard.currentCell),a?(this.removeExistingVisual(a,hotr.scratchBoard.currentCell),this.doSelectionData(a,d),this.doSelectionVisual(a,d,hotr.scratchBoard.currentCell),hotr.scratchBoard.selectedCharacter=void 0,
hotr.scratchBoard.currentCell=void 0):this[hotr.scratchBoard.currentCell].pic&&(jc.fadeOut(this[hotr.scratchBoard.currentCell].pic),hotr.blobOperations.clearFormationPosition(d)),this.step=hotr.blobOperations.getTutorialStep(),1==this.level&&(13==this.step&&(this.showTutorialStep("Now let's show these goblins who they're messing with.",void 0,"left","girl"),this.placeArrowOn(this.fightButton,"down"),this.step=14,hotr.blobOperations.setTutorialStep(14)),9==this.step&&(this.showTutorialStep("Okay, now place a second character in Squad B. Using two squads allows for advanced tactics.",
void 0,"left","girl"),this.step=10,hotr.blobOperations.setTutorialStep(10))));else{this.start();for(var a=hotr.blobOperations.getFormationOrder(),b=hotr.teamformationSize/2,c=0;c<b;c++)if(void 0!=a[c]){var d=c;this.doSelectionData(a[c],d);this.doSelectionVisual(a[c],d,this.squad1Prefix+c)}for(c=b;c<hotr.teamformationSize;c++)void 0!=a[c]&&(d=c,this.doSelectionData(a[c],d),this.doSelectionVisual(a[c],d,this.squad2Prefix+(c-b)));this.first=!0}},cellFromCellName:function(a){return-1!=a.indexOf(this.squad1Prefix)?
parseInt(a.replace(this.squad1Prefix,"")):parseInt(a.replace(this.squad2Prefix,""))+hotr.teamformationSize/2},inTransitionsComplete:function(){this.level=hotr.blobOperations.getTutorialLevel();this.step=hotr.blobOperations.getTutorialStep();this.first&&1==this.level&&4==this.step&&(this.showTutorialStep("We need to build your team - click here to select a fighter.",void 0,"right","girl"),this.step=5)},removeExistingVisual:function(a){a=hotr.blobOperations.getCurrentFormationPosition(a);-1!=a&&(a=
this.getCellName(a),this[a].pic&&jc.fadeOut(this[a].pic))},getCellName:function(a){return a>=hotr.teamformationSize/2?this.squad2Prefix+(a-hotr.teamformationSize/2):this.squad1Prefix+a},doSelectionVisual:function(a,b,c){a=hotr.blobOperations.getEntryWithId(a);a=jc.getCharacterCard(a.name);this.scaleTo(a,this[c]);jc.scaleCard(a);this.centerThisPeer(a,this[c]);this[c].pic?jc.swapFade.bind(this)(this[c].pic,a):(this.mainFrame.addChild(a),jc.fadeIn(a,255));this[c].pic=a;this.reorderChild(a,this[c].getZOrder());
this[c].border||(this[c].border=jc.makeSpriteWithPlist(uiPlist,uiPng,"portraitSmall.png"),this.mainFrame.addChild(this[c].border),this.centerThisPeer(this[c].border,this[c]),this.reorderChild(this[c].border,this[c].pic.getZOrder()+1))},doSelectionData:function(a,b){hotr.blobOperations.placeCharacterFormation(a,b)},previousFormation:function(){jc.log(["selectTeam"],"previousButton")},nextFormation:function(){jc.log(["selectTeam"],"nextButton")},fightStart:function(){jc.log(["selectTeam"],"fightStart");
1==this.level&&14!=this.step?jc.log(["selectTeam"],"fightStart before ready"):this.nextEnabled?(this.arrow&&(this.removeTutorialStep("girl","left"),this.removeChild(this.arrow,!0)),this.nextEnabled=!1,0!=hotr.blobOperations.getFormationOrder().length?(jc.log(["selectTeam"],"fightStart!!!!"),hotr.mainScene.layer.arenaPre()):jc.log(["selectTeam"],"fightStart no dudes")):jc.log(["selectTeam"],"fightStart invalid state")},kikStart:function(){this.nextEnabled&&cards.kik.pickUsers(function(a){hotr.blobOperations.getLevel();
var b=hotr.blobOperations.getTeam(),c=hotr.blobOperations.getFormation(),d=hotr.blobOperations.getPowers(),b={team:b,teamFormation:c,teamPowers:d};if(a)for(c=0;c<a.length;c++)cards.kik.send(a[c].username,{title:"Get some",text:"My army will crush you",data:b})})},close:function(){jc.log(["selectTeam"],"close")},targetTouchHandler:function(a,b,c){if((1!=this.level||14!=this.step)&&!this.handleTutorialTouches(a,b,c))return c[0]?(a==jc.touchEnded&&(this.highlight.setVisible(!0),a=c[0].getPosition(),
this.highlight.setPosition(a),this.reorderChild(this.highlight,c[0].getZOrder()+1),hotr.scratchBoard.currentCell=c[0].name,this.nextEnabled=!1,this.arrow&&this.arrow.setVisible(!1),jc.layerManager.pushLayer(EditTeam.getInstance(),10)),!0):!1},handleTutorialTouches:function(a,b,c){if(1==this.level){if(5==this.step)return this.removeTutorialStep("girl","left"),this.placeArrowOn(this.squad1Cells0,"down"),this.step=6,!0;if(6==this.step)return c&&c[0]&&"squad1Cells0"==c[0].name?(this.step=7,hotr.blobOperations.setTutorialStep(7),
!1):!0;if(10==this.step)this.removeTutorialStep("girl","left"),this.placeArrowOn(this.squad2Cells0,"down"),this.step=11;else if(11==this.step)return c&&c[0]&&"squad2Cells0"==c[0].name?(this.step=12,hotr.blobOperations.setTutorialStep(12),!1):!0}},windowConfig:{mainFrame:{type:"sprite",blackBox:!0,applyAdjustments:!0,transitionIn:"top",transitionOut:"top",sprite:"genericBackground.png",z:0,kids:{squad1Cells:{isGroup:!0,z:1,type:"grid",cols:3,itemPadding:{top:3,left:4},input:!0,members:[{type:"sprite",
input:!0,sprite:"portraitSmallDarkBackground.png"}],membersTotal:9,sprite:"portraitSmallDarkBackground.png",pos:{x:310,y:834}},squad2Cells:{isGroup:!0,z:1,type:"grid",cols:3,itemPadding:{top:3,left:4},input:!0,members:[{type:"sprite",input:!0,sprite:"portraitSmallDarkBackground.png"}],membersTotal:9,sprite:"portraitSmallDarkBackground.png",pos:{x:1234,y:831}},fightButton:{type:"button",main:"buttonFight.png",pressed:"buttonFight.png",touchDelegateName:"fightStart",z:1,pos:{x:1023,y:145}},leftSquadFrame:{type:"sprite",
sprite:"frameA.png",z:0,pos:{x:535,y:597}},rightSquadFrame:{type:"sprite",sprite:"frameB.png",z:0,pos:{x:1502,y:593}},banner:{type:"sprite",sprite:"buildYourTeamTitle.png",z:0,pos:{x:1021,y:1020}}},pos:{x:1024,y:777.9999999999999}}}});
SelectTeam.scene=function(){hotr.selectTeamScene||(hotr.selectTeamScene=cc.Scene.create(),hotr.selectTeamScene.retain(),hotr.selectTeamScene.layer=new SelectTeam,hotr.selectTeamScene.layer.retain(),hotr.selectTeamScene.addChild(hotr.selectTeamScene.layer),hotr.selectTeamScene.layer.init());return hotr.selectTeamScene};var EditTeam=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cells:20,cardLayer:void 0,playMap:{},init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),cc.SpriteFrameCache.getInstance().addSpriteFrames(cardsPlists[0]),this.initFromConfig(this.windowConfig),this.name="EditTeam",!0):!1},onShow:function(){this.start();if(!this.tableView){this.tableView=new jc.ScrollingLayer;this.characterPortraitsFrame.addChild(this.tableView);var a=this.getDisplaySpritesAndMetaData();
this.cellWidth=2*a.sprites[0].getContentSize().width;this.tableView.init({sprites:a.sprites,metaData:a.ids,cellWidth:this.cellWidth,selectionCallback:this.selectionCallback.bind(this),width:this.winSize.width});var a=this.tableView.getContentSize(),b=a.height/2,b=b+25*jc.assetScaleFactor;this.tableView.setPosition(cc.p(a.width/2,b));this.reorderChild(this.tableView,3);this.tableView.hackOn()}},inTransitionsComplete:function(){this.level=hotr.blobOperations.getTutorialLevel();this.step=hotr.blobOperations.getTutorialStep();
if(this.firstShow){if(this.step=hotr.blobOperations.getTutorialStep(),12==this.step){var a=cc.p(1450*jc.assetScaleFactor,400*jc.assetScaleFactor);this.placeArrow(a,"down")}}else this.tableView.setIndex(1),1==this.level&&7==this.step&&this.showTutorialStep("Okay, now select a character for the fight below - choose wisely.",1.5,"left","girl"),this.firstShow=!0},outTransitionsComplete:function(){jc.layerManager.popLayer()},makeScrollSprites:function(a){a=_.map(a,function(a){return this.makeScrollSprite(a)}.bind(this));
var b=jc.makeSimpleSprite("characterPortraitFrame.png");a.push(b);return a},makeScrollSprite:function(a){var b=jc.makeSimpleSprite("characterPortraitFrame.png");b.pic=jc.getCharacterCard(a);b.addChild(b.pic);this.scaleTo(b.pic,b);jc.scaleCard(b.pic);this.centerThisChild(b.pic,b);b.pic.setZOrder(-1);return b},getDisplaySpritesAndMetaData:function(){var a=hotr.blobOperations.getCharacterIdsAndTypes(),b=_.pluck(a,"name"),a=_.pluck(a,"id"),b=this.makeScrollSprites(b);return{ids:a,sprites:b}},getEmptyCells:function(a){for(var b=
[],c=0;c<a;c++){var d=jc.makeSimpleSprite("characterPortraitFrame.png");this.cellWidth||(this.cellWidth=d.getTextureRect().width+100);b.push(d)}return b},targetTouchHandler:function(a,b,c){return!0},trainPower:function(){jc.log(["editTeam"],"train")},doneTouch:function(){hotr.scratchBoard.selectedCharacter=this.tableView.selectedIndex;this.close()},selectionCallback:function(a,b,c){c?(this.card.setVisible(!0),this.element.setVisible(!0),this.lastSelection=a=hotr.blobOperations.getEntryWithId(c),b=
jc.getCharacterCardFrame(a.name),this.swapCharacterCard(b),this.placeElement(a),this.placeAttackTypes(a),this.updateStats(a),this.infoPress(),1==this.level&&7==this.step?(a=cc.p(825*jc.assetScaleFactor,400*jc.assetScaleFactor),this.placeArrow(a,"down"),this.step=8):1==this.level&&8==this.step?(this.step=9,hotr.blobOperations.setTutorialStep(9),this.placeArrowOn(this.doneButton,"down")):1==this.level&&12==this.step&&(this.step=13,hotr.blobOperations.setTutorialStep(13),this.placeArrowOn(this.doneButton,
"down"))):(this.card.setVisible(!1),this.lastSelection=void 0,this.element.setVisible(!1),this.hideStats(),this.clearAttackTypes())},clearAttackTypes:function(){this.ground.setVisible(!1);this.air.setVisible(!1)},placeAttackTypes:function(a){this.clearAttackTypes();a=spriteDefs[a.name];0==a.gameProperties.targets&&(this.ground.setVisible(!1),this.air.setVisible(!0));1==a.gameProperties.targets&&(this.ground.setVisible(!0),this.air.setVisible(!1));2==a.gameProperties.targets&&(this.ground.setVisible(!0),
this.air.setVisible(!0))},hideStats:function(){var a=jc.makeStats(),b;for(b in a)a="lbl"+b,this[a]&&this[a].setVisible(!1)},showStats:function(){var a=jc.makeStats(),b;for(b in a)a="lbl"+b,this[a]&&this[a].setVisible(!0)},updateStats:function(a){this.showStats();a=jc.makeStats(a.name);a=this.makeStringStats(a);for(var b in a)this["lbl"+b].setText(a[b])},makeStringStats:function(a){for(var b in a)if(a[b]=a[b].toString(),7>a[b].length)for(var c=0;c<7-a[b].length;c++)a[b]+=" ";return a},placeElement:function(a){a=
jc.elementSprite(spriteDefs[a.name].elementType);void 0==a?this.element.setVisible(!1):(this.element.setVisible(!0),jc.swapSpriteFrameName(this.element,a))},infoPress:function(){this.buildInfoDialogForSelectedCharacter(spriteDefs[this.lastSelection.name])},buildInfoDialogForSelectedCharacter:function(a){this.infoTitle.setText(a.formalName);this.infoText.setText(a.details)},infoTouch:function(){this.doInfoFadeOut=!0},infoFadeIn:function(){this.powerFade("out");jc.fadeIn(this.infoTitle,255,2*jc.defaultTransitionTime);
jc.fadeIn(this.infoText,255,2*jc.defaultTransitionTime);jc.fadeIn(this.infoDialog,255,2*jc.defaultTransitionTime,function(){this.scheduleOnce(this.infoFade.bind(this),2)}.bind(this))},infoFade:function(){this.doInfoFadeOut?(this.infoFadeWorker(),this.doInfoFadeOut=!1):this.scheduleOnce(this.infoFade.bind(this),2)},powerFade:function(a){for(var b=0;5>b;b++)"in"==a&&(jc.fadeIn(this["powerIcons"+b],255,2*jc.defaultTransitionTime),jc.fadeIn(this["powerLevels"+b],255,2*jc.defaultTransitionTime)),"out"==
a&&(jc.fadeOut(this["powerIcons"+b],2*jc.defaultTransitionTime),jc.fadeOut(this["powerLevels"+b],2*jc.defaultTransitionTime))},infoFadeWorker:function(){this.powerFade("in");jc.fadeOut(this.infoDialog,2*jc.defaultTransitionTime);jc.fadeOut(this.infoTitle,2*jc.defaultTransitionTime);jc.fadeOut(this.infoText,2*jc.defaultTransitionTime)},swapCharacterCard:function(a){jc.fadeOut(this.card,jc.defaultTransitionTime,function(){jc.swapSpriteFrame(this.card,a);jc.fadeIn(this.card,255)}.bind(this))},previousChar:function(){this.tableView.left()},
nextChar:function(){this.tableView.right()},close:function(){1==this.level&&9!=this.step&&13!=this.step||this.done()},windowConfig:{mainFrame:{blackBox:!0,size:{width:2048,height:1365},type:"sprite",rect:{origin:{x:220,y:220},size:{width:293,height:293}},applyAdjustments:!0,transitionIn:"top",transitionOut:"top",sprite:"genericBackground.png",z:0,kids:{closeButton:{type:"button",main:"closeButton.png",pressed:"closeButtonPressed.png",touchDelegateName:"close",z:1,pos:{x:1973,y:1081}},statsFrame:{type:"sprite",
sprite:"statsFrame.png",z:2,pos:{x:596,y:731}},doneButton:{type:"button",main:"buttonDone.png",pressed:"buttonDonePressed.png",touchDelegateName:"doneTouch",z:4,pos:{x:1500,y:457}},characterPortraitsFrame:{type:"sprite",sprite:"characterPortraitsFrame.png",z:1,pos:{x:1019,y:200}},characterPortraitsLeft:{type:"button",main:"characterPortraitsButtonLeftBrown.png",pressed:"characterPortraitsButtonLeftPressedBrown.png",touchDelegateName:"previousChar",z:10,pos:{x:97,y:208}},characterPortraitsRight:{type:"button",
main:"characterPortraitsButtonRightBrown.png",pressed:"characterPortraitsButtonRightPressedBrown.png",touchDelegateName:"nextChar",z:10,pos:{x:1956,y:198}},card:{type:"sprite",sprite:"gargoyleFire_bg.png",z:1,pos:{x:781,y:680}},element:{type:"sprite",sprite:"elements_0000_void.png",z:5,pos:{x:1015,y:420}},air:{type:"sprite",sprite:"canAttackAir.png",z:1,pos:{x:238,y:1039}},ground:{type:"sprite",sprite:"canAttackGround.png",z:1,pos:{x:384,y:1039}},lblhp:{type:"label",text:"HEALTH",width:160,height:80,
alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:3,pos:{x:335,y:875}},lbldamage:{type:"label",text:"DAMAGE",width:160,height:80,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:3,pos:{x:335,y:795}},lblarmor:{type:"label",text:"ARMOR",width:160,height:80,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:3,pos:{x:335,y:715}},lblspeed:{type:"label",text:"SPEED",width:80,height:80,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:3,pos:{x:297,
y:635}},lblpower:{type:"label",text:"POWER",width:80,height:80,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:3,pos:{x:297,y:555}},lblrange:{type:"label",text:"RANGE",width:80,height:80,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:3,pos:{x:297,y:475}},infoDialog:{type:"sprite",sprite:"titleDescription.png",z:3,pos:{x:1525,y:750}},infoTitle:{type:"label",text:"TITLE",width:400,height:80,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:4,pos:{x:1560,
y:1E3}},infoText:{type:"label",text:"DESC",width:600,height:400,alignment:0,fontSize:jc.font.fontSizeRaw,fontName:jc.mainFont,z:4,pos:{x:1525,y:680}}},pos:{x:1024,y:768}}}});EditTeam.getInstance=function(){hotr.editTeam||(hotr.editTeam=new EditTeam,hotr.editTeam.retain(),hotr.editTeam.init());return hotr.editTeam};var Victory=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:200,cells:20,cardLayer:void 0,playMap:{},init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.name="Victory",!0):!1},onShow:function(){this.start()},inTransitionsComplete:function(){jc.log(["victory"],"in transition complete")},outTransitionsComplete:function(){jc.log(["victory"],"out transition complete")},targetTouchHandler:function(a,
b,c){console.log(c[0].name);return!1},close:function(){this.onDone()},onDone:function(){},windowConfig:{mainFrame:{cell:5,type:"sprite",transitionIn:"topToMid",transitionOut:"top",sprite:"victoryScreenWindow.png",kids:{okButton:{type:"button",main:"buttonOk.png",pressed:"buttonOk.png",touchDelegateName:"close",z:1,pos:{x:510,y:85}}},z:0,pos:{x:1040,y:792.0000000000005}}}});var Defeat=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:200,cells:20,cardLayer:void 0,playMap:{},init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.name="Defeat",!0):!1},onShow:function(){this.start()},inTransitionsComplete:function(){jc.log(["defeatdialog"],"oh noes")},outTransitionsComplete:function(){jc.log(["defeatdialog"],"oh noes")},targetTouchHandler:function(a,b,c){jc.log(["defeatdialog",
"touchcore"],"oh noes");return!1},close:function(){this.onDone()},onDone:function(){},windowConfig:{mainFrame:{cell:5,type:"sprite",transitionIn:"topToMid",transitionOut:"top",sprite:"defeatWindow.png",kids:{okButton:{type:"button",main:"buttonOk.png",pressed:"buttonOk.png",touchDelegateName:"close",z:1,pos:{x:510,y:125}}},z:0,pos:{x:1040,y:792.0000000000005}}}});var Landing=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:140,cells:20,cardLayer:void 0,playMap:{},cellPrefix:"gridCells",init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(landingPlist),this.initFromConfig(this.windowConfig),!0):!1},onShow:function(){this.start()},quest:function(){hotr.mainScene.layer.map()},battle:function(){},summon:function(){},store:function(){},windowConfig:{mainFrame:{cell:5,type:"sprite",sprite:"landingScreen.png",
z:1,kids:{questButton:{type:"button",main:"questButton.png",pressed:"questButtonPressed.png",touchDelegateName:"quest",z:2,pos:{x:804,y:468}},battleButton:{type:"button",main:"battleButton.png",pressed:"battleButtonPressed.png",touchDelegateName:"battle",z:2,pos:{x:1316,y:468}},summonButton:{type:"button",main:"summonButton.png",pressed:"summonPressed.png",touchDelegateName:"summon",z:2,pos:{x:808,y:220}},storeButton:{type:"button",main:"storeButton.png",pressed:"storeButtonPressed.png",touchDelegateName:"summon",
z:2,pos:{x:1316,y:218}}},pos:{x:1004,y:756}}}});Landing.scene=function(){hotr.landingScene||(hotr.landingScene=cc.Scene.create(),hotr.landingScene.retain(),hotr.landingScene.layer=new Landing,hotr.landingScene.addChild(hotr.landingScene.layer),hotr.landingScene.layer.init());return hotr.landingScene};var Consts={idle:0,walk:1,attack:2,intro:2,dead:3,powerup:4},ArenaGame=jc.WorldLayer.extend({teamASprites:[],teamBSprites:[],sprites:[],teams:{},teamAPowers:void 0,teamBPowers:void 0,presentationSpeed:0.2,timeLimit:45,init:function(){this.name="Arena";return this._super(arenaSheet)?(this.teams.a=[],this.teams.b=[],this.teamSize=18,this.squadNumbers=this.teamSize/2,this.scheduleUpdate(),this.doConvert=!0,this.gameTime=0,this.powerBarOpenPos=cc.p(400*jc.assetScaleFactor,187*jc.assetScaleFactor),this.powerBarClosePos=
cc.p(-255*jc.assetScaleFactor,187*jc.assetScaleFactor),this.powerTilePosition=cc.p(159*jc.assetScaleFactor,100*jc.assetScaleFactor),this.powerTileSpacing=200*jc.assetScaleFactor,this.squadBarOpenPos=cc.p(1700*jc.assetScaleFactor,187*jc.assetScaleFactor),this.squadBarClosePos=cc.p(2310*jc.assetScaleFactor,187*jc.assetScaleFactor),this.squadTilePosition=cc.p(250*jc.assetScaleFactor,85*jc.assetScaleFactor),this.squadTileSpacing=200*jc.assetScaleFactor,this.tutorialPoint1=cc.p(600*jc.assetScaleFactor,
600*jc.assetScaleFactor),this.tutorialPoint2=cc.p(800*jc.assetScaleFactor,800*jc.assetScaleFactor),this.tutorial2Point1=cc.p(400*jc.assetScaleFactor,250*jc.assetScaleFactor),this.tutorial2Point2=cc.p(425*jc.assetScaleFactor,450*jc.assetScaleFactor),this.tutorial2Point3=cc.p(this.winSize.width/2,this.winSize.height/2),this.enemyStartPos=cc.p(this.worldSize.width/2+500*jc.assetScaleFactor,this.worldSize.height/2-300*jc.assetScaleFactor),!0):!1},onShow:function(){cc.SpriteFrameCache.getInstance().addSpriteFrames(shadowPlist);
cc.SpriteBatchNode.create(shadowPng);this.level=hotr.blobOperations.getTutorialLevel();this.scheduleOnce(function(){hotr.arenaScene.data?3<this.level?this.runScenario():this.runTutorial():this.runScenario0()}.bind(this))},runScenario:function(){this.teamASprites=hotr.arenaScene.data.teamA;this.teamAPowers=hotr.arenaScene.data.teamAPowers;this.teamBSprites=hotr.arenaScene.data.teamB;this.teamBPowers=hotr.arenaScene.data.teamBPowers;this.placePowerTokens();this.placeSquadTokens();this.setUp();this.placementTouches=
1;this.panToWorldPoint(this.worldMidPoint,this.getScaleFloor(),jc.defaultTransitionTime,function(){this.placeEnemyTeam();this.nextTouchDo(this.initialSetupAction,!0)}.bind(this))},runTutorial:function(){this.teamASprites=hotr.arenaScene.data.teamA;this.teamAPowers=hotr.arenaScene.data.teamAPowers;this.teamBSprites=hotr.arenaScene.data.teamB;this.teamBPowers=hotr.arenaScene.data.teamBPowers;this.step=hotr.blobOperations.getTutorialStep();if(1==this.level)if(1==this.step)this.showTutorialStep("Arg! Prepare to die, summoner!",
void 0,"right","orc"),this.setUp();else{if(14==this.step){this.setUp();this.placeEnemyTeam();var a=this.calculateScaleForSprites(this.teams.b);this.panToWorldPoint(a.mid,a.scale,jc.defaultTransitionTime,function(){this.showTutorialStep("Alright, there they are. Get ready to fight!",void 0,"left","girl");this.step=15}.bind(this))}}else 2==this.level?(this.showTutorialStep("This time you're going to pay!",void 0,"right","orc"),this.setUp()):3==this.level&&(this.showTutorialStep("We have come for the summoner. Your powers will serve our Dark Lord.",
void 0,"right","demon"),this.step=1,this.setUp())},runScenario0:function(){this.teamASprites.push("orge");this.teamASprites.push("orge");this.teamASprites.push("orge");this.teamASprites.push("orge");this.teamASprites.push("orge");this.teamASprites.push("blueKnight");this.teamASprites.push("blueKnight");this.teamASprites.push("orge");this.teamASprites.push("voidElf");this.teamASprites.push("forestElf");this.teamASprites.push("voidElf");this.teamASprites.push("forestElf");this.teamAFormation=jc.formations["4x4x4a"];
this.teamBSprites.push("elementalStone");this.teamBSprites.push("elementalStone");this.teamBSprites.push("elementalStone");this.teamBSprites.push("elementalStone");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBSprites.push("voidElf");this.teamBFormation=jc.formations["4x4x4b"];this.setUp()},initialSetupAction:function(a){this.startPos=
this.screenToWorld(a);a=cc.p(this.winSize.width/2,this.winSize.height/2);jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x?(1==this.placementTouches&&(jc.log(["Arena"],"placement a!"),this.placePlayerTeam("a")||(jc.log(["Arena"],"failed placement a!, placing b"),this.placePlayerTeam("b"))),2==this.placementTouches&&(jc.log(["Arena"],"pre placement b"),this.placePlayerTeam("b"),jc.log(["Arena"],"post placement b"),this.arrow&&this.removeChild(this.arrow,!0),jc.log(["Arena"],"post placement b")),
2==this.placementTouches||9>=this.teams.a.length?(hotr.blobOperations.saveBlob(),this.nextTouchAction=void 0,jc.log(["Arena"],"before final actions!"),this.finalActions()):(jc.log(["Arena"],"waiting for next touch!"),this.placementTouches++,this.nextTouchDo(this.initialSetupAction,!0))):(jc.log(["Arena"],"invalid location msg"),this.floatMsg("Click on the left side of the arena. You can't place troops there."))},finalActions:function(){function a(a){return void 0!=a}jc.log(["Arena"],"finalActions");
this.originalPositions={a:[].concat(this.teams.a),b:[].concat(this.teams.b)};jc.log(["Arena"],"filtering");this.teams.a=_.filter(this.teams.a,a);this.teams.b=_.filter(this.teams.b,a);jc.log(["Arena"],"sprites");this.sprites=this.teams.a.concat(this.teams.b);jc.log(["Arena"],"started");this.startedAt=Date.now();this.started=!0;jc.log(["Arena"],"schedule");this.schedule(function(a){jc.log(["Arena"],"updating...");this.doUpdate(0.1)},0.1)},placeEnemyTeam:function(a){this.startPos=a?a:cc.p(this.enemyStartPos.x,
this.enemyStartPos.y);this.placeTeamPosition(this.teams.b,this.squadNumbers);this.startPos.y-=800*jc.characterScaleFactor;this.placeTeamPosition(this.teams.b,this.teamSize)},placePlayerTeam:function(a){var b=0,b="a"==a?1:2,c=this.convertToItemPosition(this.startPos);hotr.blobOperations.setSquadLocations(a,this.startPos);jc.playEffectAtLocation("movement",c,jc.shadowZOrder,this);return this.placeTeamPosition(this.teams.a,b*this.squadNumbers)},placeTeamPosition:function(a,b){for(var c=!1,d=b-this.squadNumbers;d<
b;d++){var e=a[d];if(e){var c=!0,f=cc.p(this.startPos.x,this.startPos.y),g=d;d>this.squadNumbers&&(g-=this.squadNumbers);var k=g%4,n=Math.floor(g/4),g=200*jc.characterScaleFactor,p=-175*jc.characterScaleFactor;a[d].isFlippedX()&&(g*=-1);n*=p;f.x+=k*g;f.y+=n;f=this.convertToItemPosition(f);e.setBasePosition(f);e.ready(!0);jc.playEffectOnTarget("teleport",e,this)}}return c},getSquadMovePositions:function(a,b){for(var c=[],d=0,e=this.originalPositions.a,d="a"==a?this.squadNumbers:this.teamSize,f=d-this.squadNumbers;f<
d;f++)if(e[f]){var g=cc.p(b.x,b.y),k=f;f>this.squadNumbers&&(k-=this.squadNumbers);var n=-175*Math.floor(k/4)*jc.characterScaleFactor;g.x+=k%4*200*jc.characterScaleFactor;g.y+=n;c.push({member:e[f],pos:g})}return c},getSprite:function(a){a=jc.Sprite.spriteGenerator(spriteDefs,a,this);a.setState("idle");this.addChild(a.batch);this.addChild(a);a.setVisible(!1);a.layer=this;return a},setUp:function(){for(var a,b=0;b<this.teamASprites.length;b++)this.teamASprites[b]&&(a=this.getSprite(this.teamASprites[b].name),
a.healthBarColor=cc.c4f(26/255,245/255,15/255,1),a.homeTeam=this.getTeam.bind(this,"a"),a.enemyTeam=this.getTeam.bind(this,"b"),a.team="a",a.setVisible(!1),this.teams.a[b]=a,this.touchTargets.push(a));for(b=0;b<this.teamBSprites.length;b++)this.teamBSprites[b]&&(a=this.getSprite(this.teamBSprites[b].name),a.healthBarColor=cc.c4f(150/255,0,1,1),a.setFlippedX(!0),a.homeTeam=this.getTeam.bind(this,"b"),a.enemyTeam=this.getTeam.bind(this,"a"),a.team="b",a.setVisible(!1),this.teams.b[b]=a,this.touchTargets.push(a))},
fixOrder:function(a){},getTeam:function(a){return this.teams[a]},nextTouchDo:function(a,b){this.nextTouchAction=a;this.nextTouchAction.manualErase=b},placeSquadTokens:function(){this.squadBar=jc.makeSpriteWithPlist(uiPlist,uiPng,"squadsBackground.png");hotr.arenaScene.addChild(this.squadBar);this.squadBar.setPosition(this.squadBarClosePos);this.touchTargets.push(this.squadBar);this.squadA=jc.makeSpriteWithPlist(uiPlist,uiPng,"iconA.png");this.squadBar.addChild(this.squadA);this.squadA.setPosition(this.squadTilePosition);
this.touchTargets.push(this.squadA);this.squadB=jc.makeSpriteWithPlist(uiPlist,uiPng,"iconB.png");this.squadBar.addChild(this.squadB);this.squadB.setPosition(cc.p(this.squadTilePosition.x+this.squadTileSpacing,this.squadTilePosition.y));this.touchTargets.push(this.squadB);this.squadBarOpen=!1},placePowerTokens:function(){this.availablePowers={};this.powerBar=jc.makeSpriteWithPlist(uiPlist,uiPng,"powersBackground.png");hotr.arenaScene.addChild(this.powerBar);this.powerBar.setPosition(this.powerBarClosePos);
this.touchTargets.push(this.powerBar);3<this.teamAPowers.length&&(this.teamAPowers=this.teamAPowers.slice(0,2));for(var a=0;a<this.teamAPowers.length;a++){var b="power"+a;this[b]=jc.makeSpriteWithPlist(uiPlist,uiPng,"powerFrame.png");var c=this.teamAPowers[a];this.powerBar.addChild(this[b]);this[b].tile=jc.makeSpriteWithPlist(powerTiles[c].plist,powerTiles[c].png,powerTiles[c].icon);this[b].addChild(this[b].tile);this.scaleTo(this[b].tile,this[b]);this.centerThisChild(this[b].tile,this[b]);this[b].tile.setZOrder(this[b].getZOrder()-
1);this[b].setPosition(cc.p(this.powerTilePosition.x+this.powerTileSpacing*a,this.powerTilePosition.y));this.touchTargets.push(this[b]);this.availablePowers[b]=c}this.barOpen=!1},closeBar:function(){this.barOpen=!1;jc.log(["arena"],"Closing powerbar");this.setPowerBarFrameTouch();this.slide(this.powerBar,this.powerBarOpenPos,this.powerBarClosePos,jc.defaultTransitionTime,cc.p(jc.defaultNudge,0),"before",this.setPowerBarFrameNormal.bind(this))},openBar:function(){this.barOpen=!0;jc.log(["arena"],"opening powerbar");
this.setPowerBarFrameTouch();this.slide(this.powerBar,this.powerBarClosePos,this.powerBarOpenPos,jc.defaultTransitionTime,cc.p(-1*jc.defaultNudge,0),"after",this.setPowerBarFrameNormal.bind(this))},setPowerBarFrameTouch:function(){var a=cc.SpriteFrameCache.getInstance().getSpriteFrame("powersBackgroundPressed.png");this.powerBar.setDisplayFrame(a)},setPowerBarFrameNormal:function(){var a=cc.SpriteFrameCache.getInstance().getSpriteFrame("powersBackground.png");this.powerBar.setDisplayFrame(a)},setSquadBarTouched:function(){var a=
cc.SpriteFrameCache.getInstance().getSpriteFrame("squadsBackgroundPressed.png");this.squadBar.setDisplayFrame(a)},setSquadBarNormal:function(){var a=cc.SpriteFrameCache.getInstance().getSpriteFrame("squadsBackground.png");this.squadBar.setDisplayFrame(a)},setFrameTouched:function(a){var b=cc.SpriteFrameCache.getInstance().getSpriteFrame("powerFrameSelected.png");a.setDisplayFrame(b)},setFrameNormal:function(a){var b=cc.SpriteFrameCache.getInstance().getSpriteFrame("powerFrame.png");a.setDisplayFrame(b)},
closeSquadBar:function(){this.squadBarOpen=!1;this.setSquadBarTouched();this.slide(this.squadBar,this.squadBarOpenPos,this.squadBarClosePos,jc.defaultTransitionTime,cc.p(-1*jc.defaultNudge,0),"before",this.setSquadBarNormal.bind(this))},openSquadBar:function(){this.squadBarOpen=!0;this.setSquadBarTouched();this.slide(this.squadBar,this.squadBarClosePos,this.squadBarOpenPos,jc.defaultTransitionTime,cc.p(jc.defaultNudge,0),"after",this.setSquadBarNormal.bind(this))},update:function(a){for(var b=0;b<
this.sprites.length;b++)this.sprites[b].behavior.handleMove(a)},doUpdate:function(a){if(this.started&&(this.gameTime+=a,!this.checkWinner()&&(a=this.calculateScaleForSprites(this.sprites,!0,a),!this.scaleGate))){if(this.lastPan)b=cc.pSub(this.lastPan,a.mid);else{this.lastPan=a.mid;var b=cc.p(51,51)}if(50<Math.abs(b.x)||50<Math.abs(b.y))this.lastPan=a.mid,this.panToWorldPoint(a.mid,a.scale,jc.defaultTransitionTime,function(){this.scaleGate=!1}.bind(this))}},calculateScaleForSprites:function(a,b,c){for(var d=
this.worldSize.width,e=0,f=this.worldSize.height,g=0,k=0;k<a.length;k++)if(a[k].getParent()==this){var n=a[k].getBasePosition(),p=a[k].getTextureRect(),n=this.convertToWorldSpace(n),s=this.screenToWorld(n),n=s.x+p.width,t=s.x-p.width,r=s.y+1.5*p.height,p=s.y-p.height/2;b&&a[k].think(c);n>e&&(e=n);t<d&&(d=t);r>g&&(g=r);p<f&&(f=p)}a=cc.pMidpoint(cc.p(d,f),cc.p(e,g));d=this.getOkayScale(e-d,g-f);return{mid:a,scale:d}},setSpriteTargetLocation:function(a,b){if(b){var c=[],c=c.concat(this.getTeam("b")),
c=c.concat(this.getTeam("a"));(c=this.getBestSpriteForTouch(a,b,c))&&-1!=this.getTeam("b").indexOf(c)&&this.selectedSprite.behavior.canTarget(c)?doEnemyTouch.bind(this)(c):(c&&-1!=this.getTeam("a").indexOf(c)&&this.selectedSprite.behavior.canTarget(c),doGenericTouch.bind(this)())}else this.doGenericTouch.bind(this)()},doGenericTouch:function(a,b){this.nextTouchAction=void 0;a.behavior.followCommand(b)},doFriendTouch:function(a,b){jc.playEffectAtLocation("allySelection",b,jc.shadowZOrder,this);this.selectedSprite.removeChild(this.selectedSprite.effectAnimations.characterSelect.sprite,
!1);this.selectedSprite.effectAnimations.characterSelect.playing=!1;this.nextTouchAction=void 0;this.selectedSprite.behavior.supportCommand(a)},doEnemyTouch:function(a,b){jc.playEffectAtLocation("enemySelection",b,jc.shadowZOrder,this);this.selectedSprite.removeChild(this.selectedSprite.effectAnimations.characterSelect.sprite,!1);this.selectedSprite.effectAnimations.characterSelect.playing=!1;this.nextTouchAction=void 0;this.selectedSprite.behavior.attackCommand(a)},targetTouchHandler:function(a,
b,c){if(a==jc.touchEnded){if(3>=this.level&&!this.handleTutorialTouches(a,b,c))return;this.nextTouchAction?(this.nextTouchAction(b,c),this.nextTouchAction&&!this.nextTouchAction.manualErase&&(this.nextTouchAction=void 0)):c&&(this.checkPowerBar(c),this.checkSquadBar(c))}return!0},handleTutorialTouches:function(a,b,c){1==this.level?this.handleLevel1Tutorial(a,b,c):2==this.level?this.handleLevel2Tutorial(a,b,c):3==this.level&&this.handleLevel3Tutorial(a,b,c)},handleLevel3Tutorial:function(a,b,c){if(1==
this.step)this.showTutorialStep("Moloch? But your master was banished to The Rift a century ago - how...?",void 0,"left","girl"),this.step=2;else if(2==this.step)this.attachMsgTo("How is of little consequence, dear priestess. My master has returned and he will overtake this realm. Give us the Summoner and spare your pathetic lives for a short time.",this.guideCharacters.demon,"left"),this.step=3;else if(3==this.step)this.attachMsgTo("You cannot defeat us. RESISTANCE IS FUTILE!",this.guideCharacters.demon,
"left"),this.placeEnemyTeam(cc.p(this.worldSize.width/2+500*jc.assetScaleFactor,this.worldSize.height/2+100*jc.assetScaleFactor)),b=this.calculateScaleForSprites(this.teams.b),this.panToWorldPoint(b.mid,b.scale,jc.defaultTransitionTime,function(){this.step=4}.bind(this));else if(4==this.step)this.panToWorldPoint(this.worldMidPoint,this.getScaleFloor(),jc.defaultTransitionTime,function(){this.removeTutorialStep("demon","right",function(){this.attachMsgTo("Dragons? If the Dark One has returned and has raised an army within The Rift....",
this.guideCharacters.girl,"right")}.bind(this));this.step=4.5}.bind(this));else if(4.5==this.step)this.showTutorialStep("Priestess! The city is lost, you must flee! We will buy you what time we can. Take the summoner into the mountains. Commander Vandie, will meet you there to prepare for the coming war!",void 0,"right","dwarf"),this.step=4.6;else if(4.6==this.step)this.attachMsgTo("Your sacrifice won't be forgotten, brave soldier.",this.guideCharacters.girl,"right"),this.step=4.7;else if(4.7==this.step)this.attachMsgTo("It is as good day as any to die. Do not let it be in vain.",
this.guideCharacters.dwarf,"left"),this.step=5;else if(5==this.step)this.removeTutorialStep("girl","left"),this.removeTutorialStep("dwarf","right"),this.placeArrow(this.tutorialPoint1,"down"),this.step=6;else if(6==this.step){if(a=cc.p(this.winSize.width/2,this.winSize.height/2),this.startPos=this.screenToWorld(b),jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x&&(b=this.placePlayerTeam("a")))this.placeArrow(this.tutorialPoint2,"down"),this.step=7}else if(7==this.step){if(a=
cc.p(this.winSize.width/2,this.winSize.height/2),this.startPos=this.screenToWorld(b),jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x&&(b=this.placePlayerTeam("b")))this.removeArrow(),this.placePowerTokens(),this.finalActions(),this.step=8}else if(8==this.step)return!0},handleLevel2Tutorial:function(a,b,c){if(1==this.step)this.removeTutorialStep("orc","right",function(){this.placeEnemyTeam();var a=this.calculateScaleForSprites(this.teams.b);this.panToWorldPoint(a.mid,a.scale,
jc.defaultTransitionTime,function(){this.showTutorialStep("Don't worry, I've arranged for help! Let summon your troops.",void 0,"left","girl");this.step=2}.bind(this))}.bind(this));else if(2==this.step)this.removeTutorialStep("girl","left"),this.step=2.5,this.panToWorldPoint(this.worldMidPoint,this.getScaleFloor(),jc.defaultTransitionTime,function(){this.placeArrow(this.tutorialPoint1,"down");this.step=3}.bind(this));else if(3==this.step){if(a=cc.p(this.winSize.width/2,this.winSize.height/2),this.startPos=
this.screenToWorld(b),jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x&&(b=this.placePlayerTeam("a")))this.placeArrow(this.tutorialPoint2,"down"),this.step=4}else if(4==this.step){if(a=cc.p(this.winSize.width/2,this.winSize.height/2),this.startPos=this.screenToWorld(b),jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x&&(b=this.placePlayerTeam("b")))this.showTutorialStep("Hahahaha! You're massively out numbered!",void 0,"right","orc"),this.arrow&&this.removeChild(this.arrow,
!0),this.step=5}else 5==this.step?(this.placePowerTokens(),this.removeTutorialStep("orc","right"),this.showTutorialStep("I have a plan. Let's call in the cavalry. Open the powers tray below.",void 0,"right","girl"),this.step=5.5):5.5==this.step?(this.attachMsgTo("The power tray contains extra powers that can turn the tide of a battle to your favor.",this.guideCharacters.girl,"left"),this.step=6):6==this.step?(this.removeTutorialStep("girl","right"),this.placeArrow(this.tutorial2Point1,"left"),this.step=
7):7==this.step?(this.openBar(),this.placeArrow(this.tutorial2Point2,"down"),this.step=8):8==this.step?(this.doPower("power1",this.power1),this.placeArrow(this.tutorial2Point3,"down"),this.step=9):9==this.step?(this.removeArrow(),this.finalActions(),this.nextTouchAction(b,c),this.step=10):11==this.step&&(this.step=12,this.removeTutorialStep("girl","right"),this.showVictory())},handleLevel1Tutorial:function(a,b,c){if(1==this.step)this.step=1.5,this.removeTutorialStep("orc","right",function(){this.placeEnemyTeam();
var a=this.calculateScaleForSprites(this.teams.b);this.panToWorldPoint(a.mid,a.scale,jc.defaultTransitionTime,function(){this.showTutorialStep("Look, our enemies have summoned two goblins. You have to defeat them!",void 0,"left","girl");this.step=2}.bind(this))}.bind(this));else if(2==this.step)this.attachMsgTo("You'll need to summon your own monsters into battle. Let's pick them now",this.guideCharacters.girl,"right"),this.step=3;else if(3==this.step)this.removeTutorialStep("girl","left"),hotr.blobOperations.setTutorialStep(4),
hotr.mainScene.layer.selectEditTeamPre(),this.step=4;else if(15==this.step)this.panToWorldPoint(this.worldMidPoint,this.getScaleFloor(),jc.defaultTransitionTime,function(){this.attachMsgTo("Place your units on the arrows!",this.guideCharacters.girl,"right");this.step=16}.bind(this));else if(16==this.step)this.removeTutorialStep("girl","left"),this.placeArrow(this.tutorialPoint1,"down"),this.step=17;else if(17==this.step){if(a=cc.p(this.winSize.width/2,this.winSize.height/2),this.startPos=this.screenToWorld(b),
jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x&&(b=this.placePlayerTeam("a")))this.placeArrow(this.tutorialPoint2,"down"),this.step=18}else if(18==this.step){if(a=cc.p(this.winSize.width/2,this.winSize.height/2),this.startPos=this.screenToWorld(b),jc.insideEllipse(this.startPos,a)&&this.startPos.x<this.worldMidPoint.x&&(b=this.placePlayerTeam("b")))this.showTutorialStep("You dare challenge us? Now you die!",void 0,"right","orc"),this.arrow&&this.removeChild(this.arrow,!0),
this.step=19}else 19==this.step?(this.removeTutorialStep("orc","right"),this.finalActions()):20==this.step&&(this.removeTutorialStep("girl","left"),this.showVictory(),this.step=21)},checkSquadBar:function(a){for(var b=0;b<a.length;b++){if(a[b]==this.squadA){this.nextTouchDo(this.moveSquad.bind(this,"a"));return}if(a[b]==this.squadB){this.nextTouchDo(this.moveSquad.bind(this,"b"));return}}for(b=0;b<a.length;b++)a[b]==this.squadBar&&(this.squadBarOpen?this.closeSquadBar():this.openSquadBar())},moveSquad:function(a,
b){var c=this.screenToWorld(b),c=this.convertToItemPosition(c);jc.playEffectAtLocation("movement",c,jc.shadowZOrder,this);c=this.getSquadMovePositions(a,c);_.each(c,function(a){this.doGenericTouch(a.member,a.pos)}.bind(this))},checkPowerBar:function(a){jc.log(["arena"],"checkpower bar");for(var b in this.availablePowers)for(var c=0;c<a.length;c++)if(a[c]==this[b]){a[c].used?jc.log(["arena"],"touch - used"):(jc.log(["arena"],"touch - execute"),this.doPower(b,a[c]));return}for(c=0;c<a.length;c++)a[c]==
this.powerBar&&(this.barOpen?(jc.log(["arena"],"bar touch close"),this.closeBar()):(jc.log(["arena"],"bar touch open"),this.openBar()))},doPower:function(a,b){this.setFrameTouched(b);this.executeOffensivePower(this.availablePowers[a],b)},executeOffensivePower:function(a,b){if(this.started||!(2<this.level)){b.used=!0;var c=b.tile,d=powerTiles[a];if(!d)throw"unknown power: "+a;this.executed=Date.now();var e=globalPowers[d.offense].bind(this);if("direct"==d.type)hotr.arenaScene.layer.nextTouchDo(function(a,
d){var k=this.screenToWorld(a),k=this.convertToItemPosition(k);e(k,d);jc.log(["arena"],"fading out!");jc.shadow(b);jc.shadow(c);this.setFrameNormal(b)}.bind(this));else if("global"==d.type)e(),jc.shadow(b),jc.shadow(c),this.setFrameNormal(b);else throw"Unknown power type.";}},checkSpriteTouch:function(a){if(a=this.getBestSpriteForTouch(nodePos,a,this.getTeam("a")))jc.playEffectOnTarget("characterSelect",a,this,!0),this.selectedSprite=a,this.nextTouchAction=this.setSpriteTargetLocation.bind(this)},
getBestSpriteForTouch:function(a,b,c){for(var d,e=this.winSize.width,f=0;f<b.length;f++)if(b[f].getParent()==this&&-1!=c.indexOf(b[f])){var g=jc.getVectorTo(a,b[f].getPosition());g.distance<e&&(e=g.distance,d=b[f])}return d},checkWinner:function(){for(var a=!0,b=!0,c=0,d=0,e=this.getTeam("a"),f=this.getTeam("b"),g=0;g<e.length;g++)e[g].getParent()==this&&(a=!1),c++;for(g=0;g<f.length;g++)f[g].getParent()==this&&(b=!1),d++;if(b)return this.showVictory(),!0;if(a)return this.showDefeat(),!0;this.timeExpired()&&
(c>d&&this.showVictory(),d>c&&this.showDefeat(),d==c&&this.showDefeat())},showVictory:function(){this.started=!1;1==this.level&&19==this.step?(this.showTutorialStep("You did it! We're safe! But that won't be the last of them. Let's head back quickly.",void 0,"left","girl"),this.step=20):2==this.level&&10==this.step?(this.showTutorialStep("Nothing like a little artillery fire to even the odds. We're not through yet though. Let's head back.",void 0,"right","girl"),this.step=11):(hotr.arenaScene.data.op?
hotr.multiplayerOperations.victory(hotr.arenaScene.data.op,hotr.arenaScene.data):hotr.blobOperations.incrementLevel(),hotr.blobOperations.saveBlob(),this.victory=new Victory,this.victory.onDone=function(){this.removeChild(this.victory,!1);hotr.mainScene.layer.goToReturnPoint()}.bind(this),this.victory.init(),hotr.arenaScene.addChild(this.victory))},showDefeat:function(){this.started=!1;hotr.arenaScene.data.op&&hotr.multiplayerOperations.defeat(hotr.arenaScene.data.op,hotr.arenaScene.data);3==this.level&&
hotr.blobOperations.incrementLevel();hotr.blobOperations.saveBlob();this.defeat=new Defeat;this.defeat.onDone=function(){this.removeChild(this.defeat,!1);hotr.mainScene.layer.goToReturnPoint()}.bind(this);this.defeat.init();hotr.arenaScene.addChild(this.defeat)},timeExpired:function(){return this.gameTime>this.timeLimit?!0:!1}});ArenaGame.create=function(){var a=new ArenaGame;if(a&&a.init())return a;throw"Couldn't create the main layer of the game. Something is wrong.";};
ArenaGame.scene=function(){hotr.arenaScene&&(hotr.arenaScene.layer.release(),hotr.arenaScene.release());hotr.arenaScene=cc.Scene.create();hotr.arenaScene.retain();hotr.arenaScene.layer=ArenaGame.create();hotr.arenaScene.layer.retain();hotr.arenaScene.addChild(hotr.arenaScene.layer);return hotr.arenaScene};var Consts={idle:0,walk:1,attack:2,intro:2,dead:3,powerup:4},AnimationTest=jc.TouchLayer.extend({character:"shadowKnight",effect:"select",init:function(){if(this._super()){MainGame.scene();if(AnimationTest.loaded)this.go(),jc.playEffectOnTarget(this.effect,this.sprite,this,!1),this.bubbleAllTouches(!0);else{AnimationTest.loaded=!0;var a=[];this.character&&hotr.mainScene.layer.addAssetChain(a,this.character);this.effect&&(a.pushUnique(g_characterPlists[this.effect]),a.pushUnique(g_characterPngs[this.effect]));
this.missile&&(a.pushUnique(g_characterPlists[this.missile]),a.pushUnique(g_characterPngs[this.missile]));for(var b=0;b<a.length;b++)a[b]={src:a[b]};for(b=0;b<g_battleStuff.length;b++)a.push(g_battleStuff[b]);a={assets:a,nextScene:"animationTest"};b=new Loading;cc.Director.getInstance().getRunningScene().addChild(b);b.init(a)}return!0}return!1},go:function(){this.sprite&&(this.removeChild(this.sprite,!1),this.sprite.cleanUp&&this.sprite.cleanUp(),this.sprite=void 0);if(this.character)this.makeChar(this.character);
else if(this.effect)this.makeEffect(this.effect);else if(this.missile)this.makeMissile(this.missile);else throw"must set character, missile or effect";},makeChar:function(){this.sprite=jc.Sprite.spriteGenerator(spriteDefs,this.character,this);this.addChild(this.sprite);this.sprite.setBasePosition(cc.p(this.winSize.width/2,this.winSize.height/2));this.sprite.setState("idle")},makeIt:function(a,b){this.sprite=jc.makeSpriteWithPlist(b.plist,b.png,b.start);this.sprite.setPosition(cc.p(this.winSize.width/
2,this.winSize.height/2));this.sprite.setVisible(!0);this.addChild(this.sprite);var c=jc.makeAnimationFromRange(a,b);this.sprite.runAction(c)},makeEffect:function(){this.makeIt(this.effect,effectsConfig[this.effect])},makeMissile:function(){this.makeIt(this.missile,missileConfig[this.missile])},targetTouchHandler:function(a,b,c){this.go();return!0}});
AnimationTest.create=function(){var a=new AnimationTest;if(a&&a.init())return a;throw"Couldn't create the main layer of the game. Something is wrong.";};AnimationTest.scene=function(){var a=cc.Scene.create(),b=AnimationTest.create();a.addChild(b);jc.animationTest=b;return a};var Loading=jc.UiElementsLayer.extend({init:function(a){this.assets=a.assets;this.nextScene=a.nextScene;this.apiCalls=a.apiCalls;this.assetFunc=a.assetFunc;this.loaderAdjust=cc.p(-8*jc.assetScaleFactor,13*jc.assetScaleFactor);return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(loadingPlist),this.initFromConfig(this.windowConfig),this.start(),this.blackBox(jc.designSize),this.spinner.setVisible(!1),!0):!1},inTransitionsComplete:function(){this.animationDone=!0;this.spinner.setVisible(!0);
var a=this.spinner.getPosition(),a=cc.pAdd(this.loaderAdjust,a);this.spinner.setPosition(a);this.startLoading()},startLoading:function(){this.totalItemsCompleted=this.totalItemsToLoad=0;this.assets?this.totalItemsToLoad+=this.assets.length:this.assetFunc&&this.totalItemsToLoad++;this.apiCalls&&(this.totalItemsToLoad+=this.apiCalls.length);this.assetFunc?this.assetFunc(function(a){this.totalItemsCompleted++;this.assets=this.assets?this.assets.concat(a):a;this.totalItemsToLoad+=a.length;this.startLoadingAssets()}.bind(this)):
this.startLoadingAssets();this.apiCalls&&this.startLoadingApiCalls();this.schedule(this.checkPercent)},startLoadingAssets:function(){this.assets?cc.Loader.preload(this.assets,function(){this.ccLoaderDone=!0}.bind(this)):this.ccLoaderDone=!0},startLoadingApiCalls:function(){for(var a=async.queue(function(a,b){a.action(b)}.bind(this),2),b=0;b<this.apiCalls.length;b++)a.push({name:b,action:this.apiCalls[b]},function(a){this.totalItemsCompleted++}.bind(this));a.drain=function(){jc.log(["loader"],"apiCalls done")}.bind(this)},
raiseComplete:function(){this.unschedule(this.checkPercent);this.scheduleOnce(function(){hotr.changeScene(this.nextScene)},1)},getPercentage:function(){return 100},checkPercent:function(){if(this.animationDone){var a;a=jc.isBrowser?cc.Loader.getInstance().getPercentage:this.getPercentage;var b=0,b=0;this.assets?(!0==this.ccLoaderDone?b=100:(b=a(),100<b&&(b=100)),b=b*this.assets.length/100):b=0;a=b+this.totalItemsCompleted;b=Math.floor(21*Math.floor(a/this.totalItemsToLoad*100)/100);1>b&&(b=1);21<
b&&(b=21);b=cc.SpriteFrameCache.getInstance().getSpriteFrame("loader."+b+".png");this.spinner.setDisplayFrame(b);a>=this.totalItemsToLoad&&(b=cc.SpriteFrameCache.getInstance().getSpriteFrame("loader.21.png"),this.spinner.setDisplayFrame(b),this.scheduleOnce(this.raiseComplete.bind(this)))}},windowConfig:{leftDoor:{type:"sprite",transitionIn:"leftToMid",transitionOut:"left",sprite:"leftDoor.png",z:0,pos:{x:509.5,y:768}},rightDoor:{type:"sprite",transitionIn:"rightToMid",transitionOut:"right",sprite:"rightDoor.png",
z:0,pos:{x:1533.500000000001,y:768}},spinner:{type:"sprite",sprite:"loader.1.png",z:1}}});var MapLayer=jc.UiElementsLayer.extend({init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),cc.SpriteFrameCache.getInstance().addSpriteFrames(touchUiPlist),this.initFromConfig(this.windowConfig),this.bubbleAllTouches(!0),jc.log(["map"],"init"),this.tutorialStep1=cc.p(500*jc.assetScaleFactor,500*jc.assetScaleFactor),this.tutorialStep2=cc.p(800*jc.assetScaleFactor,500*jc.assetScaleFactor),this.tutorialStep3=cc.p(400*jc.assetScaleFactor,600*jc.assetScaleFactor),
this.start(),!0):!1},onShow:function(){this.allowOnce=!1;jc.log(["map"],"show");this.level=hotr.blobOperations.getTutorialLevel();jc.log(["map"],"level:"+this.level);0==this.level&&(hotr.blobOperations.incrementLevel(),this.level=1);1==this.level&&(jc.log(["map"],"ftue"),hotr.blobOperations.setTutorialStep(1),this.scheduleOnce(function(){this.showTutorialStep("Summoner, we've been waiting for you. I am honored. We have not had one such as yourself in Old Vallation for many years. But, it seems a raiding party approaches. Our greeting need be short. ",
void 0,"left","girl")}.bind(this)),this.step=1);2==this.level&&(jc.log(["map"],"ftue2"),hotr.blobOperations.setTutorialStep(1),this.scheduleOnce(function(){this.showTutorialStep("There's more! We need to fight again.",void 0,"left","girl")}.bind(this)),this.step=1);3==this.level&&(jc.log(["map"],"ftue3"),hotr.blobOperations.setTutorialStep(1),this.scheduleOnce(function(){this.showTutorialStep("Wait, something is wrong. There's a strange power amassing outside the city gates. We need to hurry.",void 0,
"left","girl")}.bind(this)),this.step=1);4==this.level&&(jc.log(["map"],"ftue3"),hotr.blobOperations.setTutorialStep(1),this.scheduleOnce(function(){this.showTutorialStep("The great city of Old Vallation...destroyed. Hundreds of lives sacrificed...But there is no time to dwell on those lost.",void 0,"left","girl")}.bind(this)),this.step=1)},targetTouchHandler:function(a,b,c){jc.log(["map"],"touch:"+a);a==jc.touchEnded&&(1==this.level?this.level1Tutorial():2==this.level?this.level2Tutorial():3==this.level?
this.level3Tutorial():4==this.level?this.level4Tutorial():hotr.mainScene.layer.selectEditTeamPre());return!0},level4Tutorial:function(){1==this.step?(this.attachMsgTo("Your coming is omen then. Only a summoner can bring forth the creatures of The Rift. With your help we must raise an army to defeat the Dark One.",this.guideCharacters.girl,"right"),this.step=2):2==this.step?(this.attachMsgTo("We will need to build your strength. The Rift stones you've collected will allow us to summon minions to your cause.",
this.guideCharacters.girl,"right"),this.step=3):3==this.step&&(this.attachMsgTo("To be continued.....",this.guideCharacters.girl,"right"),hotr.playerBlob.questLevel=1,hotr.blobOperations.saveBlob())},level3Tutorial:function(){1==this.step?(this.removeTutorialStep("girl","left"),this.placeArrow(this.tutorialStep2,"down"),this.step=2):2!=this.step||this.allowOnce||(this.allowOnce=!0,jc.log(["map"],"going to team"),this.removeChild(this.arrow,!0),hotr.mainScene.layer.arenaPre())},level2Tutorial:function(){1==
this.step?(this.showTutorialStep("Do you think because you killed some puny goblins that we would run away scared? You wil die, summoner.",void 0,"right","orc"),this.step=2):2==this.step?this.removeTutorialStep("orc","right",function(){this.attachMsgTo("Hmm, these fiends are much more aggressive than usual... No matter, let us drive them off.",this.guideCharacters.girl,"right");this.step=3}.bind(this)):3==this.step?(this.removeTutorialStep("girl","left"),this.placeArrow(this.tutorialStep2,"down"),
this.step=4):4!=this.step||this.allowOnce||(this.allowOnce=!0,jc.log(["map"],"going to team"),this.removeChild(this.arrow,!0),hotr.mainScene.layer.arenaPre())},level1Tutorial:function(){1==this.step?(this.showTutorialStep("Our master wants your head, summoner. Come with us and we'll spare the city.",void 0,"right","orc"),this.step=2):2==this.step?this.removeTutorialStep("orc","right",function(){this.attachMsgTo("Orc bravado. Pathetic. Click the map to head them off at the old arena!",this.guideCharacters.girl,
"right");this.step=3}.bind(this)):3==this.step?(this.removeTutorialStep("girl","left"),this.placeArrow(this.tutorialStep1,"down"),this.step=4):4==this.step&&(jc.log(["map"],"touch ended"),this.allowOnce||(this.allowOnce=!0,jc.log(["map"],"going to team"),this.removeChild(this.arrow,!0),hotr.mainScene.layer.arenaPre()))},windowConfig:{mainFrame:{applyAdjustments:!0,type:"sprite",sprite:"map.png",z:1,pos:{x:1019,y:767}}}});
MapLayer.scene=function(){hotr.mapScene||(hotr.mapScene=cc.Scene.create(),hotr.mapScene.retain(),hotr.mapScene.layer=new MapLayer,hotr.mapScene.addChild(hotr.mapScene.layer),hotr.mapScene.layer.init());return hotr.mapScene};Array.prototype.pushUnique=function(a){if(!a)throw"Attempting to load undefined value.";-1==this.indexOf(a)&&this.push(a)};
var MainGame=cc.Layer.extend({state:0,signThis:"yoyoyoyoyosignthissonsignitsignitsignit",init:function(){return this._super()?!0:!1},goToReturnPoint:function(){this.returnPoint?this.returnPoint():(jc.log(["console"],"return point not defined, going to landing"),this.changeScene("landing"))},changeScene:function(a,b,c){this.loader&&cc.Director.getInstance().getRunningScene().removeChild(this.loader,!0);this.lastScene=this.lastScene?this.currentScene:a;switch(a){case "selectEditTeamPre":this.selectEditTeamPre();
break;case "selectTeam":cc.Director.getInstance().replaceScene(SelectTeam.scene());break;case "editTeam":cc.Director.getInstance().replaceScene(EditTeam.scene());break;case "arena":cc.Director.getInstance().replaceScene(hotr.arenaScene);break;case "landing":cc.Director.getInstance().replaceScene(Landing.scene());break;case "animationTest":cc.Director.getInstance().replaceScene(AnimationTest.scene());break;case "multiplayer":cc.Director.getInstance().replaceScene(Multiplayer.scene());break;case "map":cc.Director.getInstance().replaceScene(MapLayer.scene())}this.currentScene=
a},showLoader:function(a){this.loader=new Loading;cc.Director.getInstance().getRunningScene().addChild(this.loader);this.loader.init(a)},selectEditTeamPre:function(){var a=this.makeCardDictionary(),a=a.concat(g_ui);this.showLoader({assets:a,nextScene:"selectTeam"})},map:function(){for(var a=[],b=0;b<g_battleStuff.length;b++)a.pushUnique(g_battleStuff[b]);a=a.concat(g_ui);this.showLoader({assets:a,nextScene:"map"})},arenaPre:function(){hotr.newOpponent?this.arenaMP():this.arenaQuest()},mpGetGames:function(){var a=
[],a=a.concat(g_ui);this.showLoader({assets:a,apiCalls:[function(a){hotr.multiplayerOperations.getGames(function(){a()})}],nextScene:"multiplayer"})},mpTakeTurn:function(){this.returnPoint=this.mpGetGames.bind(this);var a=this.makeCardDictionary(),a=a.concat(g_ui);this.showLoader({assets:a,nextScene:"selectTeam"})},mpStartGame:function(){this.returnPoint=this.mpGetGames.bind(this);var a=this.makeCardDictionary(),a=a.concat(g_ui);this.showLoader({assets:a,apiCalls:[function(a){hotr.multiplayerOperations.findGame(function(c){c?
a():this.mpGetGames()}.bind(this))}.bind(this)],nextScene:"selectTeam"})},arenaMP:function(){ArenaGame.scene();var a=hotr.blobOperations.getTeam();hotr.blobOperations.getLevel();var b=hotr.blobOperations.getFormation(),c=hotr.blobOperations.getPowers();this.showLoader({assetFunc:function(d){hotr.multiplayerOperations.getTeam(hotr.newOpponent,function(e,f){if(e)hotr.changeScene("landing");else{var g={op:hotr.newOpponent,teamA:a,teamAFormation:b,teamB:f.team,teamBFormation:f.formation,teamAPowers:c,
teamBPowers:[],offense:"a"},k=this.makeAssetDictionary(g.teamA,g.teamB,g.teamAPowers,g.teamBPowers);hotr.arenaScene.data=g;d(k)}}.bind(this))}.bind(this),apiCalls:[function(a){hotr.blobOperations.saveBlob(function(){a()})}],nextScene:"arena"})},arenaQuest:function(){ArenaGame.scene();this.returnPoint=this.map.bind(this);var a=hotr.blobOperations.getTeam(),b=hotr.blobOperations.getLevel(),c=hotr.blobOperations.getFormation(),d=hotr.blobOperations.getPowers();if(3==b)for(var e=0,f=0;18>f;f++)void 0==
a[f]&&(0==e?(a[f]={name:"dwarvenKnightEarth"},e++):1==e?(a[f]={name:"dwarvenKnightFire"},e++):2==e?(a[f]={name:"dwarvenKnightLife"},e++):3==e&&(a[f]={name:"elfEarth"},e=0));e=hotr.levelLogic.getTeamForLevel(b);b=hotr.levelLogic.getFormationForLevel(b);f=hotr.levelLogic.getPowers();this.doArena({teamA:a,teamAFormation:c,teamB:e,teamBFormation:b,teamAPowers:d,teamBPowers:f,offense:"a"})},arenaReplay:function(a){ArenaGame.scene();a={type:"replay",teamA:a.teamB,teamAFormation:"4x4x4a",teamB:a.teamA,teamBFormation:"4x4x4b",
teamAPowers:[],teamBPowers:[],offense:"a"};var b=this.makeAssetDictionary(a.teamA,a.teamB,a.teamAPowers,a.teamBPowers);hotr.arenaScene.data=a;this.showLoader({assets:b,nextScene:"arena"})},doArena:function(a){hotr.arenaScene.data=a;a=this.makeAssetDictionary(a.teamA,a.teamB,a.teamAPowers,a.teamBPowers);this.showLoader({assets:a,apiCalls:[function(a){hotr.blobOperations.saveBlob(function(){a()})}],nextScene:"arena"})},onEnter:function(){jc.log(["mainLayer"],"main starting");this.startGame()},doArenaDev:function(){ArenaGame.scene();
var a={teamA:[{name:"dragonRed"}],teamAFormation:"4x4x4a",teamB:[{name:"orge"}],teamBFormation:"4x4x4b",teamAPowers:[],teamBPowers:[],offense:"a"};hotr.arenaScene.data=a;a=this.makeAssetDictionary(a.teamA,a.teamB,a.teamAPowers,a.teamBPowers);this.showLoader({assets:a,nextScene:"arena"})},startGame:function(){var a=hotr.blobOperations.hasPlayed();hotr.blobOperations.hasToken()?(jc.log(["mainLayer"],"hasToken"),this.initGame()):a?(jc.log(["mainLayer"],"hasPlayed"),this.authorizeAndInitGame()):(jc.log(["mainLayer"],
"newPlayer"),this.authorizeNewPlayer())},authorizeNewPlayer:function(){jc.log(["mainLayer"],"authorizeNewPlayer");hotr.blobOperations.createNewPlayer(function(){this.startingScene()}.bind(this))},authorizeAndInitGame:function(){hotr.blobOperations.getNewAuthTokenAndBlob(function(){this.startingScene()}.bind(this))},initGame:function(){hotr.blobOperations.getBlob(function(a){a?this.startingScene():this.authorizeNewPlayer()}.bind(this))},startingScene:function(){this.changeScene("landing")},makeCardDictionary:function(){var a=
hotr.blobOperations.getCharacterNames(),b=[];_.map(a,function(a){a=this.getCardAssets(a);b.pushUnique(a.cardPng);b.pushUnique(a.cardPlist)}.bind(this));for(a=0;a<b.length;a++)b[a]={src:b[a]};return b},getCardAssets:function(a){a=spriteDefs[a].cardIndex;void 0==a&&(a=0);return{cardPng:cardsPngs[a],cardPlist:cardsPlists[a]}},makeAssetDictionary:function(a,b,c,d){d=[];for(var e=0;e<a.length;e++)if(a[e]){var f=a[e].name;this.addAssetChain(d,f)}for(e=0;e<b.length;e++)b[e]&&(f=b[e].name,this.addAssetChain(d,
f));for(e=0;e<c.length;e++)f=c[e],this.addPowerAssets(d,f);for(e=0;e<c.length;e++)f=c[e],this.addPowerAssets(d,f);d.pushUnique(g_characterPlists.greenbullet);d.pushUnique(g_characterPngs.greenbullet);d.pushUnique(g_characterPlists.greenBang);d.pushUnique(g_characterPngs.greenBang);for(e=0;e<d.length;e++)d[e]={src:d[e]};for(e=0;e<g_battleStuff.length;e++)d.pushUnique(g_battleStuff[e]);return d},addPowerAssets:function(a,b){var c=powerAnimationsRequired[b];if(c)for(var d=0;d<c.length;d++)a.pushUnique(g_characterPlists[c[d]]),
a.pushUnique(g_characterPngs[c[d]])},addAnimationChain:function(a,b){for(var c=0;c<a.length;c++)b.pushUnique(g_characterPlists[a[c]]),b.pushUnique(g_characterPngs[a[c]])},addAssetChain:function(a,b){a.pushUnique(g_characterPlists[b]);a.pushUnique(g_characterPngs[b]);spriteDefs[b].effect&&(a.pushUnique(g_characterPlists[spriteDefs[b].effect]),a.pushUnique(g_characterPngs[spriteDefs[b].effect]));if(spriteDefs[b].gameProperties&&spriteDefs[b].gameProperties.missile){g_characterPlists[spriteDefs[b].gameProperties.missile]&&
a.pushUnique(g_characterPlists[spriteDefs[b].gameProperties.missile]);a.pushUnique(g_characterPngs[spriteDefs[b].gameProperties.missile]);var c=missileConfig[spriteDefs[b].gameProperties.missile];c.effect&&(a.pushUnique(g_characterPlists[c.effect]),a.pushUnique(g_characterPngs[c.effect]))}if(spriteDefs[b].powers){var c=spriteDefs[b].powers,d;for(d in c){var e=powerAnimationsRequired[d];this.addAnimationChain(e,a)}}if(spriteDefs[b].damageMods)for(d in c=spriteDefs[b].damageMods,c)e=powerAnimationsRequired[d],
this.addAnimationChain(e,a);spriteDefs[b].gameProperties.heal&&(e=powerAnimationsRequired.heal,this.addAnimationChain(e,a));if(spriteDefs[b].deathMods)for(d in c=spriteDefs[b].deathMods,c){e=powerAnimationsRequired[d];this.addAnimationChain(e,a);for(var f in c[d])(e=powerAnimationsRequired[f])&&this.addAnimationChain(e,a)}}}),hotr=hotr||{};MainGame.create=function(){var a=new MainGame;if(a&&a.init())return a;throw"Couldn't create the main layer of the game. Something is wrong.";};
MainGame.scene=function(){hotr.mainScene||(hotr.mainScene=cc.Scene.create(),hotr.mainScene.layer=MainGame.create(),hotr.mainScene.layer.retain(),hotr.mainScene.addChild(hotr.mainScene.layer));hotr.changeScene=hotr.mainScene.layer.changeScene.bind(hotr.mainScene.layer);return hotr.mainScene};var PowerHud=jc.UiElementsLayer.extend({tiles:3,init:function(a){this.name="powerHud";this.myTiles=[];return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(powerTilesPlist),this.initFromConfig(this.windowConfig),this.powerBarOpenPos=cc.p(413*jc.assetScaleFactor,287*jc.assetScaleFactor),this.powerBarClosePos=cc.p(-305*jc.assetScaleFactor,287*jc.assetScaleFactor),this.powers=a,!0):!1},setSelected:function(a){for(var b=0;b<this.tiles;b++)this["tile"+b]!=a&&this["tile"+b].setUnselected();
a.setSelected()},scheduleThisOnce:function(a,b){this.scheduleOnce(a,b)},targetTouchHandler:function(a,b,c){return!1},onShow:function(){for(var a=this.tiles>this.powers.length?this.powers.length:this.tiles,b=0;b<a;b++){var c="tile"+b;this[c].initFromName(this.powers[b],this);this.myTiles.push(this[c])}},windowConfig:{powerBar:{type:"sprite",sprite:"powersBackground.png",kids:{tiles:{isGroup:!0,type:"line",members:[{type:"tile",name:"tile0",sprite:"powerFrame.png"},{type:"tile",name:"tile1",sprite:"powerFrame.png"},
{type:"tile",name:"tile2",sprite:"powerFrame.png"}],sprite:"powerFrame.png",z:0,pos:{x:159,y:99}}},z:0,pos:{x:413,y:287}}}});var Multiplayer=jc.UiElementsLayer.extend({deck:[],cards:{},touchTargets:[],cellWidth:140,cells:20,cardLayer:void 0,playMap:{},cellPrefix:"gridCells",init:function(){return this._super()?(cc.SpriteFrameCache.getInstance().addSpriteFrames(uiPlist),this.initFromConfig(this.windowConfig),this.tableView=new jc.ScrollingLayer,this.items=[],!0):!1},onShow:function(){this.start();this.addChild(this.tableView);var a=this.getGames();!this.tableInit&&0<a.length&&(this.tableInit=!0,this.tableView.init({isVertical:!0,
sprites:a,cellHeight:2*a[0].getContentSize().height,selectionCallback:this.selectionCallback.bind(this),height:this.winSize.height}),a=cc.p(this.itemWindow.pos.x,this.itemWindow.pos.y),a.x*=jc.assetCategoryData.scale,a.y*=jc.assetCategoryData.scale,this.tableView.setPosition(a),this.reorderChild(this.tableView,3),this.tableView.hackOn(),this.tableView.setIndex(0))},selectionCallback:function(){console.log("Touch")},getGames:function(){var a=[],b=hotr.multiplayerData;if(!b)return a;var c=hotr.blobOperations.getCreds();
this.replayData={};for(var d in b){var e=b[d],f=this.getWindowFromConfig(this.itemWindow);f.lblWins.setText(e[c.id].wins);f.lblLosses.setText(e[d].wins);this.replayData[d]=e.lastMatchData;e[d].name?f.lblName.setText(e[d].name):f.lblName.setText("Anonymous");e.turn==c.id?(f.pokeButton.setVisible(!1),f.fightButton.setVisible(!0),f.replayButton.setVisible(!0)):(f.pokeButton.setVisible(!0),f.fightButton.setVisible(!1),f.replayButton.setVisible(!1));f.pokeButton.setData(d);f.fightButton.setData(d);f.closeButton.setData(d);
f.replayButton.setData(d);a.push(f)}return a},targetTouchHandler:function(a,b,c){},back:function(){hotr.changeScene("landing")},fb:function(){},gameCenter:function(){},store:function(){},tweet:function(){},poke:function(a){},fight:function(a){hotr.newOpponent=a;hotr.mainScene.layer.mpTakeTurn()},replay:function(a){hotr.mainScene.layer.arenaReplay(this.replayData[a])},countGames:function(){var a=0,b;for(b in hotr.multiplayerData)a++;return a},startGame:function(){25>this.countGames()&&hotr.mainScene.layer.mpStartGame()},
msg:function(){},close:function(a){},windowConfig:{mainFrame:{type:"sprite",transitionIn:"top",transitionOut:"top",applyAdjustments:!0,sprite:"genericBackground.png",z:1,kids:{backButton:{type:"button",main:"backButton.png",pressed:"backButtonPressed.png",touchDelegateName:"back",z:2,pos:{x:177,y:810}},facebookButton:{type:"button",main:"facebookButton.png",pressed:"facebookButtonPressed.png",touchDelegateName:"fb",z:2,pos:{x:165,y:624}},gameCenterButton:{type:"button",main:"gameCenterButton.png",
pressed:"gameCenterPressed.png",touchDelegateName:"gameCenter",z:2,pos:{x:163,y:443}},storeButton:{type:"button",main:"mpstoreButton.png",pressed:"mpstoreButtonPressed.png",touchDelegateName:"store",z:2,pos:{x:342,y:807}},twitterButton:{type:"button",main:"tweeterButton.png",pressed:"tweeterButtonPressed.png",touchDelegateName:"tweet",z:2,pos:{x:348,y:624}},startButton:{type:"button",main:"startButton.png",pressed:"startButtonPressed.png",touchDelegateName:"startGame",z:2,pos:{x:255,y:993}},messageButton:{type:"button",
main:"messageButton.png",pressed:"messageButtonPressed.png",touchDelegateName:"msg",z:2,pos:{x:348,y:447}}},pos:{x:1024,y:778}}},itemWindow:{type:"sprite",sprite:"itemWindow.png",z:4,pos:{x:1201,y:1149},kids:{pokeButton:{type:"button",main:"pokeButton.png",pressed:"pokeButtonPressed.png",touchDelegateName:"poke",z:3,pos:{x:1147,y:123}},fightButton:{type:"button",main:"buttonFight.png",pressed:"buttonFightPressed.png",touchDelegateName:"fight",z:3,pos:{x:1147,y:183}},replayButton:{type:"button",main:"buttonFight.png",
pressed:"buttonFightPressed.png",touchDelegateName:"replay",z:3,pos:{x:1147,y:53}},itemFrame:{type:"sprite",sprite:"imageFrame.png",z:3,pos:{x:135,y:123}},closeButton:{type:"button",main:"closeButton.png",pressed:"closeButtonPressed.png",touchDelegateName:"close",z:3,pos:{x:1387,y:111}},lblName:{type:"label",text:"NAME - NAME - NAME",width:1E3,height:80,alignment:0,fontSize:50,fontName:jc.mainFont,z:3,pos:{x:775,y:159}},lblWins:{type:"label",text:"WINS",width:80,height:80,alignment:0,fontSize:40,
fontName:jc.mainFont,z:3,pos:{x:456,y:12}},lblLosses:{type:"label",text:"HEALTH",width:80,height:80,alignment:0,fontSize:40,fontName:jc.mainFont,z:3,pos:{x:745,y:12}}}}});
Multiplayer.scene=function(){hotr.multiplayer&&(hotr.multiplayer.removeChild(hotr.multiplayer.layer),hotr.multiplayer.layer.release(),hotr.multiplayer.layer=null,hotr.multiplayer.release(),hotr.multiplayer=null);hotr.multiplayer=cc.Scene.create();hotr.multiplayer.layer=new Multiplayer;hotr.multiplayer.addChild(hotr.multiplayer.layer);hotr.multiplayer.layer.init();return hotr.multiplayer};
//@ sourceMappingURL=sourcemap